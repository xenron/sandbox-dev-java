<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><title xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory">RESTEasy JAX-RS</title><link rel="stylesheet" href="css/jbossorg.css" type="text/css"/><meta xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" name="generator" content="DocBook XSL-NS Stylesheets V1.74.0"/><meta xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" http-equiv="Content-Type" content="text/html; charset=UTF-8"/></head><body><div class="book" lang="en-US"><div class="titlepage"><div><p xmlns:d="http://docbook.org/ns/docbook" id="title"><a href="http://www.jboss.org" class="site_href"><strong>JBoss.org</strong></a><a href="http://docs.jboss.org/" class="doc_href"><strong>Community Documentation</strong></a></p><div><h1 class="title"><a id="d4e1"/>RESTEasy JAX-RS</h1></div><div><h2 class="subtitle">RESTFul Web Services for Java</h2></div><div><p class="releaseinfo">3.0.5.Final</p></div></div><hr/></div><div class="toc"><dl><dt><span class="preface"><a href="#preface">Preface</a></span></dt><dt><span class="chapter"><a href="#Overview">1. Overview</a></span></dt><dt><span class="chapter"><a href="#license">2. License</a></span></dt><dt><span class="chapter"><a href="#Installation_Configuration">3. Installation/Configuration</a></span></dt><dd><dl><dt><span class="section"><a href="#upgrading-as7">3.1. Upgrading Resteasy Within JBoss AS 7</a></span></dt><dt><span class="section"><a href="#upgrading-eap61">3.2. Upgrading Resteasy Within JBoss EAP 6.1</a></span></dt><dt><span class="section"><a href="#upgrading-wildfly">3.3. Upgrading Resteasy Within Wildfly</a></span></dt><dt><span class="section"><a href="#d4e40">3.4. Configuring in JBoss AS 7, EAP, and Wildfly</a></span></dt><dd><dl><dt><span class="section"><a href="#d4e48">3.4.1. Resteasy Modules in AS7, EAP6.1, Wildfly</a></span></dt></dl></dd><dt><span class="section"><a href="#d4e111">3.5. Standalone Resteasy in Servlet 3.0 Containers</a></span></dt><dt><span class="section"><a href="#d4e118">3.6. Standalone Resteasy in Older Servlet Containers</a></span></dt><dt><span class="section"><a href="#d4e125">3.7. Configuration Switches</a></span></dt><dt><span class="section"><a href="#javax.ws.rs.core.Application">3.8. javax.ws.rs.core.Application</a></span></dt><dt><span class="section"><a href="#listener">3.9. RESTEasy as a ServletContextListener</a></span></dt><dt><span class="section"><a href="#filter">3.10. RESTEasy as a servlet Filter</a></span></dt><dt><span class="section"><a href="#RESTEasyLogging">3.11. RESTEasyLogging</a></span></dt></dl></dd><dt><span class="chapter"><a href="#Using_Path">4. Using @Path and @GET, @POST, etc.</a></span></dt><dd><dl><dt><span class="sect1"><a href="#_Path_and_regular_expression_mappings">4.1. @Path and regular expression mappings</a></span></dt></dl></dd><dt><span class="chapter"><a href="#_PathParam">5. @PathParam</a></span></dt><dd><dl><dt><span class="sect1"><a href="#Advanced__PathParam_and_Regular_Expressions">5.1. Advanced @PathParam and Regular Expressions</a></span></dt><dt><span class="sect1"><a href="#_PathParam_and_PathSegment">5.2. @PathParam and PathSegment</a></span></dt></dl></dd><dt><span class="chapter"><a href="#_QueryParam">6. @QueryParam</a></span></dt><dt><span class="chapter"><a href="#_HeaderParam">7. @HeaderParam</a></span></dt><dt><span class="chapter"><a href="#LinkHeader">8. Linking resources</a></span></dt><dd><dl><dt><span class="section"><a href="#d4e384">8.1. Link Headers</a></span></dt><dt><span class="section"><a href="#d4e389">8.2. Atom links in the resource representations</a></span></dt><dd><dl><dt><span class="section"><a href="#d4e396">8.2.1. Configuration</a></span></dt><dt><span class="section"><a href="#d4e411">8.2.2. Your first links injected</a></span></dt><dt><span class="section"><a href="#d4e432">8.2.3. Customising how the Atom links are serialised</a></span></dt><dt><span class="section"><a href="#d4e438">8.2.4. Specifying which JAX-RS methods are tied to which resources</a></span></dt><dt><span class="section"><a href="#d4e503">8.2.5. Specifying path parameter values for URI templates</a></span></dt><dt><span class="section"><a href="#d4e577">8.2.6. Securing entities</a></span></dt><dt><span class="section"><a href="#d4e602">8.2.7. Extending the UEL context</a></span></dt><dt><span class="section"><a href="#d4e618">8.2.8. Resource facades</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#_MatrixParam">9. @MatrixParam</a></span></dt><dt><span class="chapter"><a href="#_CookieParam">10. @CookieParam</a></span></dt><dt><span class="chapter"><a href="#_FormParam">11. @FormParam</a></span></dt><dt><span class="chapter"><a href="#_Form">12. @Form</a></span></dt><dt><span class="chapter"><a href="#_DefaultValue">13. @DefaultValue</a></span></dt><dt><span class="chapter"><a href="#_Encoded_and_encoding">14. @Encoded and encoding</a></span></dt><dt><span class="chapter"><a href="#_Context">15. @Context</a></span></dt><dt><span class="chapter"><a href="#JAX-RS_Resource_Locators_and_Sub_Resources">16. JAX-RS Resource Locators and Sub Resources</a></span></dt><dt><span class="chapter"><a href="#JAX-RS_Content_Negotiation">17. JAX-RS Content Negotiation</a></span></dt><dd><dl><dt><span class="sect1"><a href="#media_mappings">17.1. URL-based negotiation</a></span></dt><dt><span class="sect1"><a href="#param_media_mappings">17.2. Query String Parameter-based negotiation</a></span></dt></dl></dd><dt><span class="chapter"><a href="#Content_Marshalling_Providers">18. Content Marshalling/Providers</a></span></dt><dd><dl><dt><span class="sect1"><a href="#Default_Providers_and_default_JAX-RS_Content_Marshalling">18.1. Default Providers and default JAX-RS Content Marshalling</a></span></dt><dt><span class="sect1"><a href="#Content_Marshalling_with__Provider_classes">18.2. Content Marshalling with @Provider classes</a></span></dt><dt><span class="sect1"><a href="#MessageBodyWorkers">18.3. Providers Utility Class</a></span></dt><dt><span class="sect1"><a href="#Configuring_Document_Marshalling">18.4. Configuring Document Marshalling</a></span></dt></dl></dd><dt><span class="chapter"><a href="#Built_in_JAXB_providers">19. JAXB providers</a></span></dt><dd><dl><dt><span class="sect1"><a href="#decorators">19.1. JAXB Decorators</a></span></dt><dt><span class="sect1"><a href="#Pluggable_JAXBContext_s_with_ContextResolvers">19.2. Pluggable JAXBContext's with ContextResolvers</a></span></dt><dt><span class="sect1"><a href="#JAXB_+_XML_provider">19.3. JAXB + XML provider</a></span></dt><dd><dl><dt><span class="sect2"><a href="#XmlHeader">19.3.1. @XmlHeader and @Stylesheet</a></span></dt></dl></dd><dt><span class="sect1"><a href="#JAXB_+_JSON_provider">19.4. JAXB + JSON provider</a></span></dt><dt><span class="sect1"><a href="#JAXB_+_FastinfoSet_provider">19.5. JAXB + FastinfoSet provider</a></span></dt><dt><span class="sect1"><a href="#JAXB_Collections">19.6. Arrays and Collections of JAXB Objects</a></span></dt><dd><dl><dt><span class="sect2"><a href="#json_list">19.6.1. JSON and JAXB Collections/arrays</a></span></dt></dl></dd><dt><span class="sect1"><a href="#JAXB_Map">19.7. Maps of JAXB Objects</a></span></dt><dd><dl><dt><span class="sect2"><a href="#json_map">19.7.1. JSON and JAXB maps</a></span></dt><dt><span class="sect2"><a href="#JAXB_JSON_problems">19.7.2. Possible Problems with Jettison Provider</a></span></dt></dl></dd><dt><span class="sect1"><a href="#JAXB_INTERFACES">19.8. Interfaces, Abstract Classes, and JAXB</a></span></dt><dt><span class="sect1"><a href="#configuration">19.9. Configurating JAXB Marshalling</a></span></dt></dl></dd><dt><span class="chapter"><a href="#Atom">20. Resteasy Atom Support</a></span></dt><dd><dl><dt><span class="sect1"><a href="#resteasy_atom">20.1. Resteasy Atom API and Provider</a></span></dt><dt><span class="sect1"><a href="#jaxb_atom">20.2. Using JAXB with the Atom Provider</a></span></dt></dl></dd><dt><span class="chapter"><a href="#json">21. JSON Support via Jackson</a></span></dt><dd><dl><dt><span class="sect1"><a href="#d4e1039">21.1. Using Jackson 1.9.x Outside of JBoss AS7</a></span></dt><dt><span class="sect1"><a href="#d4e1043">21.2. Using Jackson 1.9.x Inside of JBoss AS7</a></span></dt><dt><span class="sect1"><a href="#d4e1046">21.3. Using Jackson 2.2.x Outside of JBoss AS7</a></span></dt><dt><span class="sect1"><a href="#d4e1050">21.4. Using Jackson 2.2.x Inside of JBoss AS7</a></span></dt><dt><span class="sect1"><a href="#d4e1054">21.5. Additional Resteasy Specifics</a></span></dt><dt><span class="sect1"><a href="#Possible_Jackson_Problems">21.6. Possible Conflict With JAXB Provider</a></span></dt><dt><span class="sect1"><a href="#JSONP_Support">21.7. JSONP Support</a></span></dt></dl></dd><dt><span class="chapter"><a href="#json-p">22. JSON Support via Java EE 7 JSON-P API</a></span></dt><dt><span class="chapter"><a href="#Multipart">23. Multipart Providers</a></span></dt><dd><dl><dt><span class="sect1"><a href="#MultipartInput">23.1. Input with multipart/mixed</a></span></dt><dt><span class="sect1"><a href="#multipart_list">23.2. java.util.List with multipart data</a></span></dt><dt><span class="sect1"><a href="#MultipartFormData">23.3. Input with multipart/form-data</a></span></dt><dt><span class="sect1"><a href="#multipart_map">23.4. java.util.Map with multipart/form-data</a></span></dt><dt><span class="sect1"><a href="#MultipartRelated">23.5. Input with multipart/related</a></span></dt><dt><span class="sect1"><a href="#multipart_output">23.6. Output with multipart</a></span></dt><dt><span class="sect1"><a href="#multipart_list_output">23.7. Multipart Output with java.util.List</a></span></dt><dt><span class="sect1"><a href="#multipart_formdata_output">23.8. Output with multipart/form-data</a></span></dt><dt><span class="sect1"><a href="#multipart_map_output">23.9. Multipart FormData Output with java.util.Map</a></span></dt><dt><span class="sect1"><a href="#multipart_related_output">23.10. Output with multipart/related</a></span></dt><dt><span class="sect1"><a href="#multipartform_annotation">23.11. @MultipartForm and POJOs</a></span></dt><dt><span class="sect1"><a href="#xop_with_multipart_related">23.12. XML-binary Optimized Packaging (Xop)</a></span></dt><dt><span class="sect1"><a href="#multipart_parsing_note">23.13. Note about multipart parsing and working with other frameworks</a></span></dt><dt><span class="sect1"><a href="#multipart_overwrite_default_content_type">23.14. Overwriting the default fallback content type for multipart messages</a></span></dt><dt><span class="sect1"><a href="#multipart_overwrite_content_type">23.15. Overwriting the content type for multipart messages</a></span></dt><dt><span class="sect1"><a href="#multipart_overwrite_default_charset">23.16. Overwriting the default fallback charset for multipart messages</a></span></dt></dl></dd><dt><span class="chapter"><a href="#Built_in_YAML_Provider">24. YAML Provider</a></span></dt><dt><span class="chapter"><a href="#StringConverter">25. String marshalling for String based @*Param</a></span></dt><dt><span class="chapter"><a href="#Responses_using_javax.ws.rs.core.Response">26. Responses using javax.ws.rs.core.Response</a></span></dt><dt><span class="chapter"><a href="#ExceptionHandling">27. Exception Handling</a></span></dt><dd><dl><dt><span class="sect1"><a href="#ExceptionMappers">27.1. Exception Mappers</a></span></dt><dt><span class="sect1"><a href="#builtinException">27.2. Resteasy Built-in Internally-Thrown Exceptions</a></span></dt><dt><span class="sect1"><a href="#overring_resteasy_exceptions">27.3. Overriding Resteasy Builtin Exceptions</a></span></dt></dl></dd><dt><span class="chapter"><a href="#Configuring_Individual_JAX-RS_Resource_Beans">28. Configuring Individual JAX-RS Resource Beans</a></span></dt><dt><span class="chapter"><a href="#gzip">29. GZIP Compression/Decompression</a></span></dt><dt><span class="chapter"><a href="#ContentRange">30. Content-Range Support</a></span></dt><dt><span class="chapter"><a href="#Cache_NoCache_CacheControl">31. Resteasy Caching Features</a></span></dt><dd><dl><dt><span class="sect1"><a href="#Cache_Annotation">31.1. @Cache and @NoCache Annotations</a></span></dt><dt><span class="sect1"><a href="#client_cache">31.2. Client "Browser" Cache</a></span></dt><dt><span class="sect1"><a href="#server_cache">31.3. Local Server-Side Response Cache</a></span></dt></dl></dd><dt><span class="chapter"><a href="#Interceptors">32. Filters and Interceptors</a></span></dt><dd><dl><dt><span class="sect1"><a href="#d4e1328">32.1. Server Side Filters</a></span></dt><dt><span class="sect1"><a href="#d4e1333">32.2. Client Side Filters</a></span></dt><dt><span class="sect1"><a href="#d4e1337">32.3. Reader and Writer Interceptors</a></span></dt><dt><span class="sect1"><a href="#d4e1340">32.4. Per Resource Method Filters and Interceptors</a></span></dt><dt><span class="sect1"><a href="#d4e1344">32.5. Ordering</a></span></dt></dl></dd><dt><span class="chapter"><a href="#Asynchronous_HTTP_Request_Processing">33. Asynchronous HTTP Request Processing</a></span></dt><dt><span class="chapter"><a href="#async_job_service">34. Asynchronous Job Service</a></span></dt><dd><dl><dt><span class="sect1"><a href="#async_job">34.1. Using Async Jobs</a></span></dt><dt><span class="sect1"><a href="#oneway">34.2. Oneway: Fire and Forget</a></span></dt><dt><span class="sect1"><a href="#async_job_setup">34.3. Setup and Configuration</a></span></dt></dl></dd><dt><span class="chapter"><a href="#RESTEasy_Embedded_Container">35. Embedded Containers</a></span></dt><dd><dl><dt><span class="section"><a href="#d4e1385">35.1. Undertow</a></span></dt><dt><span class="section"><a href="#d4e1389">35.2. Sun JDK HTTP Server</a></span></dt><dt><span class="section"><a href="#d4e1396">35.3. TJWS Embeddable Servlet Container</a></span></dt><dt><span class="section"><a href="#d4e1408">35.4. Netty</a></span></dt></dl></dd><dt><span class="chapter"><a href="#RESTEasy_Server-side_Mock_Framework">36. Server-side Mock Framework</a></span></dt><dt><span class="chapter"><a href="#Securing_JAX-RS_and_RESTeasy">37. Securing JAX-RS and RESTeasy</a></span></dt><dt><span class="chapter"><a href="#oauth2">38. OAuth 2.0 and Resteasy Skeleton Key</a></span></dt><dd><dl><dt><span class="section"><a href="#d4e1461">38.1. System Requirements</a></span></dt><dt><span class="section"><a href="#d4e1474">38.2. Generate the Security Domain Key Pair</a></span></dt><dt><span class="section"><a href="#d4e1479">38.3. Setting up the Auth Server</a></span></dt><dd><dl><dt><span class="section"><a href="#d4e1482">38.3.1. Setting up your Security Domain</a></span></dt><dt><span class="section"><a href="#d4e1509">38.3.2. Auth Server Config File</a></span></dt><dt><span class="section"><a href="#d4e1576">38.3.3. Set up web.xml</a></span></dt><dt><span class="section"><a href="#d4e1579">38.3.4. Set up jboss-web.xml</a></span></dt><dt><span class="section"><a href="#d4e1583">38.3.5. Set up jboss-deployment-structure.xml</a></span></dt><dt><span class="section"><a href="#d4e1587">38.3.6. Tweak your login page</a></span></dt></dl></dd><dt><span class="section"><a href="#d4e1592">38.4. Setting Up An App for SSO</a></span></dt><dd><dl><dt><span class="section"><a href="#d4e1595">38.4.1. SSO config file</a></span></dt><dt><span class="section"><a href="#d4e1639">38.4.2. Set up web.xml</a></span></dt><dt><span class="section"><a href="#d4e1642">38.4.3. Set up jboss-web.xml</a></span></dt><dt><span class="section"><a href="#d4e1646">38.4.4. Set up jboss-deployment-structure.xml</a></span></dt></dl></dd><dt><span class="section"><a href="#d4e1650">38.5. Bearer Token only Setup</a></span></dt><dd><dl><dt><span class="section"><a href="#d4e1653">38.5.1. Bearer token auth config file</a></span></dt><dt><span class="section"><a href="#d4e1669">38.5.2. Set up web.xml</a></span></dt><dt><span class="section"><a href="#d4e1672">38.5.3. Set up jboss-web.xml</a></span></dt><dt><span class="section"><a href="#d4e1676">38.5.4. Set up jboss-deployment-structure.xml</a></span></dt></dl></dd><dt><span class="section"><a href="#d4e1680">38.6. Obtaining an access token programmatically.</a></span></dt><dt><span class="section"><a href="#d4e1690">38.7. Access remote services securely in a secure web session</a></span></dt><dt><span class="section"><a href="#d4e1698">38.8. Check Out the OAuth2 Example!</a></span></dt><dt><span class="section"><a href="#d4e1702">38.9. Auth Server Action URLs</a></span></dt></dl></dd><dt><span class="chapter"><a href="#Authentication">39. Authentication</a></span></dt><dd><dl><dt><span class="section"><a href="#d4e1730">39.1. OAuth core 1.0a</a></span></dt><dd><dl><dt><span class="section"><a href="#d4e1739">39.1.1. Authenticating with OAuth 1.0a</a></span></dt><dt><span class="section"><a href="#d4e1775">39.1.2. Accessing protected resources</a></span></dt><dt><span class="section"><a href="#d4e1795">39.1.3. Implementing an OAuthProvider</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#d4e1807">40. JSON Web Signature and Encryption (JOSE-JWT)</a></span></dt><dd><dl><dt><span class="section"><a href="#d4e1810">40.1. JSON Web Signature (JWS)</a></span></dt><dt><span class="section"><a href="#d4e1816">40.2. JSON Web Encryption (JWE)</a></span></dt></dl></dd><dt><span class="chapter"><a href="#signature">41. Doseta Digital Signature Framework</a></span></dt><dd><dl><dt><span class="section"><a href="#d4e1878">41.1. Maven settings</a></span></dt><dt><span class="section"><a href="#d4e1883">41.2. Signing API</a></span></dt><dd><dl><dt><span class="section"><a href="#d4e1889">41.2.1. @Signed annotation</a></span></dt></dl></dd><dt><span class="section"><a href="#d4e1897">41.3. Signature Verification API</a></span></dt><dd><dl><dt><span class="section"><a href="#d4e1906">41.3.1. Annotation-based verification</a></span></dt></dl></dd><dt><span class="section"><a href="#d4e1914">41.4. Managing Keys via a KeyRepository</a></span></dt><dd><dl><dt><span class="section"><a href="#d4e1917">41.4.1. Create a KeyStore</a></span></dt><dt><span class="section"><a href="#d4e1924">41.4.2. Configure Restreasy to use the KeyRepository</a></span></dt><dt><span class="section"><a href="#d4e1938">41.4.3. Using DNS to Discover Public Keys</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#d4e1952">42. Body Encryption and Signing via SMIME</a></span></dt><dd><dl><dt><span class="section"><a href="#d4e1955">42.1. Maven settings</a></span></dt><dt><span class="section"><a href="#d4e1960">42.2. Message Body Encryption</a></span></dt><dt><span class="section"><a href="#d4e1971">42.3. Message Body Signing</a></span></dt><dt><span class="section"><a href="#d4e1982">42.4. application/pkcs7-signature</a></span></dt></dl></dd><dt><span class="chapter"><a href="#RESTEasy_EJB_Integration">43. EJB Integration</a></span></dt><dt><span class="chapter"><a href="#RESTEasy_Spring_Integration">44. Spring Integration</a></span></dt><dt><span class="chapter"><a href="#CDI">45. CDI Integration</a></span></dt><dd><dl><dt><span class="section"><a href="#d4e2034">45.1. Using CDI beans as JAX-RS components</a></span></dt><dt><span class="section"><a href="#d4e2041">45.2. Default scopes</a></span></dt><dt><span class="section"><a href="#d4e2053">45.3. Configuration within JBoss 6 M4 and Higher</a></span></dt><dt><span class="section"><a href="#d4e2056">45.4. Configuration with different distributions</a></span></dt></dl></dd><dt><span class="chapter"><a href="#Seam">46. Seam Integration</a></span></dt><dt><span class="chapter"><a href="#Guice1">47. Guice 3.0 Integration</a></span></dt><dd><dl><dt><span class="section"><a href="#d4e2078">47.1. Request Scope</a></span></dt><dt><span class="section"><a href="#d4e2082">47.2. Binding JAX-RS utilities</a></span></dt><dt><span class="section"><a href="#d4e2085">47.3. Configuring Stage</a></span></dt><dt><span class="section"><a href="#d4e2089">47.4. Custom Injector creation</a></span></dt></dl></dd><dt><span class="chapter"><a href="#RESTEasy_Client_Framework">48. Resteasy Client API</a></span></dt><dd><dl><dt><span class="sect1"><a href="#d4e2098">48.1. JAX-RS 2.0 Client API</a></span></dt><dt><span class="sect1"><a href="#d4e2106">48.2. Resteasy Proxy Framework</a></span></dt><dt><span class="sect1"><a href="#transport_layer">48.3. Apache HTTP Client 4.x and other backends</a></span></dt></dl></dd><dt><span class="chapter"><a href="#AJAX_Client">49. AJAX Client</a></span></dt><dd><dl><dt><span class="section"><a href="#d4e2191">49.1. Generated JavaScript API</a></span></dt><dd><dl><dt><span class="section"><a href="#d4e2200">49.1.1. JavaScript API servlet</a></span></dt><dt><span class="section"><a href="#d4e2204">49.1.2. JavaScript API usage</a></span></dt><dt><span class="section"><a href="#d4e2258">49.1.3. Work with @Form</a></span></dt><dt><span class="section"><a href="#d4e2270">49.1.4. MIME types and unmarshalling.</a></span></dt><dt><span class="section"><a href="#d4e2295">49.1.5. MIME types and marshalling.</a></span></dt></dl></dd><dt><span class="section"><a href="#d4e2324">49.2. Using the JavaScript API to build AJAX queries</a></span></dt><dd><dl><dt><span class="section"><a href="#d4e2327">49.2.1. The REST object</a></span></dt><dt><span class="section"><a href="#d4e2347">49.2.2. The REST.Request class</a></span></dt></dl></dd><dt><span class="section"><a href="#d4e2397">49.3. Caching Features</a></span></dt></dl></dd><dt><span class="chapter"><a href="#Validation">50. Validation</a></span></dt><dd><dl><dt><span class="section"><a href="#d4e2429">50.1. Violation reporting</a></span></dt><dt><span class="section"><a href="#d4e2455">50.2. Bean Validation 1.1</a></span></dt><dt><span class="section"><a href="#d4e2459">50.3. Bean Validation 1.0</a></span></dt><dt><span class="section"><a href="#d4e2470">50.4. Validation Service Providers</a></span></dt></dl></dd><dt><span class="chapter"><a href="#Maven_and_RESTEasy">51. Maven and RESTEasy</a></span></dt><dt><span class="chapter"><a href="#JBoss5">52. JBoss AS 5.x Integration</a></span></dt><dt><span class="chapter"><a href="#JBoss AS 6">53. JBoss AS 6/7 Integration</a></span></dt><dt><span class="chapter"><a href="#doc">54. Documentation Support</a></span></dt><dt><span class="chapter"><a href="#Migration_from_older_versions">55. Migration from older versions</a></span></dt><dd><dl><dt><span class="sect1"><a href="#d4e2504">55.1. Migrating from 3.0 to 3.0.4</a></span></dt><dt><span class="sect1"><a href="#d4e2509">55.2. Migrating from 3.0-beta-6 and 3.0-rc-1</a></span></dt><dt><span class="sect1"><a href="#d4e2516">55.3. Migrating from 3.0-beta-5 and 3.0-beta-6</a></span></dt><dt><span class="sect1"><a href="#d4e2523">55.4. Migrating from 3.0-beta-4 and 3.0-beta-5</a></span></dt><dt><span class="sect1"><a href="#d4e2528">55.5. Migrating from 3.0-beta-2 and 3.0-beta-4</a></span></dt><dt><span class="sect1"><a href="#d4e2533">55.6. Migrating from 3.0-beta-1 and 3.0-beta-2</a></span></dt><dt><span class="sect1"><a href="#d4e2537">55.7. Migrating from 2.x to 3.0-beta-1</a></span></dt><dt><span class="sect1"><a href="#d4e2549">55.8. Migrating from 2.3.2 to 2.3.3</a></span></dt><dt><span class="sect1"><a href="#d4e2553">55.9. Migrating from 2.3.0 to 2.3.1</a></span></dt><dt><span class="sect1"><a href="#d4e2557">55.10. Migrating from 2.2.x to 2.3</a></span></dt><dt><span class="sect1"><a href="#22_221">55.11. Migrating from 2.2.0 to 2.2.1</a></span></dt><dt><span class="sect1"><a href="#21_22">55.12. Migrating from 2.1.x to 2.2</a></span></dt><dt><span class="sect1"><a href="#20_21">55.13. Migrating from 2.0.x to 2.1</a></span></dt><dt><span class="sect1"><a href="#Migrating_to_Resteasy_12_20">55.14. Migrating from 1.2.x to 2.0</a></span></dt><dt><span class="sect1"><a href="#migrating_1.2_1.2.1">55.15. Migrating from 1.2.GA to 1.2.1.GA</a></span></dt><dt><span class="sect1"><a href="#Migrating_to_Resteasy_1_1_1_2">55.16. Migrating from 1.1 to 1.2</a></span></dt></dl></dd><dt><span class="chapter"><a href="#REST_BOOKS">56. Books You Can Read</a></span></dt></dl></div>

   

   

   <div class="preface" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="preface"/>Preface</h2></div></div></div>
      
      <p>
         Commercial development support, production support and training for RESTEasy JAX-RS is
         available through JBoss, a division of Red Hat Inc. (see http://www.jboss.com/).
      </p>

      <p>
         In some of the example listings, what is meant to be displayed on one line does not fit
         inside the available page width. These lines have been broken up. A '\' at the end of a
         line means that a break has been introduced to fit in the page, with the following lines
         indented. So:
         </p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">
            Let's pretend to have an extremely \
            long line that \
            does not fit
            This one is short
         </pre><p>
         Is really:
         </p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">
            Let's pretend to have an extremely long line that does not fit
            This one is short
         </pre><p>
      </p>
   </div>



   <div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="Overview"/>Chapter 1. Overview</h2></div></div></div>


<p>

JAX-RS, JSR-311, is a new JCP specification that provides a Java API for RESTful Web Services over the HTTP protocol.
    Resteasy is an portable implementation of this specification which can run in any Servlet container. Tighter
    integration with JBoss Application Server is also available to make the user experience nicer in that environment.
    While JAX-RS is only a server-side specification, Resteasy has innovated to bring JAX-RS to the client through the
    RESTEasy JAX-RS Client Framework. This client-side framework allows you to map outgoing HTTP requests to remote
    servers using JAX-RS annotations and interface proxies.
</p>
<p>


</p>
<p>

</p><div class="itemizedlist"><ul><li>
 JAX-RS implementation
</li><li>
 Portable to any app-server/Tomcat that runs on JDK 5 or higher
</li><li>
 Embeddable server implementation for junit testing
</li><li>
 EJB and Spring integration
</li><li>
 Client framework to make writing HTTP clients easy (JAX-RS only define server bindings)
</li></ul></div><p>

</p>
<p>


</p>
</div>

   <div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="license"/>Chapter 2. License</h2></div></div></div>
    
    <p>RESTEasy is distributed under the ASL 2.0 license. It does not distribute any thirdparty libraries that are
        GPL. It does ship thirdparty libraries licensed under
        Apache ASL 2.0 and LGPL.
    </p>
</div>

   <div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="Installation_Configuration"/>Chapter 3. Installation/Configuration</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="#upgrading-as7">3.1. Upgrading Resteasy Within JBoss AS 7</a></span></dt><dt><span class="section"><a href="#upgrading-eap61">3.2. Upgrading Resteasy Within JBoss EAP 6.1</a></span></dt><dt><span class="section"><a href="#upgrading-wildfly">3.3. Upgrading Resteasy Within Wildfly</a></span></dt><dt><span class="section"><a href="#d4e40">3.4. Configuring in JBoss AS 7, EAP, and Wildfly</a></span></dt><dd><dl><dt><span class="section"><a href="#d4e48">3.4.1. Resteasy Modules in AS7, EAP6.1, Wildfly</a></span></dt></dl></dd><dt><span class="section"><a href="#d4e111">3.5. Standalone Resteasy in Servlet 3.0 Containers</a></span></dt><dt><span class="section"><a href="#d4e118">3.6. Standalone Resteasy in Older Servlet Containers</a></span></dt><dt><span class="section"><a href="#d4e125">3.7. Configuration Switches</a></span></dt><dt><span class="section"><a href="#javax.ws.rs.core.Application">3.8. javax.ws.rs.core.Application</a></span></dt><dt><span class="section"><a href="#listener">3.9. RESTEasy as a ServletContextListener</a></span></dt><dt><span class="section"><a href="#filter">3.10. RESTEasy as a servlet Filter</a></span></dt><dt><span class="section"><a href="#RESTEasyLogging">3.11. RESTEasyLogging</a></span></dt></dl></div>
    

    <p>
        RESTEasy is installed and configured in different ways depending on which environment you are running in.
        If you are running in JBoss AS 6-M4 (milestone 4) or higher, resteasy is already bundled and integrated
        completely
        so there is very little you have to do. If you are running in a different distribution, there is some manual
        installation and configuration you will have to do.

    </p>

    <div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="upgrading-as7"/>3.1. Upgrading Resteasy Within JBoss AS 7</h2></div></div></div>
        
        <p>
            Resteasy is bundled with JBoss AS 7.  You will likely have the need to upgrade Resteasy in AS7.  The Resteasy
            distribution comes with a zip file called resteasy-jboss-modules-3.0.5.Final.zip.  Unzip this file while
            with the modules/ directory of the JBoss AS7 distribution.  This will overwrite some of the existing files there.
        </p>
    </div>
    <div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="upgrading-eap61"/>3.2. Upgrading Resteasy Within JBoss EAP 6.1</h2></div></div></div>
        
        <p>
            Resteasy is bundled with JBoss EAP 6.1.  You will likely have the need to upgrade Resteasy in JBoss EAP 6.1.  The Resteasy
            distribution comes with a zip file called resteasy-jboss-modules-3.0.5.Final.zip.  Unzip this file while
            with the modules/system/layers/base/ directory of the JBoss EAP 6.1 distribution.  This will overwrite some of the existing files there.
        </p>
    </div>
    <div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="upgrading-wildfly"/>3.3. Upgrading Resteasy Within Wildfly</h2></div></div></div>
        
        <p>
            Resteasy is bundled with Wildfly.  You will likely have the need to upgrade Resteasy in Wildfly.  The Resteasy
            distribution comes with a zip file called resteasy-jboss-modules-wf8-3.0.5.Final.zip.  Unzip this file while
            with the modules/system/layers/base/ directory of the Wildfly distribution.  This will overwrite some of the existing files there.
        </p>
    </div>
    <div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d4e40"/>3.4. Configuring in JBoss AS 7, EAP, and Wildfly</h2></div></div></div>
        
        <p>
            RESTEasy is bundled with JBoss/Wildfly and completely integrated as per the requirements of Java EE 6.
            First you must at least provide an empty web.xml file.  You can of course deploy any custom servlet, filter
            or security constraint you want to within your web.xml, but the least amount of work is to create an empty
            web.xml file.  Also, resteasy context-params are available if you want to tweak turn on/off any specific
            resteasy feature.
        </p>
        <p>
            </p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">
                
&lt;web-app version="3.0" xmlns="http://java.sun.com/xml/ns/javaee"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/web-app_3_0.xsd"&gt;
&lt;/web-app&gt;

            </pre><p>
        </p>
        <p>
            Since we're not using a jax-rs servlet mapping, we must define an Application class that is annotated with
            the @ApplicationPath annotation.  If you return any empty set for by classes and singletons, your WAR will
            be scanned for JAX-RS annotation resource and provider classes.
        </p>
        <pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">
            import javax.ws.rs.ApplicationPath;
            import javax.ws.rs.core.Application;

            @ApplicationPath("/root-path")
            public class MyApplication extends Application
            {
            }
        </pre>
        <p>
            The Resteasy distribution has ported the "Restful Java" O'Reilly workbook examples to AS7.  You can
            find these under the directory examples/oreilly-workbook-as7.
        </p>
    <div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d4e48"/>3.4.1. Resteasy Modules in AS7, EAP6.1, Wildfly</h3></div></div></div>
        
        <p>
            Resteasy and JAX-RS are automically loaded into your deployment's classpath, if and only if you are deploying
            a JAX-RS Application.  If you only want to use the client library, you will have to create a dependency
            for it within your deployment.  Also, only some resteasy features are automatically loaded.  To bring
            in these libraries, you'll have to create a jboss-deployment-structure.xml file within your WEB-INF
            directory of your WAR file.  Here's an example:
        </p>
        <pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">
            
&lt;jboss-deployment-structure&gt;
    &lt;deployment&gt;
        &lt;dependencies&gt;
            &lt;module name="org.jboss.resteasy.resteasy-yaml-provider" services="import"/&gt;
        &lt;/dependencies&gt;
    &lt;/deployment&gt;
&lt;/jboss-deployment-structure&gt;

        </pre>
        <p>The <code class="literal">services</code> attribute must be set to import for modules that have default providers
            that must be registered.  The following
            table specifies which modules are loaded by default when JAX-RS services are deployed and which aren't.
        </p>
        <p>
            </p><div class="table"><a id="d4e55"/><p class="title"><b>Table 3.1. </b></p><div class="table-contents">
            <table border="1"><colgroup><col/><col/><col/></colgroup><thead><tr><th>
                        Module Name
                    </th><th>
                        Loaded by Default
                    </th><th>
                        Description
                    </th></tr></thead><tbody><tr><td>
                    org.jboss.resteasy.resteasy-jaxrs
                </td><td>
                    yes
                </td><td>
                    Core resteasy libraries for server and client.  You will need to include this in your deployment
                    if you are only using JAX-RS client
                </td></tr><tr><td>
                        org.jboss.resteasy.resteasy-cdi
                    </td><td>
                        yes
                    </td><td>
                        Resteasy CDI integration
                    </td></tr><tr><td>
                        org.jboss.resteasy.resteasy-jaxb-provider
                    </td><td>
                        yes
                    </td><td>
                        XML JAXB integration.
                    </td></tr><tr><td>
                        org.jboss.resteasy.resteasy-atom-provider
                    </td><td>
                        yes
                    </td><td>
                        Resteasy's atom library.
                    </td></tr><tr><td>
                        org.jboss.resteasy.resteasy-jackson-provider
                    </td><td>
                        yes
                    </td><td>
                        Integration with the JSON parser and object mapper, Jackson.
                    </td></tr><tr><td>
                        org.jboss.resteasy.resteasy-jsapi
                    </td><td>
                        yes
                    </td><td>
                        Resteasy's Javascript API.
                    </td></tr><tr><td>
                        org.jboss.resteasy.resteasy-multipart-provider
                    </td><td>
                        yes
                    </td><td>
                        Features for dealing with multipart formats.
                    </td></tr><tr><td>
                        org.jboss.resteasy.resteasy-crypto
                    </td><td>
                        no
                    </td><td>
                        S/MIME, DKIM, and support for other security formats.
                    </td></tr><tr><td>
                        org.jboss.resteasy.jose-jwt
                    </td><td>
                        no
                    </td><td>
                        JOSE-JWT library.  JSON Web Token.
                    </td></tr><tr><td>
                        org.jboss.resteasy.resteasy-jettison-provider
                    </td><td>
                        no
                    </td><td>
                        Alternative JAXB-like parser for JSON.
                    </td></tr><tr><td>
                        org.jboss.resteasy.resteasy-yaml-provider
                    </td><td>
                        no
                    </td><td>
                        YAML marshalling.
                    </td></tr><tr><td>
                        org.jboss.resteasy.skeleton-key
                    </td><td>
                        no
                    </td><td>
                        OAuth2 support for AS7.
                    </td></tr></tbody></table>
            </div></div><p><br class="table-break"/>
        </p>
    </div>
</div>
    <div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d4e111"/>3.5. Standalone Resteasy in Servlet 3.0 Containers</h2></div></div></div>
        
        <p>
            If you are using resteasy outside of JBoss/Wildfly, in a standalone servlet container like Tomcat or Jetty
            you will need to include the core Resteasy jars in your WAR file.  Resteasy provides integration with standalone
            Servlet 3.0 containers via the <code class="literal">ServletContainerInitializer</code> integration interface.  To
            use this, you must also include the <code class="literal">resteasy-servlet-initializer</code> artifact in your WAR
            file as well.
        </p>
<pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">
        
        &lt;dependency&gt;
            &lt;groupId&gt;org.jboss.resteasy&lt;/groupId&gt;
            &lt;artifactId&gt;resteasy-servlet-initializer&lt;/artifactId&gt;
            &lt;version&gt;3.0.5.Final&lt;/version&gt;
        &lt;/dependency&gt;

</pre>
        <p>
            We strongly suggest that you
            use Maven to build your WAR files as RESTEasy is split into
            a bunch of different modules. You can see an example Maven project in one of the examples in the examples/
            directory.
            If you are not using Maven,when you download RESTeasy and unzip it you will see a lib/ directory that contains the libraries
            needed by resteasy.
            Copy these into your /WEB-INF/lib directory. Place your JAX-RS annotated class resources and providers
            within
            one or more jars within /WEB-INF/lib or your raw class files within /WEB-INF/classes.
        </p>
    </div>
    <div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d4e118"/>3.6. Standalone Resteasy in Older Servlet Containers</h2></div></div></div>
        
        <p>
            The <code class="literal">resteasy-servlet-initializer</code> artifact will not work in Servlet versions older than
            3.0.  You'll then have to manually declare the Resteasy servlet in your WEB-INF/web.xml file of your WAR project.
            For example:
        </p>
        <p>

            </p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">
                
&lt;web-app&gt;
    &lt;display-name&gt;Archetype Created Web Application&lt;/display-name&gt;

    &lt;servlet&gt;
        &lt;servlet-name&gt;Resteasy&lt;/servlet-name&gt;
        &lt;servlet-class&gt;
            org.jboss.resteasy.plugins.server.servlet.HttpServletDispatcher
        &lt;/servlet-class&gt;
        &lt;init-param&gt;
            &lt;param-name&gt;javax.ws.rs.Application&lt;/param-name&gt;
            &lt;param-value&gt;com.restfully.shop.services.ShoppingApplication&lt;/param-value&gt;
        &lt;/init-param&gt;
    &lt;/servlet&gt;

    &lt;servlet-mapping&gt;
        &lt;servlet-name&gt;Resteasy&lt;/servlet-name&gt;
        &lt;url-pattern&gt;/*&lt;/url-pattern&gt;
    &lt;/servlet-mapping&gt;

&lt;/web-app&gt;

            </pre><p>
        </p>
        <p>
            The Resteasy servlet is responsible for initializing some basic components of RESTeasy.
        </p>
    </div>
    <div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d4e125"/>3.7. Configuration Switches</h2></div></div></div>
        
        <p>Resteasy receives configuration options from &lt;context-param&gt; elements.</p>
        <p>
            </p><div class="table"><a id="d4e129"/><p class="title"><b>Table 3.2. </b></p><div class="table-contents">
                <table border="1"><colgroup><col/><col/><col/></colgroup><thead><tr><th>
                                Option Name
                            </th><th>
                                Default Value
                            </th><th>
                                Description
                            </th></tr></thead><tbody><tr><td>
                                resteasy.servlet.mapping.prefix
                            </td><td>
                                no default
                            </td><td>
                                If the url-pattern for the Resteasy servlet-mapping is not /*
                            </td></tr><tr><td>
                                resteasy.scan
                            </td><td>
                                false
                            </td><td>
                                Automatically scan WEB-INF/lib jars and WEB-INF/classes directory for both @Provider and
                                JAX-RS resource classes (@Path, @GET, @POST etc..) and register them
                            </td></tr><tr><td>
                                resteasy.scan.providers
                            </td><td>
                                false
                            </td><td>
                                Scan for @Provider classes and register them
                            </td></tr><tr><td>
                                resteasy.scan.resources
                            </td><td>
                                false
                            </td><td>
                                Scan for JAX-RS resource classes
                            </td></tr><tr><td>
                                resteasy.providers
                            </td><td>
                                no default
                            </td><td>
                                A comma delimited list of fully qualified @Provider class names you want to register
                            </td></tr><tr><td>
                                resteasy.use.builtin.providers
                            </td><td>
                                true
                            </td><td>
                                Whether or not to register default, built-in @Provider classes. (Only available in
                                1.0-beta-5 and later)
                            </td></tr><tr><td>
                                resteasy.resources
                            </td><td>
                                no default
                            </td><td>
                                A comma delimited list of fully qualified JAX-RS resource class names you want to
                                register
                            </td></tr><tr><td>
                                resteasy.jndi.resources
                            </td><td>
                                no default
                            </td><td>
                                A comma delimited list of JNDI names which reference objects you want to register as
                                JAX-RS resources
                            </td></tr><tr><td>
                                javax.ws.rs.Application
                            </td><td>
                                no default
                            </td><td>
                                Fully qualified name of Application class to bootstrap in a spec portable way
                            </td></tr><tr><td>
                                resteasy.media.type.mappings
                            </td><td>
                                no default
                            </td><td>
                                Replaces the need for an Accept header by mapping file name extensions (like .xml or
                                .txt) to a media type. Used when the client
                                is unable to use a Accept header to choose a representation (i.e. a browser). See JAX-RS
                                Content Negotiation chapter for more details.
                            </td></tr><tr><td>
                                resteasy.language.mappings
                            </td><td>
                                no default
                            </td><td>
                                Replaces the need for an Accept-Language header by mapping file name extensions (like
                                .en or .fr) to a language. Used when the client
                                is unable to use a Accept-Language header to choose a language (i.e. a browser). See
                                JAX-RS Content Negotiation chapter for more details
                            </td></tr><tr><td>
                                resteasy.document.expand.entity.references
                            </td><td>
                                true
                            </td><td>
                                Expand external entities in org.w3c.dom.Document files
                            </td></tr><tr><td>
                                resteasy.wider.request.matching
                            </td><td>
                                true
                            </td><td>
                                Turns off the JAX-RS spec defined class-level expression filtering and instead
                                tries to match version every method's full path.
                            </td></tr><tr><td>
                                resteasy.use.container.form.params
                            </td><td>
                                true
                            </td><td>
                                Will use the HttpServletRequest.getParameterMap() method to obtain form parameters.
                                Use this switch if you are calling this method within a servlet filter or eating
                                the input stream within the filter.
                            </td></tr></tbody></table>
            </div></div><p><br class="table-break"/>

        </p>
        <p>

            The resteasy.servlet.mapping.prefix &lt;context param&gt; variable must be set if your servlet-mapping for
            the Resteasy servlet has a url-pattern other than /*. For example, if the url-pattern is
        </p>
        <p>

            </p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">

                &lt;servlet-mapping&gt;
                &lt;servlet-name&gt;Resteasy&lt;/servlet-name&gt;
                &lt;url-pattern&gt;/restful-services/*&lt;/url-pattern&gt;
                &lt;/servlet-mapping&gt;
            </pre><p>
        </p>
        <p>

            Then the value of resteasy-servlet.mapping.prefix must be:
        </p>
        <p>

            </p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">

                &lt;context-param&gt;
                &lt;param-name&gt;resteasy.servlet.mapping.prefix&lt;/param-name&gt;
                &lt;param-value&gt;/restful-services&lt;/param-value&gt;
                &lt;/context-param&gt;
            </pre><p>
        </p>
    </div>
    <div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="javax.ws.rs.core.Application"/>3.8. javax.ws.rs.core.Application</h2></div></div></div>
        

        <p>

            The javax.ws.rs.core.Application class is a standard JAX-RS class that you may implement to provide
            information on your deployment. It is simply a class the lists all JAX-RS root resources and providers.
        </p>
        <p>

            </p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">
                /**
                * Defines the components of a JAX-RS application and supplies additional
                * metadata. A JAX-RS application or implementation supplies a concrete
                * subclass of this abstract class.
                */
                public abstract class Application
                {
                private static final Set&lt;Object&gt; emptySet = Collections.emptySet();

                /**
                * Get a set of root resource and provider classes. The default lifecycle
                * for resource class instances is per-request. The default lifecycle for
                * providers is singleton.
                * &lt;p/&gt;
                * &lt;p&gt;Implementations should warn about and ignore classes that do not
                * conform to the requirements of root resource or provider classes.
                * Implementations should warn about and ignore classes for which
                * {@link #getSingletons()} returns an instance. Implementations MUST
                * NOT modify the returned set.&lt;/p&gt;
                *
                * @return a set of root resource and provider classes. Returning null
                * is equivalent to returning an empty set.
                */
                public abstract Set&lt;Class&lt;?&gt;&gt; getClasses();

                /**
                * Get a set of root resource and provider instances. Fields and properties
                * of returned instances are injected with their declared dependencies
                * (see {@link Context}) by the runtime prior to use.
                * &lt;p/&gt;
                * &lt;p&gt;Implementations should warn about and ignore classes that do not
                * conform to the requirements of root resource or provider classes.
                * Implementations should flag an error if the returned set includes
                * more than one instance of the same class. Implementations MUST
                * NOT modify the returned set.&lt;/p&gt;
                * &lt;p/&gt;
                * &lt;p&gt;The default implementation returns an empty set.&lt;/p&gt;
                *
                * @return a set of root resource and provider instances. Returning null
                * is equivalent to returning an empty set.
                */
                public Set&lt;Object&gt; getSingletons()
                {
                return emptySet;
                }

                }
            </pre><p>
        </p>
        <p>


        </p>
        <p>

            To use Application you must set a servlet init-param, javax.ws.rs.Application with a fully qualified class
            that implements Application. For example:
        </p>
        <p>

            </p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">    
    &lt;servlet&gt;
        &lt;servlet-name&gt;Resteasy&lt;/servlet-name&gt;
        &lt;servlet-class&gt;
            org.jboss.resteasy.plugins.server.servlet.HttpServletDispatcher
        &lt;/servlet-class&gt;
        &lt;init-param&gt;
            &lt;param-name&gt;javax.ws.rs.Application&lt;/param-name&gt;
            &lt;param-value&gt;com.restfully.shop.services.ShoppingApplication&lt;/param-value&gt;
        &lt;/init-param&gt;
    &lt;/servlet&gt;  </pre><p>
        </p>
        <p>

            If you have this set, you should probably turn off automatic scanning as this will probably result in
            duplicate classes being registered.
        </p>
        <p>


        </p>
    </div>

    <div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="listener"/>3.9. RESTEasy as a ServletContextListener</h2></div></div></div>
        

        <p>
            This section is pretty much deprecated if you are using a Servlet 3.0 container or higher.  Skip it if
            you are and read the configuration section above on installing in Servlet 3.0.
            The initialization of RESTEasy can be performed within a ServletContextListener instead of within the
            Servlet. You may need this if you are writing custom Listeners that need to interact with RESTEasy at boot
            time. An example of this is the RESTEasy Spring integration that requires a Spring ServletContextListener.
            The org.jboss.resteasy.plugins.server.servlet.ResteasyBootstrap class is a ServletContextListener that
            configures an instance of an ResteasyProviderFactory and Registry. You can obtain instances of a
            ResteasyProviderFactory and Registry from the ServletContext attributes
            org.jboss.resteasy.spi.ResteasyProviderFactory and org.jboss.resteasy.spi.Registry. From these instances you
            can programmatically interact with RESTEasy registration interfaces.
        </p>

        <pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">
            
&lt;web-app&gt;
   &lt;listener&gt;
      &lt;listener-class&gt;
         org.jboss.resteasy.plugins.server.servlet.ResteasyBootstrap
      &lt;/listener-class&gt;
   &lt;/listener&gt;

  &lt;!-- ** INSERT YOUR LISTENERS HERE!!!! --&gt;

   &lt;servlet&gt;
      &lt;servlet-name&gt;Resteasy&lt;/servlet-name&gt;
      &lt;servlet-class&gt;
         org.jboss.resteasy.plugins.server.servlet.HttpServletDispatcher
      &lt;/servlet-class&gt;
   &lt;/servlet&gt;

   &lt;servlet-mapping&gt;
      &lt;servlet-name&gt;Resteasy&lt;/servlet-name&gt;
      &lt;url-pattern&gt;/resteasy/*&lt;/url-pattern&gt;
   &lt;/servlet-mapping&gt;

&lt;/web-app&gt;

        </pre>
    </div>
    <div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="filter"/>3.10. RESTEasy as a servlet Filter</h2></div></div></div>
        

        <p>
            This section is pretty much deprecated if you are using a Servlet 3.0 container or higher.  Skip it if
            you are and read the configuration section above on installing in Servlet 3.0.
            The downside of running Resteasy as a Servlet is that you cannot have static resources like .html and .jpeg
            files in the
            same path as your JAX-RS services. Resteasy allows you to run as a Filter instead. If a JAX-RS resource is
            not
            found under the URL requested, Resteasy will delegate back to the base servlet container to resolve URLs.
        </p>

        <pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">
            
&lt;web-app&gt;
    &lt;filter&gt;
        &lt;filter-name&gt;Resteasy&lt;/filter-name&gt;
        &lt;filter-class&gt;
            org.jboss.resteasy.plugins.server.servlet.FilterDispatcher
        &lt;/filter-class&gt;
        &lt;init-param&gt;
            &lt;param-name&gt;javax.ws.rs.Application&lt;/param-name&gt;
            &lt;param-value&gt;com.restfully.shop.services.ShoppingApplication&lt;/param-value&gt;
        &lt;/init-param&gt;
    &lt;/filter&gt;

    &lt;filter-mapping&gt;
        &lt;filter-name&gt;Resteasy&lt;/filter-name&gt;
        &lt;url-pattern&gt;/*&lt;/url-pattern&gt;
    &lt;/filter-mapping&gt;

&lt;/web-app&gt;
        </pre>
    </div>

    <div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="RESTEasyLogging"/>3.11. RESTEasyLogging</h2></div></div></div>
        

        <p>

            RESTEasy supports logging via java.util.logging, Log4j, or Slf4j.  How it picks which framework to delegate to is
	    expressed in the following algorithm:
        </p>
	<div class="itemizedlist"><ul><li>
	    <p>If log4j is in the application's classpath, log4j will be used</p>
	  </li><li>
	    <p>If slf4j is in the application's classpath, slf4j will be used</p>
	  </li><li>
	    <p>java.util.logging is the default if neither log4j or slf4j is in the classpath</p>
	  </li><li>
	    <p>If the servlet context param resteasy.logger.type is set to JUL, LOG4J, or SLF4J will override this default behavior</p>
	  </li></ul></div>
        <p>
            The logging categories are still a work in progress, but the initial set should make it easier to
            troubleshoot issues. Currently, the framework has defined the following log categories:
        </p>
        <p>

            </p><div class="table"><a id="d4e232"/><p class="title"><b>Table 3.3. </b></p><div class="table-contents">
                <table border="1"><colgroup><col/><col/></colgroup><thead><tr><th>
                                Category
                            </th><th>
                                Function
                            </th></tr></thead><tbody><tr><td>
                                org.jboss.resteasy.core
                            </td><td>
                                Logs all activity by the core RESTEasy implementation
                            </td></tr><tr><td>
                                org.jboss.resteasy.plugins.providers
                            </td><td>
                                Logs all activity by RESTEasy entity providers
                            </td></tr><tr><td>
                                org.jboss.resteasy.plugins.server
                            </td><td>
                                Logs all activity by the RESTEasy server implementation.
                            </td></tr><tr><td>
                                org.jboss.resteasy.specimpl
                            </td><td>
                                Logs all activity by JAX-RS implementing classes
                            </td></tr><tr><td>
                                org.jboss.resteasy.mock
                            </td><td>
                                Logs all activity by the RESTEasy mock framework
                            </td></tr></tbody></table>
            </div></div><p><br class="table-break"/>

        </p>
    </div>
</div>

   <div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="Using_Path"/>Chapter 4. Using @Path and @GET, @POST, etc.</h2></div></div></div><div class="toc"><dl><dt><span class="sect1"><a href="#_Path_and_regular_expression_mappings">4.1. @Path and regular expression mappings</a></span></dt></dl></div>


<p>

</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">
@Path("/library")
public class Library {

   @GET
   @Path("/books")
   public String getBooks() {...}

   @GET
   @Path("/book/{isbn}")
   public String getBook(@PathParam("isbn") String id) {
      // search my database and get a string representation and return it
   }

   @PUT
   @Path("/book/{isbn}")
   public void addBook(@PathParam("isbn") String id, @QueryParam("name") String name) {...}

   @DELETE
   @Path("/book/{id}")
   public void removeBook(@PathParam("id") String id {...}

   
}
</pre><p>
</p>
<p>

Let's say you have the Resteasy servlet configured and reachable at a root path of http://myhost.com/services.  The requests would be handled by the Library class:
</p>
<p>

</p><div class="itemizedlist"><ul><li>
 GET http://myhost.com/services/library/books
</li><li>
 GET http://myhost.com/services/library/book/333
</li><li>
 PUT http://myhost.com/services/library/book/333
</li><li>
 DELETE http://myhost.com/services/library/book/333
</li></ul></div><p>

</p>
<p>

The @javax.ws.rs.Path annotation must exist on either the class and/or a resource method.  If it exists on both the class and method, the relative path to the resource method is a concatenation of the class and method.
</p>
<p>

In the @javax.ws.rs package there are annotations for each HTTP method.  @GET, @POST, @PUT, @DELETE, and @HEAD.  You place these on public methods that you want to map to that certain kind of HTTP method.  As long as there is a @Path annotation on the class, you do not have to have a @Path annotation on the method you are mapping.  You can have more than one HTTP method as long as they can be distinguished from other methods.
</p>
<p>

When you have a @Path annotation on a method without an HTTP method, these are called JAXRSResourceLocators.
</p>
<p>


</p>
<div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="_Path_and_regular_expression_mappings"/>4.1. @Path and regular expression mappings</h2></div></div></div>


<p>

The @Path annotation is not limited to simple path expressions.  You also have the ability to insert regular expressions into @Path's value.  For example:
</p>
<p>

</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">
@Path("/resources)
public class MyResource {

   @GET
   @Path("{var:.*}/stuff")
   public String get() {...}
}
</pre><p>
</p>
<p>

The following GETs will route to the getResource() method:
</p>
<p>

</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">
GET /resources/stuff
GET /resources/foo/stuff
GET /resources/on/and/on/stuff
</pre><p>
</p>
<p>

The format of the expression is:
</p>
<p>

</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">
"{" variable-name [ ":" regular-expression ] "}"
</pre><p>
</p>
<p>

The regular-expression part is optional.  When the expression is not provided, it defaults to a wildcard matching of one particular segment.  In regular-expression terms, the expression defaults to 
</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">
"([]*)"
</pre><p>
</p>
<p>

For example:
</p>
<p>

@Path("/resources/{var}/stuff")
</p>
<p>

will match these:
</p>
<p>

</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">
GET /resources/foo/stuff
GET /resources/bar/stuff
</pre><p>
</p>
<p>

but will not match:
</p>
<p>

</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">
GET /resources/a/bunch/of/stuff
</pre><p>
</p>
<p>

</p>
<p>

</p>
<p>


</p>
</div>
</div>

   <div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="_PathParam"/>Chapter 5. @PathParam</h2></div></div></div><div class="toc"><dl><dt><span class="sect1"><a href="#Advanced__PathParam_and_Regular_Expressions">5.1. Advanced @PathParam and Regular Expressions</a></span></dt><dt><span class="sect1"><a href="#_PathParam_and_PathSegment">5.2. @PathParam and PathSegment</a></span></dt></dl></div>


<p>

@PathParam is a parameter annotation which allows you to map variable URI path fragments into your method call.
</p>
<p>

</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">
@Path("/library")
public class Library {

   @GET
   @Path("/book/{isbn}")
   public String getBook(@PathParam("isbn") String id) {
      // search my database and get a string representation and return it
   }
}
</pre><p>
</p>
<p>

What this allows you to do is embed variable identification within the URIs of your resources.  In the above example, an isbn URI parameter is used
to pass information about the book we want to access.  The parameter type you inject into can be any primitive type, a String, or any Java object that has
a constructor that takes a String parameter, or a static valueOf method that takes a String as a parameter.  For example, lets say we wanted isbn to be a real object.  We could do:
</p>
<p>

</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">

   @GET
   @Path("/book/{isbn}")
   public String getBook(@PathParam("isbn") ISBN id) {...}


   public class ISBN {
      public ISBN(String str) {...}
   }

</pre><p>
</p>
<p>

Or instead of a public String constructors, have a valueOf method:
</p>
<p>

</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">
  public class ISBN {
     
     public static ISBN valueOf(String isbn) {...}
  }
</pre><p>
</p>
<p>

</p>
<p>


</p>
<div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="Advanced__PathParam_and_Regular_Expressions"/>5.1. Advanced @PathParam and Regular Expressions</h2></div></div></div>


<p>

There are a few more complicated uses of @PathParams not discussed in the previous section.
</p>
<p>

</p>
<p>


</p>
<p>

You are allowed to specify one or more path params embedded in one URI segment.  Here are some examples:
</p>
<p>

</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">
1. @Path("/aaa{param}bbb")
2. @Path("/{name}-{zip}")
3. @Path("/foo{name}-{zip}bar")
</pre><p>
</p>
<p>

So, a URI of "/aaa111bbb" would match #1.  "/bill-02115" would match #2.  "foobill-02115bar" would match #3.
</p>
<p>


</p>
<p>

We discussed before how you can use regular expression patterns within @Path values.
</p>
<p>

</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">

@GET
@Path("/aaa{param:b+}/{many:.*}/stuff")
public String getIt(@PathParam("param") String bs, @PathParam("many") String many) {...}

</pre><p>
</p>
<p>

For the following requests, lets see what the values of the "param" and "many" @PathParams would be:
</p>
<p>

</p><div class="table"><a id="d4e321"/><p class="title"><b>Table 5.1. </b></p><div class="table-contents">
<table border="1"><colgroup><col/><col/><col/></colgroup><thead><tr><th>
Request</th><th>
param</th><th>
many</th></tr></thead><tbody><tr><td>
GET /aaabb/some/stuff</td><td>
bb</td><td>
some</td></tr><tr><td>
GET /aaab/a/lot/of/stuff</td><td>
b</td><td>
a/lot/of</td></tr></tbody></table>
</div></div><p><br class="table-break"/>

</p>
<p>


</p>
</div>
<div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="_PathParam_and_PathSegment"/>5.2. @PathParam and PathSegment</h2></div></div></div>


<p>

The specification has a very simple abstraction for examining a fragment of the URI path being invoked on  javax.ws.rs.core.PathSegment:
</p>
<p>

</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">

public interface PathSegment {

    /**
     * Get the path segment.
     * &lt;p&gt;
     * @return the path segment
     */
    String getPath();
    /**
     * Get a map of the matrix parameters associated with the path segment
     * @return the map of matrix parameters
     */
    MultivaluedMap&lt;String, String&gt; getMatrixParameters();
    
}

</pre><p>
</p>
<p>

You can have Resteasy inject a PathSegment instead of a value with your @PathParam.
</p>
<p>

</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">
   @GET
   @Path("/book/{id}")
   public String getBook(@PathParam("id") PathSegment id) {...}

</pre><p>
</p>
<p>

This is very useful if you have a bunch of @PathParams that use matrix parameters.  The idea of matrix parameters is
    that they are an arbitrary set of name-value pairs embedded in a uri path segment.  The PathSegment object gives you
    access to these parameters. See also MatrixParam.
</p>
<p>

A matrix parameter example is:
</p>
<p>

GET http://host.com/library/book;name=EJB 3.0;author=Bill Burke
</p>
<p>

The basic idea of matrix parameters is that it represents resources that are addressable by their attributes as well as their raw id.
</p>
<p>

</p>
<p>

</p>
<p>

</p>
<p>

</p>
<p>

</p>
<p>

</p>
<p>

</p>
<p>

</p>
<p>

</p>
<p>

</p>
<p>


</p>
</div>
</div>

   <div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="_QueryParam"/>Chapter 6. @QueryParam</h2></div></div></div>


<p>

The @QueryParam annotation allows you to map a URI query string parameter or url form encoded parameter to your method invocation.
</p>
<p>

GET /books?num=5
</p>
<p>

</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">
   


   @GET
   public String getBooks(@QueryParam("num") int num) {
   ...
   }
</pre><p>
</p>
<p>

Currently since Resteasy is built on top of a Servlet, it does not distinguish between URI query strings or url form encoded paramters.  Like PathParam, your parameter type can be an String, primitive, or class that has a String constructor or static valueOf() method.
</p>
<p>

</p>
<p>


</p>
</div>

   <div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="_HeaderParam"/>Chapter 7. @HeaderParam</h2></div></div></div>


<p>

The @HeaderParam annotation allows you to map a request HTTP header to your method invocation.
</p>
<p>

GET /books?num=5
</p>
<p>

</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">
   
   @GET
   public String getBooks(@HeaderParam("From") String from) {
   ...
   }
</pre><p>
</p>
<p>

Like PathParam, your parameter type can be an String, primitive, or class that has a String constructor or static valueOf() method.  For example, MediaType has a valueOf() method and you could do:
</p>
<p>

</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">

   @PUT
   public void put(@HeaderParam("Content-Type") MediaType contentType, ...)
</pre><p>
</p>
<p>

</p>
<p>


</p>
</div>

   
<div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="LinkHeader"/>Chapter 8. Linking resources</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="#d4e384">8.1. Link Headers</a></span></dt><dt><span class="section"><a href="#d4e389">8.2. Atom links in the resource representations</a></span></dt><dd><dl><dt><span class="section"><a href="#d4e396">8.2.1. Configuration</a></span></dt><dt><span class="section"><a href="#d4e411">8.2.2. Your first links injected</a></span></dt><dt><span class="section"><a href="#d4e432">8.2.3. Customising how the Atom links are serialised</a></span></dt><dt><span class="section"><a href="#d4e438">8.2.4. Specifying which JAX-RS methods are tied to which resources</a></span></dt><dt><span class="section"><a href="#d4e503">8.2.5. Specifying path parameter values for URI templates</a></span></dt><dt><span class="section"><a href="#d4e577">8.2.6. Securing entities</a></span></dt><dt><span class="section"><a href="#d4e602">8.2.7. Extending the UEL context</a></span></dt><dt><span class="section"><a href="#d4e618">8.2.8. Resource facades</a></span></dt></dl></dd></dl></div>
	
	<p>
		There are two mechanisms available in RESTEasy to link a resource to another, and to link resources to
		operations: the Link HTTP header, and Atom links inside the resource representations.
	</p>
	<div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d4e384"/>8.1. Link Headers</h2></div></div></div>
		
		<p>
		RESTEasy has both client and server side support for the <a class="ulink" href="http://tools.ietf.org/html/draft-nottingham-http-link-header-06">Link header specification</a>.
		See the javadocs for org.jboss.resteasy.spi.LinkHeader, org.jboss.resteasy.spi.Link, and org.jboss.resteasy.client.ClientResponse.
		</p>
		<p>
		The main advantage of Link headers over Atom links in the resource is that those links are available
		without parsing the entity body.
		</p>
	</div>
	<div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d4e389"/>8.2. Atom links in the resource representations</h2></div></div></div>
		
		<p>
		RESTEasy allows you to inject <a class="ulink" href="http://tools.ietf.org/html/rfc4287#section-4.2.7">Atom links</a> directly inside the entity objects you are sending to the
		client, via auto-discovery.
		</p>
		<div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="warning"><h2>Warning</h2>
			<p>This is only available when using the Jettison or JAXB providers (for JSON and XML).</p>
		</div>
		<p>
		The main advantage over Link headers is that you can have any number of Atom links directly over the
		concerned resources, for any number of resources in the response. For example, you can have Atom links
		for the root response entity, and also for each of its children entities.
		</p>
		<div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d4e396"/>8.2.1. Configuration</h3></div></div></div>
			
			<p>
				There is no configuration required to be able to inject Atom links in your resource
				representation, you just have to have this maven artifact in your path:
			</p>
			<table id="d4e399">
				<caption>Table 8.1. Maven artifact for Atom link injection</caption>
				<thead>
					<tr>
						<th rowspan="1" colspan="1">Group</th>
						<th rowspan="1" colspan="1">Artifact</th>
						<th rowspan="1" colspan="1">Version</th>
					</tr>
				</thead>
				<tbody>
					<tr>
						<td rowspan="1" colspan="1">org.jboss.resteasy</td>
						<td rowspan="1" colspan="1">resteasy-links</td>
						<td rowspan="1" colspan="1">3.0.5.Final</td>
					</tr>
				</tbody>
			</table>
		</div>
		<div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d4e411"/>8.2.2. Your first links injected</h3></div></div></div>
			
			<p>
			You need three things in order to tell RESTEasy to inject Atom links in your entities:
			</p>
			<div class="itemizedlist"><ul><li>
					<p>
					Annotate the JAX-RS method with <code class="classname">@AddLinks</code> to indicate that you want
					Atom links injected in your response entity.
					</p>
				</li><li>
					<p>
					Add <code class="classname">RESTServiceDiscovery</code> fields to the resource classes where you
					want Atom links injected.
					</p>
				</li><li>
					<p>
					Annotate the JAX-RS methods you want Atom links for with <code class="classname">@LinkResource</code>,
					so that RESTEasy knows which links to create for which resources.
					</p>
				</li></ul></div>
			<p>
			The following example illustrates how you would declare everything in order to get the Atom links
			injected in your book store:
			</p>
			<pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Path</span><!-- <br/> --><span class="java_separator">(</span><!-- <br/> --><span class="java_literal">&quot;/&quot;</span><!-- <br/> --><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Consumes</span><span class="java_separator">({</span><span class="java_literal">&quot;application/xml&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;application/json&quot;</span><span class="java_separator">})</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Produces</span><span class="java_separator">({</span><span class="java_literal">&quot;application/xml&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;application/json&quot;</span><span class="java_separator">})</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">interface</span><span class="java_plain">&nbsp;</span><span class="java_type">BookStore</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">AddLinks</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">LinkResource</span><span class="java_separator">(</span><span class="java_plain">value&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">Book</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@GET</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Path</span><span class="java_separator">(</span><span class="java_literal">&quot;books&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">Collection</span><span class="java_operator">&lt;</span><span class="java_type">Book</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;getBooks</span><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">LinkResource</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@POST</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Path</span><span class="java_separator">(</span><span class="java_literal">&quot;books&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;addBook</span><span class="java_separator">(</span><span class="java_type">Book</span><span class="java_plain">&nbsp;book</span><span class="java_separator">);</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">AddLinks</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">LinkResource</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@GET</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Path</span><span class="java_separator">(</span><span class="java_literal">&quot;book/{id}&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">Book</span><span class="java_plain">&nbsp;getBook</span><span class="java_separator">(</span><span class="java_plain">@</span><span class="java_type">PathParam</span><span class="java_separator">(</span><span class="java_literal">&quot;id&quot;</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;id</span><span class="java_separator">);</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">LinkResource</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@PUT</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Path</span><span class="java_separator">(</span><span class="java_literal">&quot;book/{id}&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;updateBook</span><span class="java_separator">(</span><span class="java_plain">@</span><span class="java_type">PathParam</span><span class="java_separator">(</span><span class="java_literal">&quot;id&quot;</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;id</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">Book</span><span class="java_plain">&nbsp;book</span><span class="java_separator">);</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">LinkResource</span><span class="java_separator">(</span><span class="java_plain">value&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">Book</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@DELETE</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Path</span><span class="java_separator">(</span><span class="java_literal">&quot;book/{id}&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;deleteBook</span><span class="java_separator">(</span><span class="java_plain">@</span><span class="java_type">PathParam</span><span class="java_separator">(</span><span class="java_literal">&quot;id&quot;</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;id</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_separator">}</span></pre>
			<p>
			And this is the definition of the Book resource:
			</p>
			<pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Mapped</span><!-- <br/> --><span class="java_separator">(</span><!-- <br/> --><span class="java_plain">namespaceMap&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;@</span><!-- <br/> --><span class="java_type">XmlNsMap</span><!-- <br/> --><span class="java_separator">(</span><!-- <br/> --><span class="java_plain">jsonName&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_literal">&quot;atom&quot;</span><!-- <br/> --><span class="java_separator">,</span><!-- <br/> --><span class="java_plain">&nbsp;namespace&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_literal">&quot;http://www.w3.org/2005/Atom&quot;</span><!-- <br/> --><span class="java_separator">))</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">XmlRootElement</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">XmlAccessorType</span><span class="java_separator">(</span><span class="java_type">XmlAccessType</span><span class="java_separator">.</span><span class="java_plain">NONE</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Book</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">XmlAttribute</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;author</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">XmlID</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">XmlAttribute</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;title</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">XmlElementRef</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">RESTServiceDiscovery</span><span class="java_plain">&nbsp;rest</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_separator">}</span></pre>
			<p>
			If you do a GET /order/foo you will then get this XML representation:
			</p>
			<pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_processing_instruction">&lt;?xml&nbsp;version=&quot;1.0&quot;&nbsp;encoding=&quot;UTF-8&quot;&nbsp;standalone=&quot;yes&quot;?&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">book</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">xmlns:atom</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;http://www.w3.org/2005/Atom&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">title</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;foo&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">author</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;bar&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">atom:link</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">href</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;http://localhost:8081/books&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">rel</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;list&quot;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">atom:link</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">href</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;http://localhost:8081/books&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">rel</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;add&quot;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">atom:link</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">href</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;http://localhost:8081/book/foo&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">rel</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;self&quot;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">atom:link</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">href</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;http://localhost:8081/book/foo&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">rel</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;update&quot;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">atom:link</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">href</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;http://localhost:8081/book/foo&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">rel</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;remove&quot;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">book</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
</pre>
			<p>
			And in JSON format:
			</p>
			<pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVASCRIPT">{
 "book":
 {
  "@title":"foo",
  "@author":"bar",
  "atom.link":
   [
    {"@href":"http://localhost:8081/books","@rel":"list"},
    {"@href":"http://localhost:8081/books","@rel":"add"},
    {"@href":"http://localhost:8081/book/foo","@rel":"self"},
    {"@href":"http://localhost:8081/book/foo","@rel":"update"},
    {"@href":"http://localhost:8081/book/foo","@rel":"remove"}
   ]
 }
}</pre>
		</div>
		<div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d4e432"/>8.2.3. Customising how the Atom links are serialised</h3></div></div></div>
			
			<p>
			Because the <code class="classname">RESTServiceDiscovery</code> is in fact a JAXB type which inherits from
			<code class="classname">List</code> you are free to annotate it as you want to customise the JAXB serialisation,
			or just rely on the default with <code class="classname">@XmlElementRef</code>.
			</p>
		</div>
		<div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d4e438"/>8.2.4. Specifying which JAX-RS methods are tied to which resources</h3></div></div></div>
			
			<p>
			This is all done by annotating the methods with the <code class="classname">@LinkResource</code> annotation.
			It supports the following optional parameters:
			</p>
			<table id="d4e442">
				<caption>Table 8.2. <p><code class="classname">@LinkResource</code> parameters</p></caption>
				<thead>
					<tr>
						<th rowspan="1" colspan="1">Parameter</th>
						<th rowspan="1" colspan="1">Type</th>
						<th rowspan="1" colspan="1">Function</th>
						<th rowspan="1" colspan="1">Default</th>
					</tr>
				</thead>
				<tbody>
					<tr>
						<td rowspan="1" colspan="1">value</td>
						<td rowspan="1" colspan="1"><code class="classname">Class</code></td>
						<td rowspan="1" colspan="1">Declares an Atom link for the given type of resources.</td>
						<td rowspan="1" colspan="1">Defaults to the entity body type (non-annotated parameter), or the method's return type.
						This default does not work with <code class="classname">Response</code> or <code class="classname">Collection</code>
						types, they need to be explicitly specified.</td>
					</tr>
					<tr>
						<td rowspan="1" colspan="1">rel</td>
						<td rowspan="1" colspan="1"><code class="classname">String</code></td>
						<td rowspan="1" colspan="1">The Atom link relation</td>
						<td rowspan="1" colspan="1">
							<div class="variablelist"><dl><dt><span class="term">list</span></dt><dd><p>For <code class="classname">GET</code> methods returning a <code class="classname">Collection</code></p></dd><dt><span class="term">self</span></dt><dd><p>For <code class="classname">GET</code> methods returning a non-<code class="classname">Collection</code></p></dd><dt><span class="term">remove</span></dt><dd><p>For <code class="classname">DELETE</code> methods</p></dd><dt><span class="term">update</span></dt><dd><p>For <code class="classname">PUT</code> methods</p></dd><dt><span class="term">add</span></dt><dd><p>For <code class="classname">POST</code> methods</p></dd></dl></div>
						</td>
					</tr>
				</tbody>
			</table>
			<p>
			You can add several <code class="classname">@LinkResource</code> annotations on a single method by enclosing
			them in	a <code class="classname">@LinkResources</code> annotation. This way you can add links to the same
			method on several resource types. For example the <code class="constant">/order/foo/comments</code> operation
			can belongs on the <code class="classname">Order</code> resource with the <code class="constant">comments</code>
			relation, and on the <code class="classname">Comment</code> resource with the <code class="constant">list</code>
			relation. 
			</p>
		</div>
		<div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d4e503"/>8.2.5. Specifying path parameter values for URI templates</h3></div></div></div>
			
			<p>
			When RESTEasy adds links to your resources it needs to insert the right values in the URI template.
			This is done either automatically by guessing the list of values from the entity, or by specifying
			the values in the <code class="classname">@LinkResource</code> <code class="varname">pathParameters</code> parameter.
			</p>
			<div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d4e508"/>8.2.5.1. Loading URI template values from the entity</h4></div></div></div>
				
				<p>
					URI template values are extracted from the entity from fields or Java Bean properties
					annotated with <code class="classname">@ResourceID</code>, JAXB's <code class="classname">@XmlID</code> or 
					JPA's <code class="classname">@Id</code>. If there are more than one URI template
					value to find in a given entity, you can annotate your entity with <code class="classname">@ResourceIDs</code>
					to list the names of fields or properties that make up this entity's Id. If there are other
					URI template values required from a parent entity, we try to find that parent in a field or
					Java Bean property
					annotated with <code class="classname">@ParentResource</code>. The list of URI template
					values extracted up every <code class="classname">@ParentResource</code> is then reversed and used
					as the list of values for the URI template.
				</p>
				<p>For example, let's consider the previous Book example, and a list of comments:</p>
			<pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">XmlRootElement</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">XmlAccessorType</span><span class="java_separator">(</span><span class="java_type">XmlAccessType</span><span class="java_separator">.</span><span class="java_plain">NONE</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Comment</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">ParentResource</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">Book</span><span class="java_plain">&nbsp;book</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">XmlElement</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;author</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">XmlID</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">XmlAttribute</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">XmlElementRef</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">RESTServiceDiscovery</span><span class="java_plain">&nbsp;rest</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_separator">}</span></pre>
				<p>
				Given the previous book store service augmented with comments:
				</p>
			<pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Path</span><!-- <br/> --><span class="java_separator">(</span><!-- <br/> --><span class="java_literal">&quot;/&quot;</span><!-- <br/> --><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Consumes</span><span class="java_separator">({</span><span class="java_literal">&quot;application/xml&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;application/json&quot;</span><span class="java_separator">})</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Produces</span><span class="java_separator">({</span><span class="java_literal">&quot;application/xml&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;application/json&quot;</span><span class="java_separator">})</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">interface</span><span class="java_plain">&nbsp;</span><span class="java_type">BookStore</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">AddLinks</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">LinkResources</span><span class="java_separator">({</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">LinkResource</span><span class="java_separator">(</span><span class="java_plain">value&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">Book</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">,</span><span class="java_plain">&nbsp;rel&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;comments&quot;</span><span class="java_separator">),</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">LinkResource</span><span class="java_separator">(</span><span class="java_plain">value&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">Comment</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">})</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@GET</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Path</span><span class="java_separator">(</span><span class="java_literal">&quot;book/{id}/comments&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">Collection</span><span class="java_operator">&lt;</span><span class="java_type">Comment</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;getComments</span><span class="java_separator">(</span><span class="java_plain">@</span><span class="java_type">PathParam</span><span class="java_separator">(</span><span class="java_literal">&quot;id&quot;</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;bookId</span><span class="java_separator">);</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">AddLinks</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">LinkResource</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@GET</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Path</span><span class="java_separator">(</span><span class="java_literal">&quot;book/{id}/comment/{cid}&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">Comment</span><span class="java_plain">&nbsp;getComment</span><span class="java_separator">(</span><span class="java_plain">@</span><span class="java_type">PathParam</span><span class="java_separator">(</span><span class="java_literal">&quot;id&quot;</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;bookId</span><span class="java_separator">,</span><span class="java_plain">&nbsp;@</span><span class="java_type">PathParam</span><span class="java_separator">(</span><span class="java_literal">&quot;cid&quot;</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;commentId</span><span class="java_separator">);</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">LinkResource</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@POST</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Path</span><span class="java_separator">(</span><span class="java_literal">&quot;book/{id}/comments&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;addComment</span><span class="java_separator">(</span><span class="java_plain">@</span><span class="java_type">PathParam</span><span class="java_separator">(</span><span class="java_literal">&quot;id&quot;</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;bookId</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">Comment</span><span class="java_plain">&nbsp;comment</span><span class="java_separator">);</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">LinkResource</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@PUT</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Path</span><span class="java_separator">(</span><span class="java_literal">&quot;book/{id}/comment/{cid}&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;updateComment</span><span class="java_separator">(</span><span class="java_plain">@</span><span class="java_type">PathParam</span><span class="java_separator">(</span><span class="java_literal">&quot;id&quot;</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;bookId</span><span class="java_separator">,</span><span class="java_plain">&nbsp;@</span><span class="java_type">PathParam</span><span class="java_separator">(</span><span class="java_literal">&quot;cid&quot;</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;commentId</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">Comment</span><span class="java_plain">&nbsp;comment</span><span class="java_separator">);</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">LinkResource</span><span class="java_separator">(</span><span class="java_type">Comment</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@DELETE</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Path</span><span class="java_separator">(</span><span class="java_literal">&quot;book/{id}/comment/{cid}&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;deleteComment</span><span class="java_separator">(</span><span class="java_plain">@</span><span class="java_type">PathParam</span><span class="java_separator">(</span><span class="java_literal">&quot;id&quot;</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;bookId</span><span class="java_separator">,</span><span class="java_plain">&nbsp;@</span><span class="java_type">PathParam</span><span class="java_separator">(</span><span class="java_literal">&quot;cid&quot;</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;commentId</span><span class="java_separator">);</span>
</span>
<!--  --><br/><span class="java_separator">}</span></pre>
				<p>
				Whenever we need to make links for a <code class="classname">Book</code> entity, we look up the ID
				in the <code class="classname">Book</code>'s <code class="classname">@XmlID</code> property. Whenever we make links
				for <code class="classname">Comment</code> entities, we have a list of values taken from the <code class="classname">Comment</code>'s
				<code class="classname">@XmlID</code> and its <code class="classname">@ParentResource</code>: the <code class="classname">Book</code> and
				its <code class="classname">@XmlID</code>.
				</p>
				<p>
				For a <code class="classname">Comment</code> with <code class="varname">id</code> <code class="constant">"1"</code> on a <code class="classname">Book</code>
				with <code class="varname">title</code> <code class="constant">"foo"</code> we will therefore get a list of URI
				template values of <code class="constant">{"foo", "1"}</code>, to be replaced in the URI template, thus
				obtaining either <code class="constant">"/book/foo/comments"</code> or <code class="constant">"/book/foo/comment/1"</code>.
				</p>
			</div>
			<div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d4e541"/>8.2.5.2. Specifying path parameters manually</h4></div></div></div>
				
				<p>
				If you do not want to annotate your entities with resource ID annotations (<code class="classname">@ResourceID</code>,
				<code class="classname">@ResourceIDs</code>, <code class="classname">@XmlID</code> or <code class="classname">@Id</code>) and 
				<code class="classname">@ParentResource</code>, you can also specify the URI template values inside the
				<code class="classname">@LinkResource</code> annotation, using Unified Expression Language expressions:
				</p>
				<table id="d4e550">
					<caption>Table 8.3. <p><code class="classname">@LinkResource</code> URI template parameter</p></caption>
					<thead>
						<tr>
							<th rowspan="1" colspan="1">Parameter</th>
							<th rowspan="1" colspan="1">Type</th>
							<th rowspan="1" colspan="1">Function</th>
							<th rowspan="1" colspan="1">Default</th>
						</tr>
					</thead>
					<tbody>
						<tr>
							<td rowspan="1" colspan="1">pathParameters</td>
							<td rowspan="1" colspan="1"><code class="classname">String[]</code></td>
							<td rowspan="1" colspan="1">Declares a list of UEL expressions to obtain the URI template values.</td>
							<td rowspan="1" colspan="1">Defaults to using <code class="classname">@ResourceID</code>, <code class="classname">@ResourceIDs</code>,
							<code class="classname">@XmlID</code> or <code class="classname">@Id</code> and <code class="classname">@ParentResource</code>
							annotations to extract the values from the model.</td>
						</tr>
					</tbody>
				</table>
				<p>
				The UEL expressions are evaluated in the context of the entity, which means that any unqualified
				variable will be taken as a property for the entity itself, with the special variable 
				<code class="varname">this</code> bound to the entity we're generating links for.
				</p>
				<p>
				The previous example of <code class="classname">Comment</code> service could be declared as such:
				</p>
				<pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Path</span><!-- <br/> --><span class="java_separator">(</span><!-- <br/> --><span class="java_literal">&quot;/&quot;</span><!-- <br/> --><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Consumes</span><span class="java_separator">({</span><span class="java_literal">&quot;application/xml&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;application/json&quot;</span><span class="java_separator">})</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Produces</span><span class="java_separator">({</span><span class="java_literal">&quot;application/xml&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;application/json&quot;</span><span class="java_separator">})</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">interface</span><span class="java_plain">&nbsp;</span><span class="java_type">BookStore</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">AddLinks</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">LinkResources</span><span class="java_separator">({</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">LinkResource</span><span class="java_separator">(</span><span class="java_plain">value&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">Book</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">,</span><span class="java_plain">&nbsp;rel&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;comments&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;pathParameters&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;${title}&quot;</span><span class="java_separator">),</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">LinkResource</span><span class="java_separator">(</span><span class="java_plain">value&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">Comment</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">,</span><span class="java_plain">&nbsp;pathParameters&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_literal">&quot;${book.title}&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;${id}&quot;</span><span class="java_separator">})</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">})</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@GET</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Path</span><span class="java_separator">(</span><span class="java_literal">&quot;book/{id}/comments&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">Collection</span><span class="java_operator">&lt;</span><span class="java_type">Comment</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;getComments</span><span class="java_separator">(</span><span class="java_plain">@</span><span class="java_type">PathParam</span><span class="java_separator">(</span><span class="java_literal">&quot;id&quot;</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;bookId</span><span class="java_separator">);</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">AddLinks</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">LinkResource</span><span class="java_separator">(</span><span class="java_plain">pathParameters&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_literal">&quot;${book.title}&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;${id}&quot;</span><span class="java_separator">})</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@GET</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Path</span><span class="java_separator">(</span><span class="java_literal">&quot;book/{id}/comment/{cid}&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">Comment</span><span class="java_plain">&nbsp;getComment</span><span class="java_separator">(</span><span class="java_plain">@</span><span class="java_type">PathParam</span><span class="java_separator">(</span><span class="java_literal">&quot;id&quot;</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;bookId</span><span class="java_separator">,</span><span class="java_plain">&nbsp;@</span><span class="java_type">PathParam</span><span class="java_separator">(</span><span class="java_literal">&quot;cid&quot;</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;commentId</span><span class="java_separator">);</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">LinkResource</span><span class="java_separator">(</span><span class="java_plain">pathParameters&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_literal">&quot;${book.title}&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;${id}&quot;</span><span class="java_separator">})</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@POST</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Path</span><span class="java_separator">(</span><span class="java_literal">&quot;book/{id}/comments&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;addComment</span><span class="java_separator">(</span><span class="java_plain">@</span><span class="java_type">PathParam</span><span class="java_separator">(</span><span class="java_literal">&quot;id&quot;</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;bookId</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">Comment</span><span class="java_plain">&nbsp;comment</span><span class="java_separator">);</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">LinkResource</span><span class="java_separator">(</span><span class="java_plain">pathParameters&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_literal">&quot;${book.title}&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;${id}&quot;</span><span class="java_separator">})</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@PUT</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Path</span><span class="java_separator">(</span><span class="java_literal">&quot;book/{id}/comment/{cid}&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;updateComment</span><span class="java_separator">(</span><span class="java_plain">@</span><span class="java_type">PathParam</span><span class="java_separator">(</span><span class="java_literal">&quot;id&quot;</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;bookId</span><span class="java_separator">,</span><span class="java_plain">&nbsp;@</span><span class="java_type">PathParam</span><span class="java_separator">(</span><span class="java_literal">&quot;cid&quot;</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;commentId</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">Comment</span><span class="java_plain">&nbsp;comment</span><span class="java_separator">);</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">LinkResource</span><span class="java_separator">(</span><span class="java_type">Comment</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">,</span><span class="java_plain">&nbsp;pathParameters&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_literal">&quot;${book.title}&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;${id}&quot;</span><span class="java_separator">})</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@DELETE</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Path</span><span class="java_separator">(</span><span class="java_literal">&quot;book/{id}/comment/{cid}&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;deleteComment</span><span class="java_separator">(</span><span class="java_plain">@</span><span class="java_type">PathParam</span><span class="java_separator">(</span><span class="java_literal">&quot;id&quot;</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;bookId</span><span class="java_separator">,</span><span class="java_plain">&nbsp;@</span><span class="java_type">PathParam</span><span class="java_separator">(</span><span class="java_literal">&quot;cid&quot;</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;commentId</span><span class="java_separator">);</span>
</span>
<!--  --><br/><span class="java_separator">}</span></pre>
			</div>
		</div>
		<div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d4e577"/>8.2.6. Securing entities</h3></div></div></div>
			
			<p>
			You can restrict which links are injected in the resource based on security restrictions for the client,
			so that if the current client doesn't have permission to delete a resource he will not be presented
			with the <code class="constant">"delete"</code> link relation.
			</p>
			<p>
			Security restrictions can either be specified on the <code class="classname">@LinkResource</code> annotation,
			or using RESTEasy and EJB's security annotation <code class="classname">@RolesAllowed</code> on the JAX-RS
			method.
			</p>
			<table id="d4e584">
				<caption>Table 8.4. <p><code class="classname">@LinkResource</code> security restrictions</p></caption>
				<thead>
					<tr>
						<th rowspan="1" colspan="1">Parameter</th>
						<th rowspan="1" colspan="1">Type</th>
						<th rowspan="1" colspan="1">Function</th>
						<th rowspan="1" colspan="1">Default</th>
					</tr>
				</thead>
				<tbody>
					<tr>
						<td rowspan="1" colspan="1">constraint</td>
						<td rowspan="1" colspan="1"><code class="classname">String</code></td>
						<td rowspan="1" colspan="1">A UEL expression which must evaluate to true to inject this method's link in the
						response entity.</td>
						<td rowspan="1" colspan="1">Defaults to using <code class="classname">@RolesAllowed</code> from the JAX-RS method.</td>
					</tr>
				</tbody>
			</table>
		</div>
		<div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d4e602"/>8.2.7. Extending the UEL context</h3></div></div></div>
			
			<p>
			We've seen that both the URI template values and the security constraints of <code class="classname">@LinkResource</code>
			use UEL to evaluate expressions, and we provide a basic UEL context with access only to the entity
			we're injecting links in, and nothing more.
			</p>
			<p>
			If you want to add more variables or functions in this
			context, you can by adding a <code class="classname">@LinkELProvider</code> annotation on the JAX-RS method,
			its class, or its package. This annotation's value should point to a class that implements the
			<code class="classname">ELProvider</code> interface, which wraps the default <code class="classname">ELContext</code>
			in order to add any missing functions.
			</p>
			<p>
			For example, if you want to support the Seam annotation <code class="varname">s:hasPermission(target, permission)</code>
			in your security constraints, you can add a <code class="classname">package-info.java</code> file like this:
			</p>
			<pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">LinkELProvider</span><!-- <br/> --><span class="java_separator">(</span><!-- <br/> --><span class="java_type">SeamELProvider</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_keyword">class</span><!-- <br/> --><span class="java_separator">)</span>
<!--  --><br/><span class="java_keyword">package</span><span class="java_plain">&nbsp;org</span><span class="java_separator">.</span><span class="java_plain">jboss</span><span class="java_separator">.</span><span class="java_plain">resteasy</span><span class="java_separator">.</span><span class="java_plain">links</span><span class="java_separator">.</span><span class="java_plain">test</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_keyword">import</span><span class="java_plain">&nbsp;org</span><span class="java_separator">.</span><span class="java_plain">jboss</span><span class="java_separator">.</span><span class="java_plain">resteasy</span><span class="java_separator">.</span><span class="java_plain">links</span><span class="java_separator">.</span><span class="java_operator">*</span><span class="java_separator">;</span></pre>
			<p>
			With the following provider implementation:
			</p>
			<pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_keyword">package</span><!-- <br/> --><span class="java_plain">&nbsp;org</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">jboss</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">resteasy</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">links</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">test</span><!-- <br/> --><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_keyword">import</span><span class="java_plain">&nbsp;javax</span><span class="java_separator">.</span><span class="java_plain">el</span><span class="java_separator">.</span><span class="java_type">ELContext</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_keyword">import</span><span class="java_plain">&nbsp;javax</span><span class="java_separator">.</span><span class="java_plain">el</span><span class="java_separator">.</span><span class="java_type">ELResolver</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_keyword">import</span><span class="java_plain">&nbsp;javax</span><span class="java_separator">.</span><span class="java_plain">el</span><span class="java_separator">.</span><span class="java_type">FunctionMapper</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_keyword">import</span><span class="java_plain">&nbsp;javax</span><span class="java_separator">.</span><span class="java_plain">el</span><span class="java_separator">.</span><span class="java_type">VariableMapper</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_keyword">import</span><span class="java_plain">&nbsp;org</span><span class="java_separator">.</span><span class="java_plain">jboss</span><span class="java_separator">.</span><span class="java_plain">seam</span><span class="java_separator">.</span><span class="java_plain">el</span><span class="java_separator">.</span><span class="java_type">SeamFunctionMapper</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_keyword">import</span><span class="java_plain">&nbsp;org</span><span class="java_separator">.</span><span class="java_plain">jboss</span><span class="java_separator">.</span><span class="java_plain">resteasy</span><span class="java_separator">.</span><span class="java_plain">links</span><span class="java_separator">.</span><span class="java_type">ELProvider</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">SeamELProvider</span><span class="java_plain">&nbsp;</span><span class="java_keyword">implements</span><span class="java_plain">&nbsp;</span><span class="java_type">ELProvider</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">ELContext</span><span class="java_plain">&nbsp;getContext</span><span class="java_separator">(</span><span class="java_keyword">final</span><span class="java_plain">&nbsp;</span><span class="java_type">ELContext</span><span class="java_plain">&nbsp;ctx</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">ELContext</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">SeamFunctionMapper</span><span class="java_plain">&nbsp;functionMapper</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Override</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">ELResolver</span><span class="java_plain">&nbsp;getELResolver</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;ctx</span><span class="java_separator">.</span><span class="java_plain">getELResolver</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Override</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">FunctionMapper</span><span class="java_plain">&nbsp;getFunctionMapper</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">if</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_plain">functionMapper&nbsp;</span><span class="java_operator">==</span><span class="java_plain">&nbsp;</span><span class="java_literal">null</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;functionMapper&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">SeamFunctionMapper</span><span class="java_separator">(</span><span class="java_plain">ctx</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">getFunctionMapper</span><span class="java_separator">());</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;functionMapper</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Override</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">VariableMapper</span><span class="java_plain">&nbsp;getVariableMapper</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;ctx</span><span class="java_separator">.</span><span class="java_plain">getVariableMapper</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">};</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_separator">}</span></pre>
			<p>
			And then use it as such:
			</p>
				<pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Path</span><!-- <br/> --><span class="java_separator">(</span><!-- <br/> --><span class="java_literal">&quot;/&quot;</span><!-- <br/> --><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Consumes</span><span class="java_separator">({</span><span class="java_literal">&quot;application/xml&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;application/json&quot;</span><span class="java_separator">})</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Produces</span><span class="java_separator">({</span><span class="java_literal">&quot;application/xml&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;application/json&quot;</span><span class="java_separator">})</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">interface</span><span class="java_plain">&nbsp;</span><span class="java_type">BookStore</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">AddLinks</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">LinkResources</span><span class="java_separator">({</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">LinkResource</span><span class="java_separator">(</span><span class="java_plain">value&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">Book</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">,</span><span class="java_plain">&nbsp;rel&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;comments&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;constraint&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;${s:hasPermission(this,&nbsp;'add-comment')}&quot;</span><span class="java_separator">),</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">LinkResource</span><span class="java_separator">(</span><span class="java_plain">value&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">Comment</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">,</span><span class="java_plain">&nbsp;constraint&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;${s:hasPermission(this,&nbsp;'insert')}&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">})</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@GET</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Path</span><span class="java_separator">(</span><span class="java_literal">&quot;book/{id}/comments&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">Collection</span><span class="java_operator">&lt;</span><span class="java_type">Comment</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;getComments</span><span class="java_separator">(</span><span class="java_plain">@</span><span class="java_type">PathParam</span><span class="java_separator">(</span><span class="java_literal">&quot;id&quot;</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;bookId</span><span class="java_separator">);</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">AddLinks</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">LinkResource</span><span class="java_separator">(</span><span class="java_plain">constraint&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;${s:hasPermission(this,&nbsp;'read')}&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@GET</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Path</span><span class="java_separator">(</span><span class="java_literal">&quot;book/{id}/comment/{cid}&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">Comment</span><span class="java_plain">&nbsp;getComment</span><span class="java_separator">(</span><span class="java_plain">@</span><span class="java_type">PathParam</span><span class="java_separator">(</span><span class="java_literal">&quot;id&quot;</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;bookId</span><span class="java_separator">,</span><span class="java_plain">&nbsp;@</span><span class="java_type">PathParam</span><span class="java_separator">(</span><span class="java_literal">&quot;cid&quot;</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;commentId</span><span class="java_separator">);</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">LinkResource</span><span class="java_separator">(</span><span class="java_plain">constraint&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;${s:hasPermission(this,&nbsp;'insert')}&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@POST</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Path</span><span class="java_separator">(</span><span class="java_literal">&quot;book/{id}/comments&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;addComment</span><span class="java_separator">(</span><span class="java_plain">@</span><span class="java_type">PathParam</span><span class="java_separator">(</span><span class="java_literal">&quot;id&quot;</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;bookId</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">Comment</span><span class="java_plain">&nbsp;comment</span><span class="java_separator">);</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">LinkResource</span><span class="java_separator">(</span><span class="java_plain">constraint&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;${s:hasPermission(this,&nbsp;'update')}&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@PUT</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Path</span><span class="java_separator">(</span><span class="java_literal">&quot;book/{id}/comment/{cid}&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;updateComment</span><span class="java_separator">(</span><span class="java_plain">@</span><span class="java_type">PathParam</span><span class="java_separator">(</span><span class="java_literal">&quot;id&quot;</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;bookId</span><span class="java_separator">,</span><span class="java_plain">&nbsp;@</span><span class="java_type">PathParam</span><span class="java_separator">(</span><span class="java_literal">&quot;cid&quot;</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;commentId</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">Comment</span><span class="java_plain">&nbsp;comment</span><span class="java_separator">);</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">LinkResource</span><span class="java_separator">(</span><span class="java_type">Comment</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">,</span><span class="java_plain">&nbsp;constraint&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;${s:hasPermission(this,&nbsp;'delete')}&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@DELETE</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Path</span><span class="java_separator">(</span><span class="java_literal">&quot;book/{id}/comment/{cid}&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;deleteComment</span><span class="java_separator">(</span><span class="java_plain">@</span><span class="java_type">PathParam</span><span class="java_separator">(</span><span class="java_literal">&quot;id&quot;</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;bookId</span><span class="java_separator">,</span><span class="java_plain">&nbsp;@</span><span class="java_type">PathParam</span><span class="java_separator">(</span><span class="java_literal">&quot;cid&quot;</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;commentId</span><span class="java_separator">);</span>
</span>
<!--  --><br/><span class="java_separator">}</span></pre>
		</div>
		<div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d4e618"/>8.2.8. Resource facades</h3></div></div></div>
			
			<p>
			Sometimes it is useful to add resources which are just containers or layers on other resources. For
			example if you want to represent a collection of <code class="classname">Comment</code> with a start index
			and a certain number of entries, in order to implement paging. Such a collection is not really an 
			entity in your model, but it should obtain the <code class="constant">"add"</code> and <code class="constant">"list"</code>
			link relations for the <code class="constant">Comment</code> entity.
			</p>
			<p>
			This is possible using resource facades. A resource facade is a resource which implements the
			<code class="classname">ResourceFacade&lt;T&gt;</code> interface for the type <code class="varname">T</code>, and as
			such, should receive all links for that type.
			</p>
			<p>
			Since in most cases the instance of the <code class="varname">T</code> type is not directly available in the
			resource facade, we need another way to extract its URI template values, and this is done by calling
			the resource facade's <code class="methodname">pathParameters()</code> method to obtain a map of URI template
			values by name. This map will be used to fill in the URI template values for any link generated for
			<code class="varname">T</code>, if there are enough values in the map.
			</p>
			<p>
			Here is an example of such a resource facade for a collection of <code class="classname">Comment</code>s:
			</p>
				<pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">XmlRootElement</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">XmlAccessorType</span><span class="java_separator">(</span><span class="java_type">XmlAccessType</span><span class="java_separator">.</span><span class="java_plain">NONE</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">ScrollableCollection</span><span class="java_plain">&nbsp;</span><span class="java_keyword">implements</span><span class="java_plain">&nbsp;</span><span class="java_type">ResourceFacade</span><span class="java_operator">&lt;</span><span class="java_type">Comment</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;bookId</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">XmlAttribute</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">int</span><span class="java_plain">&nbsp;start</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">XmlAttribute</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">int</span><span class="java_plain">&nbsp;totalRecords</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">XmlElement</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">List</span><span class="java_operator">&lt;</span><span class="java_type">Comment</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;comments&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">ArrayList</span><span class="java_operator">&lt;</span><span class="java_type">Comment</span><span class="java_operator">&gt;</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">XmlElementRef</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">RESTServiceDiscovery</span><span class="java_plain">&nbsp;rest</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">Class</span><span class="java_operator">&lt;</span><span class="java_type">Comment</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;facadeFor</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;</span><span class="java_type">Comment</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">Map</span><span class="java_operator">&lt;</span><span class="java_type">String</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_operator">?</span><span class="java_plain">&nbsp;</span><span class="java_keyword">extends</span><span class="java_plain">&nbsp;</span><span class="java_type">Object</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;pathParameters</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">HashMap</span><span class="java_operator">&lt;</span><span class="java_type">String</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;map&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">HashMap</span><span class="java_operator">&lt;</span><span class="java_type">String</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_operator">&gt;</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;map</span><span class="java_separator">.</span><span class="java_plain">put</span><span class="java_separator">(</span><span class="java_literal">&quot;id&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;bookId</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;map</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_separator">}</span></pre>
			<p>
			This will produce such an XML collection:
			</p>
			<pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_plain"></span><br />
<span class="xml_processing_instruction">&lt;?xml&nbsp;version=&quot;1.0&quot;&nbsp;encoding=&quot;UTF-8&quot;&nbsp;standalone=&quot;yes&quot;?&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">collection</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">xmlns:atom</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;http://www.w3.org/2005/Atom&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">totalRecords</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;2&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">start</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;0&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">atom.link</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">href</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;http://localhost:8081/book/foo/comments&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">rel</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;add&quot;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">atom.link</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">href</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;http://localhost:8081/book/foo/comments&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">rel</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;list&quot;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">comment</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">xmlid</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;0&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">text</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">great&nbsp;book</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">text</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">atom.link</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">href</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;http://localhost:8081/book/foo/comment/0&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">rel</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;self&quot;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">atom.link</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">href</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;http://localhost:8081/book/foo/comment/0&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">rel</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;update&quot;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">atom.link</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">href</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;http://localhost:8081/book/foo/comment/0&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">rel</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;remove&quot;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">atom.link</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">href</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;http://localhost:8081/book/foo/comments&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">rel</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;add&quot;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">atom.link</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">href</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;http://localhost:8081/book/foo/comments&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">rel</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;list&quot;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">comment</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">comment</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">xmlid</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;1&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">text</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">terrible&nbsp;book</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">text</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">atom.link</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">href</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;http://localhost:8081/book/foo/comment/1&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">rel</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;self&quot;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">atom.link</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">href</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;http://localhost:8081/book/foo/comment/1&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">rel</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;update&quot;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">atom.link</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">href</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;http://localhost:8081/book/foo/comment/1&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">rel</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;remove&quot;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">atom.link</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">href</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;http://localhost:8081/book/foo/comments&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">rel</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;add&quot;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">atom.link</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">href</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;http://localhost:8081/book/foo/comments&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">rel</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;list&quot;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">comment</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">collection</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
</pre>
		</div>
	</div>
</div>

   <div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="_MatrixParam"/>Chapter 9. @MatrixParam</h2></div></div></div>


<p>

The idea of matrix parameters is that they are an arbitrary set of name-value pairs embedded in a uri path segment.  
A matrix parameter example is:
</p>
<p>

GET http://host.com/library/book;name=EJB 3.0;author=Bill Burke
</p>
<p>

The basic idea of matrix parameters is that it represents resources that are addressable by their attributes as well as their raw id.  The @MatrixParam annotation allows you to inject URI matrix parameters into your method invocation
</p>
<p>

</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">

   @GET
   public String getBook(@MatrixParam("name") String name, @MatrixParam("author") String author) {...}
</pre><p>
</p>
<p>

There is one big problem with @MatrixParam that the current version of the specification does not resolve.  What if the same MatrixParam exists twice in different path segments?  In this case, right now, its probably better to use PathParam combined with PathSegment.
</p>
<p>

</p>
<p>

</p>
<p>


</p>
</div>

   <div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="_CookieParam"/>Chapter 10. @CookieParam</h2></div></div></div>


<p>

The @CookieParam annotation allows you to inject the value of a cookie or an object representation of an HTTP request cookie into your method invocation
</p>
<p>

GET /books?num=5
</p>
<p>

</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">
   


   @GET
   public String getBooks(@CookieParam("sessionid") int id) {
   ...
   }

   @GET
   publi cString getBooks(@CookieParam("sessionid") javax.ws.rs.core.Cookie id) {...}
</pre><p>
</p>
<p>

Like PathParam, your parameter type can be an String, primitive, or class that has a String constructor or static valueOf() method.  You can also get an object representation of the cookie via the javax.ws.rs.core.Cookie class.
</p>
<p>

</p>
<p>


</p>
</div>

   <div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="_FormParam"/>Chapter 11. @FormParam</h2></div></div></div>


<p>

When the input request body is of the type "application/x-www-form-urlencoded", a.k.a. an HTML Form, you can inject individual form parameters from the request body into method parameter values.
</p>
<p>

</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">
&lt;form method="POST" action="/resources/service"&gt;
First name: 
&lt;input type="text" name="firstname"&gt;
&lt;br&gt;
Last name: 
&lt;input type="text" name="lastname"&gt;
&lt;/form&gt;
</pre><p>
</p>
<p>

If you post through that form, this is what the service might look like:
</p>
<p>

</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">
@Path("/")
public class NameRegistry {

   @Path("/resources/service")
   @POST
   public void addName(@FormParam("firstname") String first, @FormParam("lastname") String last) {...}

</pre><p>
</p>
<p>

You cannot combine @FormParam with the default "application/x-www-form-urlencoded" that unmarshalls to a MultivaluedMap&lt;String, String&gt;.  i.e. This is illegal:
</p>
<p>

</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">
@Path("/")
public class NameRegistry {

   @Path("/resources/service")
   @POST
   @Consumes("application/x-www-form-urlencoded")
   public void addName(@FormParam("firstname") String first, MultivaluedMap&lt;String, String&gt; form) {...}

</pre><p>
</p>
<p>


</p>
</div>

   <div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="_Form"/>Chapter 12. @Form</h2></div></div></div>


<p>

This is a RESTEasy specific annotation that allows you to re-use any @*Param annotation within an injected class.  RESTEasy will instantiate the class and inject values into any annotated @*Param or @Context property.  This is useful if you have a lot of parameters on your method and you want to condense them into a value object.
</p>
<p>

</p>
<p>

</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">
public class MyForm {

   @FormParam("stuff")
   private int stuff;


   @HeaderParam("myHeader")
   private String header;


   @PathParam("foo")
   public void setFoo(String foo) {...}
}



@POST
@Path("/myservice")
public void post(@Form MyForm form) {...}
</pre><p>
</p>
<p>

When somebody posts to /myservice, RESTEasy will instantiate an instance of MyForm and inject the form parameter "stuff" into the "stuff" field, the header "myheader" into the header field, and call the setFoo method with the path param variable of "foo".
</p>
<p>

</p>
<p>
Also, @Form has some expanded @FormParam features.  If you specify a prefix within the Form param, this will prepend a prefix to any form parameter lookup.  For example,
    let's say you have one Address class, but want to reference invoice and shipping addresses from the same set of form parameters:
</p>
<pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">
    public static class Person
    {

       @FormParam("name")
       private String name;

       @Form(prefix = "invoice")
       private Address invoice;

       @Form(prefix = "shipping")
       private Address shipping;

    }

    public static class Address
    {

       @FormParam("street")
       private String street;
    }

    @Path("person")
    public static class MyResource
    {

       @POST
       @Produces(MediaType.TEXT_PLAIN)
       @Consumes(MediaType.APPLICATION_FORM_URLENCODED)
       public String post(@Form Person p)
       {
          return p.toString();
       }
    }
</pre>
    <p>
        In this example, the client could send the following form parameters:
    </p>
    <pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">
name=bill
invoice.street=xxx
shipping.street=yyy
    </pre>
    <p>
        The Person.invoice and Person.shipping fields would be populated appropriately. Also, prefix mappings also support lists and maps:
    </p>
<pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">
    
    public static class Person {
        @Form(prefix="telephoneNumbers") List&lt;TelephoneNumber&gt; telephoneNumbers;
        @Form(prefix="address") Map&lt;String, Address&gt; addresses;
    }

    public static class TelephoneNumber {
        @FormParam("countryCode") private String countryCode;
        @FormParam("number") private String number;
    }

    public static class Address {
        @FormParam("street") private String street;
        @FormParam("houseNumber") private String houseNumber;
    }

    @Path("person")
    public static class MyResource {

        @POST
        @Consumes(MediaType.APPLICATION_FORM_URLENCODED)
        public void post (@Form Person p) {} 

</pre>
    <p>The following form params could be submitted and the Person.telephoneNumbers and Person.addresses fields would be populated appropriately</p>
<pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">
    request.addFormHeader("telephoneNumbers[0].countryCode", "31");
    request.addFormHeader("telephoneNumbers[0].number", "0612345678");
    request.addFormHeader("telephoneNumbers[1].countryCode", "91");
    request.addFormHeader("telephoneNumbers[1].number", "9717738723");
    request.addFormHeader("address[INVOICE].street", "Main Street");
    request.addFormHeader("address[INVOICE].houseNumber", "2");
    request.addFormHeader("address[SHIPPING].street", "Square One");
    request.addFormHeader("address[SHIPPING].houseNumber", "13");

</pre>

</div>

   <div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="_DefaultValue"/>Chapter 13. @DefaultValue</h2></div></div></div>


<p>

@DefaultValue is a parameter annotation that can be combined with any of the other @*Param annotations to define a default value when the HTTP request item does not exist.
</p>
<p>

</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">
   @GET
   public String getBooks(@QueryParam("num") @DefaultValue("10") int num) {...}
</pre><p>
</p>
<p>

</p>
<p>


</p>
</div>

   <div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="_Encoded_and_encoding"/>Chapter 14. @Encoded and encoding</h2></div></div></div>


<p>

JAX-RS allows you to get encoded or decoded @*Params and specify path definitions and parameter names using encoded or decoded strings.
</p>
<p>


</p>
<p>

The @javax.ws.rs.Encoded annotation can be used on a class, method, or param.  By default, inject @PathParam and @QueryParams are decoded.  By additionally adding the @Encoded annotation, the value of these params will be provided in encoded form.
</p>
<p>

</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">
@Path("/")
public class MyResource {

  @Path("/{param}")
  @GET
  public String get(@PathParam("param") @Encoded String param) {...}
</pre><p>
</p>
<p>

In the above example, the value of the @PathParam injected into the param of the get() method will be URL encoded.  Adding the @Encoded annotation as a paramater annotation triggers this affect.
</p>
<p>

You may also use the @Encoded annotation on the entire method and any combination of @QueryParam or @PathParam's values will be encoded.
</p>
<p>

</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">
@Path("/")
public class MyResource {
  
   @Path("/{param}")
   @GET
   @Encoded
   public String get(@QueryParam("foo") String foo, @PathParam("param") String param) {}
}


</pre><p>
</p>
<p>

In the above example, the values of the "foo" query param and "param" path param will be injected as encoded values.
</p>
<p>

You can also set the default to be encoded for the entire class.
</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">
@Path("/")
@Encoded
public class ClassEncoded {
  
   @GET
   public String get(@QueryParam("foo") String foo) {}
}
</pre><p>
</p>
<p>


</p>
<p>

The @Path annotation has an attribute called encode.  Controls whether the literal part of the supplied value (those characters that are not part of a template variable) are URL encoded. If true, any characters in the URI template that are not valid URI character will be automatically encoded. If false then all characters must be valid URI characters.  By default this is set to true.  If you want to encoded the characters yourself, you may.
</p>
<p>

</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">
@Path(value="hello%20world", encode=false)
</pre><p>
</p>
<p>


</p>
<p>

Much like @Path.encode(), this controls whether the specified query param name should be encoded by the container before it tries to find the query param in the request.
</p>
<p>

</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">
@QueryParam(value="hello%20world", encode=false)
</pre><p>
</p>
<p>

</p>
<p>

</p>
<p>


</p>
</div>

   <div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="_Context"/>Chapter 15. @Context</h2></div></div></div>


<p>

The @Context annotation allows you to inject instances of javax.ws.rs.core.HttpHeaders, javax.ws.rs.core.UriInfo, javax.ws.rs.core.Request, javax.servlet.HttpServletRequest, javax.servlet.HttpServletResponse, javax.servlet.ServletConfig, javax.servlet.ServletContext, and javax.ws.rs.core.SecurityContext objects.
</p>
<p>


</p>
</div>

   <div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="JAX-RS_Resource_Locators_and_Sub_Resources"/>Chapter 16. JAX-RS Resource Locators and Sub Resources</h2></div></div></div>


<p>

Resource classes are able to partially process a request and provide another "sub" resource object that can process the remainder of the request.  For example:
</p>
<p>

</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">
@Path("/")
public class ShoppingStore {

   @Path("/customers/{id}")
   public Customer getCustomer(@PathParam("id") int id) {
      Customer cust = ...; // Find a customer object
      return cust;
   }
}


public class Customer {
   
    @GET
    public String get() {...}

    @Path("/address")
    public String getAddress() {...}

}

</pre><p>
</p>
<p>

</p>
<p>

Resource methods that have a @Path annotation, but no HTTP method are considered sub-resource locators.  Their job is to provide an object that can process the request.  In the above example ShoppingStore is a root resource because its class is annotated with @Path.  The getCustomer() method is a sub-resource locator method.
</p>
<p>

If the client invoked:
</p>
<p>

</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">GET /customer/123</pre><p>
</p>
<p>

The ShoppingStore.getCustomer() method would be invoked first.  This method provides a Customer object that can service the request.  The http request will be dispatched to the Customer.get() method.  Another example is:
</p>
<p>

</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">GET /customer/123/address</pre><p>
</p>
<p>

In this request, again, first the ShoppingStore.getCustomer() method is invoked.  A customer object is returned, and the rest of the request is dispatched to the Customer.getAddress() method.
</p>
<p>


</p>
<p>

Another interesting feature of Sub-resource locators is that the locator method result is dynamically processed at runtime to figure out how to dispatch the request.  So, the ShoppingStore.getCustomer() method does not have to declare any specific type.
</p>
<p>

</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">
@Path("/")
public class ShoppingStore {

   @Path("/customers/{id}")
   public java.lang.Object getCustomer(@PathParam("id") int id) {
      Customer cust = ...; // Find a customer object
      return cust;
   }
}


public class Customer {
   
    @GET
    public String get() {...}

    @Path("/address")
    public String getAddress() {...}

}

</pre><p>
</p>
<p>

In the above example, getCustomer() returns a java.lang.Object.  Per request, at runtime, the JAX-RS server will figure out how to dispatch the request based on the object returned by getCustomer().  What are the uses of this?  Well, maybe you have a class hierarchy for your customers.  Customer is the abstract base, CorporateCustomer and IndividualCustomer are subclasses.  Your getCustomer() method might be doing a Hibernate polymorphic query and doesn't know, or care, what concrete class is it querying for, or what it returns.
</p>
<p>

</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">
@Path("/")
public class ShoppingStore {

   @Path("/customers/{id}")
   public java.lang.Object getCustomer(@PathParam("id") int id) {
      Customer cust = entityManager.find(Customer.class, id);
      return cust;
   }
}


public class Customer {
   
    @GET
    public String get() {...}

    @Path("/address")
    public String getAddress() {...}

}

public class CorporateCustomer extendsCustomer {
   
    @Path("/businessAddress")
    public String getAddress() {...}

}

</pre><p>
</p>
<p>

</p>
<p>


</p>
</div>

   <div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="JAX-RS_Content_Negotiation"/>Chapter 17. JAX-RS Content Negotiation</h2></div></div></div><div class="toc"><dl><dt><span class="sect1"><a href="#media_mappings">17.1. URL-based negotiation</a></span></dt><dt><span class="sect1"><a href="#param_media_mappings">17.2. Query String Parameter-based negotiation</a></span></dt></dl></div>
   

   <p>

      The HTTP protocol has built in content negotiation headers that allow the client and server to specify what
      content they are transferring and what content they would prefer to get. The server declares content preferences
      via the @Produces and @Consumes headers.
   </p>
   <p>


      @Consumes is an array of media types that a particular resource or resource method consumes. For example:
   </p>
   <p>

      </p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">
         @Consumes("text/*")
         @Path("/library")
         public class Library {

         @POST
         public String stringBook(String book) {...}


         @Consumes("text/xml")
         @POST
         public String jaxbBook(Book book) {...}
      </pre><p>
   </p>
   <p>

      When a client makes a request, JAX-RS first finds all methods that match the path, then, it sorts things based on
      the content-type header sent by the client.
      So, if a client sent:
   </p>
   <p>

      </p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">
         POST /library
         content-type: text/plain

         thsi sis anice book
      </pre><p>
   </p>
   <p>

      The stringBook() method would be invoked because it matches to the default "text/*" media type. Now, if
      the client instead sends XML:
   </p>
   <p>

      </p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">
         POST /library
         content-type: text/xml

         &lt;book name="EJB 3.0" author="Bill Burke"/&gt;
      </pre><p>
   </p>
   <p>

      The jaxbBook() method would be invoked.
   </p>
   <p>


      The @Produces is used to map a client request and match it up to the client's Accept header. The Accept HTTP
      header is sent by the client and defines the media types the client prefers to receive from the server.
   </p>
   <p>


      </p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">
         @Produces("text/*")
         @Path("/library")
         public class Library {

         @GET
         @Produces("application/json")
         public String getJSON() {...}


         @GET
         public String get() {...}
      </pre><p>
   </p>
   <p>

      So, if the client sends:
   </p>
   <p>

      </p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">
         GET /library
         Accept: application/json
      </pre><p>
   </p>
   <p>

      The getJSON() method would be invoked
   </p>
   <p>


      @Consumes and @Produces can list multiple media types that they support. The client's Accept header can also send
      multiple types it might like to receive. More specific media types are chosen first. The client Accept header or
      @Produces @Consumes can also specify weighted preferences that are used to match up requests with resource
      methods. This is best explained by RFC 2616 section 14.1 . Resteasy supports this complex way of doing content
      negotiation.
   </p>
   <p>


   </p>
   <p>

      A variant in JAX-RS is a combination of media type, content-language, and content encoding as well as etags, last
      modified headers, and other preconditions. This is a more complex form of content negotiation that is done
      programmatically by the application developer using the javax.ws.rs.Variant, VarianListBuilder, and Request
      objects. Request is injected via @Context. Read the javadoc for more info on these.
   </p>
<div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="media_mappings"/>17.1. URL-based negotiation</h2></div></div></div>

<p>
Some clients, like browsers, cannot use the Accept and Accept-Language headers to negotiation the representation's media type
or language.  RESTEasy allows you to map file name suffixes like (.xml, .txt, .en, .fr) to media types and languages.  These file name suffixes
take the place and override any Accept header sent by the client.  You configure this using the resteasy.media.type.mappings and resteasy.language.mappings
context-param variables within your web.xml
</p>
<pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">

&lt;web-app&gt;
    &lt;display-name&gt;Archetype Created Web Application&lt;/display-name&gt;
    &lt;context-param&gt;
        &lt;param-name&gt;resteasy.media.type.mappings&lt;/param-name&gt;
        &lt;param-value&gt;html : text/html, json : application/json, xml : application/xml&lt;/param-value&gt;
    &lt;/context-param&gt;

   &lt;context-param&gt;
        &lt;param-name&gt;resteasy.language.mappings&lt;/param-name&gt;
        &lt;param-value&gt; en : en-US, es : es, fr : fr&lt;/param-name&gt;
   &lt;/context-param&gt;

    &lt;servlet&gt;
        &lt;servlet-name&gt;Resteasy&lt;/servlet-name&gt;
        &lt;servlet-class&gt;org.jboss.resteasy.plugins.server.servlet.HttpServletDispatcher&lt;/servlet-class&gt;
    &lt;/servlet&gt;

    &lt;servlet-mapping&gt;
        &lt;servlet-name&gt;Resteasy&lt;/servlet-name&gt;
        &lt;url-pattern&gt;/*&lt;/url-pattern&gt;
    &lt;/servlet-mapping&gt;
&lt;/web-app&gt;

</pre>
<p>
Mappings are a comma delimited list of suffix/mediatype or suffix/language mappings.  Each mapping is delimited by a ':'.  So, if you invoked GET /foo/bar.xml.en, this would be equivalent to invoking the following request:
</p>
<pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">
GET /foo/bar
Accept: application/xml
Accept-Language: en-US
</pre>
<p>
The mapped file suffixes are stripped from the target URL path before the request is dispatched to a corresponding JAX-RS resource.
</p>
</div>

<div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="param_media_mappings"/>17.2. Query String Parameter-based negotiation</h2></div></div></div>

<p>
RESTEasy can do content negotiation based in a parameter in query string. To enable this, the web.xml can be configured like follow:
</p>
<pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">

&lt;web-app&gt;
    &lt;display-name&gt;Archetype Created Web Application&lt;/display-name&gt;
    &lt;context-param&gt;
        &lt;param-name&gt;resteasy.media.type.param.mapping&lt;/param-name&gt;
        &lt;param-value&gt;someName&lt;/param-value&gt;
    &lt;/context-param&gt;

    &lt;servlet&gt;
        &lt;servlet-name&gt;Resteasy&lt;/servlet-name&gt;
        &lt;servlet-class&gt;org.jboss.resteasy.plugins.server.servlet.HttpServletDispatcher&lt;/servlet-class&gt;
    &lt;/servlet&gt;

    &lt;servlet-mapping&gt;
        &lt;servlet-name&gt;Resteasy&lt;/servlet-name&gt;
        &lt;url-pattern&gt;/*&lt;/url-pattern&gt;
    &lt;/servlet-mapping&gt;
&lt;/web-app&gt;

</pre>
<p>The param-value is the name of the query string parameter that RESTEasy will use in the place of the Accept header.</p>
<p>Invoking http://service.foo.com/resouce?someName=application/xml, will give the application/xml media type the highest priority in the content negotiation.</p>
<p>In cases where the request contains both the parameter and the Accept header, the parameter will be more relevant.</p>
<p>It is possible to left the param-value empty, what will cause the processor to look for a parameter named 'accept'.</p>
</div>

</div>

    <div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="Content_Marshalling_Providers"/>Chapter 18. Content Marshalling/Providers</h2></div></div></div><div class="toc"><dl><dt><span class="sect1"><a href="#Default_Providers_and_default_JAX-RS_Content_Marshalling">18.1. Default Providers and default JAX-RS Content Marshalling</a></span></dt><dt><span class="sect1"><a href="#Content_Marshalling_with__Provider_classes">18.2. Content Marshalling with @Provider classes</a></span></dt><dt><span class="sect1"><a href="#MessageBodyWorkers">18.3. Providers Utility Class</a></span></dt><dt><span class="sect1"><a href="#Configuring_Document_Marshalling">18.4. Configuring Document Marshalling</a></span></dt></dl></div>
   
   <div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="Default_Providers_and_default_JAX-RS_Content_Marshalling"/>18.1. Default Providers and default JAX-RS Content Marshalling</h2></div></div></div>
      

      <p>

         Resteasy can automatically marshal and unmarshal a few different message bodies.
      </p>
      <p>

         </p><div class="table"><a id="d4e788"/><p class="title"><b>Table 18.1. </b></p><div class="table-contents">
            <table border="1"><colgroup><col/><col/></colgroup><thead><tr><th>
                        Media Types
                     </th><th>
                        Java Type
                     </th></tr></thead><tbody><tr><td>
                        application/*+xml, text/*+xml, application/*+json, application/*+fastinfoset, application/atom+*
                     </td><td>
                        JaxB annotated classes
                     </td></tr><tr><td>
                        application/*+xml, text/*+xml
                     </td><td>
                        org.w3c.dom.Document
                     </td></tr><tr><td>
                        */*
                     </td><td>
                        java.lang.String
                     </td></tr><tr><td>
                        */*
                     </td><td>
                        java.io.InputStream
                     </td></tr><tr><td>
                        text/plain
                     </td><td>
                        primtives, java.lang.String, or any type that has a String constructor, or static
                        valueOf(String) method for input, toString() for output
                     </td></tr><tr><td>
                        */*
                     </td><td>
                        javax.activation.DataSource
                     </td></tr><tr><td>
                        */*
                     </td><td>
                        java.io.File
                     </td></tr><tr><td>
                        */*
                     </td><td>
                        byte[]
                     </td></tr><tr><td>
                        application/x-www-form-urlencoded
                     </td><td>
                        javax.ws.rs.core.MultivaluedMap
                     </td></tr></tbody></table>
         </div></div><p><br class="table-break"/>

      </p>
      <p>

      </p>
      <p>

      </p>
      <p>


      </p>
   </div>
   <div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="Content_Marshalling_with__Provider_classes"/>18.2. Content Marshalling with @Provider classes</h2></div></div></div>
      

      <p>

         The JAX-RS specification allows you to plug in your own request/response body reader and writers. To do this,
         you annotate a class
         with @Provider and specify the @Produces types for a writer and @Consumes types for a reader. You must
         also implement
         a MessageBodyReader/Writer interface respectively. Here is an example.
      </p>
      <p>


         The Resteasy ServletContextLoader will automatically scan your WEB-INF/lib and classes directories for classes
         annotated with @Provider or you can manually configure them in web.xml. See Installation/Configuration
      </p>
      <p>


      </p>
   </div>
   <div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="MessageBodyWorkers"/>18.3. Providers Utility Class</h2></div></div></div>
      

      <p>

         javax.ws.rs.ext.Providers is a simple injectable interface that allows you to look up MessageBodyReaders,
          Writers, ContextResolvers, and ExceptionMappers. It is very useful, for instance, for implementing
          multipart providers. Content types that embed
         other random content types.
      </p>
      <p>

         </p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">

public interface Providers
{

   /**
    * Get a message body reader that matches a set of criteria. The set of
    * readers is first filtered by comparing the supplied value of
    * {@code mediaType} with the value of each reader's
    * {@link javax.ws.rs.Consumes}, ensuring the supplied value of
    * {@code type} is assignable to the generic type of the reader, and
    * eliminating those that do not match.
    * The list of matching readers is then ordered with those with the best
    * matching values of {@link javax.ws.rs.Consumes} (x/y &gt; x&amp;#47;* &gt; *&amp;#47;*)
    * sorted first. Finally, the
    * {@link MessageBodyReader#isReadable}
    * method is called on each reader in order using the supplied criteria and
    * the first reader that returns {@code true} is selected and returned.
    *
    * @param type        the class of object that is to be written.
    * @param mediaType   the media type of the data that will be read.
    * @param genericType the type of object to be produced. E.g. if the
    *                    message body is to be converted into a method parameter, this will be
    *                    the formal type of the method parameter as returned by
    *                    &lt;code&gt;Class.getGenericParameterTypes&lt;/code&gt;.
    * @param annotations an array of the annotations on the declaration of the
    *                    artifact that will be initialized with the produced instance. E.g. if the
    *                    message body is to be converted into a method parameter, this will be
    *                    the annotations on that parameter returned by
    *                    &lt;code&gt;Class.getParameterAnnotations&lt;/code&gt;.
    * @return a MessageBodyReader that matches the supplied criteria or null
    *         if none is found.
    */
   &lt;T&gt; MessageBodyReader&lt;T&gt; getMessageBodyReader(Class&lt;T&gt; type,
                                                 Type genericType, Annotation annotations[], MediaType mediaType);

   /**
    * Get a message body writer that matches a set of criteria. The set of
    * writers is first filtered by comparing the supplied value of
    * {@code mediaType} with the value of each writer's
    * {@link javax.ws.rs.Produces}, ensuring the supplied value of
    * {@code type} is assignable to the generic type of the reader, and
    * eliminating those that do not match.
    * The list of matching writers is then ordered with those with the best
    * matching values of {@link javax.ws.rs.Produces} (x/y &gt; x&amp;#47;* &gt; *&amp;#47;*)
    * sorted first. Finally, the
    * {@link MessageBodyWriter#isWriteable}
    * method is called on each writer in order using the supplied criteria and
    * the first writer that returns {@code true} is selected and returned.
    *
    * @param mediaType   the media type of the data that will be written.
    * @param type        the class of object that is to be written.
    * @param genericType the type of object to be written. E.g. if the
    *                    message body is to be produced from a field, this will be
    *                    the declared type of the field as returned by
    *                    &lt;code&gt;Field.getGenericType&lt;/code&gt;.
    * @param annotations an array of the annotations on the declaration of the
    *                    artifact that will be written. E.g. if the
    *                    message body is to be produced from a field, this will be
    *                    the annotations on that field returned by
    *                    &lt;code&gt;Field.getDeclaredAnnotations&lt;/code&gt;.
    * @return a MessageBodyReader that matches the supplied criteria or null
    *         if none is found.
    */
   &lt;T&gt; MessageBodyWriter&lt;T&gt; getMessageBodyWriter(Class&lt;T&gt; type,
                                                 Type genericType, Annotation annotations[], MediaType mediaType);

   /**
    * Get an exception mapping provider for a particular class of exception.
    * Returns the provider whose generic type is the nearest superclass of
    * {@code type}.
    *
    * @param type the class of exception
    * @return an {@link ExceptionMapper} for the supplied type or null if none
    *         is found.
    */
   &lt;T extends Throwable&gt; ExceptionMapper&lt;T&gt; getExceptionMapper(Class&lt;T&gt; type);

   /**
    * Get a context resolver for a particular type of context and media type.
    * The set of resolvers is first filtered by comparing the supplied value of
    * {@code mediaType} with the value of each resolver's
    * {@link javax.ws.rs.Produces}, ensuring the generic type of the context
    * resolver is assignable to the supplied value of {@code contextType}, and
    * eliminating those that do not match. If only one resolver matches the
    * criteria then it is returned. If more than one resolver matches then the
    * list of matching resolvers is ordered with those with the best
    * matching values of {@link javax.ws.rs.Produces} (x/y &gt; x&amp;#47;* &gt; *&amp;#47;*)
    * sorted first. A proxy is returned that delegates calls to
    * {@link ContextResolver#getContext(java.lang.Class)} to each matching context
    * resolver in order and returns the first non-null value it obtains or null
    * if all matching context resolvers return null.
    *
    * @param contextType the class of context desired
    * @param mediaType   the media type of data for which a context is required.
    * @return a matching context resolver instance or null if no matching
    *         context providers are found.
    */
   &lt;T&gt; ContextResolver&lt;T&gt; getContextResolver(Class&lt;T&gt; contextType,
                                             MediaType mediaType);
}

         </pre><p>
      </p>
      <p>


      </p>
      <p>

         A Providers instance is injectable into MessageBodyReader or Writers:
      </p>
      <p>

         </p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">
            @Provider
            @Consumes("multipart/fixed")
            public class MultipartProvider implements MessageBodyReader {

            private @Context Providers providers;

            ...

            }
         </pre><p>
      </p>
      <p>


      </p>
   </div>
   
   <div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="Configuring_Document_Marshalling"/>18.4. Configuring Document Marshalling</h2></div></div></div>
      

      <p>
   
         XML document parsers are subject to a form of attack known as the XXE (Xml eXternal Entity) Attack
         (<a class="ulink" href="http://www.securiteam.com/securitynews/6D0100A5PU.html">http://www.securiteam.com/securitynews/6D0100A5PU.html</a>),
         in which expanding an external entity causes an unsafe file to be loaded. For example, the document
      </p>
      
      <pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">
      &lt;?xml version="1.0"?&gt;
      &lt;!DOCTYPE foo
      [&lt;!ENTITY xxe SYSTEM "file:///etc/passwd"&gt;]&gt;
      &lt;search&gt;
         &lt;user&gt;bill&lt;/user&gt;
         &lt;file&gt;&amp;xxe;&lt;file&gt;
      &lt;/search&gt;
      </pre>
      
      <p>
      
      could cause the passwd file to be loaded.
      </p>
      
      <p>
      
         Resteasy's built-in unmarshaller for org.w3c.dom.Document files will expand external entities by default, but it can be configured to replace them by the empty string by setting the context parameter "resteasy.document.expand.entity.references" to "false" in the web.xml file:
   
      </p>
      
      <pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">
         &lt;context-param&gt;
            &lt;param-name&gt;resteasy.document.expand.entity.references&lt;/param-name&gt;
            &lt;param-value&gt;false&lt;/param-value&gt;
         &lt;/context-param&gt;
      </pre>
   </div>
   
</div>

    <div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="Built_in_JAXB_providers"/>Chapter 19. JAXB providers</h2></div></div></div><div class="toc"><dl><dt><span class="sect1"><a href="#decorators">19.1. JAXB Decorators</a></span></dt><dt><span class="sect1"><a href="#Pluggable_JAXBContext_s_with_ContextResolvers">19.2. Pluggable JAXBContext's with ContextResolvers</a></span></dt><dt><span class="sect1"><a href="#JAXB_+_XML_provider">19.3. JAXB + XML provider</a></span></dt><dd><dl><dt><span class="sect2"><a href="#XmlHeader">19.3.1. @XmlHeader and @Stylesheet</a></span></dt></dl></dd><dt><span class="sect1"><a href="#JAXB_+_JSON_provider">19.4. JAXB + JSON provider</a></span></dt><dt><span class="sect1"><a href="#JAXB_+_FastinfoSet_provider">19.5. JAXB + FastinfoSet provider</a></span></dt><dt><span class="sect1"><a href="#JAXB_Collections">19.6. Arrays and Collections of JAXB Objects</a></span></dt><dd><dl><dt><span class="sect2"><a href="#json_list">19.6.1. JSON and JAXB Collections/arrays</a></span></dt></dl></dd><dt><span class="sect1"><a href="#JAXB_Map">19.7. Maps of JAXB Objects</a></span></dt><dd><dl><dt><span class="sect2"><a href="#json_map">19.7.1. JSON and JAXB maps</a></span></dt><dt><span class="sect2"><a href="#JAXB_JSON_problems">19.7.2. Possible Problems with Jettison Provider</a></span></dt></dl></dd><dt><span class="sect1"><a href="#JAXB_INTERFACES">19.8. Interfaces, Abstract Classes, and JAXB</a></span></dt><dt><span class="sect1"><a href="#configuration">19.9. Configurating JAXB Marshalling</a></span></dt></dl></div>
   

   <p>

      As required by the specification, RESTEasy JAX-RS includes support for (un)marshalling JAXB annotated classes.
      RESTEasy provides multiple JAXB Providers to address some subtle differences between classes generated by XJC
      and classes which are simply annotated with @XmlRootElement, or working with JAXBElement classes directly.
   </p>
   <p>

      For the most part, developers using the JAX-RS API, the selection of which provider is invoked will be
      completely transparent. For developers wishing to access the providers directly (which most folks won't need to
      do), this document describes which provider is best suited for different configurations.
   </p>
   <p>

      A JAXB Provider is selected by RESTEasy when a parameter or return type is an object that is annotated with
      JAXB annotations (such as @XmlRootEntity or @XmlType) or if the type is a JAXBElement. Additionally, the
      resource class or resource method will be annotated with either a @Consumes or @Produces annotation and
      contain one or more of the following values:
   </p>
   <p>

      </p><div class="itemizedlist"><ul><li>
            text/*+xml
         </li><li>
            application/*+xml
         </li><li>
            application/*+fastinfoset
         </li><li>
            application/*+json
         </li></ul></div><p>

   </p>
   <p>

   </p>
   <p>

      RESTEasy will select a different provider based on the return type or parameter type used in the resource. This
      section describes how the selection process works.
   </p>
   <p>

      @XmlRootEntity
      When a class is annotated with a @XmlRootElement annotation, RESTEasy will select the
      JAXBXmlRootElementProvider. This provider handles basic marshaling and unmarshalling of custom JAXB
      entities.
   </p>
   <p>

      @XmlType
      Classes which have been generated by XJC will most likely not contain an @XmlRootEntity annotation. In order
      for these classes to marshalled, they must be wrapped within a JAXBElement instance. This is typically
      accomplished by invoking a method on the class which serves as the XmlRegistry and is named ObjectFactory.
   </p>
   <p>

      The JAXBXmlTypeProvider provider is selected when the class is annotated with an XmlType annotation and not an
      XmlRootElement annotation.
   </p>
   <p>

      This provider simplifies this task by attempting to locate the XmlRegistry for the target class. By default, a
      JAXB implementation will create a class called ObjectFactory and is located in the same package as the target
      class. When this class is located, it will contain a "create" method that takes the object instance
      as a parameter. For example, if the target type is called "Contact", then the ObjectFactory class
      will have a method:
   </p>
   <p>

      public JAXBElement createContact(Contact value) {..
   </p>
   <p>

      JAXBElement&lt;?&gt;
      If your resource works with the JAXBElement class directly, the RESTEasy runtime will select the
      JAXBElementProvider. This provider examines the ParameterizedType value of the JAXBElement in order to select
      the appropriate JAXBContext.
   </p>
   <p>

   </p>
   <p>


   </p>
    <div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="decorators"/>19.1. JAXB Decorators</h2></div></div></div>
        
        <p>Resteasy's JAXB providers have a pluggable way to decorate Marshaller and Unmarshaller instances.
        The way it works is that you can write an annotation that can trigger the decoration of a
        Marshaller or Unmarshaller.  Your decorators can do things like set Marshaller or Unmarshaller properties,
        set up validation, stuff like that.  Here's an example.  Let's say we want to have an annotation
        that will trigger pretty-printing, nice formatting, of an XML document.  If we were doing raw
        JAXB, we would set a property on the Marshaller of Marshaller.JAXB_FORMATTED_OUTPUT.  Let's
        write a Marshaller decorator.</p>
        <p>First we define a annotation:</p>
 <pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">

 import org.jboss.resteasy.annotations.Decorator;

 @Target({ElementType.TYPE, ElementType.METHOD, ElementType.PARAMETER, ElementType.FIELD})
 @Retention(RetentionPolicy.RUNTIME)
 @Decorator(processor = PrettyProcessor.class, target = Marshaller.class)
 public @interface Pretty {}
 </pre>
        <p>To get this to work, we must annotate our @Pretty annotation with a meta-annotation called
        @Decorator.  The target() attribute must be the JAXB Marshaller class.  The processor()
        attribute is a class we will write next.</p>
 <pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">
 
 import org.jboss.resteasy.core.interception.DecoratorProcessor;
 import org.jboss.resteasy.annotations.DecorateTypes;

 import javax.xml.bind.Marshaller;
 import javax.xml.bind.PropertyException;
 import javax.ws.rs.core.MediaType;
 import javax.ws.rs.Produces;
 import java.lang.annotation.Annotation;

 /**
  * @author &lt;a href="mailto:bill@burkecentral.com"&gt;Bill Burke&lt;/a&gt;
  * @version $Revision: 1 $
  */
 @DecorateTypes({"text/*+xml", "application/*+xml"})
 public class PrettyProcessor implements DecoratorProcessor&lt;Marshaller, Pretty&gt;
 {
    public Marshaller decorate(Marshaller target, Pretty annotation,
                  Class type, Annotation[] annotations, MediaType mediaType)
    {
       target.setProperty(Marshaller.JAXB_FORMATTED_OUTPUT, Boolean.TRUE);
    }
 }
 
 </pre>
    <p>
        The processor implementation must implement the DecoratorProcessor interface and should also be annotated
        with @DecorateTypes.  This annotation specifies what media types the processor can be used with. Now that
        we've defined our annotation and our Processor, we can use it on our JAX-RS resource methods
        or JAXB types as follows:
    </p>
 <pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">
   @GET
   @Pretty
   @Produces("application/xml")
   public SomeJAXBObject get() {...}
 </pre>
        <p>If you are confused, check the Resteasy source code for the implementation of @XmlHeader</p>
    </div>
   <div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="Pluggable_JAXBContext_s_with_ContextResolvers"/>19.2. Pluggable JAXBContext's with ContextResolvers</h2></div></div></div>
      

      <p>

         You should not use this feature unless you know what you're doing.
      </p>
      <p>

         Based on the class you are marshalling/unmarshalling, RESTEasy will, by default create and cache JAXBContext
         instances per class type. If you do not want RESTEasy to create JAXBContexts, you can plug-in your own by
         implementing an instance of javax.ws.rs.ext.ContextResolver
      </p>
      <p>

 </p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">
 public interface ContextResolver&lt;T&gt;
 {
T getContext(Class&lt;?&gt; type);
 }

 @Provider
 @Produces("application/xml")
 public class MyJAXBContextResolver implements ContextResolver&lt;JAXBContext&gt;
 {
JAXBContext getContext(Class&lt;?&gt; type)
{
   if (type.equals(WhateverClassIsOverridedFor.class)) return JAXBContext.newInstance()...;
}
 }
         </pre><p>
      </p>
      <p>

         You must provide a @Produces annotation to specify the media type the context is meant for. You must also
         make sure to implement ContextResolver&lt;JAXBContext&gt;. This helps the runtime match to the correct
         context resolver. You must also annotate the ContextResolver class with @Provider.
      </p>
      <p>

         There are multiple ways to make this ContextResolver available.
      </p>
      <p>

         </p><div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="orderedlist"><ol><li>
               Return it as a class or instance from a javax.ws.rs.core.Application implementation
            </li><li>
               List it as a provider with resteasy.providers
            </li><li>
               Let RESTEasy automatically scan for it within your WAR file. See Configuration Guide
            </li><li>
               Manually add it via ResteasyProviderFactory.getInstance().registerProvider(Class) or
               registerProviderInstance(Object)
            </li></ol></div><p>

      </p>
      <p>


      </p>
   </div>
   <div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="JAXB_+_XML_provider"/>19.3. JAXB + XML provider</h2></div></div></div>
      
       <p>
           Resteasy is required to provide JAXB provider support for XML.  It has a few extra annotations
           that can help code your app.
       </p>
       <div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="XmlHeader"/>19.3.1. @XmlHeader and @Stylesheet</h3></div></div></div>
           
           <p>Sometimes when outputting XML documents you may want to set an XML header. Resteasy provides
           the @org.jboss.resteasy.annotations.providers.jaxb.XmlHeader annotation for this.  For example:</p>
 <pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">
 
@XmlRootElement
public static class Thing
{
   private String name;

   public String getName()
   {
      return name;
   }

   public void setName(String name)
   {
      this.name = name;
   }
}

@Path("/test")
public static class TestService
{

   @GET
   @Path("/header")
   @Produces("application/xml")
   @XmlHeader("&lt;?xml-stylesheet type='text/xsl' href='${baseuri}foo.xsl' ?&gt;")
   public Thing get()
   {
      Thing thing = new Thing();
      thing.setName("bill");
      return thing;
   }
}
 </pre>
           <p>
               The @XmlHeader here forces the XML output to have an xml-stylesheet header.  This header
               could also have been put on the Thing class to get the same result.  See the javadocs for more
               details on how you can use substitution values provided by resteasy.
               </p>
           <p>
               Resteasy also has a convenience annotation for stylesheet headers.  For example:
           </p>
 <pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">
 
@XmlRootElement
public static class Thing
{
   private String name;

   public String getName()
   {
      return name;
   }

   public void setName(String name)
   {
      this.name = name;
   }
}

@Path("/test")
public static class TestService
{

   @GET
   @Path("/stylesheet")
   @Produces("application/xml")
   @Stylesheet(type="text/css", href="${basepath}foo.xsl")
   @Junk
   public Thing getStyle()
   {
      Thing thing = new Thing();
      thing.setName("bill");
      return thing;
   }
}
 </pre>
       </div>
   </div>
   <div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="JAXB_+_JSON_provider"/>19.4. JAXB + JSON provider</h2></div></div></div>
      

      <p>

         RESTEasy allows you to marshall JAXB annotated POJOs to and from JSON. This provider wraps the Jettison JSON
         library to accomplish this.  You can obtain more information about Jettison and how it works from:
      </p>
  <p>
     http://jettison.codehaus.org/
  </p>
       <p>
           To use this integration with Jettision you need to import the resteasy-jettison-provider Maven module.  Older versions
           of RESTEasy used to include this within the resteasy-jaxb-provider but we decided to modularize it more.
       </p>
      <p>
    Jettison has two mapping formats. One is BadgerFish the other is a Jettison
        Mapped Convention format.  The Mapped Convention is the default mapping.
      </p>
      <p>

      </p>
      <p>

         For example, consider this JAXB class:
      </p>
      <p>

 </p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">
 @XmlRootElement(name = "book")
 public class Book
 {
private String author;
private String ISBN;
private String title;

public Book()
{
}

public Book(String author, String ISBN, String title)
{
   this.author = author;
   this.ISBN = ISBN;
   this.title = title;
}

@XmlElement
public String getAuthor()
{
   return author;
}

public void setAuthor(String author)
{
   this.author = author;
}

@XmlElement
public String getISBN()
{
   return ISBN;
}

public void setISBN(String ISBN)
{
   this.ISBN = ISBN;
}

@XmlAttribute
public String getTitle()
{
   return title;
}

public void setTitle(String title)
{
   this.title = title;
}
 }
         </pre><p>
      </p>
      <p>


      </p>
      <p>

         This is how the JAXB Book class would be marshalled to JSON using the BadgerFish Convention
      </p>
      <p>

 </p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">
 {"book":
    {
       "@title":"EJB 3.0",
       "author":{"$":"Bill Burke"},
       "ISBN":{"$":"596529260"}
    }
 }
 </pre><p>
      </p>
      <p>

         Notice that element values have a map associated with them and to get to the value of the element, you must
         access the "$" variable. Here's an example of accessing the book in Javascript:
      </p>
      <p>

 </p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">
 var data = eval("(" + xhr.responseText + ")");
 document.getElementById("zone").innerHTML = data.book.@title;
 document.getElementById("zone").innerHTML += data.book.author.$;
 </pre><p>
      </p>
      <p>


      </p>
      <p>

         To use the BadgerFish Convention you must use the
         @org.jboss.resteasy.annotations.providers.jaxb.json.BadgerFish annotation on the JAXB class you are
         marshalling/unmarshalling, or, on the JAX-RS resource method or parameter:
      </p>
      <p>

 </p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">
 @BadgerFish
 @XmlRootElement(name = "book")
 public class Book {...}
 </pre><p>
      </p>
      <p>

         If you are returning a book on the JAX-RS method and you don't want to (or can't) pollute your JAXB classes
         with RESTEasy annotations, add the annotation to the JAX-RS method:
      </p>
      <p>

 </p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">
 @BadgerFish
 @GET
 public Book getBook(...) {...}
 </pre><p>
      </p>
      <p>

         If a Book is your input then you put it on the parameter:
      </p>
      <p>

 </p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">
 @POST
 public void newBook(@BadgerFish Book book) {...}
 </pre><p>
      </p>
      <p>


      </p>
      <p>

         The default Jettison Mapped Convention would return JSON that looked like this:
      </p>
      <p>

 </p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">
 { "book" :
      {
         "@title":"EJB 3.0",
         "author":"Bill Burke",
         "ISBN":596529260
       }
 }
 </pre><p>
      </p>
      <p>

         Notice that the @XmlAttribute "title" is prefixed with the '@' character. Unlike BadgerFish, the
         '$' does not represent the value of element text. This format is a bit simpler than the BadgerFish
         convention which is why it was chose as a default. Here's an example of accessing this in Javascript:
      </p>
      <p>

 </p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">
 var data = eval("(" + xhr.responseText + ")");
 document.getElementById("zone").innerHTML = data.book.@title;
 document.getElementById("zone").innerHTML += data.book.author;
 </pre><p>
      </p>
      <p>


      </p>
      <p>

         The Mapped Convention allows you to fine tune the JAXB mapping using the
         @org.jboss.resteasy.annotations.providers.jaxb.json.Mapped annotation. You can provide an XML Namespace to
         JSON namespace mapping. For example, if you defined your JAXB namespace within your package-info.java class like this:
  </p>
 <pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">
 @javax.xml.bind.annotation.XmlSchema(namespace="http://jboss.org/books")
 package org.jboss.resteasy.test.books;
 </pre>
  <p>
      You would have to define a JSON to XML namespace mapping or you would receive an exception of something like this:
  </p>
 <pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">
 java.lang.IllegalStateException: Invalid JSON namespace: http://jboss.org/books
 at org.codehaus.jettison.mapped.MappedNamespaceConvention.getJSONNamespace(MappedNamespaceConvention.java:151)
 at org.codehaus.jettison.mapped.MappedNamespaceConvention.createKey(MappedNamespaceConvention.java:158)
 at org.codehaus.jettison.mapped.MappedXMLStreamWriter.writeStartElement(MappedXMLStreamWriter.java:241)
 </pre>
      <p>
        To fix this problem you need another annotation, @Mapped.  You use the @Mapped annotation on your JAXB classes, on your JAX-RS resource method, or on
        the parameter you are unmarshalling
  </p>
 <pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">
 import org.jboss.resteasy.annotations.providers.jaxb.json.Mapped;
 import org.jboss.resteasy.annotations.providers.jaxb.json.XmlNsMap;

 ...

@GET
@Produces("application/json")
@Mapped(namespaceMap = {
        @XmlNsMap(namespace = "http://jboss.org/books", jsonName = "books")
})
public Book get() {...}

 </pre>
      <p>
      Besides mapping XML to JSON namespaces, you can also force @XmlAttribute's to be marshaled as XMLElements.
      </p>
      <p>

         </p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">
            @Mapped(attributeAsElements={"title"})
            @XmlRootElement(name = "book")
            public class Book {...}
         </pre><p>
      </p>
      <p>

         If you are returning a book on the JAX-RS method and you don't want to (or can't) pollute your JAXB classes
         with RESTEasy annotations, add the annotation to the JAX-RS method:
      </p>
      <p>

         </p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">
            @Mapped(attributeAsElements={"title"})
            @GET
            public Book getBook(...) {...}
         </pre><p>
      </p>
      <p>

         If a Book is your input then you put it on the parameter:
      </p>
      <p>

 </p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">
 @POST
 public void newBook(@Mapped(attributeAsElements={"title"}) Book book) {...}
 </pre><p>
      </p>
      <p>

      </p>
      <p>

      </p>
      <p>

      </p>
      <p>

      </p>
      <p>

      </p>
      <p>


      </p>
   </div>
   <div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="JAXB_+_FastinfoSet_provider"/>19.5. JAXB + FastinfoSet provider</h2></div></div></div>
      

      <p>

         RESTEasy supports the FastinfoSet mime type with JAXB annotated classes. Fast infoset documents are faster
         to serialize and parse, and smaller in size, than logically equivalent XML documents. Thus, fast infoset
         documents may be used whenever the size and processing time of XML documents is an issue. It is configured
         the same way the XML JAXB provider is so really no other documentation is needed here.
      </p>
       <p>
           To use this integration with Fastinfoset you need to import the resteasy-fastinfoset-provider Maven module.  Older versions
           of RESTEasy used to include this within the resteasy-jaxb-provider but we decided to modularize it more.
       </p>
      <p>


      </p>
   </div>
   <div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="JAXB_Collections"/>19.6. Arrays and Collections of JAXB Objects</h2></div></div></div>
      
      <p>
         RESTEasy will automatically
         marshal arrays, java.util.Set's, and java.util.List's of JAXB objects to and from XML, JSON, Fastinfoset (or any other new JAXB mapper Restasy comes up with).
      </p>
 <pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">
 @XmlRootElement(name = "customer")
 @XmlAccessorType(XmlAccessType.FIELD)
 public class Customer
 {
@XmlElement
private String name;

public Customer()
{
}

public Customer(String name)
{
   this.name = name;
}

public String getName()
{
   return name;
}
 }

 @Path("/")
 public class MyResource
 {
   @PUT
   @Path("array")
   @Consumes("application/xml")
   public void putCustomers(Customer[] customers)
   {
      Assert.assertEquals("bill", customers[0].getName());
      Assert.assertEquals("monica", customers[1].getName());
   }

   @GET
   @Path("set")
   @Produces("application/xml")
   public Set&lt;Customer&gt; getCustomerSet()
   {
      HashSet&lt;Customer&gt; set = new HashSet&lt;Customer&gt;();
      set.add(new Customer("bill"));
      set.add(new Customer("monica"));

      return set;
   }


   @PUT
   @Path("list")
   @Consumes("application/xml")
   public void putCustomers(List&lt;Customer&gt; customers)
   {
      Assert.assertEquals("bill", customers.get(0).getName());
      Assert.assertEquals("monica", customers.get(1).getName());
   }
 }
 
 </pre>
   <p>
      The above resource can publish and receive JAXB objects.  It is assumed that are wrapped in a collection element
   </p>
 <pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">
 &lt;collection&gt;
&lt;customer&gt;&lt;name&gt;bill&lt;/name&gt;&lt;/customer&gt;
&lt;customer&gt;&lt;name&gt;monica&lt;/name&gt;&lt;/customer&gt;
 &lt;collection&gt;
 
 </pre>
   <p>You can change the namespace URI, namespace tag, and collection element name by using the @org.jboss.resteasy.annotations.providers.jaxb.Wrapped annotation on a parameter or method</p>
 <pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">
 @Target({ElementType.PARAMETER, ElementType.METHOD})
 @Retention(RetentionPolicy.RUNTIME)
 public @interface Wrapped
 {
String element() default "collection";

String namespace() default "http://jboss.org/resteasy";

String prefix() default "resteasy";
 }
 </pre>
<p>So, if we wanted to output this XML</p>
 <pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">
 &lt;foo:list xmlns:foo="http://foo.org"&gt;
&lt;customer&gt;&lt;name&gt;bill&lt;/name&gt;&lt;/customer&gt;
&lt;customer&gt;&lt;name&gt;monica&lt;/name&gt;&lt;/customer&gt;
 &lt;/foo:list&gt;
 
 </pre>
<p>We would use the @Wrapped annotation as follows: </p>
 <pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">
   @GET
   @Path("list")
   @Produces("application/xml")
   @Wrapped(element="list", namespace="http://foo.org", prefix="foo")
   public List&lt;Customer&gt; getCustomerSet()
   {
      List&lt;Customer&gt; list = new ArrayList&lt;Customer&gt;();
      list.add(new Customer("bill"));
      list.add(new Customer("monica"));

      return list;
   }
 
 </pre>
  <div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="json_list"/>19.6.1. JSON and JAXB Collections/arrays</h3></div></div></div>
    
    <p>Resteasy supports using collections with JSON.  It encloses lists, sets, or arrays of returned JAXB objects within a simple
    JSON array.  For example:</p>
 <pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">
   @XmlRootElement
@XmlAccessorType(XmlAccessType.FIELD)
public static class Foo
{
   @XmlAttribute
   private String test;

   public Foo()
   {
   }

   public Foo(String test)
   {
      this.test = test;
   }

   public String getTest()
   {
      return test;
   }

   public void setTest(String test)
   {
      this.test = test;
   }
}
 </pre>
 <p>This a List or array of this Foo class would be represented in JSON like this:</p>
 <pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">
 
 [{"foo":{"@test":"bill"}},{"foo":{"@test":"monica}"}}]
 
 </pre>
 <p>It also expects this format for input</p>
  </div>
</div>
   <div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="JAXB_Map"/>19.7. Maps of JAXB Objects</h2></div></div></div>
      
      <p>
         RESTEasy will automatically
         marshal maps of JAXB objects to and from XML, JSON, Fastinfoset (or any other new JAXB mapper Restasy comes up with).
         Your parameter or method return type must be a generic with a String as the key and the JAXB object's type.
     </p>
 <pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">
@XmlRootElement(namespace = "http://foo.com")
public static class Foo
{
   @XmlAttribute
   private String name;

   public Foo()
   {
   }

   public Foo(String name)
   {
      this.name = name;
   }

   public String getName()
   {
      return name;
   }
}

@Path("/map")
public static class MyResource
{
   @POST
   @Produces("application/xml")
   @Consumes("application/xml")
   public Map&lt;String, Foo&gt; post(Map&lt;String, Foo&gt; map)
   {
      Assert.assertEquals(2, map.size());
      Assert.assertNotNull(map.get("bill"));
      Assert.assertNotNull(map.get("monica"));
      Assert.assertEquals(map.get("bill").getName(), "bill");
      Assert.assertEquals(map.get("monica").getName(), "monica");
      return map;
   }
 }
 
 </pre>
   <p>
      The above resource can publish and receive JAXB objects within a map.  By default, they are wrapped in a "map" element in the
      default namespace.  Also, each "map" element has zero or more "entry" elements with a "key" attribute.
   </p>
 <pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">
 &lt;map&gt;
&lt;entry key="bill" xmlns="http://foo.com"&gt;
    &lt;foo name="bill"/&gt;
&lt;/entry&gt;
&lt;entry key="monica" xmlns="http://foo.com"&gt;
    &lt;foo name="monica"/&gt;
&lt;/entry&gt;
 &lt;/map&gt;
 
 </pre>
   <p>You can change the namespace URI, namespace prefix and map, entry, and key element and attribute names by using the @org.jboss.resteasy.annotations.providers.jaxb.WrappedMap annotation on a parameter or method</p>
 <pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">
 @Target({ElementType.PARAMETER, ElementType.METHOD})
 @Retention(RetentionPolicy.RUNTIME)
 public @interface WrappedMap
 {
/**
 * map element name
 */
String map() default "map";

/**
 * entry element name *
 */
String entry() default "entry";

/**
 * entry's key attribute name
 */
String key() default "key";

String namespace() default "";

String prefix() default "";
 }
 </pre>
<p>So, if we wanted to output this XML</p>
 <pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">
 &lt;hashmap&gt;
&lt;hashentry hashkey="bill" xmlns:foo="http://foo.com"&gt;
    &lt;foo:foo name="bill"/&gt;
&lt;/hashentry&gt;
 &lt;/map&gt;
 
 </pre>
<p>We would use the @WrappedMap annotation as follows: </p>
 <pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">
@Path("/map")
public static class MyResource
{
   @GET
   @Produces("application/xml")
   @WrappedMap(map="hashmap", entry="hashentry", key="hashkey")
   public Map&lt;String, Foo&gt; get()
   {
      ...
      return map;
   }
 
 </pre>
  <div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="json_map"/>19.7.1. JSON and JAXB maps</h3></div></div></div>
    
    <p>Resteasy supports using maps with JSON.  It encloses maps returned JAXB objects within a simple
    JSON map.  For example:</p>
 <pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">
   @XmlRootElement
@XmlAccessorType(XmlAccessType.FIELD)
public static class Foo
{
   @XmlAttribute
   private String test;

   public Foo()
   {
   }

   public Foo(String test)
   {
      this.test = test;
   }

   public String getTest()
   {
      return test;
   }

   public void setTest(String test)
   {
      this.test = test;
   }
}
 </pre>
 <p>This a List or array of this Foo class would be represented in JSON like this:</p>
 <pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">
 
 { "entry1" : {"foo":{"@test":"bill"}}, "entry2" : {"foo":{"@test":"monica}"}}}
 
 </pre>
 <p>It also expects this format for input</p>
  </div>
  <div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="JAXB_JSON_problems"/>19.7.2. Possible Problems with Jettison Provider</h3></div></div></div>
      
      <p>
          If you have the resteasy-jackson-provider-xxx.jar in your classpath, the Jackson JSON provider
              will be triggered.  This will screw up code that is dependent on the Jettison JAXB/JSon provider.
              If you had been using the Jettison JAXB/Json providers, you must either remove
              Jackson from your WEB-INF/lib or classpath, or use the @NoJackson annotation on your JAXB classes.
      </p>
  </div>
</div>
<div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="JAXB_INTERFACES"/>19.8. Interfaces, Abstract Classes, and JAXB</h2></div></div></div>
   
   <p>
    Some objects models use abstract classes and interfaces heavily.  Unfortunately, JAXB doesn't work with interfaces
    that are root elements and RESTEasy can't unmarshal parameters that are interfaces or raw abstract classes because
    it doesn't have enough information to create a JAXBContext.  For example:
   </p>
 <pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">
 public interface IFoo {}

 @XmlRootElement
 public class RealFoo implements IFoo {}

 @Path("/jaxb")
 public class MyResource {

@PUT
@Consumes("application/xml")
public void put(IFoo foo) {...}
 }
 </pre>
<p>
  In this example, you would get an error from RESTEasy of something like "Cannot find a MessageBodyReader for...".  This is because
  RESTEasy does not know that implementations of IFoo are JAXB classes and doesn't know how to create a JAXBContext for it.  As a workaround,
 RESTEasy allows you to use the JAXB annotation @XmlSeeAlso on the interface to correct the problem.  (NOTE, this will not work with manual, hand-coded JAXB).
</p>
 <pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">
 @XmlSeeAlso(RealFoo.class)
 public interface IFoo {}
 </pre>
<p>
The extra @XmlSeeAlso on IFoo allows RESTEasy to create a JAXBContext that knows how to unmarshal RealFoo instances.
</p>
</div>

<div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="configuration"/>19.9. Configurating JAXB Marshalling</h2></div></div></div>
   
   <p>
     As a consumer of XML datasets, JAXB is subject to a form of attack
     known as the XXE (Xml eXternal Entity) Attack
     (<a class="ulink" href="http://www.securiteam.com/securitynews/6D0100A5PU.html">http://www.securiteam.com/securitynews/6D0100A5PU.html</a>),
     in which expanding an external entity causes an unsafe file to be loaded.  Preventing the expansion of 
     external entities is discussed in <a class="xref" href="#Configuring_Document_Marshalling" title="18.4. Configuring Document Marshalling">Section 18.4, “Configuring Document Marshalling”</a>.  The same context
     parameter, "resteasy.document.expand.entity.references", applies to JAXB unmarshallers as well.
   </p>
</div>
</div>

    <div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="Atom"/>Chapter 20. Resteasy Atom Support</h2></div></div></div><div class="toc"><dl><dt><span class="sect1"><a href="#resteasy_atom">20.1. Resteasy Atom API and Provider</a></span></dt><dt><span class="sect1"><a href="#jaxb_atom">20.2. Using JAXB with the Atom Provider</a></span></dt></dl></div>
   
   <p>
      From W3.org (http://tools.ietf.org/html/rfc4287):
   </p>
   <p>
      "Atom is an XML-based document format that describes lists of related
      information known as "feeds". Feeds are composed of a number of
      items, known as "entries", each with an extensible set of attached
      metadata. For example, each entry has a title.

      The primary use case that Atom addresses is the syndication of Web
      content such as weblogs and news headlines to Web sites as well as
      directly to user agents."
   </p>
   <p>
      Atom is the next-gen RSS feed. Although it is used primarily for the syndication of blogs and news, many
      are starting to use this format as the envelope for Web Services, for example, distributed notifications, job
      queues, or simply a nice format for sending or receiving data in bulk from a service.
   </p>
   <div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="resteasy_atom"/>20.1. Resteasy Atom API and Provider</h2></div></div></div>
      
      <p>RESTEasy has defined a simple object model in Java to represent Atom and uses JAXB to marshal and unmarshal
         it. The
         main classes are in the org.jboss.resteasy.plugins.providers.atom package and are Feed, Entry, Content, and
         Link. If you
         look at the source, you'd see that these are annotated with JAXB annotations. The distribution contains
         the javadocs for this project and are a must to learn the model. Here is a simple example of sending
         an atom feed using the Resteasy API.
      </p>
      <pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">
import org.jboss.resteasy.plugins.providers.atom.Content;
import org.jboss.resteasy.plugins.providers.atom.Entry;
import org.jboss.resteasy.plugins.providers.atom.Feed;
import org.jboss.resteasy.plugins.providers.atom.Link;
import org.jboss.resteasy.plugins.providers.atom.Person;

@Path("atom")
public class MyAtomService
{

   @GET
   @Path("feed")
   @Produces("application/atom+xml")
   public Feed getFeed() throws URISyntaxException
   {
      Feed feed = new Feed();
      feed.setId(new URI("http://example.com/42"));
      feed.setTitle("My Feed");
      feed.setUpdated(new Date());
      Link link = new Link();
      link.setHref(new URI("http://localhost"));
      link.setRel("edit");
      feed.getLinks().add(link);
      feed.getAuthors().add(new Person("Bill Burke"));
      Entry entry = new Entry();
      entry.setTitle("Hello World");
      Content content = new Content();
      content.setType(MediaType.TEXT_HTML_TYPE);
      content.setText("Nothing much");
      entry.setContent(content);
      feed.getEntries().add(entry);
      return feed;
   }
}

      </pre>
      <p>Because Resteasy's atom provider is JAXB based, you are not limited to sending atom objects using XML.
         You can automatically re-use all the other JAXB providers that Resteasy has like JSON and fastinfoset.
         All you have to do is have "atom+" in front of the main subtype. i.e. @Produces("application/atom+json") or
         @Consumes("application/atom+fastinfoset")
      </p>
   </div>
   <div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="jaxb_atom"/>20.2. Using JAXB with the Atom Provider</h2></div></div></div>
      
      <p>
         The org.jboss.resteasy.plugins.providers.atom.Content class allows you to unmarshal and marshal JAXB
         annotated objects that are the body of the content. Here's an example of sending an Entry with
         a Customer object attached as the body of the entry's content.
      </p>
      <pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">
@XmlRootElement(namespace = "http://jboss.org/Customer")
@XmlAccessorType(XmlAccessType.FIELD)
public class Customer
{
   @XmlElement
   private String name;

   public Customer()
   {
   }

   public Customer(String name)
   {
      this.name = name;
   }

   public String getName()
   {
      return name;
   }
}

@Path("atom")
public static class AtomServer
{
   @GET
   @Path("entry")
   @Produces("application/atom+xml")
   public Entry getEntry()
   {
      Entry entry = new Entry();
      entry.setTitle("Hello World");
      Content content = new Content();
      content.setJAXBObject(new Customer("bill"));
      entry.setContent(content);
      return entry;
   }
}
</pre>
      <p>
         The Content.setJAXBObject() method is used to tell the content object you are sending back
         a Java JAXB object and want it marshalled appropriately. If you are using a different base
         format other than XML, i.e. "application/atom+json", this attached JAXB object will be marshalled
         into that same format.
      </p>
      <p>
         If you have an atom document as your input, you can also extract JAXB objects from Content using the
         Content.getJAXBObject(Class clazz) method. Here is an example of an input atom document and extracting
         a Customer object from the content.
      </p>
      <pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">
@Path("atom")
public static class AtomServer
{
   @PUT
   @Path("entry")
   @Produces("application/atom+xml")
   public void putCustomer(Entry entry)
   {
      Content content = entry.getContent();
      Customer cust = content.getJAXBObject(Customer.class);
   }
}
</pre>
   </div>

</div>

    <div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="json"/>Chapter 21. JSON Support via Jackson</h2></div></div></div><div class="toc"><dl><dt><span class="sect1"><a href="#d4e1039">21.1. Using Jackson 1.9.x Outside of JBoss AS7</a></span></dt><dt><span class="sect1"><a href="#d4e1043">21.2. Using Jackson 1.9.x Inside of JBoss AS7</a></span></dt><dt><span class="sect1"><a href="#d4e1046">21.3. Using Jackson 2.2.x Outside of JBoss AS7</a></span></dt><dt><span class="sect1"><a href="#d4e1050">21.4. Using Jackson 2.2.x Inside of JBoss AS7</a></span></dt><dt><span class="sect1"><a href="#d4e1054">21.5. Additional Resteasy Specifics</a></span></dt><dt><span class="sect1"><a href="#Possible_Jackson_Problems">21.6. Possible Conflict With JAXB Provider</a></span></dt><dt><span class="sect1"><a href="#JSONP_Support">21.7. JSONP Support</a></span></dt></dl></div>
    
    <p>Besides the Jettision JAXB adapter for JSON, Resteasy also support integration with the Jackson project.
        Many users find the output from Jackson much much nicer than the Badger format or Mapped format provided by
        Jettison.
        Jackson lives at http://jackson.codehaus.org. It allows you to easily marshal Java objects to and from JSON.
        It has a Java Bean based model as well as JAXB like APIs. Resteasy integrates with the JavaBean model as
        described
        at this url: http://jackson.codehaus.org/Tutorial.
    </p>
    <p>While Jackson does come with its own JAX-RS integration. Resteasy expanded it a little. To include
        it within your project, just add this maven dependency to your build.  Resteasy supports both Jackson 1.9.x
        and Jackson 2.2.x.  Read further on how to use each.
    </p>
    <div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d4e1039"/>21.1. Using Jackson 1.9.x Outside of JBoss AS7</h2></div></div></div>
        
        <p>If you're deploying Resteasy outside of JBoss AS7 add the resteasy jackson provder to your WAR
        pom.xml build</p>
        <pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">
    &lt;dependency&gt;
       &lt;groupId&gt;org.jboss.resteasy&lt;/groupId&gt;
       &lt;artifactId&gt;resteasy-jackson-provider&lt;/artifactId&gt;
       &lt;version&gt;3.0.5.Final&lt;/version&gt;
    &lt;/dependency&gt;
 </pre>
    </div>
    <div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d4e1043"/>21.2. Using Jackson 1.9.x Inside of JBoss AS7</h2></div></div></div>
        
        <p>If you're deploying Resteasy with JBoss AS7, there's nothing you need to do except to make sure
            you've updated your AS7 distribution with the latest and greatest Resteasy.  See the installation sectio
            of this documentation for more details.</p>
    </div>
    <div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d4e1046"/>21.3. Using Jackson 2.2.x Outside of JBoss AS7</h2></div></div></div>
        
        <p>If you're deploying Resteasy outside of JBoss AS7 add the resteasy jackson provder to your WAR
            pom.xml build</p>
        <pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">
    &lt;dependency&gt;
       &lt;groupId&gt;org.jboss.resteasy&lt;/groupId&gt;
       &lt;artifactId&gt;resteasy-jackson2-provider&lt;/artifactId&gt;
       &lt;version&gt;3.0.5.Final&lt;/version&gt;
    &lt;/dependency&gt;
 </pre>
    </div>
    <div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d4e1050"/>21.4. Using Jackson 2.2.x Inside of JBoss AS7</h2></div></div></div>
        
        <p>If you want to use Jackson 2.2.x inside of JBoss AS7 you'll have to create a jboss-deployment-structure.xml file
        within your WEB-INF directory.  By default AS7 includes the Jackson 1.9.x JAX-RS integration, so you'll want
        to exclude it from your dependencies, and add the jackson2 ones.</p>
        <pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">
&lt;jboss-deployment-structure&gt;
    &lt;deployment&gt;
        &lt;exclusions&gt;
           &lt;module name="org.jboss.resteasy.resteasy-jackson-provider"/&gt;
        &lt;/exclusions&gt;
        &lt;dependencies&gt;
            &lt;module name="org.jboss.resteasy.resteasy-jackson2-provider" services="import"/&gt;
        &lt;/dependencies&gt;
    &lt;/deployment&gt;
&lt;/jboss-deployment-structure&gt; </pre>
    </div>
    <div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d4e1054"/>21.5. Additional Resteasy Specifics</h2></div></div></div>
        

    <p>The first extra piece that Resteasy added to the integration was
        to support "application/*+json". Jackson would only accept "application/json" and "text/json" as valid
        media types. This allows you to create json-based media types and still
        let Jackson marshal things for you. For example:
    </p>
    <pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">
        
@Path("/customers")
public class MyService {

   @GET
   @Produces("application/vnd.customer+json")
   public Customer[] getCustomers() {}
}

    </pre>
    <p>Another problem that occurs is when you are using the Resteasy JAXB providers alongside Jackson.
        You may want to use Jettison and JAXB to output your JSON instead of Jackson. In this case, you must
        either not install the Jackson provider, or use the annotation
        @org.jboss.resteasy.annotations.providers.NoJackson
        on your JAXB annotated classes. For example:
    </p>
    <pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">
        

    @XmlRootElement
    @NoJackson
    public class Customer {...}

    @Path("/customers")
    public class MyService {

       @GET
       @Produces("application/vnd.customer+json")
       public Customer[] getCustomers() {}
    }
    
    </pre>
    <p>
        If you can't annotate the JAXB class with @NoJackson, then you can
        use the annotation on a method parameter. For example:
    </p>
    <pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">
        

        @XmlRootElement
        public class Customer {...}

        @Path("/customers")
        public class MyService {

           @GET
           @Produces("application/vnd.customer+json")
           @NoJackson
           public Customer[] getCustomers() {}

           @POST
           @Consumes("application/vnd.customer+json")
           public void createCustomer(@NoJackson Customer[] customers) {...}
        }
        
    </pre>
    </div>
    <div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="Possible_Jackson_Problems"/>21.6. Possible Conflict With JAXB Provider</h2></div></div></div>
        
        <p>
            If your Jackson classes are annotated with JAXB annotations and you have the resteasy-jaxb-provider in your
            classpath, you may trigger the Jettision JAXB marshalling code. To turn off the JAXB json marshaller
            use the @org.jboss.resteasy.annotations.providers.jaxb.IgnoreMediaTypes("application/*+json") on your
            classes.
        </p>
    </div>
    <div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="JSONP_Support"/>21.7. JSONP Support</h2></div></div></div>
        
        <p>
            If you're using Jackson, Resteasy has <a class="ulink" href="http://en.wikipedia.org/wiki/JSONP">JSONP</a> that you can turn on by adding
            the provider <code class="literal">org.jboss.resteasy.plugins.providers.jackson.JacksonJsonpInterceptor</code> (Jackson2JsonpInterceptor if you're using the Jackson2 provider)
            to your deployments.
            If the media type of the response is json and a callback query parameter is given, the response will be a javascript snippet with
            a method call of the method defined by the callback parameter.
            For example:
</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">
GET /resources/stuff?callback=processStuffResponse
</pre><p>
            will produce this response:
</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">
processStuffResponse(&lt;nomal JSON body&gt;)
</pre><p>
            This supports the default behavior of <a class="ulink" href="http://api.jquery.com/jQuery.ajax/">jQuery</a>.
        </p>
        <p>
            You can change the name of the callback parameter by setting the callbackQueryParameter property.
        </p>
    </div>
</div>

    <div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="json-p"/>Chapter 22. JSON Support via Java EE 7 JSON-P API</h2></div></div></div>
    
    <p>No, this is not the JSONP you are thinking of!  JSON-P is a new Java EE 7 JSON parsing API.  Horrible name for
        a new JSON parsing API!  What were they thinking?  Anyways, Resteasy has
        a provider for it.  If you are using Wildfly, it is required by Java EE 7 so you will have it automatically bundled.
        Otherwise, use this maven dependency.
    </p>
    <pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">
    &lt;dependency&gt;
       &lt;groupId&gt;org.jboss.resteasy&lt;/groupId&gt;
       &lt;artifactId&gt;resteasy-json-p-provider&lt;/artifactId&gt;
       &lt;version&gt;3.0.5.Final&lt;/version&gt;
    &lt;/dependency&gt;
 </pre>
    <p>
        It has built in support for JsonObject, JsonArray, and JsonStructure as request or response entities.  It should
        not conflict with Jackson or Jettison if you have that in your path too.
    </p>
</div>

    <div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="Multipart"/>Chapter 23. Multipart Providers</h2></div></div></div><div class="toc"><dl><dt><span class="sect1"><a href="#MultipartInput">23.1. Input with multipart/mixed</a></span></dt><dt><span class="sect1"><a href="#multipart_list">23.2. java.util.List with multipart data</a></span></dt><dt><span class="sect1"><a href="#MultipartFormData">23.3. Input with multipart/form-data</a></span></dt><dt><span class="sect1"><a href="#multipart_map">23.4. java.util.Map with multipart/form-data</a></span></dt><dt><span class="sect1"><a href="#MultipartRelated">23.5. Input with multipart/related</a></span></dt><dt><span class="sect1"><a href="#multipart_output">23.6. Output with multipart</a></span></dt><dt><span class="sect1"><a href="#multipart_list_output">23.7. Multipart Output with java.util.List</a></span></dt><dt><span class="sect1"><a href="#multipart_formdata_output">23.8. Output with multipart/form-data</a></span></dt><dt><span class="sect1"><a href="#multipart_map_output">23.9. Multipart FormData Output with java.util.Map</a></span></dt><dt><span class="sect1"><a href="#multipart_related_output">23.10. Output with multipart/related</a></span></dt><dt><span class="sect1"><a href="#multipartform_annotation">23.11. @MultipartForm and POJOs</a></span></dt><dt><span class="sect1"><a href="#xop_with_multipart_related">23.12. XML-binary Optimized Packaging (Xop)</a></span></dt><dt><span class="sect1"><a href="#multipart_parsing_note">23.13. Note about multipart parsing and working with other frameworks</a></span></dt><dt><span class="sect1"><a href="#multipart_overwrite_default_content_type">23.14. Overwriting the default fallback content type for multipart messages</a></span></dt><dt><span class="sect1"><a href="#multipart_overwrite_content_type">23.15. Overwriting the content type for multipart messages</a></span></dt><dt><span class="sect1"><a href="#multipart_overwrite_default_charset">23.16. Overwriting the default fallback charset for multipart messages</a></span></dt></dl></div>
   
   <p>Resteasy has rich support for the "multipart/*" and "multipart/form-data" mime types.  The multipart mime
      format is used to pass lists of content bodies.  Multiple content bodies are embedded in one message.
      "multipart/form-data" is often found in web application HTML Form documents and is generally used to
      upload files.  The form-data format is the same as other multipart formats, except that each inlined piece
      of content has a name associated with it.
    </p>
   <p>RESTEasy provides
   a custom API for reading and writing multipart types as well as marshalling arbitrary List (for any multipart type)
      and Map (multipart/form-data only)
   objects</p>
   <div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="MultipartInput"/>23.1. Input with multipart/mixed</h2></div></div></div>
      
      <p>When writing a JAX-RS service, RESTEasy provides an interface that allows you to read in any
      multipart mime type.  org.jboss.resteasy.plugins.providers.multipart.MultipartInput</p>
      <pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">
package org.jboss.resteasy.plugins.providers.multipart;

public interface MultipartInput
{
   List&lt;InputPart&gt; getParts();

   String getPreamble();

   // You must call close to delete any temporary files created
   // Otherwise they will be deleted on garbage collection or on JVM exit
   void close();
}

public interface InputPart
{
   MultivaluedMap&lt;String, String&gt; getHeaders();

   String getBodyAsString();

   &lt;T&gt; T getBody(Class&lt;T&gt; type, Type genericType) throws IOException;

   &lt;T&gt; T getBody(org.jboss.resteasy.util.GenericType&lt;T&gt; type) throws IOException;

   MediaType getMediaType();

   boolean isContentTypeFromMessage();
}
      </pre>
      <p>MultipartInput is a simple interface that allows you to get access to each part of the multipart message.
      Each part is represented by an InputPart interface. Each part has a set of headers associated with it
      You can unmarshall the part by calling one of the getBody() methods.  The Type genericType parameter can be null,
      but the Class type parameter must be set.  Resteasy will find a MessageBodyReader based on the media type
      of the part as well as the type information you pass in.  The following piece of code is unmarshalling
      parts which are XML into a JAXB annotated class called Customer.
      </p>
<pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">
   @Path("/multipart")
   public class MyService
   {
      @PUT
      @Consumes("multipart/mixed")
      public void put(MultipartInput input)
      {
         List&lt;Customer&gt; customers = new ArrayList...;
         for (InputPart part : input.getParts())
         {
            Customer cust = part.getBody(Customer.class, null);
            customers.add(cust);
         }
         input.close();
      }
   }
</pre>
      <p>
         Sometimes you may want to unmarshall a body part that is sensitive to generic type metadata.  In this case
         you can use the org.jboss.resteasy.util.GenericType class.  Here's an example of unmarshalling a type that
         is sensitive to generic type metadata.
      </p>
<pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">
   @Path("/multipart")
   public class MyService
   {
      @PUT
      @Consumes("multipart/mixed")
      public void put(MultipartInput input)
      {
         for (InputPart part : input.getParts())
         {
            List&lt;Customer&gt; cust = part.getBody(new GenericType&gt;List&gt;Customer&lt;&lt;() {});
         }
         input.close();
      }
   }

</pre>
      <p>
         Use of GenericType is required because it is really the only way to obtain generic type information at runtime.
      </p>
   </div>
   <div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="multipart_list"/>23.2. java.util.List with multipart data</h2></div></div></div>
      
      <p>If your body parts are uniform, you do not have to manually unmarshall each and every part.
      You can just provide a java.util.List as your input parameter.  It must have the type it is
      unmarshalling with the generic parameter of the List type declaration.  Here's an example again
      of unmarshalling a list of customers.</p>
<pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">
   @Path("/multipart")
   public class MyService
   {
      @PUT
      @Consumes("multipart/mixed")
      public void put(List&lt;Customer&gt; customers)
      {
         ...
      }
   }

</pre>
   </div>
   <div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="MultipartFormData"/>23.3. Input with multipart/form-data</h2></div></div></div>
      
      <p>When writing a JAX-RS service, RESTEasy provides an interface that allows you to read in
      multipart/form-data mime type.  "multipart/form-data" is often found in web application HTML Form documents and is generally used to
      upload files.  The form-data format is the same as other multipart formats, except that each inlined piece
      of content has a name associated with it.  The interface used for form-data input is
         org.jboss.resteasy.plugins.providers.multipart.MultipartFormDataInput</p>
<pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">
public interface MultipartFormDataInput extends MultipartInput
{
   @Deprecated
   Map&lt;String, InputPart&gt; getFormData();

   Map&lt;String, List&lt;InputPart&gt;&gt; getFormDataMap();

   &lt;T&gt; T getFormDataPart(String key, Class&lt;T&gt; rawType, Type genericType) throws IOException;

   &lt;T&gt; T getFormDataPart(String key, GenericType&lt;T&gt; type) throws IOException;
}
</pre>
      <p>
         It works in much the same way as MultipartInput described earlier in this chapter.
      </p>

   </div>
   <div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="multipart_map"/>23.4. java.util.Map with multipart/form-data</h2></div></div></div>
      
      <p>With form-data, if your body parts are uniform, you do not have to manually unmarshall each and every part.
      You can just provide a java.util.Map as your input parameter.  It must have the type it is
      unmarshalling with the generic parameter of the List type declaration.  Here's an example of
      of unmarshalling a Map of Customer objects which are JAXB annotated classes.</p>
<pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">
   @Path("/multipart")
   public class MyService
   {
      @PUT
      @Consumes("multipart/form-data")
      public void put(Map&lt;String, Customer&gt; customers)
      {
         ...
      }
   }

</pre>
   </div>
   <div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="MultipartRelated"/>23.5. Input with multipart/related</h2></div></div></div>
      
      <p>When writing a JAX-RS service, RESTEasy provides an interface that allows you to read in
      multipart/related mime type. A multipart/related is used to indicate that message parts
      should not be considered individually but rather as parts of an aggregate whole. One example
      usage for multipart/related is to send a web page complete with images in a single message.
      Every multipart/related message has a root/start part that references the other parts of the message.
      The parts are identified by their "Content-ID" headers. multipart/related is defined by RFC 2387.
      The interface used for related input is org.jboss.resteasy.plugins.providers.multipart.MultipartRelatedInput</p>
<pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">
public interface MultipartRelatedInput extends MultipartInput
{
   String getType();

   String getStart();

   String getStartInfo();

   InputPart getRootPart();

   Map&lt;String, InputPart&gt; getRelatedMap();
}
</pre>
      <p>
         It works in much the same way as MultipartInput described earlier in this chapter.
      </p>

   </div>
   <div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="multipart_output"/>23.6. Output with multipart</h2></div></div></div>
      
      <p>RESTEasy provides a simple API to output multipart data.</p>
<pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">
package org.jboss.resteasy.plugins.providers.multipart;

public class MultipartOutput
{
   public OutputPart addPart(Object entity, MediaType mediaType)

   public OutputPart addPart(Object entity, GenericType type, MediaType mediaType)

   public OutputPart addPart(Object entity, Class type, Type genericType, MediaType mediaType)

   public List&lt;OutputPart&gt; getParts()

   public String getBoundary()

   public void setBoundary(String boundary)
}

public class OutputPart
{
   public MultivaluedMap&lt;String, Object&gt; getHeaders()

   public Object getEntity()

   public Class getType()

   public Type getGenericType()

   public MediaType getMediaType()
}


</pre>
      <p>When you want to output multipart data it is as simple as creating a MultipartOutput object
      and calling addPart() methods.  Resteasy will automatically find a MessageBodyWriter
      to marshall your entity objects.  Like MultipartInput, sometimes you may have marshalling
      which is sensitive to generic type metadata.  In that case, use GenericType.  Most of the time though
      passing in an Object and its MediaType is enough.  In the example below, we are sending
      back a "multipart/mixed" format back to the calling client.  The parts are
      Customer objects which are JAXB annotated and will be marshalling into "application/xml".</p>
<pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">
   @Path("/multipart")
   public class MyService
   {
      @GET
      @Produces("multipart/mixed")
      public MultipartOutput get()
      {
         MultipartOutput output = new MultipartOutput();
         output.addPart(new Customer("bill"), MediaType.APPLICATION_XML_TYPE);
         output.addPart(new Customer("monica"), MediaType.APPLICATION_XML_TYPE);
         return output;
      }

</pre>
   </div>
   <div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="multipart_list_output"/>23.7. Multipart Output with java.util.List</h2></div></div></div>
      
      <p>If your body parts are uniform, you do not have to manually marshall each and every part or even
         use a MultipartOutput object..
      You can just provide a java.util.List.  It must have the generic type it is
      marshalling with the generic parameter of the List type declaration.  You must also annotate the method
         with the @PartType annotation to specify what media type each part is.  Here's an example
      of sending back a list of customers back to a client.  The customers are JAXB objects</p>
<pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">
   @Path("/multipart")
   public class MyService
   {
      @GET
      @Produces("multipart/mixed")
      @PartType("application/xml")
      public List&lt;Customer&gt; get()
      {
         ...
      }
   }

</pre>
   </div>
   <div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="multipart_formdata_output"/>23.8. Output with multipart/form-data</h2></div></div></div>
      
      <p>RESTEasy provides a simple API to output multipart/form-data.</p>
<pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">
package org.jboss.resteasy.plugins.providers.multipart;

public class MultipartFormDataOutput extends MultipartOutput
{
   public OutputPart addFormData(String key, Object entity, MediaType mediaType)

   public OutputPart addFormData(String key, Object entity, GenericType type, MediaType mediaType)

   public OutputPart addFormData(String key, Object entity, Class type, Type genericType, MediaType mediaType)

   public Map&lt;String, OutputPart&gt; getFormData()
}

</pre>
      <p>When you want to output multipart/form-data it is as simple as creating a MultipartFormDataOutput object
      and calling addFormData() methods.  Resteasy will automatically find a MessageBodyWriter
      to marshall your entity objects.  Like MultipartInput, sometimes you may have marshalling
      which is sensitive to generic type metadata.  In that case, use GenericType.  Most of the time though
      passing in an Object and its MediaType is enough.  In the example below, we are sending
      back a "multipart/form-data" format back to the calling client.  The parts are
      Customer objects which are JAXB annotated and will be marshalling into "application/xml".</p>
<pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">
   @Path("/form")
   public class MyService
   {
      @GET
      @Produces("multipart/form-data")
      public MultipartFormDataOutput get()
      {
         MultipartFormDataOutput output = new MultipartFormDataOutput();
         output.addPart("bill", new Customer("bill"), MediaType.APPLICATION_XML_TYPE);
         output.addPart("monica", new Customer("monica"), MediaType.APPLICATION_XML_TYPE);
         return output;
      }

</pre>
   </div>
   <div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="multipart_map_output"/>23.9. Multipart FormData Output with java.util.Map</h2></div></div></div>
      
      <p>If your body parts are uniform, you do not have to manually marshall each and every part or even
         use a MultipartFormDataOutput object..
      You can just provide a java.util.Map.  It must have the generic type it is
      marshalling with the generic parameter of the Map type declaration.  You must also annotate the method
         with the @PartType annotation to specify what media type each part is.  Here's an example
      of sending back a list of customers back to a client.  The customers are JAXB objects</p>
<pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">
   @Path("/multipart")
   public class MyService
   {
      @GET
      @Produces("multipart/form-data")
      @PartType("application/xml")
      public Map&lt;String, Customer&gt; get()
      {
         ...
      }
   }

</pre>
   </div>
   <div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="multipart_related_output"/>23.10. Output with multipart/related</h2></div></div></div>
      
      <p>RESTEasy provides a simple API to output multipart/related.</p>
<pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">
package org.jboss.resteasy.plugins.providers.multipart;

public class MultipartRelatedOutput extends MultipartOutput
{
   public OutputPart getRootPart()

   public OutputPart addPart(Object entity, MediaType mediaType,
      String contentId, String contentTransferEncoding)

   public String getStartInfo()

   public void setStartInfo(String startInfo)
}

</pre>
      <p>When you want to output multipart/related it is as simple as creating a MultipartRelatedOutput object
      and calling addPart() methods. The first added part will be used as the root part of the multipart/related
      message.
      Resteasy will automatically find a MessageBodyWriter to marshall your entity objects. Like MultipartInput,
      sometimes you may have marshalling which is sensitive to generic type metadata. In that case, use
      GenericType.  Most of the time though passing in an Object and its MediaType is enough.  In the example
      below, we are sending back a "multipart/related" format back to the calling client. We are sending a
      html with 2 images.</p>
<pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">
@Path("/related")
public class MyService
{
   @GET
   @Produces("multipart/related")
   public MultipartRelatedOutput get()
   {
      MultipartRelatedOutput output = new MultipartRelatedOutput();
      output.setStartInfo("text/html");

      Map&lt;String, String&gt; mediaTypeParameters = new LinkedHashMap&lt;String, String&gt;();
      mediaTypeParameters.put("charset", "UTF-8");
      mediaTypeParameters.put("type", "text/html");
      output
         .addPart(
            "&lt;html&gt;&lt;body&gt;\n"
            + "This is me: &lt;img src='cid:http://example.org/me.png' /&gt;\n"
            + "&lt;br /&gt;This is you: &lt;img src='cid:http://example.org/you.png' /&gt;\n"
            + "&lt;/body&gt;&lt;/html&gt;",
            new MediaType("text", "html", mediaTypeParameters),
            "&lt;mymessage.xml@example.org&gt;", "8bit");
      output.addPart("// binary octets for me png",
            new MediaType("image", "png"), "&lt;http://example.org/me.png&gt;",
            "binary");
      output.addPart("// binary octets for you png", new MediaType(
            "image", "png"),
            "&lt;http://example.org/you.png&gt;", "binary");
      client.putRelated(output);
      return output;
   }
}
</pre>
   </div>
   <div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="multipartform_annotation"/>23.11. @MultipartForm and POJOs</h2></div></div></div>
      
      <p>If you have a exact knowledge of your multipart/form-data packets, you can map
      them to and from a POJO class to and from multipart/form-data using the
      @org.jboss.resteasy.annotations.providers.multipart.MultipartForm annotation
      and the JAX-RS @FormParam annotation.  You simple define a POJO with
      at least a default constructor and annotate its fields and/or properties
      with @FormParams.  These @FormParams must also be annotated with
      @org.jboss.resteasy.annotations.providers.multipart.PartType if you
      are doing output.  For example:</p>
<pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">
   public class CustomerProblemForm {
      @FormParam("customer")
      @PartType("application/xml")
      private Customer customer;

      @FormParam("problem")
      @PartType("text/plain")
      private String problem;

      public Customer getCustomer() { return customer; }
      public void setCustomer(Customer cust) { this.customer = cust; }
      public String getProblem() { return problem; }
      public void setProblem(String problem) { this.problem = problem; }
   }
</pre>
      <p>After defining your POJO class you can then use it to represent multipart/form-data.  Here's
      an example of sending a CustomerProblemForm using the RESTEasy client framework</p>
<pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">
   @Path("portal")
   public interface CustomerPortal {

      @Path("issues/{id}")
      @Consumes("multipart/form-data")
      @PUT
      public void putProblem(@MultipartForm CustomerProblemForm,
                             @PathParam("id") int id);
   }

   {
       CustomerPortal portal = ProxyFactory.create(CustomerPortal.class, "http://example.com");
       CustomerProblemForm form = new CustomerProblemForm();
       form.setCustomer(...);
       form.setProblem(...);

       portal.putProblem(form, 333);
   }
</pre>
      <p>You see that the @MultipartForm annotation was used to tell RESTEasy that the object has @FormParam
      and that it should be marshalled from that.  You can also use the same object to receive multipart data.
      Here is an example of the server side counterpart of our customer portal.</p>
<pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">
   @Path("portal")
   public class CustomerPortalServer {

      @Path("issues/{id})
      @Consumes("multipart/form-data")
      @PUT
      public void putIssue(@MultipartForm CustoemrProblemForm,
                           @PathParam("id") int id) {
         ... write to database...
      }
   }
</pre>
   </div>
   <div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="xop_with_multipart_related"/>23.12. XML-binary Optimized Packaging (Xop)</h2></div></div></div>
      
      <p>RESTEasy supports Xop messages packaged as multipart/related. What does this mean? If you have a JAXB
      annotated POJO that also holds some binary content you may choose to send it in such a way where the binary
      does not need to be encoded in any way (neither base64 neither hex). This results in faster transport while
      still using the convenient POJO. More about Xop can be read here:
      <a class="link" href="#">http://www.w3.org/TR/xop10/</a>. Now lets see an example:</p>
      <p>First we have a JAXB annotated POJO to work with. @XmlMimeType tells JAXB the mime type of the binary
      content (its not required to do XOP packaging but it is recommended to be set if you know the exact type):</p>
<pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">
@XmlRootElement
@XmlAccessorType(XmlAccessType.FIELD)
public static class Xop {
  private Customer bill;

  private Customer monica;

  @XmlMimeType(MediaType.APPLICATION_OCTET_STREAM)
  private byte[] myBinary;

  @XmlMimeType(MediaType.APPLICATION_OCTET_STREAM)
  private DataHandler myDataHandler;

  // methods, other fields ...
}
</pre>
      <p>In the above POJO myBinary and myDataHandler will be processed as binary attachments while the whole Xop
      object will be sent as xml (in the places of the binaries only their references will be generated).
      javax.activation.DataHandler is the most general supported type so if you need an java.io.InputStream or a
      javax.activation.DataSource you need to go with the DataHandler. Some other special types are supported too:
      java.awt.Image and javax.xml.transform.Source. Let's assume that Customer is also JAXB friendly POJO in the
      above example (of course it can also have binary parts). Now lets see a an example Java client that sends this:</p>
<pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">
// our client interface:
@Path("mime")
public static interface MultipartClient {
  @Path("xop")
  @PUT
  @Consumes(MultipartConstants.MULTIPART_RELATED)
  public void putXop(@XopWithMultipartRelated Xop bean);
}

// Somewhere using it:
{
  MultipartClient client = ProxyFactory.create(MultipartClient.class,
    "http://www.example.org");
  Xop xop = new Xop(new Customer("bill"), new Customer("monica"),
    "Hello Xop World!".getBytes("UTF-8"),
    new DataHandler(new ByteArrayDataSource("Hello Xop World!".getBytes("UTF-8"),
    MediaType.APPLICATION_OCTET_STREAM)));
  client.putXop(xop);
}
</pre>
	<p>We used @Consumes(MultipartConstants.MULTIPART_RELATED) to tell RESTEasy that we want to send multipart/related
	packages (that's the container format that will hold our Xop message). We used @XopWithMultipartRelated to tell
	RESTEasy that we want to make Xop messages. So we have a POJO and a client service that is willing to send it. All
	we need now a server that can read it:</p>
<pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">
@Path("/mime")
public class XopService {
  @PUT
  @Path("xop")
  @Consumes(MultipartConstants.MULTIPART_RELATED)
  public void putXopWithMultipartRelated(@XopWithMultipartRelated Xop xop) {
    // do very important things here
  }
}
</pre>
	<p>We used @Consumes(MultipartConstants.MULTIPART_RELATED) to tell RESTEasy that we want to read multipart/related
	packages. We used @XopWithMultipartRelated to tell RESTEasy that we want to read Xop messages. Of course we could
	also produce Xop return values but we would than also need to annotate that and use a Produce annotation, too.</p>
   </div>
   <div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="multipart_parsing_note"/>23.13. Note about multipart parsing and working with other frameworks</h2></div></div></div>
      
      <p>There are a lot of frameworks doing multipart parsing automatically with the help of filters and interceptors.
      Like org.jboss.seam.web.MultipartFilter in Seam or org.springframework.web.multipart.MultipartResolver in Spring.
      However the incoming multipart request stream can be parsed only once. Resteasy users working with multipart should
      make sure that nothing parses the stream before Resteasy gets it.</p>
   </div>
   <div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="multipart_overwrite_default_content_type"/>23.14. Overwriting the default fallback content type for multipart messages</h2></div></div></div>
      
      <p>By default if no Content-Type header is present in a part, "text/plain; charset=us-ascii" is used as fallback.
      This is the value defined by the MIME RFC. However for example some web clients (like most, if not all, web browsers)
      do not send Content-Type headers for all fields in a multipart/form-data request (only for the file parts). This can
      cause character encoding and unmarshalling errors on the server side. To correct this there is an option to define an
      other, non-rfc compliant fallback value. This can be done dynamically per request with the PreProcessInterceptor
      infrastructure of RESTEasy. In the following example we will set "*/*; charset=UTF-8" as the new default fallback:
</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">
import org.jboss.resteasy.plugins.providers.multipart.InputPart;

@Provider
@ServerInterceptor
public class ContentTypeSetterPreProcessorInterceptor implements
		PreProcessInterceptor {

	public ServerResponse preProcess(HttpRequest request,
			ResourceMethod method) throws Failure, WebApplicationException {
		request.setAttribute(InputPart.DEFAULT_CONTENT_TYPE_PROPERTY,
				"*/*; charset=UTF-8");
		return null;
	}

}
</pre><p>
      </p>
   </div>
   
  <div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="multipart_overwrite_content_type"/>23.15. Overwriting the content type for multipart messages</h2></div></div></div>
      
      <p>Using an interceptor and the <code class="code">InputPart.DEFAULT_CONTENT_TYPE_PROPERTY</code>
      attribute allows setting a default Content-Type, but it is also possible to override
      the Content-Type, if any, in any input part by calling
      <code class="methodname">org.jboss.resteasy.plugins.providers.multipart.InputPart.setMediaType()</code>.
      For example:
      </p>
    
<pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">
@POST
@Path("query")
@Consumes(MediaType.MULTIPART_FORM_DATA)
@Produces(MediaType.TEXT_PLAIN)
public Response setMediaType(MultipartInput input) throws IOException
{
   List&lt;InputPart&gt; parts = input.getParts();
   InputPart part = parts.get(0);
   part.setMediaType(MediaType.valueOf("application/foo+xml"));
   String s = part.getBody(String.class, null);
   ...
}
</pre>  
      
  </div>
  
  <div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="multipart_overwrite_default_charset"/>23.16. Overwriting the default fallback charset for multipart messages</h2></div></div></div>
      
      
      <p>Sometimes, a part may have a Content-Type header with no charset parameter.  If the
      <code class="code">InputPart.DEFAULT_CONTENT_TYPE_PROPERTY</code> property is set and the value has a charset parameter,
      that value will be appended to an existing Content-Type header that has no charset parameter.
      It is also possible to specify a default charset using the constant
      <code class="code">InputPart.DEFAULT_CHARSET_PROPERTY</code>
      (actual value "resteasy.provider.multipart.inputpart.defaultCharset"):
      </p>
      
<pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">
import org.jboss.resteasy.plugins.providers.multipart.InputPart;

@Provider
@ServerInterceptor
public class ContentTypeSetterPreProcessorInterceptor implements
		PreProcessInterceptor {

	public ServerResponse preProcess(HttpRequest request,
			ResourceMethod method) throws Failure, WebApplicationException {
		request.setAttribute(InputPart.DEFAULT_CHARSET_PROPERTY, "UTF-8");
		return null;
	}

}
</pre>

      <p>If both <code class="code">InputPart.DEFAULT_CONTENT_TYPE_PROPERTY</code> and
      <code class="code">InputPart.DEFAULT_CHARSET_PROPERTY</code> are set, then the value of
      <code class="code">InputPart.DEFAULT_CHARSET_PROPERTY</code> will override any charset in the value of
      <code class="code">InputPart.DEFAULT_CONTENT_TYPE_PROPERTY</code>.
      </p>
  </div>
</div>
    <div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="Built_in_YAML_Provider"/>Chapter 24. YAML Provider</h2></div></div></div>
   

   <p>

      Since 3.0.5.Final  release, resteasy comes with built in support for YAML using the SnakeYAML library. To enable YAML support,
      you need to drop in the SnakeYaml 1.8 jar and the resteasy-yaml-provider.jar (whatever the current version is) in RestEASY's classpath.
   </p>
   <p>


   </p>
   <p>

      SnakeYaml jar file can either be downloaded from Google code at
       http://code.google.com/p/snakeyaml/downloads/list
   </p>
   <p>

      Or if you use maven, the SnakeYaml jar is available through SonaType public repositories and included using this
      dependency:
   </p>
   <p>

 </p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">
 &lt;dependency&gt;
&lt;groupId&gt;org.yaml&lt;/groupId&gt;
&lt;artifactId&gt;snakeyaml&lt;/artifactId&gt;
&lt;version&gt;1.8&lt;/version&gt;
 &lt;/dependency&gt;
      </pre><p>
   </p>
   <p>

      When starting resteasy look out in the logs for a line stating that the YamlProvider has been added - this
      indicates that resteasy has found the Jyaml jar:
   </p>
   <p>

      2877 Main INFO org.jboss.resteasy.plugins.providers.RegisterBuiltin - Adding YamlProvider
   </p>
   <p>


   </p>
   <p>

      The Yaml provider recognises three mime types:
   </p>
   <p>

      </p><div class="itemizedlist"><ul><li>
            text/x-yaml
         </li><li>
            text/yaml
         </li><li>
            application/x-yaml
         </li></ul></div><p>

   </p>
   <p>


   </p>
   <p>

      This is an example of how to use Yaml in a resource method.
   </p>
   <p>

 </p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">
 import javax.ws.rs.Consumes;
 import javax.ws.rs.GET;
 import javax.ws.rs.Path;
 import javax.ws.rs.Produces;

 @Path("/yaml")
 public class YamlResource
 {

@GET
@Produces("text/x-yaml")
public MyObject getMyObject() {
   return createMyObject();
}
...
 }
 </pre><p>
   </p>
   <p>

   </p>
   <p>

   </p>
   <p>


   </p>
</div>

   <div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="StringConverter"/>Chapter 25. String marshalling for String based @*Param</h2></div></div></div>
   
   <p>@PathParam, @QueryParam, @MatrixParam, @FormParam, and @HeaderParam are represented as strings in a raw
      HTTP request. The specification says that these types of injected parameters can be converted to objects
      if these objects have a valueOf(String) static method or a constructor that takes one String parameter.
      What if you have a class where valueOf() or this string constructor doesn't exist or is inappropriate for
      an HTTP request? JAX-RS 2.0 has the javax.ws.rs.ext.ParamConverterProvider to help in this situation.
       See javadoc for more details.
   </p>
</div>
   <div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="Responses_using_javax.ws.rs.core.Response"/>Chapter 26. Responses using javax.ws.rs.core.Response</h2></div></div></div>


<p>

You can build custom responses using the javax.ws.rs.core.Response and ResponseBuilder classes.  If you want to do your own streaming, your entity response must be an implementation of javax.ws.rs.core.StreamingOutput.   See the java doc for more information.
</p>
<p>


</p>
</div>

   <div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="ExceptionHandling"/>Chapter 27. Exception Handling</h2></div></div></div><div class="toc"><dl><dt><span class="sect1"><a href="#ExceptionMappers">27.1. Exception Mappers</a></span></dt><dt><span class="sect1"><a href="#builtinException">27.2. Resteasy Built-in Internally-Thrown Exceptions</a></span></dt><dt><span class="sect1"><a href="#overring_resteasy_exceptions">27.3. Overriding Resteasy Builtin Exceptions</a></span></dt></dl></div>
   

   <div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="ExceptionMappers"/>27.1. Exception Mappers</h2></div></div></div>
   
   <p>

      ExceptionMappers are custom, application provided, components that can catch thrown application exceptions and
      write specific HTTP responses. The are classes annotated with @Provider and that implement this interface
   </p>
   <p>

      </p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">
         package javax.ws.rs.ext;

         import javax.ws.rs.core.Response;

         /**
         * Contract for a provider that maps Java exceptions to
         * {@link javax.ws.rs.core.Response}. An implementation of this interface must
         * be annotated with {@link Provider}.
         *
         * @see Provider
         * @see javax.ws.rs.core.Response
         */
         public interface ExceptionMapper&lt;E&gt;
         {

         /**
         * Map an exception to a {@link javax.ws.rs.core.Response}.
         *
         * @param exception the exception to map to a response
         * @return a response mapped from the supplied exception
         */
         Response toResponse(E exception);
         }
      </pre><p>
   </p>
   <p>

      When an application exception is thrown it will be caught by the JAX-RS runtime. JAX-RS will then scan registered
      ExceptionMappers to see which one support marshalling the exception type thrown. Here is an example of
      ExceptionMapper
   </p>
   <p>

      </p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">

         @Provider
         public class EJBExceptionMapper implements ExceptionMapper&lt;javax.ejb.EJBException&gt;
         {

         Response toResponse(EJBException exception) {
         return Response.status(500).build();
         }

         }
      </pre><p>
   </p>
   <p>

      You register ExceptionMappers the same way you do MessageBodyReader/Writers. By scanning, through the resteasy
      provider context-param (if you're deploying via a WAR file), or programmatically through the
      ResteasyProviderFactory class.
   </p>
   <p>


   </p>
   </div>
   <div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="builtinException"/>27.2. Resteasy Built-in Internally-Thrown Exceptions</h2></div></div></div>
     
     <p>Resteasy has a set of built-in exceptions that are thrown by it when it encounters errors during dispatching or marshalling.  They all
           revolve around specific HTTP error codes.  You can find them in RESTEasy's javadoc under the package org.jboss.resteasy.spi.  Here's 
           a list of them:</p>
<div class="table"><a id="d4e1225"/><p class="title"><b>Table 27.1. </b></p><div class="table-contents">
<table border="1"><colgroup><col/><col/><col/></colgroup><thead><tr><th>Exception</th><th>HTTP Code</th><th>Description</th></tr></thead><tbody><tr><td>ReaderException</td><td>400</td><td>All exceptions thrown from MessageBodyReaders are wrapped within this exception.  If there is no ExceptionMapper for the
wrapped exception or if the exception isn't a WebApplicationException, then resteasy will return a 400 code by default.</td></tr><tr><td>WriterException</td><td>500</td><td>All exceptions thrown from MessageBodyWriters are wrapped within this exception.  If there is no ExceptionMapper for the
wrapped exception or if the exception isn't a WebApplicationException, then resteasy will return a 400 code by default.</td></tr><tr><td>o.j.r.plugins.providers.jaxb.JAXBUnmarshalException</td><td>400</td><td>The JAXB providers (XML and Jettison) throw this exception on reads.  They may be wrapping JAXBExceptions.  This class extends ReaderException</td></tr><tr><td>o.j.r.plugins.providers.jaxb.JAXBMarshalException</td><td>500</td><td>The JAXB providers (XML and Jettison) throw this exception on writes.  They may be wrapping JAXBExceptions.  This class extends WriterException</td></tr><tr><td>ApplicationException</td><td>N/A</td><td>This exception wraps all exceptions thrown from application code.  It functions much in the same way as InvocationTargetException.
If there is an ExceptionMapper for wrapped exception, then that is used to handle the request.</td></tr><tr><td>Failure</td><td>N/A</td><td>Internal Resteasy.  Not logged</td></tr><tr><td>LoggableFailure</td><td>N/A</td><td>Internal Resteasy error.  Logged</td></tr><tr><td>DefaultOptionsMethodException</td><td>N/A</td><td>If the user invokes HTTP OPTIONS and no JAX-RS method for it, Resteasy provides a default behavior by throwing this exception</td></tr></tbody></table>
</div></div><br class="table-break"/>
</div>
<div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="overring_resteasy_exceptions"/>27.3. Overriding Resteasy Builtin Exceptions</h2></div></div></div>
   
   <p>You may override Resteasy built-in exceptions by writing an ExceptionMapper for the exception.  For that matter, you can write an ExceptionMapper
   for any thrown exception including WebApplicationException</p>
</div>
</div>

   <div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="Configuring_Individual_JAX-RS_Resource_Beans"/>Chapter 28. Configuring Individual JAX-RS Resource Beans</h2></div></div></div>


<p>


</p>
<p>

If you are scanning your path for JAX-RS annotated resource beans, your beans will be registered in per-request mode.  This means an instance will be created per HTTP request served.  Generally, you will need information from your environment.  If you are running within a servlet container using the WAR-file distribution, in Beta-2 and lower, you can only use the JNDI lookups to obtain references to Java EE resources and configuration information.  In this case, define your EE configuration (i.e. ejb-ref, env-entry, persistence-context-ref, etc...) within web.xml of the resteasy WAR file.  Then within your code do jndi lookups in the java:comp namespace.  For example:
</p>
<p>

web.xml
</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">

&lt;ejb-ref&gt;
  &lt;ejb-ref-name&gt;ejb/foo&lt;/ejb-ref-name&gt;
  ...
&lt;/ejb-ref&gt;

</pre><p>
</p>
<p>

resource code:
</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">
@Path("/")
public class MyBean {

   public Object getSomethingFromJndi() {
      new InitialContext.lookup("java:comp/ejb/foo");
   }
...
}
</pre><p>
</p>
<p>


</p>
<p>

You can also manually configure and register your beans through the Registry.  To do this in a WAR-based deployment, you need to write a specific ServletContextListener to do this.  Within the listener, you can obtain a reference to the registry as follows:
</p>
<p>

</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">

public class MyManualConfig implements ServletContextListener
{
   public void contextInitialized(ServletContextEvent event)
   {

      Registry registry = (Registry) event.getServletContext().getAttribute(Registry.class.getName());

   }
...
}

</pre><p>
</p>
<p>

Please also take a look at our Spring Integration as well as the Embedded Container's Spring Integration
</p>
<p>

</p>
<p>


</p>
</div>

   <div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="gzip"/>Chapter 29. GZIP Compression/Decompression</h2></div></div></div>
   
   <p>
    Resteasy has automatic GZIP decompression support.  If the client framework or a JAX-RS
    service receives a message body with a Content-Encoding of "gzip", it
    will automatically decompress it.  The client framework automatically
    sets the Accept-Encoding header to be "gzip, deflate".  So you do not
    have to set this header yourself.
    </p>
    <p>Resteasy also supports automatic
    compression.  If the client framework is sending a request
    or the server is sending a response with the Content-Encoding header
    set to "gzip", Resteasy will do the compression. So that you do not
    have to set the Content-Encoding header directly, you can use the
    @org.jboss.resteasy.annotation.GZIP annotation.
   </p>
<pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">
@Path("/")
public interface MyProxy {

   @Consumes("application/xml")
   @PUT
   public void put(@GZIP Order order);
}
</pre>
   <p>In the above example, we tag the outgoing message body, order, to
   be gzip compressed.  You can use the same annotation to tag server responses
   </p>
<pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">
@Path("/")
public class MyService {

   @GET
   @Produces("application/xml")
   @GZIP
   public String getData() {...}
}
</pre>
</div>
   <div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="ContentRange"/>Chapter 30. Content-Range Support</h2></div></div></div>
   
   <p>
      Resteasy supports <code class="literal">Range</code> requests for <code class="literal">java.io.File</code> response entities.
   </p>
      <pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">
   @Path("/")
   public class Resource {
      @GET
      @Path("file")
      @Produces("text/plain")
      public File getFile()
      {
         return file;
      }
   }

      Response response = client.target(generateURL("/file")).request()
              .header("Range", "1-4").get();
      Assert.assertEquals(response.getStatus(), 206);
      Assert.assertEquals(4, response.getLength());
      System.out.println("Content-Range: " + response.getHeaderString("Content-Range"));


      </pre>
</div>

   <div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="Cache_NoCache_CacheControl"/>Chapter 31. Resteasy Caching Features</h2></div></div></div><div class="toc"><dl><dt><span class="sect1"><a href="#Cache_Annotation">31.1. @Cache and @NoCache Annotations</a></span></dt><dt><span class="sect1"><a href="#client_cache">31.2. Client "Browser" Cache</a></span></dt><dt><span class="sect1"><a href="#server_cache">31.3. Local Server-Side Response Cache</a></span></dt></dl></div>
   
   <p>
     Resteasy provides numerous annotations and facilities to support HTTP caching semantics.  Annotations to make setting Cache-Control
     headers easier and both server-side and client-side in-memory caches are available.
   </p>
  <div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="Cache_Annotation"/>31.1. @Cache and @NoCache Annotations</h2></div></div></div>
  
   <p>
      Resteasy provides an extension to JAX-RS that allows you to automatically set Cache-Control headers on a successful
      GET request.  It can only be used on @GET annotated methods.  A successful @GET request is any request
      that returns 200 OK response.
   </p>
   <pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">
package org.jboss.resteasy.annotations.cache;

public @interface Cache
{
   int maxAge() default -1;
   int sMaxAge() default -1;
   boolean noStore() default false;
   boolean noTransform() default false;
   boolean mustRevalidate() default false;
   boolean proxyRevalidate() default false;
   boolean isPrivate() default false;
}

public @interface NoCache
{
   String[] fields() default {};
}

   </pre>
   <p>
      While @Cache builds a complex Cache-Control header, @NoCache is a simplified notation to say that you don't
      want anything cached i.e. Cache-Control: nocache.
   </p>
   <p>
      These annotations can be put on the resource class or interface and specifies a default cache value for each
      @GET resource method.  Or they can be put individually on each @GET resource method.
   </p>
   </div>
   <div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="client_cache"/>31.2. Client "Browser" Cache</h2></div></div></div>
     
     <p>
        Resteasy has the ability to set up a client-side, browser-like, cache.  You can use it with the Client Proxy Framework, or with raw
        ClientRequests.  This cache looks for Cache-Control headers sent back with a server response.  If the Cache-Control headers specify
       that the client is allowed to cache the response, Resteasy caches it within local memory.  The cache obeys max-age requirements 
       and will also automatically do HTTP 1.1 cache revalidation if either or both the Last-Modified and/or ETag headers are sent back with the
       original response.  See the HTTP 1.1 specification for details on how Cache-Control or cache revalidation works.
     </p>
     <p>It is very simple to enable caching.  Here's an example of using the client cache with the Client Proxy Framework</p>
<pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">
@Path("/orders")
public interface OrderServiceClient {

   @Path("{id}")
   @GET
   @Produces("application/xml")
   public Order getOrder(@PathParam("id") String id);
}
</pre>
    <p>To create a proxy for this interface and enable caching for that proxy requires only a few simple steps:</p>
<pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">
import org.jboss.resteasy.client.ProxyFactory;
import org.jboss.resteasy.client.cache.CacheFactory;
import org.jboss.resteasy.client.cache.LightweightBrowserCache;

public static void main(String[] args) throws Exception
{
      RegisterBuiltin.register(ResteasyProviderFactory.getInstance());
      OrderServiceClient proxy = ProxyFactory.create(OrderServiceClient.class, generateBaseUrl());

      // This line enables caching
      LightweightBrowserCache cache = CacheFactory.makeCacheable(proxy);
}
</pre>
   <p>If you are using the ClientRequest class to make invocations rather than the proxy framework, it is just as easy</p>
<pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">
import org.jboss.resteasy.client.ProxyFactory;
import org.jboss.resteasy.client.cache.CacheFactory;
import org.jboss.resteasy.client.cache.LightweightBrowserCache;

public static void main(String[] args) throws Exception
{
      RegisterBuiltin.register(ResteasyProviderFactory.getInstance());

      // This line enables caching
      LightweightBrowserCache cache = new LightweightBrowserCache();

      ClientRequest request = new ClientRequest("http://example.com/orders/333");
      CacheFactory.makeCacheable(request, cache);
}
</pre>
   <p>The LightweightBrowserCache, by default, has a maximum 2 megabytes of caching space.  You can change this programmatically by callings
         its setMaxBytes() method.   If the cache gets full, the cache completely wipes itself of all cached data.  This may seem
         a bit draconian, but the cache was written to avoid unnecessary synchronizations in a concurrent environment where the cache is 
         shared between multiple threads.  If you desire a more complex caching solution or if you want to plug in a thirdparty cache
         please contact our resteasy-developers list and discuss it with the community.
   </p>
   </div>
   <div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="server_cache"/>31.3. Local Server-Side Response Cache</h2></div></div></div>
      
      <p>Resteasy has a server-side cache that can sit in front of your JAX-RS services.
          It automatically caches marshalled responses from HTTP GET JAX-RS invocations if, and only if your
          JAX-RS resource method sets a Cache-Control header.  When a GET comes in, the Resteasy Server Cache checks
          to see if the URI is stored in the cache.  If it does, it returns the already marshalled response without
          invoking your JAX-RS method.  Each cache entry has a max age to whatever is specified in the Cache-Control
          header of the initial request.  The cache also will automatically generate an ETag using an MD5 hash on the
          response body.  This allows the client to do HTTP 1.1 cache revalidation with the IF-NONE-MATCH header.
          The cache is also smart enough to perform revalidation if there is no initial cache hit, but the jax-rs
          method still returns a body that has the same ETag.
      </p>
       <p>
         The cache is also automatically invalidated for a particular URI that has
           PUT, POST, or DELETE invoked on it.  You can also obtain a reference to the cache by injecting a
           org.jboss.resteasy.plugins.cache.ServerCache
           via the @Context annotation
       </p>
<pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">

    @Context
    ServerCache cache;

    @GET
    public String get(@Context ServerCache cache) {...}

</pre>
      <p>To set up the server-side cache you must register an instance of org.jboss.resteasy.plugins.cache.server.ServerCacheFeature
          via your Application getSingletons() or getClasses() methods.  The underlying cache is Infinispan.  By default,
          Resteasy will create an Infinispan cache for you.  Alternatively, you can create and pass in an instance
          of your cache to the ServerCacheFeature constructor.  You can also configure Infinispan by specifying
          various context-param variables in your web.xml.  First, if you are using Maven you must depend on the resteasy-cache-core artifact:</p>
<pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">

&lt;dependency&gt;
   &lt;groupId&gt;org.jboss.resteasy&lt;/groupId&gt;
   &lt;artifactId&gt;resteasy-cache-core&lt;/artifactId&gt;
   &lt;version&gt;3.0.5.Final&lt;/version&gt;
&lt;/dependency&gt;

</pre>
      <p>The next thing you should probably do is set up the Infinispan configuration in your web.xml.</p>
<pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">

&lt;web-app&gt;
    &lt;context-param&gt;
        &lt;param-name&gt;server.request.cache.infinispan.config.file&lt;/param-name&gt;
        &lt;param-value&gt;infinispan.xml&lt;/param-value&gt;
    &lt;/context-param&gt;

    &lt;context-param&gt;
        &lt;param-name&gt;server.request.cache.infinispan.cache.name&lt;/param-name&gt;
        &lt;param-value&gt;MyCache&lt;/param-value&gt;
    &lt;/context-param&gt;

&lt;/web-app&gt;

</pre>
   <p>
       server.request.cache.infinispan.config.file can either be a classpath or a file path. server.request.cache.infinispan.cache.name
       is the name of the cache you want to reference that is declared in the config file.
   </p>
   </div>
</div>

   <div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="Interceptors"/>Chapter 32. Filters and Interceptors</h2></div></div></div><div class="toc"><dl><dt><span class="sect1"><a href="#d4e1328">32.1. Server Side Filters</a></span></dt><dt><span class="sect1"><a href="#d4e1333">32.2. Client Side Filters</a></span></dt><dt><span class="sect1"><a href="#d4e1337">32.3. Reader and Writer Interceptors</a></span></dt><dt><span class="sect1"><a href="#d4e1340">32.4. Per Resource Method Filters and Interceptors</a></span></dt><dt><span class="sect1"><a href="#d4e1344">32.5. Ordering</a></span></dt></dl></div>
    
    <p>JAX-RS 2.0 has two different concepts for interceptions: Filters and Interceptors.  Filters are mainly used to
    modify or process incoming and outgoing request headers or response headers.  They execute before and after
    request and response processing.</p>
    <div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d4e1328"/>32.1. Server Side Filters</h2></div></div></div>
        
    <p>
        On the server-side you have two different types of filters.  ContainerRequestFilters
        run before your JAX-RS resource method is invoked.  ContainerResponseFilters run after your JAX-RS resource method
        is invoked.  As an added caveat, ContainerRequestFilters come in two flavors:  pre-match and post-matching.  Pre-matching
        ContainerRequestFilters are designated with the @PreMatching annotation and will execute before the JAX-RS resource
        method is matched with the incoming HTTP request.  Pre-matching filters often are used to modify request attributes
        to change how it matches to a specific resource method (i.e. strip .xml and add an Accept header).  ContainerRequestFilters can abort the request by calling ContainerRequestContext.abortWith(Response).  A filter
        might want to abort if it implements a custom authentication protocol.
    </p>
    <p>
          After the resource class method is executed, JAX-RS will run all ContainerResponseFilters.  These filters
        allow you to modify the outgoing response before it is marshalling and sent to the client.
        So given all that, here's some pseudo
        code to give some understanding of how things work.
    </p>
    <pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">
        // execute pre match filters
        for (ContainerRequestFilter filter : preMatchFilters) {
            filter.filter(requestContext);
            if (isAborted(requestContext)) {
               sendAbortionToClient(requestContext);
               return;
            }
        }
        // match the HTTP request to a resource class and method
        JaxrsMethod method = matchMethod(requestContext);

        // Execute post match filters
        for (ContainerRequestFilter filter : postMatchFilters) {
           filter.filter(requestContext);
           if (isAborted(requestContext)) {
              sendAbortionToClient(requestContext);
              return;
           }
        }

        // execute resource class method
        method.execute(request);

        // execute response filters
        for (ContainerResponseFilter filter : responseFilters) {
           filter.filter(requestContext, responseContext);
        }
    </pre>
    </div>
    <div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d4e1333"/>32.2. Client Side Filters</h2></div></div></div>
        
        <p>
            On the client side you also have two types of filters: ClientRequestFilter and ClientResponseFilter.
            ClientRequestFilters run before your HTTP request is sent over the wire to the server.  ClientResponseFilters
            run after a response is received from the server, but before the response body is unmarshalled.  ClientRequestFilters
            are also allowed to abort the execute of the request and provide a canned response without going over the
            wire to the server.  ClientResponseFilters can modfiy the Response object before it is handed back to
            application code.  Here's some pseudo code to illustrate things.
        </p>
        <pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">
            // execute request filters
            for (ClientRequestFilter filter : requestFilters) {
               filter.filter(requestContext);
               if (isAborted(requestContext)) {
                  return requestContext.getAbortedResponseObject();
               }
            }

            // send request over the wire
            response = sendRequest(request);

            // execute response filters
            for (ClientResponseFilter filter : responseFilters) {
               filter.filter(requestContext, responseContext);
            }
        </pre>
    </div>
    <div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d4e1337"/>32.3. Reader and Writer Interceptors</h2></div></div></div>
        
        <p>
            While filters modify request or response headers, interceptors deal with message bodies.  Interceptors are executed
            in the same call stack as their corresponding reader or writer.  ReaderInterceptors
            wrap around the execution of MessageBodyReaders.  WriterInterceptors wrap around the execution of MessageBodyWriters.
            They can be used to implement a specific content-encoding.  They can be used to generate digital signatures or
            to post or pre-process a Java object model before or after it is marshalled.
        </p>
    </div>
    <div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d4e1340"/>32.4. Per Resource Method Filters and Interceptors</h2></div></div></div>
        
        <p>
            Sometimes you want a filter or interceptor to only run for a specific resource method.  You can do this in two different
            ways:  register an implementation of DynamicFeature or use the @NameBinding annotation.  The DynamicFeature
            interface is executed at deployment time for each resource method.  You just use the Configurable interface
            to register the filters and interceptors you want for the specific resource method.  @NameBinding works a lot
            like CDI interceptors.  You annotate a custom annotation with @NameBinding and then apply that custom annotation
            to your filter and resource method
        </p>
        <pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">
            @NameBinding
            public @interface DoIt {}

            @DoIt
            public class MyFilter implements ContainerRequestFilter {...}

            @Path("/root")
            public class MyResource {

               @GET
               @DoIt
               public String get() {...}
            }
        </pre>
    </div>
    <div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d4e1344"/>32.5. Ordering</h2></div></div></div>
        
        <p>
            Ordering is accomplished by using the @BindingPriority annotation on your filter or interceptor class.
        </p>
    </div>

</div>
   <div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="Asynchronous_HTTP_Request_Processing"/>Chapter 33. Asynchronous HTTP Request Processing</h2></div></div></div>
   
   <p>
      Asynchronous HTTP Request Processing is a relatively new technique that allows you to process a single HTTP
      request using non-blocking I/O and, if desired in separate threads. Some refer to it as COMET capabilities.
      The primary use case for Asynchronous HTTP is
      in the case where the client is polling the server for a delayed response. The usual example is an AJAX chat
      client where you want to push/pull from both the client and the server. These scenarios have the client blocking
      a long time on the server’s socket waiting for a new message. What happens in synchronous HTTP where the server is
      blocking on incoming and outgoing I/O is that you end up having a thread consumed per client connection.
      This eats up memory and valuable thread resources. Not such a big deal in 90% of applications (in fact using
      asynchronous processing may actually hurt your performance in most common scenarios), but when you start
      getting a lot of concurrent clients that are blocking like this, there’s a lot of wasted resources and your
      server does not scale that well.
   </p>
    <p>
        The JAX-RS 2.0 specification has added asynchronous HTTP support via two classes.  The @Suspended annotation,
      and AsyncResponse interface.
   </p>
   <p>
       Injecting an AsynchronousResponse as a parameter to your jax-rs methods tells Resteasy that the HTTP request/response should be detached from the currently
      executing thread and that the current thread should not try to automatically process the response.
   </p>
   <p>
      The AsyncResponse is the callback object.
      The act of calling one of the resume() methods will cause a response to be sent back to the client and will also terminate the
      HTTP request. Here is an example of asynchronous processing:
   </p>


   <pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">
import javax.ws.rs.Suspend;
import javax.ws.rs.core.AsynchronousResponse;

@Path("/")
public class SimpleResource
{

   @GET
   @Path("basic")
   @Produces("text/plain")
   public void getBasic(@Suspended final AsyncResponse response) throws Exception
   {
      Thread t = new Thread()
      {
         @Override
         public void run()
         {
            try
            {
               Response jaxrs = Response.ok("basic").type(MediaType.TEXT_PLAIN).build();
               response.resume(jaxrs);
            }
            catch (Exception e)
            {
               e.printStackTrace();
            }
         }
      };
      t.start();
   }
}
   </pre>
    <p>
        AsyncResponse also has other methods to cancel the execution.  See javadoc for more details.
    </p>
    <p>
        NOTE: The old Resteasy proprietary API for async http has been deprecated and may be removed as soon as Resteasy 3.1.
    </p>
</div>
   <div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="async_job_service"/>Chapter 34. Asynchronous Job Service</h2></div></div></div><div class="toc"><dl><dt><span class="sect1"><a href="#async_job">34.1. Using Async Jobs</a></span></dt><dt><span class="sect1"><a href="#oneway">34.2. Oneway: Fire and Forget</a></span></dt><dt><span class="sect1"><a href="#async_job_setup">34.3. Setup and Configuration</a></span></dt></dl></div>
   
   <p>
      The Resteasy Asynchronous Job Service is an implementation of the Asynchronous Job pattern defined in O'Reilly's "Restful Web Services" book.  The idea of it is to bring asynchronicity to a synchronous protocol.
   </p>
   <div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="async_job"/>34.1. Using Async Jobs</h2></div></div></div>
     
      <p>While HTTP is a synchronous protocol
      it does have a faint idea of asynchronous invocations.  The HTTP 1.1 response code 202, "Accepted" means that the server
      has received and accepted the response for processing, but the processing has not yet been completed.  The Resteasy 
      Asynchronous Job Service builds around this idea.
   </p>
<pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">
POST http://example.com/myservice?asynch=true
</pre>
   <p>
    For example, if you make the above post with the asynch query parameter set to true, Resteasy will return a 202, "Accepted" response code and run the invocation in the background.  It also sends back a Location header with a URL pointing to where the response of the background method is located.
   </p>
<pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">
HTTP/1.1 202 Accepted
Location: http://example.com/asynch/jobs/3332334
</pre>
   <p>
   The URI will have the form of:
   </p>
<pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">
/asynch/jobs/{job-id}?wait={millisconds}|nowait=true
</pre>
   <p>You can perform the GET, POST, and DELETE operations on this job URL.  GET returns whatever the JAX-RS resource method you invoked
   returned as a response if the job was completed.  If the job has not completed, this GET will return a response code of 202, Accepted.  Invoking GET does not remove the job, so you can call it multiple times.  When Resteasy's job queue gets full, it will evict
the least recently used job from memory.  You can manually clean up after yourself by calling DELETE on the URI.  POST does
a read of the JOB response and will remove the JOB it has been completed.
</p>
   <p>Both GET and POST allow you to specify a maximum
wait time in milliseconds, a "wait" query parameter.  Here's an example:
</p>
<pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">
POST http://example.com/asynch/jobs/122?wait=3000
</pre>
   <p>  If you do not specify a "wait" parameter, the GET or POST will not wait at all if the job is not complete.</p>
   <p>  NOTE!!  While you can invoke GET, DELETE, and PUT methods asynchronously, this breaks the HTTP 1.1 contract of these methods.  While these invocations may not change the state of the resource if invoked more than once, they do change the state of the server as new Job entries with each invocation.  If you want to be a purist, stick with only invoking POST methods asynchronously.
   </p>
   <p> Security NOTE!  Resteasy role-based security (annotations) does not work with the Asynchronous Job Service.  You must use
   XML declarative security within your web.xml file. Why? It is impossible to implement role-based security portably.  In the future, we may have specific JBoss integration, but will not support other environments.</p>
   </div>
   <div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="oneway"/>34.2. Oneway: Fire and Forget</h2></div></div></div>
      
      <p>
         Resteasy also supports the notion of fire and forget.  This will also return a 202, Accepted response, but no Job will
         be created.  This is as simple as using the oneway query parameter instead of asynch.  For example:
      </p>
<pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">
POST http://example.com/myservice?oneway=true
</pre>
   <p> Security NOTE!  Resteasy role-based security (annotations) does not work with the Asynchronous Job Service.  You must use
   XML declaritive security within your web.xml file. Why? It is impossible to implement role-based security portably.  In the future, we may have specific JBoss integration, but will not support other environments.</p>
   </div>
   <div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="async_job_setup"/>34.3. Setup and Configuration</h2></div></div></div>
     
     <p>You must enable the Asynchronous Job Service in your web.xml file as it is not turned on by default.</p>
<pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">

&lt;web-app&gt;
    &lt;!-- enable the Asynchronous Job Service --&gt;
    &lt;context-param&gt;
        &lt;param-name&gt;resteasy.async.job.service.enabled&lt;/param-name&gt;
        &lt;param-value&gt;true&lt;/param-value&gt;
    &lt;/context-param&gt;

    &lt;!-- The next context parameters are all optional.  
         Their default values are shown as example param-values --&gt;

    &lt;!-- How many jobs results can be held in memory at once? --&gt;
    &lt;context-param&gt;
        &lt;param-name&gt;resteasy.async.job.service.max.job.results&lt;/param-name&gt;
        &lt;param-value&gt;100&lt;/param-value&gt;
    &lt;/context-param&gt;

    &lt;!-- Maximum wait time on a job when a client is querying for it --&gt;
    &lt;context-param&gt;
        &lt;param-name&gt;resteasy.async.job.service.max.wait&lt;/param-name&gt;
        &lt;param-value&gt;300000&lt;/param-value&gt;
    &lt;/context-param&gt;

    &lt;!-- Thread pool size of background threads that run the job --&gt;
    &lt;context-param&gt;
        &lt;param-name&gt;resteasy.async.job.service.thread.pool.size&lt;/param-name&gt;
        &lt;param-value&gt;100&lt;/param-value&gt;
    &lt;/context-param&gt;

    &lt;!-- Set the base path for the Job uris --&gt;
    &lt;context-param&gt;
        &lt;param-name&gt;resteasy.async.job.service.base.path&lt;/param-name&gt;
        &lt;param-value&gt;/asynch/jobs&lt;/param-value&gt;
    &lt;/context-param&gt;

    &lt;listener&gt;
        &lt;listener-class&gt;
            org.jboss.resteasy.plugins.server.servlet.ResteasyBootstrap
        &lt;/listener-class&gt;
    &lt;/listener&gt;

    &lt;servlet&gt;
        &lt;servlet-name&gt;Resteasy&lt;/servlet-name&gt;
        &lt;servlet-class&gt;
            org.jboss.resteasy.plugins.server.servlet.HttpServletDispatcher
        &lt;/servlet-class&gt;
    &lt;/servlet&gt;

    &lt;servlet-mapping&gt;
        &lt;servlet-name&gt;Resteasy&lt;/servlet-name&gt;
        &lt;url-pattern&gt;/*&lt;/url-pattern&gt;
    &lt;/servlet-mapping&gt;

&lt;/web-app&gt;

</pre>
   </div>
</div>

   <div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="RESTEasy_Embedded_Container"/>Chapter 35. Embedded Containers</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="#d4e1385">35.1. Undertow</a></span></dt><dt><span class="section"><a href="#d4e1389">35.2. Sun JDK HTTP Server</a></span></dt><dt><span class="section"><a href="#d4e1396">35.3. TJWS Embeddable Servlet Container</a></span></dt><dt><span class="section"><a href="#d4e1408">35.4. Netty</a></span></dt></dl></div>


    <p>Resteasy has a few different plugins for different embedabble HTTP and/or Servlet containers if use Resteasy in
    a test environment, or within an environment where you do not want a Servlet engine dependency.</p>
    <div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d4e1385"/>35.1. Undertow</h2></div></div></div>
        
        <p>
            Undertow is a new Servlet Container that is used by Wildfly (JBoss Community Server).  You can embed
            Undertow as you wish.  Here's a a test that shows it in action.
</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">
import io.undertow.servlet.api.DeploymentInfo;
import org.jboss.resteasy.plugins.server.undertow.UndertowJaxrsServer;
import org.jboss.resteasy.test.TestPortProvider;
import org.junit.AfterClass;
import org.junit.Assert;
import org.junit.BeforeClass;
import org.junit.Test;

import javax.ws.rs.ApplicationPath;
import javax.ws.rs.GET;
import javax.ws.rs.Path;
import javax.ws.rs.Produces;
import javax.ws.rs.client.Client;
import javax.ws.rs.client.ClientBuilder;
import javax.ws.rs.core.Application;
import java.util.HashSet;
import java.util.Set;

/**
 * @author &lt;a href="mailto:bill@burkecentral.com"&gt;Bill Burke&lt;/a&gt;
 * @version $Revision: 1 $
 */
public class UndertowTest
{
   private static UndertowJaxrsServer server;

   @Path("/test")
   public static class Resource
   {
      @GET
      @Produces("text/plain")
      public String get()
      {
         return "hello world";
      }
   }

   @ApplicationPath("/base")
   public static class MyApp extends Application
   {
      @Override
      public Set&lt;Class&lt;?&gt;&gt; getClasses()
      {
         HashSet&lt;Class&lt;?&gt;&gt; classes = new HashSet&lt;Class&lt;?&gt;&gt;();
         classes.add(Resource.class);
         return classes;
      }
   }

   @BeforeClass
   public static void init() throws Exception
   {
      server = new UndertowJaxrsServer().start();
   }

   @AfterClass
   public static void stop() throws Exception
   {
      server.stop();
   }

   @Test
   public void testApplicationPath() throws Exception
   {
      server.deploy(MyApp.class);
      Client client = ClientBuilder.newClient();
      String val = client.target(TestPortProvider.generateURL("/base/test"))
                         .request().get(String.class);
      Assert.assertEquals("hello world", val);
      client.close();
   }

   @Test
   public void testApplicationContext() throws Exception
   {
      server.deploy(MyApp.class, "/root");
      Client client = ClientBuilder.newClient();
      String val = client.target(TestPortProvider.generateURL("/root/test"))
                         .request().get(String.class);
      Assert.assertEquals("hello world", val);
      client.close();
   }

   @Test
   public void testDeploymentInfo() throws Exception
   {
      DeploymentInfo di = server.undertowDeployment(MyApp.class);
      di.setContextPath("/di");
      di.setDeploymentName("DI");
      server.deploy(di);
      Client client = ClientBuilder.newClient();
      String val = client.target(TestPortProvider.generateURL("/di/base/test"))
                         .request().get(String.class);
      Assert.assertEquals("hello world", val);
      client.close();
   }
}

</pre><p>
        </p>
    </div>
    <div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d4e1389"/>35.2. Sun JDK HTTP Server</h2></div></div></div>
        
        <p>
            The Sun JDK comes with a simple HTTP server implementation (com.sun.net.httpserver.HttpServer) which you
            can run Resteasy on top of.
        </p>
    <pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class=""> 
      HttpServer httpServer = HttpServer.create(new InetSocketAddress(port), 10);
      contextBuilder = new HttpContextBuilder();
      contextBuilder.getDeployment().getActualResourceClasses().add(SimpleResource.class);
      HttpContext context = contextBuilder.bind(httpServer);
      context.getAttributes().put("some.config.info", "42");
      httpServer.start();

      contextBuilder.cleanup();
      httpServer.stop(0);
    </pre>
    <p>
        Create your HttpServer the way you want then use the org.jboss.resteasy.plugins.server.sun.http.HttpContextBuilder to initialize Resteasy
        and bind it to an HttpContext.  The HttpContext attributes are available by injecting in a org.jboss.resteasy.spi.ResteasyConfiguration
        interface using @Context within your provider and resource classes.

    </p>
    <p>Maven project you must include is:</p>
<pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class=""> 
  &lt;dependency&gt;
      &lt;groupId&gt;org.jboss.resteasy&lt;/groupId&gt;
      &lt;artifactId&gt;resteasy-jdk-http&lt;/artifactId&gt;
      &lt;version&gt;3.0.5.Final&lt;/version&gt;
  &lt;/dependency&gt;
</pre>

   
    </div>

    <div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d4e1396"/>35.3. TJWS Embeddable Servlet Container</h2></div></div></div>
        
<p>

RESTeasy integrates with the TJWS Embeddable Servlet container.  It comes with this distribution, or you can reference the Maven artifact.  You must also provide
    a servlet API dependency as well.
</p>

<pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class=""> 
  &lt;dependency&gt;
      &lt;groupId&gt;org.jboss.resteasy&lt;/groupId&gt;
      &lt;artifactId&gt;tjws&lt;/artifactId&gt;
      &lt;version&gt;3.0.5.Final&lt;/version&gt;
  &lt;/dependency&gt;

  &lt;dependency&gt;
      &lt;groupId&gt;javax.servlet&lt;/groupId&gt;
      &lt;artifactId&gt;servlet-api&lt;/artifactId&gt;
      &lt;version&gt;2.5&lt;/version&gt;
  &lt;/dependency&gt;
</pre>

<p>

From the distribution, move the jars in resteasy-jaxrs.war/WEB-INF/lib into your classpath.  You must both programmatically register your JAX-RS beans using the embedded server's Registry.  Here's an example:
</p>
<p>

</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">

@Path("/")
public class MyResource {

   @GET
   public String get() { return "hello world"; }
 

   public static void main(String[] args) throws Exception 
   {
      TJWSEmbeddedJaxrsServer tjws = new TJWSEmbeddedJaxrsServer();
      tjws.setPort(8080);
      tjws.start();
      tjws.getRegistry().addPerRequestResource(RestEasy485Resource.class);
   }
}

</pre><p>
</p>
<p>

The server can either host non-encrypted or SSL based resources, but not both.  See the Javadoc for TJWSEmbeddedJaxrsServer as well as its superclass TJWSServletServer.  The TJWS website is also a good place for information.
</p>
<p>


</p>
<p>

If you want to use Spring, see the SpringBeanProcessor.  Here's a pseudo-code example
</p>
<p>

</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">

   public static void main(String[] args) throws Exception 
   {
      final TJWSEmbeddedJaxrsServer tjws = new TJWSEmbeddedJaxrsServer();
      tjws.setPort(8081);

      tjws.start();
      org.jboss.resteasy.plugins.server.servlet.SpringBeanProcessor processor = new SpringBeanProcessor(tjws.getDeployment().getRegistry(), tjws.getDeployment().getFactory();
      ConfigurableBeanFactory factory = new XmlBeanFactory(...);
      factory.addBeanPostProcessor(processor);
   }
</pre><p>
      </p>
    </div>
    <div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d4e1408"/>35.4. Netty</h2></div></div></div>
        
        <p>
            Resteasy has integration with the popular Netty project as well..
        </p>
    <pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class=""> 
   public static void start(ResteasyDeployment deployment) throws Exception
   {
      netty = new NettyJaxrsServer();
      netty.setDeployment(deployment);
      netty.setPort(TestPortProvider.getPort());
      netty.setRootResourcePath("");
      netty.setSecurityDomain(null);
      netty.start();
   }
    </pre>

    <p>Maven project you must include is:</p>
<pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class=""> 
  &lt;dependency&gt;
      &lt;groupId&gt;org.jboss.resteasy&lt;/groupId&gt;
      &lt;artifactId&gt;resteasy-netty&lt;/artifactId&gt;
      &lt;version&gt;3.0.5.Final&lt;/version&gt;
  &lt;/dependency&gt;
</pre>

    </div>

</div>

   <div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="RESTEasy_Server-side_Mock_Framework"/>Chapter 36. Server-side Mock Framework</h2></div></div></div>


<p>

Although RESTEasy has an Embeddable Container, you may not be comfortable with the idea of starting and stopping a web server within unit tests (in reality, the embedded container starts in milli seconds), or you might not like the idea of using Apache HTTP Client or java.net.URL to test your code.  RESTEasy provides a mock framework so that you can invoke on your resource directly.
</p>
<p>

</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">
import org.jboss.resteasy.mock.*;
...

      Dispatcher dispatcher = MockDispatcherFactory.createDispatcher();

      POJOResourceFactory noDefaults = new POJOResourceFactory(LocatingResource.class);
      dispatcher.getRegistry().addResourceFactory(noDefaults);

      {
         MockHttpRequest request = MockHttpRequest.get("/locating/basic");
         MockHttpResponse response = new MockHttpResponse();

         dispatcher.invoke(request, response);


         Assert.assertEquals(HttpServletResponse.SC_OK, response.getStatus());
         Assert.assertEquals("basic", response.getContentAsString());
      }
</pre><p>
</p>
<p>

See the RESTEasy Javadoc for all the ease-of-use methods associated with MockHttpRequest, and MockHttpResponse.
</p>
<p>


</p>
</div>

   <div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="Securing_JAX-RS_and_RESTeasy"/>Chapter 37. Securing JAX-RS and RESTeasy</h2></div></div></div>


<p>

Because Resteasy is deployed as a servlet, you must use standard web.xml constraints to enable authentication and authorization.  
</p>
<p>

Unfortunately, web.xml constraints do not mesh very well with JAX-RS in some situations.  The problem is that web.xml URL pattern matching is very very limited.  URL patterns in web.xml only support simple wildcards, so JAX-RS resources like:
</p>
<p>

</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">/{pathparam1}/foo/bar/{pathparam2} </pre><p>
</p>
<p>

Cannot be mapped as a web.xml URL pattern like:
</p>
<p>

</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">/*/foo/bar/*</pre><p>
</p>
<p>

To get around this problem you will need to use the security annotations defined below on your JAX-RS methods.  You will still need to set up some general security constraint elements in web.xml to turn on authentication.
</p>
<p>


</p>
<p>

Resteasy JAX-RS supports the @RolesAllowed, @PermitAll and @DenyAll annotations on JAX-RS methods.   By default though, Resteasy does not recognize these annotations.  You have to 
configure Resteasy to turn on role-based security by setting a context parameter.  NOTE!!!  Do not turn on this switch if you are using EJBs.  The EJB container will provide this
functionality instead of Resteasy.

</p>
<pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">

&lt;web-app&gt;
...
   &lt;context-param&gt;
      &lt;param-name&gt;resteasy.role.based.security&lt;/param-name&gt;
      &lt;param-value&gt;true&lt;/param-value&gt;
   &lt;/context-param&gt;
&lt;/web-app&gt;
</pre>

<p>There is a bit of quirkiness with this approach.   You will have to declare all roles used within the Resteasy JAX-RS war file that you are using in your JAX-RS classes and set up a security constraint that permits all of these roles access to every URL handled by the JAX-RS runtime.  You'll just have to trust that Resteasy JAX-RS authorizes properly.
</p>
<p>

How does Resteasy do authorization?  Well, its really simple.  It just sees if a method is annotated with @RolesAllowed and then just does HttpServletRequest.isUserInRole.  If one of the @RolesAllowed passes, then allow the request, otherwise, a response is sent back with a 401 (Unauthorized) response code.
</p>
<p>

So, here's an example of a modified RESTEasy WAR file.  You'll notice that every role declared is allowed access to every URL controlled by the Resteasy servlet.
</p>
<p>

</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">

&lt;web-app&gt;

   &lt;context-param&gt;
      &lt;param-name&gt;resteasy.role.based.security&lt;/param-name&gt;
      &lt;param-value&gt;true&lt;/param-value&gt;
   &lt;/context-param&gt;

   &lt;listener&gt;
      &lt;listener-class&gt;org.jboss.resteasy.plugins.server.servlet.ResteasyBootstrap&lt;/listener-class&gt;
   &lt;/listener&gt;

   &lt;servlet&gt;
      &lt;servlet-name&gt;Resteasy&lt;/servlet-name&gt;
      &lt;servlet-class&gt;org.jboss.resteasy.plugins.server.servlet.HttpServletDispatcher&lt;/servlet-class&gt;
   &lt;/servlet&gt;

   &lt;servlet-mapping&gt;
      &lt;servlet-name&gt;Resteasy&lt;/servlet-name&gt;
      &lt;url-pattern&gt;/*&lt;/url-pattern&gt;
   &lt;/servlet-mapping&gt;

   &lt;security-constraint&gt;
      &lt;web-resource-collection&gt;
         &lt;web-resource-name&gt;Resteasy&lt;/web-resource-name&gt;
         &lt;url-pattern&gt;/security&lt;/url-pattern&gt;
      &lt;/web-resource-collection&gt;
       &lt;auth-constraint&gt;
         &lt;role-name&gt;admin&lt;/role-name&gt;
         &lt;role-name&gt;user&lt;/role-name&gt;
      &lt;/auth-constraint&gt;
  &lt;/security-constraint&gt;

   &lt;login-config&gt;
      &lt;auth-method&gt;BASIC&lt;/auth-method&gt;
      &lt;realm-name&gt;Test&lt;/realm-name&gt;
   &lt;/login-config&gt;

   &lt;security-role&gt;
      &lt;role-name&gt;admin&lt;/role-name&gt;
   &lt;/security-role&gt;
   &lt;security-role&gt;
      &lt;role-name&gt;user&lt;/role-name&gt;
   &lt;/security-role&gt;


&lt;/web-app&gt;


</pre><p>
</p>
<p>


</p>
</div>

   
<div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="oauth2"/>Chapter 38. OAuth 2.0 and Resteasy Skeleton Key</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="#d4e1461">38.1. System Requirements</a></span></dt><dt><span class="section"><a href="#d4e1474">38.2. Generate the Security Domain Key Pair</a></span></dt><dt><span class="section"><a href="#d4e1479">38.3. Setting up the Auth Server</a></span></dt><dd><dl><dt><span class="section"><a href="#d4e1482">38.3.1. Setting up your Security Domain</a></span></dt><dt><span class="section"><a href="#d4e1509">38.3.2. Auth Server Config File</a></span></dt><dt><span class="section"><a href="#d4e1576">38.3.3. Set up web.xml</a></span></dt><dt><span class="section"><a href="#d4e1579">38.3.4. Set up jboss-web.xml</a></span></dt><dt><span class="section"><a href="#d4e1583">38.3.5. Set up jboss-deployment-structure.xml</a></span></dt><dt><span class="section"><a href="#d4e1587">38.3.6. Tweak your login page</a></span></dt></dl></dd><dt><span class="section"><a href="#d4e1592">38.4. Setting Up An App for SSO</a></span></dt><dd><dl><dt><span class="section"><a href="#d4e1595">38.4.1. SSO config file</a></span></dt><dt><span class="section"><a href="#d4e1639">38.4.2. Set up web.xml</a></span></dt><dt><span class="section"><a href="#d4e1642">38.4.3. Set up jboss-web.xml</a></span></dt><dt><span class="section"><a href="#d4e1646">38.4.4. Set up jboss-deployment-structure.xml</a></span></dt></dl></dd><dt><span class="section"><a href="#d4e1650">38.5. Bearer Token only Setup</a></span></dt><dd><dl><dt><span class="section"><a href="#d4e1653">38.5.1. Bearer token auth config file</a></span></dt><dt><span class="section"><a href="#d4e1669">38.5.2. Set up web.xml</a></span></dt><dt><span class="section"><a href="#d4e1672">38.5.3. Set up jboss-web.xml</a></span></dt><dt><span class="section"><a href="#d4e1676">38.5.4. Set up jboss-deployment-structure.xml</a></span></dt></dl></dd><dt><span class="section"><a href="#d4e1680">38.6. Obtaining an access token programmatically.</a></span></dt><dt><span class="section"><a href="#d4e1690">38.7. Access remote services securely in a secure web session</a></span></dt><dt><span class="section"><a href="#d4e1698">38.8. Check Out the OAuth2 Example!</a></span></dt><dt><span class="section"><a href="#d4e1702">38.9. Auth Server Action URLs</a></span></dt></dl></div>
    
    <p>
        The overall goal of Resteasy Skeleton Key is to provide a unified way for both Browser and JAX-RS clients
        to be secured in an integrated and seemless fashion.  We want to support a network of applications and
        services so that if one server needs to execute or forward requests to another, there is a secure and
        scalable way to do this without hitting a central authentication server each and every request.
    </p>
    <p>
        The <a class="ulink" href="http://tools.ietf.org/html/rfc6749">OAuth 2.0</a> Authorization Framework enables a
        third-party to obtain access to an HTTP resource on behalf of a resource owner without the third-party
        having to know the credentials of the resource owner.  It does this by issuing access tokens via a browser
        redirect protocol, or by a direct grant.  The access tokens can then be transmitted by the <a class="ulink" href="http://tools.ietf.org/html/draft-ietf-oauth-v2-bearer-23">OAuth2 Bearer Token</a>
        protocol to access the protected resource.
    </p>
    <p>
        Resteasy Skeleton Key is an OAuth 2.0 implementation that allows you to use existing JBoss AS7 security infrastructure
        to secure your web applications and restful services.  You can turn an existing web app into an OAuth 2.0 Access
        Token Provider or you can turn a JBoss AS7 Security Domain into a central authentication and authorization
        server that a whole host of applications and services can use.  Here are the features in a nutshell:
    </p>
    <p>
    </p><div class="itemizedlist"><ul><li>
            <p>
                Turn an existing servlet-form-auth-based web application into an OAuth 2.0 provider.
            </p>
        </li><li>
            <p>
                Provide Distributed Single-Sign-On (SSO) from a central authentication server.  Log in once, and
                you can securely access any browser-based app configured to work in the domain.
            </p>
        </li><li>
            <p>
                Provide Distributed Logout.  Following one link from any application can log you out of all your
                distributed applications configured to use SSO.
            </p>
        </li><li>
            <p>
                Web apps can interact securely with any remote restful service by forwarding access tokens through
                the standard Authorization header.
            </p>
        </li><li>
            <p>
                Access tokens are digitally signed by the oauth2 framework and can be used to access any service
                configured to work in the domain.  The tokens contain both identity and role mapping information.  Because
                they are digitally signed, there's no need to overload the central authentication server with each request
                to verify identity and to determine permissions.
            </p>
        </li></ul></div><p>
    </p>
    <div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="important"><h2>Important</h2>
        <p>The Resteasy distribution comes with an OAuth2 Skeleton key example.  This is a great way to see
            OAuth2 in action and how it is configured.  You may also want to use this as a template for your applications.
        </p>
    </div>

    <div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d4e1461"/>38.1. System Requirements</h2></div></div></div>
        
        <div class="itemizedlist"><ul><li>
                <p>JBoss AS 7.1.x or higher</p>
            </li><li>
                <p>HTTPS is required.  See the JBoss 7 documentation on how to enable SSL for web applications</p>
            </li><li>
                Resteasy 3.0 or higher must be installed within your AS7 distribution.  View how to <a class="link" href="#upgrading-as7" title="3.1. Upgrading Resteasy Within JBoss AS 7">upgrade AS7</a>
                to the latest version of Resteasy.
            </li><li>
                <p>A username/password based JBoss security domain</p>
            </li><li>
                <p>Browser-based apps must be configured to use servlet FORM authentication and web.xml security
                constraints</p>
            </li></ul></div>
     </div>
    <div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d4e1474"/>38.2. Generate the Security Domain Key Pair</h2></div></div></div>
        
        <p>
            Access tokens are digitally signed and verified by an RSA keypair.  You must generate this keypair using
            the JDK's keytool command or by something like openssl.
        </p>
<pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">
$ keytool -genkey -alias mydomain -keyalg rsa -keystore realm.jks
</pre>
        <p>
            This will ask you a series of questions that will be used to create the X509 public certificate. Basic PKI
            stuff that you hopefully are already familiar with.  Move this keystore file into a directory that you can
            reference from a configuration file.  I suggest the standalone/configuration directory of your JBoss AS7
            distribution.
        </p>
    </div>
    <div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d4e1479"/>38.3. Setting up the Auth Server</h2></div></div></div>
        
        <p>The next thing you're gonna want to do is set up a web application to be your OAuth2 provider.
        This can be an existing web app or you can create a new WAR to be your central authentication server.
        An existing web app must be configured to use servlet FORM authentication.  Enabling OAuth2 within
        this app will not change how normal users interact with it.</p>
        <div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d4e1482"/>38.3.1. Setting up your Security Domain</h3></div></div></div>
            
            <p>
                You can use any set of JBoss AS7 login modules you want to store your username, passwords and role mappings.
                Each security domain will be comprised of regular users, oauth clients, and admins.  Oauth clients
                represent either a web application that wants to use the auth-server to do SSO, or they are traditional
                oauth clients that want access permision to act on behalf of another user (the traditional OAuth use case).
                Every oauth client must have a username, password, and a specific role mapping that gives them various permissions to
                participate in OAuth 2 protocols.  There is a role that grants an oauth client permission
                to login as a specific user (default is <code class="literal">login</code>.  This is the SSO case.  There is a role that grants a client permission
                to request permission to act on behalf of a user (default is <code class="literal">oauth</code>).  Additional
                role mappings assigned to the oauth client define what additional permissions they are allowed to have.  These
                additional permissions are the role mappings of the application and are the intersection of the permissions
                given to the user the client is acting on behalf of.  This is better explained by an example role mapping file:
           </p>
<pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">
wburke=user,admin
loginclient=login
oauthclient1=oauth,*
oauthclient2=oauth,user
</pre>
            <p>
                In the above role mapping file with have a simple user <code class="literal">wburke</code>.  He has application
                role permissions of <code class="literal">user</code> and <code class="literal">admin</code>.  One oauth client user
                is <code class="literal">loginclient</code>.  It has been given a role mapping of <code class="literal">login</code>.
                This client is allowed to login as the user and is given all roles of the user.  The <code class="literal">oauthclient1</code>
                user is not allowed to login as the user, but is allowed to obtain an OAuth grant to act on behalf of the
                user.  The <code class="literal">*</code> role means that <code class="literal">oauthclient1</code> is granted the same
                roles as the user it is acting on behalf of.  If <code class="literal">oauthclient1</code> acts on behalf of
                <code class="literal">wburke</code> then it will have both <code class="literal">user</code> and <code class="literal">admin</code> permissions.
                The <code class="literal">oauthclient2</code> is also allowed to use the oauth grant protocol, but it will only
                ever be granted <code class="literal">user</code> permissions.
            </p>
            <p>
                You are not confined to login, oauth, and * as role mapping names.  You can configure them to
                be whatever you want.
            </p>
            <p>
                <span class="emphasis"><em>Why have different login and oauth role mappings?</em></span>  <code class="literal">login</code> clients
                are allowed to bypass entering username and password if the user has already logged in once and has
                an existing authenticated session with the server.  <code class="literal">oauth</code> clients are <span class="emphasis"><em>always</em></span>
                required to enter username and password.  You probably don't want to grant permission automatically to
                an oauth client.  A user will want to look at who is requesting permission.  This role distinction
                gives you this capability.
            </p>
        </div>
        <div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d4e1509"/>38.3.2. Auth Server Config File</h3></div></div></div>
            
            <p>You must create a configuration file that holds all the configuration for OAuth2.  This is json formatted
            If you name it <code class="literal">resteasy-oauth.json</code> and put it within the <code class="literal">WEB-INF/</code>
            directory of your war, that's all you have to do.  Otherwise, you must specify the full path
            to this configuration file within a context-param within your web.xml file.  The name of this param
            is <code class="literal">skeleton.key.config.file</code>.  You can reference System properties within the
            value of this context-param by enclosing them within <code class="literal">${VARIABLE}</code>.  Here's an
            example configuration:</p>
<pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">
{
   "realm" : "mydomain",
   "admin-role" : "admin",
   "login-role" : "login",
   "oauth-client-role" : "oauth",
   "wildcard-role" : "*",
   "realm-keystore" : "${jboss.server.config.dir}/realm.jks",
   "realm-key-alias" : "mydomain",
   "realm-keystore-password" : "password",
   "realm-private-key-password" : "password",
   "access-code-lifetime" : "300",
   "token-lifetime" : "3600",
   "truststore" : "${jboss.server.config.dir}/client-truststore.ts",
   "truststore-password" : "password",
   "resources" : [
      "https://example.com/customer-portal",
      "https://somewhere.com/product-portal"
   ]
}
</pre>
            <p>
                Let's go over what each of these config variables represent:
                </p><div class="variablelist"><dl><dt><span class="term">realm</span></dt><dd>
                            <p>
                                Name of the realm representing the users of your distributed applications and services
                            </p>
                        </dd><dt><span class="term">admin-role</span></dt><dd>
                            <p>
                                Admin role mapping used for admins.  You must have this defined if you want to
                                do distributed logout.
                            </p>
                        </dd><dt><span class="term">login-role</span></dt><dd>
                            <p>
                                Role mapping for login clients.
                            </p>
                        </dd><dt><span class="term">oauth-client-role</span></dt><dd>
                            <p>
                                Role mapping for regular oauth clients.
                            </p>
                        </dd><dt><span class="term">wildcard-role</span></dt><dd>
                            <p>
                                Role mapping for assigning all roles to an oauth client wishing to act on behalf of a user.
                            </p>
                        </dd><dt><span class="term">realm-keystore</span></dt><dd>
                            <p>
                                Absolute path pointing to the keystore that contains the realm's keypair.  This keypair
                                is used to digitally sign access tokens.  You may use <code class="literal">${VARIABLE}</code>
                                to reference System properties.  The example is referencing the JBoss config dir.
                            </p>
                        </dd><dt><span class="term">realm-key-alias</span></dt><dd>
                            <p>
                                Key alias for the key pair stored in your realm-keystore file.
                            </p>
                        </dd><dt><span class="term">realm-keystore-password</span></dt><dd>
                            <p>
                                Password to access the keystore.
                            </p>
                        </dd><dt><span class="term">realm-private-key-password</span></dt><dd>
                            <p>
                                Password to access the private realm key within the keystore
                            </p>
                        </dd><dt><span class="term">access-code-lifetime</span></dt><dd>
                            <p>
                                The access code is obtained via a browser redirect after you log into the central server.
                                This access code is then transmitted in a separate request to the auth server to obtain
                                an access token.  This variable is the lifetime of this access code.  In how many seconds
                                will it expire.  You want to keep this value short.  The default is 300 seconds.
                            </p>
                        </dd><dt><span class="term">token-lifetime</span></dt><dd>
                            <p>
                             This is how long in seconds the access token is viable after it was first created.  The
                                default is one hour.  Depending on your security requirements you may want to extend
                                or shorten this default.
                            </p>
                        </dd><dt><span class="term">truststore</span></dt><dd>
                            <p>
                                Used for outgoing client HTTPS communications.  This contains one or more trusted
                                host certificates or certificate authorities.  This is OPTIONAL if you are not
                                using distributed logout.
                            </p>
                        </dd><dt><span class="term">truststore-password</span></dt><dd>
                            <p>
                                Password for the truststore keystore.
                            </p>
                        </dd><dt><span class="term">resources</span></dt><dd>
                            <p>
                                Root URLs of applications using this auth-server for SSO.  This is OPTIONAL and only
                                needed if you want to allow distributed logout.
                            </p>
                        </dd></dl></div><p>
            </p>
        </div>
        <div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d4e1576"/>38.3.3. Set up web.xml</h3></div></div></div>
            
            <p>
                Set up your security constraints however you like.  You must though use FORM authentication.
            </p>
        </div>
        <div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d4e1579"/>38.3.4. Set up jboss-web.xml</h3></div></div></div>
            
            <p>
                In jboss-web.xml in your WEB-INF directory, point to your security domain as a normal secured web app does,
                and also use a specific valve.
            </p>
            <pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">
&lt;jboss-web&gt;
    &lt;security-domain&gt;java:/jaas/commerce&lt;/security-domain&gt;
    &lt;valve&gt;
        &lt;class-name&gt;org.jboss.resteasy.skeleton.key.as7.OAuthAuthenticationServerValve&lt;/class-name&gt;
    &lt;/valve&gt;
&lt;/jboss-web&gt;</pre>
        </div>
        <div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d4e1583"/>38.3.5. Set up jboss-deployment-structure.xml</h3></div></div></div>
            
            <p>
                You must import the skeleton key modules so that the classes are visible to this application.  Include
                this file within WEB-INF
            </p>
            <pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">
&lt;jboss-deployment-structure&gt;
    &lt;deployment&gt;
        &lt;dependencies&gt;
            &lt;module name="org.jboss.resteasy.resteasy-jaxrs" services="import"/&gt;
            &lt;module name="org.jboss.resteasy.resteasy-jackson-provider" services="import"/&gt;
            &lt;module name="org.jboss.resteasy.skeleton-key"/&gt;
        &lt;/dependencies&gt;
    &lt;/deployment&gt;
&lt;/jboss-deployment-structure&gt;</pre>
        </div>
        <div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d4e1587"/>38.3.6. Tweak your login page</h3></div></div></div>
            
            <p>
                The action url used by your login form is dependent on the oauth protocol.  Skeleton key defines
                a request attribute called <code class="literal">OAUTH_FORM_ACTION</code> which is the URL you should
                use for the form's action.  Here's an example login.jsp page that uses this attribute:
            </p>
            <pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">
&lt;form action="&lt;%= request.getAttribute("OAUTH_FORM_ACTION")%&gt;" method=post&gt;
    &lt;p&gt;&lt;strong&gt;Please Enter Your User Name: &lt;/strong&gt;
    &lt;input type="text" name="j_username" size="25"&gt;
    &lt;p&gt;&lt;p&gt;&lt;strong&gt;Please Enter Your Password: &lt;/strong&gt;
    &lt;input type="password" size="15" name="j_password"&gt;
    &lt;p&gt;&lt;p&gt;
    &lt;input type="submit" value="Submit"&gt;
    &lt;input type="reset" value="Reset"&gt;
&lt;/form&gt;
</pre>
        </div>
    </div>
    <div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d4e1592"/>38.4. Setting Up An App for SSO</h2></div></div></div>
        
        <p>
            This section specifies how you can use the central auth-server for SSO.  Following these directions will
            use the auth-server for browser log in.  The server will also be able to do bearer token authentication as well.
        </p>
        <div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d4e1595"/>38.4.1. SSO config file</h3></div></div></div>
            
            <p>
                The best way to create the config file for your application is to ask the central authentication server
                you configured in the last section.  So, boot up the auth server and go to https://<span class="emphasis"><em>auth-server-context-root</em></span>/j_oauth_realm_info.html.
                For example: <code class="literal">https://localhost:8443/auth-server/j_oauth_realm_info.html</code>. This will
                show template configurations depending on which valve you are using.  You want the <code class="literal">OAuthManagedResourceValve</code> config.
                It will look something like this.
            </p>
            <pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">
{
  "realm" : "mydomain",
  "realm-public-key" : "MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQCO8XXyi7oAq5ecsYy+tJrl54N2TtKAkxuWEDmzvSPU+mUA2/3qHcxucZakG74Z49410tn5IIu2CXXlk9CuKcpXvKh+cPBzmC1Nmbd+4MelRVVZnvogyPICs8h3sNTAMNdfI6hDc5/MfVQQ9m5OZrKbNR3dY50mTi/ExnJ5IWPqxQIDAQAB",
  "admin-role" : "admin",
  "auth-url" : "https://localhost:8443/auth-server/login.jsp",
  "code-url" : "https://localhost:8443/auth-server/j_oauth_resolve_access_code",
  "truststore" : "REQUIRED",
  "truststore-password" : "REQUIRED",
  "client-id" : "REQUIRED",
  "client-credentials" : {
    "password" : "REQUIRED"
  }
}</pre>
            Let's go over what each of these config variables represent:
            <div class="variablelist"><dl><dt><span class="term">realm</span></dt><dd>
                        <p>
                            Name of the realm representing the users of your distributed applications and services
                        </p>
                    </dd><dt><span class="term">realm-public-key</span></dt><dd>
                        <p>
                            PEM format of public key.
                        </p>
                    </dd><dt><span class="term">admin-role</span></dt><dd>
                        <p>
                            Admin role mapping used for admins.  You must have this defined if you want to
                            do distributed logout.
                        </p>
                    </dd><dt><span class="term">auth-url</span></dt><dd>
                        <p>
                            URL of the auth server's login page.
                        </p>
                    </dd><dt><span class="term">code-url</span></dt><dd>
                        <p>
                            URL to turn an access code into an access token. (Part of the OAuth2 protocol)
                        </p>
                    </dd><dt><span class="term">truststore</span></dt><dd>
                        <p>
                            Used for outgoing client HTTPS communications.  This contains one or more trusted
                            host certificates or certificate authorities.  This is REQUIRED as you must talk
                            HTTPS to the auth server to turn an access code into an access token.  You can
                            create this truststore by extracting the public certificate of the auth server's SSL
                            keystore.  The google knows if you want to know how to do this.
                        </p>
                    </dd><dt><span class="term">truststore-password</span></dt><dd>
                        <p>
                            Password for the truststore keystore.
                        </p>
                    </dd><dt><span class="term">client-id</span></dt><dd>
                        <p>
                            Username of the login client.  This server will send client-id and password when
                            turning an access code into an access token.  Internally, the server will do an HTTPS
                            invocation to the auth-server passing this information using Basic AUTH.
                        </p>
                    </dd><dt><span class="term">client-credentials</span></dt><dd>
                        <p>
                            Must specify the password of the oauth login client.
                        </p>
                    </dd></dl></div>
        </div>
        <div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d4e1639"/>38.4.2. Set up web.xml</h3></div></div></div>
            
            <p>
                Set up your security constraints however you like.  You must though use FORM authentication.
            </p>
        </div>
        <div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d4e1642"/>38.4.3. Set up jboss-web.xml</h3></div></div></div>
            
            <p>
                In jboss-web.xml in your WEB-INF directory you need to use a specific valve.
            </p>
            <pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">
&lt;jboss-web&gt;
    &lt;valve&gt;
        &lt;class-name&gt;org.jboss.resteasy.skeleton.key.as7.OAuthManagedResourceValve&lt;/class-name&gt;
    &lt;/valve&gt;
&lt;/jboss-web&gt;</pre>
        </div>
        <div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d4e1646"/>38.4.4. Set up jboss-deployment-structure.xml</h3></div></div></div>
            
            <p>
                You must import the skeleton key modules so that the classes are visible to this application.  Include
                this file within WEB-INF
            </p>
            <pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">
&lt;jboss-deployment-structure&gt;
    &lt;deployment&gt;
        &lt;dependencies&gt;
            &lt;module name="org.jboss.resteasy.resteasy-jaxrs" services="import"/&gt;
            &lt;module name="org.jboss.resteasy.resteasy-jackson-provider" services="import"/&gt;
            &lt;module name="org.jboss.resteasy.skeleton-key"/&gt;
        &lt;/dependencies&gt;
    &lt;/deployment&gt;
&lt;/jboss-deployment-structure&gt;</pre>
        </div>
    </div>
    <div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d4e1650"/>38.5. Bearer Token only Setup</h2></div></div></div>
        
        <p>
            If you have a web app that you want only to allow Bearer token authentication, i.e. a set of JAX-RS services
            then follow these directions.
        </p>
        <div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d4e1653"/>38.5.1. Bearer token auth config file</h3></div></div></div>
            
            <p>
                The best way to create the config file for your application is to ask the central authentication server
                you configured in the last section.  So, boot up the auth server and go to https://<span class="emphasis"><em>auth-server-context-root</em></span>/j_oauth_realm_info.html.
                For example: <code class="literal">https://localhost:8443/auth-server/j_oauth_realm_info.html</code>. This will
                show template configurations depending on which valve you are using.  You want the <code class="literal">BearerTokenAuthenticatorValve</code> config.
                It will look something like this.
            </p>
            <pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">
{
  "realm" : "mydomain",
  "realm-public-key" : "MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQCO8XXyi7oAq5ecsYy+tJrl54N2TtKAkxuWEDmzvSPU+mUA2/3qHcxucZakG74Z49410tn5IIu2CXXlk9CuKcpXvKh+cPBzmC1Nmbd+4MelRVVZnvogyPICs8h3sNTAMNdfI6hDc5/MfVQQ9m5OZrKbNR3dY50mTi/ExnJ5IWPqxQIDAQAB",
}</pre>
            All that is needed is the realm name, and the public key of the realm.
            Let's go over what each of these config variables represent:
            <div class="variablelist"><dl><dt><span class="term">realm</span></dt><dd>
                        <p>
                            Name of the realm representing the users of your distributed applications and services
                        </p>
                    </dd><dt><span class="term">realm-public-key</span></dt><dd>
                        <p>
                            PEM format of the realm's public key.  Used to verify tokens.
                        </p>
                    </dd></dl></div>
        </div>
        <div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d4e1669"/>38.5.2. Set up web.xml</h3></div></div></div>
            
            <p>
                Set up your security constraints however you like.  You must though use FORM authentication.
            </p>
        </div>
        <div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d4e1672"/>38.5.3. Set up jboss-web.xml</h3></div></div></div>
            
            <p>
                In jboss-web.xml in your WEB-INF directory you need to use a specific valve.
            </p>
            <pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">
&lt;jboss-web&gt;
    &lt;valve&gt;
        &lt;class-name&gt;org.jboss.resteasy.skeleton.key.as7.BearerTokenAuthenticatorValve&lt;/class-name&gt;
    &lt;/valve&gt;
&lt;/jboss-web&gt;</pre>
        </div>
        <div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d4e1676"/>38.5.4. Set up jboss-deployment-structure.xml</h3></div></div></div>
            
            <p>
                You must import the skeleton key modules so that the classes are visible to this application.  Include
                this file within WEB-INF
            </p>
            <pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">
&lt;jboss-deployment-structure&gt;
    &lt;deployment&gt;
        &lt;dependencies&gt;
            &lt;module name="org.jboss.resteasy.resteasy-jaxrs" services="import"/&gt;
            &lt;module name="org.jboss.resteasy.resteasy-jackson-provider" services="import"/&gt;
            &lt;module name="org.jboss.resteasy.skeleton-key"/&gt;
        &lt;/dependencies&gt;
    &lt;/deployment&gt;
&lt;/jboss-deployment-structure&gt;</pre>
        </div>
    </div>
    <div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d4e1680"/>38.6. Obtaining an access token programmatically.</h2></div></div></div>
        
        <p>
            You can request an access token from the auth-server by doing a simple HTTPS invocation.  You must
            use BASIC authentication to identify your user, and you will get back a signed access token for that user.
            Here's an example using a JAX-RS 2.0 client:
        </p>
<pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">
    ResteasyClient client = new ResteasyClientBuilder()
                                .truststore(truststore)
                                .build();

    Form form = new Form().param("grant_type", "client_credentials");
    ResteasyWebTarget target = client.target("https://localhost:8443/auth-server/j_oauth_token_grant");
    target.configuration().register(new BasicAuthentication("bburke@redhat.com", "password"));
    AccessTokenResponse res = target.request()
                           .post(Entity.form(form), AccessTokenResponse.class);
</pre>
        <p>
           The above makes a simple POST to the context root of the auth server with <code class="literal">j_oauth_token_grant</code>
            at the end of the target URL.  This resource is responsible for creating access tokens.
        </p>
 <pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">
    try
    {
       Response response = client.target("https://localhost:8443/database/products").request()
                               .header(HttpHeaders.AUTHORIZATION, "Bearer " + res.getToken()).get();
       String xml = response.readEntity(String.class);
    }
    finally
    {
       client.close();
    }
</pre>
        <p>
            The access token is a simple string.  To invoke on a service protected by bearer token auth, just
            set the <code class="literal">Authorization</code> header of your HTTPS request with a value of <code class="literal">Bearer</code>
            and then the access token string.
        </p>

    </div>
    <div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d4e1690"/>38.7. Access remote services securely in a secure web session</h2></div></div></div>
        
        <p>
            If you have an application secured by one of the methods described in this chapter, you can obtain
            the access token of the current web session so that you can use it to invoke on other remote services
            securely using bearer token authentication.  Each HttpServletRequest in a secure web session has an attribute
            called <code class="literal">org.jboss.resteasy.skeleton.key.SkeletonKeySession</code> which points to an instance
            of a class with the same  name.  This class contains the access token and also points to the truststore
            you configured.  You can then extract this info and make secure remote invocations.  Here's an example of that.
        </p>
<pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">
   public List&lt;String&gt; getCustomers(HttpServletRequest request)
   {
      SkeletonKeySession session = (SkeletonKeySession)request.getAttribute(SkeletonKeySession.class.getName());
      ResteasyClient client = new ResteasyClientBuilder()
                 .truststore(session.getMetadata().getTruststore())
                 .build();
      try
      {
         Response response = client.target("https://localhost:8443/database/customers").request()
                 .header(HttpHeaders.AUTHORIZATION, "Bearer " + session.getToken()).get();
         return response.readEntity(new GenericType&lt;List&lt;String&gt;&gt;(){});
      }
      finally
      {
         client.close();
      }
   }
        
</pre>
        <p>
            If you are within a JAX-RS environment you can inject a <code class="literal">SkeletonKeySession</code> using the <code class="literal">@Context</code> annotation.
        </p>
    </div>
    <div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d4e1698"/>38.8. Check Out the OAuth2 Example!</h2></div></div></div>
        
        <div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="important"><h2>Important</h2>
          <p>The Resteasy distribution comes with an example project that shows all of these different features in action!  Check it out!</p>
        </div>
    </div>
    <div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d4e1702"/>38.9. Auth Server Action URLs</h2></div></div></div>
        
        <p>
            For reference, here is the set of relative URL actions that the auth server will publish.
            </p><div class="variablelist"><dl><dt><span class="term"><span class="emphasis"><em>login page</em></span></span></dt><dd>
                        <p>
                            The is the url of your login page.  OAuth clients will redirect to it.  This is application
                            specific.
                        </p>
                    </dd><dt><span class="term">j_oauth_resolve_access_code</span></dt><dd>
                        <p>
                            Used by oauth clients to turn an access code into an access token.
                        </p>
                    </dd><dt><span class="term">j_oauth_logout</span></dt><dd>
                        <p>
                            Do a GET request to this URL and it will perform a distributed logout.
                        </p>
                    </dd><dt><span class="term">j_oauth_token_grant</span></dt><dd>
                        <p>
                            Do a POST with BASIC Auth to obtain an access token for a specific user.
                        </p>
                    </dd><dt><span class="term">j_oauth_realm_info.html</span></dt><dd>
                        <p>
                            Displays an HTML page with template configurations for using this realm.
                        </p>
                    </dd></dl></div><p>
        </p>
    </div>
</div>
   

<div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="Authentication"/>Chapter 39. Authentication</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="#d4e1730">39.1. OAuth core 1.0a</a></span></dt><dd><dl><dt><span class="section"><a href="#d4e1739">39.1.1. Authenticating with OAuth 1.0a</a></span></dt><dt><span class="section"><a href="#d4e1775">39.1.2. Accessing protected resources</a></span></dt><dt><span class="section"><a href="#d4e1795">39.1.3. Implementing an OAuthProvider</a></span></dt></dl></dd></dl></div>
    
    <p>Since Resteasy runs within a servlet container you can use most (all?) mechanism available in your servlet container for authentication.  Basic and Digest
    authentication are probably the easiest to set up and fit nicely into REST's stateless principle.  Form security can be used, but requires passing
    the session's cookie value with each request.  We have done some preliminary work on OAuth and also plan to work on OpenID and SAML integration in the future.</p>
    <div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d4e1730"/>39.1. OAuth core 1.0a</h2></div></div></div>
    	
    	<p>
    		RESTEasy has preliminary support for <a class="ulink" href="http://oauth.net/core/1.0a">OAuth core 1.0a</a>.
    		This includes support for authenticating with OAuth (as described by the <a class="ulink" href="http://oauth.net/core/1.0a#rfc.section.6">spec section 6</a>)
    		and OAuth authentication for protected resources (as described by the <a class="ulink" href="http://oauth.net/core/1.0a#rfc.section.7">spec section 7</a>).
    	</p>
    	<div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="important"><h2>Important</h2>
    		<p>
    			This API is deprecated and will be removed in subsequent versions of Resteasy unless there is an outcry from the community.
                We're focusing on OAuth 2.0 protocols.  Please see our <a class="link" href="#oauth2" title="Chapter 38. OAuth 2.0 and Resteasy Skeleton Key">OAuth 2.0 Work</a>.
    		</p>
    	</div>
    	<div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d4e1739"/>39.1.1. Authenticating with OAuth 1.0a</h3></div></div></div>
    		
    		<p>
				OAuth authentication is the process in which Users grant access to their Protected Resources without sharing their credentials with the Consumer.
			</p>
			<p>
				OAuth Authentication is done in three steps:
			</p>
			<div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="orderedlist"><ol><li>
					<p>
						The Consumer obtains an unauthorized Request Token. This part is handled by RESTEasy.
					</p>
				</li><li>
					<p>
					The User authorizes the Request Token. This part is <span class="emphasis"><em>not handled by RESTEasy</em></span> because it requires a user interface where the User
					logs in and authorizes or denies the Request Token. This cannot be implemented automatically as it needs to be integrated with your User login process
					and user interface.
					</p>
				</li><li>
					<p>
					The Consumer exchanges the Request Token for an Access Token. This part is handled by RESTEasy. 
					</p>
				</li></ol></div>
			<p>
				In order for RESTEasy to provide the two URL endpoints where the Client will request unauthorized Request Tokens and exchange authorized Request Tokens
				for Access Tokens, you need to enable the OAuthServlet in your web.xml:
			</p>
			<pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><br />
<span class="xml_comment">&lt;!--&nbsp;The&nbsp;OAuth&nbsp;Servlet&nbsp;handles&nbsp;token&nbsp;exchange&nbsp;--&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">servlet</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">servlet-name</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">OAuth</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">servlet-name</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">servlet-class</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">org.jboss.RESTEasy.auth.oauth.OAuthServlet</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">servlet-class</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">servlet</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain"></span><br />
<span class="xml_comment">&lt;!--&nbsp;This&nbsp;will&nbsp;be&nbsp;the&nbsp;base&nbsp;for&nbsp;the&nbsp;token&nbsp;exchange&nbsp;endpoint&nbsp;URL&nbsp;--&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">servlet-mapping</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">servlet-name</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">OAuth</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">servlet-name</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">url-pattern</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">/oauth/*</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">url-pattern</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">servlet-mapping</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><br />
</pre>
			<p>
				The following configuration options are available using <code class="code">&lt;context-param&gt; elements</code>:
			</p>
			<table id="d4e1755">
				<caption>Table 39.1. OAuth 1.0a Servlet options</caption>
				<thead>
					<tr>
						<th rowspan="1" colspan="1">Option Name</th>
						<th rowspan="1" colspan="1">Default</th>
						<th rowspan="1" colspan="1">Description</th>
					</tr>
				</thead>
				<tbody>
					<tr>
						<td rowspan="1" colspan="1">oauth.provider.provider-class</td>
						<td rowspan="1" colspan="1">*Required*</td>
						<td rowspan="1" colspan="1">Defines the fully-qualified class name of your OAuthProvider implementation</td>
					</tr>
					<tr>
						<td rowspan="1" colspan="1">oauth.provider.tokens.request</td>
						<td rowspan="1" colspan="1">/requestToken</td>
						<td rowspan="1" colspan="1">This defines the endpoint URL for requesting unauthorized Request Tokens</td>
					</tr>
					<tr>
						<td rowspan="1" colspan="1">oauth.provider.tokens.access</td>
						<td rowspan="1" colspan="1">/accessToken</td>
						<td rowspan="1" colspan="1">This defines the endpoint URL for exchanging authorized Request Tokens for Access Tokens</td>
					</tr>
				</tbody>
			</table>
		</div>
    	<div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d4e1775"/>39.1.2. Accessing protected resources</h3></div></div></div>
    		
    		<p>
				After successfully receiving the Access Token and Token Secret, the Consumer is able to access the Protected Resources on behalf of the User.
			</p>
			<p>
				RESTEasy supports OAuth authentication for protected resources using a servlet filter which should be mapped in your web.xml for all
				protected resources:
			</p>
			<pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><br />
<span class="xml_comment">&lt;!--&nbsp;The&nbsp;OAuth&nbsp;Filter&nbsp;handles&nbsp;authentication&nbsp;for&nbsp;protected&nbsp;resources&nbsp;--&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">filter</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">filter-name</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">OAuth&nbsp;Filter</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">filter-name</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">filter-class</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">org.jboss.RESTEasy.auth.oauth.OAuthFilter</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">filter-class</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">filter</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><br />
<span class="xml_comment">&lt;!--&nbsp;This&nbsp;defines&nbsp;the&nbsp;URLs&nbsp;which&nbsp;should&nbsp;require&nbsp;OAuth&nbsp;authentication&nbsp;for&nbsp;your&nbsp;protected&nbsp;resources&nbsp;--&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">filter-mapping</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">filter-name</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">OAuth&nbsp;Filter</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">filter-name</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">url-pattern</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">/rest/*</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">url-pattern</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">filter-mapping</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><br />
</pre>
			<p>
				The following configuration options are available using <code class="code">&lt;context-param&gt; elements</code>:
			</p>
			<table id="d4e1782">
				<caption>Table 39.2. OAuth Filter options</caption>
				<thead>
					<tr>
						<th rowspan="1" colspan="1">Option Name</th>
						<th rowspan="1" colspan="1">Default</th>
						<th rowspan="1" colspan="1">Description</th>
					</tr>
				</thead>
				<tbody>
					<tr>
						<td rowspan="1" colspan="1">oauth.provider.provider-class</td>
						<td rowspan="1" colspan="1">*Required*</td>
						<td rowspan="1" colspan="1">Defines the fully-qualified class name of your OAuthProvider implementation</td>
					</tr>
				</tbody>
			</table>
			<p>
				Once authenticated, the OAuth Servlet Filter will set your request's Principal and Roles, which can then be
				accessed using the JAX-RS SecurityContext. You can also protect your resources using Roles as described in the section "Securing JAX-RS and RESTeasy".
			</p>
		</div>
		<div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d4e1795"/>39.1.3. Implementing an OAuthProvider</h3></div></div></div>
			
			<p>
				In order for RESTEasy to implement OAuth it needs you to provide an instance of <code class="code">OAuthProvider</code> which
				will provide access to the list of Consumer, Request and Access Tokens. Because one size doesn’t fit all we cannot
				know if you wish to store your Tokens and Consumer credentials in a configuration file, in memory, or on persistent storage.
			</p>
			<p>
				All you need to do is implement the <code class="code">OAuthProvider</code> interface:
			</p>
			<pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">

public interface OAuthProvider {
	String getRealm();

	OAuthConsumer getConsumer(String consumerKey)throws OAuthException;
	OAuthToken getRequestToken(String consumerKey, String requestToken) throws OAuthException;
	OAuthToken getAccessToken(String consumerKey, String accessToken) throws OAuthException;
	
	OAuthToken makeRequestToken(String consumerKey, String callback) throws OAuthException;
	OAuthToken makeAccessToken(String consumerKey, String requestToken, String verifier) throws OAuthException;

	String authoriseRequestToken(String consumerKey, String requestToken) throws OAuthException;

	void checkTimestamp(OAuthToken token, long timestamp) throws OAuthException;
}

			</pre>
			<p>
				If a Consumer Key, or Token doesn’t exist, or if the timestamp is not valid,
				simply throw an <code class="code">OAuthException</code>.
			</p>
			<p>
				The rest of the interfaces used in <code class="code">OAuthProvider</code> are:
			</p>
			<pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">

public interface OAuthConsumer {
	String getKey();
	String getSecret();
}

public interface OAuthToken {
	OAuthConsumer getConsumer();
	String getToken();
	String getSecret();
	Principal getPrincipal();
	Set&lt;String&gt; getRoles();
}

			</pre>
	    </div>
	</div>
</div>
    <div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d4e1807"/>Chapter 40. JSON Web Signature and Encryption (JOSE-JWT)</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="#d4e1810">40.1. JSON Web Signature (JWS)</a></span></dt><dt><span class="section"><a href="#d4e1816">40.2. JSON Web Encryption (JWE)</a></span></dt></dl></div>
  

  <p>JSON Web Signature and Encryption (JOSE JWT) is a new specification that can be used
  to encode content as a string and either digitally sign or encrypt it.  I won't go over the spec here
  Do a Google search on it ifyou're interested</p>

  <div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d4e1810"/>40.1. JSON Web Signature (JWS)</h2></div></div></div>
      
      <p>To digitally sign content using JWS, use the <code class="literal">org.jboss.resteasy.jose.jws.JWSBuilder</code> class.
          To unpack and verify a JWS, use the <code class="literal">org.jboss.resteasy.jose.jws.JWSInput</code> class. (TODO, write
          more doco here!)
      Here's an example:</p>
      <pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">
          
   @Test
   public void testRSAWithContentType() throws Exception
   {
      KeyPair keyPair = KeyPairGenerator.getInstance("RSA").generateKeyPair();

      String encoded = new JWSBuilder()
              .contentType(MediaType.TEXT_PLAIN_TYPE)
              .content("Hello World", MediaType.TEXT_PLAIN_TYPE)
              .rsa256(keyPair.getPrivate());

      System.out.println(encoded);

      JWSInput input = new JWSInput(encoded, ResteasyProviderFactory.getInstance());
      System.out.println(input.getHeader());
      String msg = (String)input.readContent(String.class);
      Assert.assertEquals("Hello World", msg);
      Assert.assertTrue(RSAProvider.verify(input, keyPair.getPublic()));

   }

      </pre>
  </div>
    <div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d4e1816"/>40.2. JSON Web Encryption (JWE)</h2></div></div></div>
        
        <p>To encrypt content using JWE, use the <code class="literal">org.jboss.resteasy.jose.jwe.JWEBuilder</code> class.
            To decrypt content using JWE, use the <code class="literal">org.jboss.resteasy.jose.jwe.JWEInput</code> class. (TODO, write
            more doco here!)
            Here's an example:</p>
        <pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">
            
   @Test
   public void testRSA() throws Exception
   {
      KeyPair keyPair = KeyPairGenerator.getInstance("RSA").generateKeyPair();

      String content = "Live long and prosper.";

      {
      String encoded = new JWEBuilder().contentBytes(content.getBytes()).RSA1_5((RSAPublicKey)keyPair.getPublic());
      System.out.println("encoded: " + encoded);
      byte[] raw = new JWEInput(encoded).decrypt((RSAPrivateKey)keyPair.getPrivate()).getRawContent();
      String from = new String(raw);
      Assert.assertEquals(content, from);
      }
      {
         String encoded = new JWEBuilder().contentBytes(content.getBytes()).RSA_OAEP((RSAPublicKey)keyPair.getPublic());
         System.out.println("encoded: " + encoded);
         byte[] raw = new JWEInput(encoded).decrypt((RSAPrivateKey)keyPair.getPrivate()).getRawContent();
         String from = new String(raw);
         Assert.assertEquals(content, from);
      }
      {
         String encoded = new JWEBuilder().contentBytes(content.getBytes()).A128CBC_HS256().RSA1_5((RSAPublicKey)keyPair.getPublic());
         System.out.println("encoded: " + encoded);
         byte[] raw = new JWEInput(encoded).decrypt((RSAPrivateKey)keyPair.getPrivate()).getRawContent();
         String from = new String(raw);
         Assert.assertEquals(content, from);
      }
      {
         String encoded = new JWEBuilder().contentBytes(content.getBytes()).A128CBC_HS256().RSA_OAEP((RSAPublicKey)keyPair.getPublic());
         System.out.println("encoded: " + encoded);
         byte[] raw = new JWEInput(encoded).decrypt((RSAPrivateKey)keyPair.getPrivate()).getRawContent();
         String from = new String(raw);
         Assert.assertEquals(content, from);
      }
   }

   @Test
   public void testDirect() throws Exception
   {
      String content = "Live long and prosper.";
      String encoded = new JWEBuilder().contentBytes(content.getBytes()).dir("geheim");
      System.out.println("encoded: " + encoded);
      byte[] raw = new JWEInput(encoded).decrypt("geheim").getRawContent();
      String from = new String(raw);
      Assert.assertEquals(content, from);

   }
        </pre>
    </div>

</div>

   <div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="signature"/>Chapter 41. Doseta Digital Signature Framework</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="#d4e1878">41.1. Maven settings</a></span></dt><dt><span class="section"><a href="#d4e1883">41.2. Signing API</a></span></dt><dd><dl><dt><span class="section"><a href="#d4e1889">41.2.1. @Signed annotation</a></span></dt></dl></dd><dt><span class="section"><a href="#d4e1897">41.3. Signature Verification API</a></span></dt><dd><dl><dt><span class="section"><a href="#d4e1906">41.3.1. Annotation-based verification</a></span></dt></dl></dd><dt><span class="section"><a href="#d4e1914">41.4. Managing Keys via a KeyRepository</a></span></dt><dd><dl><dt><span class="section"><a href="#d4e1917">41.4.1. Create a KeyStore</a></span></dt><dt><span class="section"><a href="#d4e1924">41.4.2. Configure Restreasy to use the KeyRepository</a></span></dt><dt><span class="section"><a href="#d4e1938">41.4.3. Using DNS to Discover Public Keys</a></span></dt></dl></dd></dl></div>
  

  <p>Digital signatures allow you to protect the integrity of a message.
  They are used to verify that a message sent was sent by the actual user that
  sent the message and was modified in transit. Most web apps handle message
  integrity by using TLS, like HTTPS, to secure the connection between the
  client and server. Sometimes though, we have representations that are going
  to be forwarded to more than one recipient. Some representations may hop
  around from server to server. In this case, TLS is not enough. There needs
  to be a mechanism to verify who sent the original representation and that
  they actually sent that message. This is where digital signatures come
  in.</p>

  <p>While the mime type multiple/signed exists, it does have drawbacks.
  Most importantly it requires the receiver of the message body to understand
  how to unpack. A receiver may not understand this mime type. A better
  approach would be to put signatures in an HTTP header so that receivers that
  don't need to worry about the digital signature, don't have to.</p>

  <p>The email world has a nice protocol called <a class="ulink" href="http://dkim.org">Domain Keys Identified Mail</a> (DKIM). Work is
  also being done to apply this header to protocols other than email (i.e.
  HTTP) through the <a class="ulink" href="https://tools.ietf.org/html/draft-crocker-doseta-base-02">DOSETA
  specifications</a>. It allows you to sign a message body and attach the
  signature via a DKIM-Signature header. Signatures are calculated by first
  hashing the message body then combining this hash with an arbitrary set of
  metadata included within the DKIM-Signature header. You can also add other
  request or response headers to the calculation of the signature. Adding
  metadata to the signature calculation gives you a lot of flexibility to
  piggyback various features like expiration and authorization. Here's what an
  example DKIM-Signature header might look like.</p>

  <pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">DKIM-Signature: v=1;
                a=rsa-sha256;
                d=example.com;
                s=burke;
                c=simple/simple;
                h=Content-Type;
                x=0023423111111;
                bh=2342322111;
                b=M232234=

</pre>

  <p>As you can see it is a set of name value pairs delimited by a ';'.
  While its not THAT important to know the structure of the header, here's an
  explanation of each parameter:</p>

  <div class="variablelist"><dl><dt><span class="term">v</span></dt><dd>
        <p>Protocol version. Always 1.</p>
      </dd><dt><span class="term">a</span></dt><dd>
        <p>Algorithm used to hash and sign the message. RSA signing and
        SHA256 hashing is the only supported algorithm at the moment by
        Resteasy.</p>
      </dd><dt><span class="term">d</span></dt><dd>
        <p>Domain of the signer. This is used to identify the signer as
        well as discover the public key to use to verify the signature.</p>
      </dd><dt><span class="term">s</span></dt><dd>
        <p>Selector of the domain. Also used to identify the signer and
        discover the public key.</p>
      </dd><dt><span class="term">c</span></dt><dd>
        <p>Canonical algorithm. Only simple/simple is supported at the
        moment. Basically this allows you to transform the message body before
        calculating the hash</p>
      </dd><dt><span class="term">h</span></dt><dd>
        <p>Semi-colon delimited list of headers that are included in the
        signature calculation.</p>
      </dd><dt><span class="term">x</span></dt><dd>
        <p>When the signature expires. This is a numeric long value of the
        time in seconds since epoch. Allows signer to control when a signed
        message's signature expires</p>
      </dd><dt><span class="term">t</span></dt><dd>
        <p>Timestamp of signature. Numeric long value of the time in
        seconds since epoch. Allows the verifier to control when a signature
        expires.</p>
      </dd><dt><span class="term">bh</span></dt><dd>
        <p>Base 64 encoded hash of the message body.</p>
      </dd><dt><span class="term">b</span></dt><dd>
        <p>Base 64 encoded signature.</p>
      </dd></dl></div>

  <p>To verify a signature you need a public key. DKIM uses DNS text
  records to discover a public key. To find a public key, the verifier
  concatenates the Selector (s parameter) with the domain (d parameter)</p>

  <p>&lt;selector&gt;._domainKey.&lt;domain&gt;</p>

  <p>It then takes that string and does a DNS request to retrieve a TXT
  record under that entry. In our above example burke._domainKey.example.com
  would be used as a string. This is a every interesting way to publish public
  keys. For one, it becomes very easy for verifiers to find public keys.
  There's no real central store that is needed. DNS is a infrastructure IT
  knows how to deploy. Verifiers can choose which domains they allow requests
  from. Resteasy supports discovering public keys via DNS. It also instead
  allows you to discover public keys within a local Java KeyStore if you do
  not want to use DNS. It also allows you to plug in your own mechanism to
  discover keys.</p>

  <p>If you're interested in learning the possible use cases for digital
  signatures, here's a <a class="ulink" href="http://bill.burkecentral.com/2011/02/21/multiple-uses-for-content-signature/">blog</a>
  you might find interesting.</p>

  <div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d4e1878"/>41.1. Maven settings</h2></div></div></div>
    

    <p>You must include the resteasy-crypto project to use the digital
    signature framework.</p>

    <pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">        &lt;dependency&gt;
            &lt;groupId&gt;org.jboss.resteasy&lt;/groupId&gt;
            &lt;artifactId&gt;resteasy-crypto&lt;/artifactId&gt;
            &lt;version&gt;3.0.5.Final&lt;/version&gt;
        &lt;/dependency&gt;

</pre>
  </div>

  <div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d4e1883"/>41.2. Signing API</h2></div></div></div>
    

    <p>To sign a request or response using the Resteasy client or server
    framework you need to create an instance of
    org.jboss.resteasy.security.doseta.DKIMSignature. This class represents
    the DKIM-Signature header. You instantiate the DKIMSignature object and
    then set the "DKIM-Signature" header of the request or response. Here's an
    example of using it on the server-side:</p>

    <pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">import org.jboss.resteasy.security.doseta.DKIMSignature;
import java.security.PrivateKey;


@Path("/signed")
public static class SignedResource
{
   @GET
   @Path("manual")
   @Produces("text/plain")
   public Response getManual()
   {
      PrivateKey privateKey = ....; // get the private key to sign message
      
      DKIMSignature signature = new DKIMSignature();
      signature.setSelector("test");
      signature.setDomain("samplezone.org");
      signature.setPrivateKey(privateKey);

      Response.ResponseBuilder builder = Response.ok("hello world");
      builder.header(DKIMSignature.DKIM_SIGNATURE, signature);
      return builder.build();
   }
}

// client example

DKIMSignature signature = new DKIMSignature();
PrivateKey privateKey = ...; // go find it
signature.setSelector("test");
signature.setDomain("samplezone.org");
signature.setPrivateKey(privateKey);

ClientRequest request = new ClientRequest("http://...");
request.header("DKIM-Signature", signature);
request.body("text/plain", "some body to sign");
ClientResponse response = request.put();
</pre><p>To sign a message you need a PrivateKey. This can be
    generated by KeyTool or manually using regular, standard JDK Signature
    APIs. Resteasy currently only supports RSA key pairs. The DKIMSignature
    class also allows you to add and control how various pieces of metadata
    are added to the DKIM-Signature header and the signature calculation. See
    the javadoc for more details.</p>

    <p>If you are including more than one signature, then just add
    additional DKIMSignature instances to the headers of the request or
    response.</p>

    <div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d4e1889"/>41.2.1. @Signed annotation</h3></div></div></div>
      

      <p>Instead of using the API, Resteasy also provides you an
      annotation alternative to the manual way of signing using a
      DKIMSignature instances is to use the
      @org.jboss.resteasy.annotations.security.doseta.Signed annotation. It is
      required that you configure a KeyRepository as described later in this
      chapter. Here's an example:</p>

      <pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">   @GET
   @Produces("text/plain")
   @Path("signedresource")
   @Signed(selector="burke", domain="sample.com", timestamped=true, expires=@After(hours=24))
   public String getSigned()
   {
      return "hello world";
   }

</pre><p>The above example using a bunch of the optional annotation
      attributes of @Signed to create the following Content-Signature
      header:</p>

      <pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">DKIM-Signature: v=1;
                a=rsa-sha256;
                c=simple/simple;
                domain=sample.com;
                s=burke;
                t=02342342341;
                x=02342342322;
                bh=m0234fsefasf==;
                b=mababaddbb==
   
</pre><p><em class="parameter"><code>This annotation also works with the client proxy
      framework.</code></em></p>
    </div>
  </div>

  <div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d4e1897"/>41.3. Signature Verification API</h2></div></div></div>
    

    <p>If you want fine grain control over verification, this is an API to
    verify signatures manually. Its a little tricky because you'll need the
    raw bytes of the HTTP message body in order to verify the signature. You
    can get at an unmarshalled message body as well as the underlying raw
    bytes by using a org.jboss.resteasy.spi.MarshalledEntity injection. Here's
    an example of doing this on the server side:</p>

    <pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">import org.jboss.resteasy.spi.MarshalledEntity;


@POST
@Consumes("text/plain")
@Path("verify-manual")
public void verifyManual(@HeaderParam("Content-Signature") DKIMSignature signature,
                         @Context KeyRepository repository, 
                         @Context HttpHeaders headers, 
                         MarshalledEntity&lt;String&gt; input) throws Exception
{
      Verifier verifier = new Verifier();
      Verification verification = verifier.addNew();
      verification.setRepository(repository);
      verification.setStaleCheck(true);
      verification.setStaleSeconds(100);
      try {
          verifier.verifySignature(headers.getRequestHeaders(), input.getMarshalledBytes, signature);
      } catch (SignatureException ex) {
      }
      System.out.println("The text message posted is: " + input.getEntity());
}
</pre><p>MarshalledEntity is a generic interface. The template
    parameter should be the Java type you want the message body to be
    converted into. You will also have to configure a KeyRepository. This is
    describe later in this chapter.</p>

    <p>The client side is a little bit different:</p>

    <pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">ClientRequest request = new ClientRequest("http://localhost:9095/signed"));


ClientResponse&lt;String&gt; response = request.get(String.class);
Verifier verifier = new Verifier();
Verification verification = verifier.addNew();
verification.setRepository(repository);
response.getProperties().put(Verifier.class.getName(), verifier);

// signature verification happens when you get the entity
String entity = response.getEntity();

</pre><p><em class="parameter"><code>On the client side, you create a verifier and add
    it as a property to the ClientResponse. This will trigger the verification
    interceptors.</code></em></p>

    <div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d4e1906"/>41.3.1. Annotation-based verification</h3></div></div></div>
      

      <p>The easiest way to verify a signature sent in a HTTP request on
      the server side is to use the
      @@org.jboss.resteasy.annotations.security.doseta.Verify (or
      @Verifications which is used to verify multiple signatures). Here's an
      example:</p>

      <pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">      @POST
      @Consumes("text/plain")
      @Verify
      public void post(String input)
      {
      }

</pre><p>In the above example, any DKIM-Signature headers attached to
      the posted message body will be verified. The public key to verify is
      discovered using the configured KeyRepository (discussed later in this
      chapter). You can also specify which specific signatures you want to
      verify as well as define multiple verifications you want to happen via
      the @Verifications annotation. Here's a complex example:</p>

      <pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">@POST
@Consumes("text/plain")
@Verifications(
   @Verify(identifierName="d", identiferValue="inventory.com", stale=@After(days=2)),
   @Verify(identifierName="d", identiferValue="bill.com")
}
public void post(String input) {...}
</pre><p>The above is expecting 2 different signature to be included
      within the DKIM-Signature header.</p>

      <p>Failed verifications will throw an
      org.jboss.resteasy.security.doseta.UnauthorizedSignatureException. This
      causes a 401 error code to be sent back to the client. If you catch this
      exception using an ExceptionHandler you can browse the failure
      results.</p>
    </div>
  </div>

  <div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d4e1914"/>41.4. Managing Keys via a KeyRepository</h2></div></div></div>
    

    <p>Resteasy manages keys for you through a
    org.jboss.resteasy.security.doseta.KeyRepository. By default, the
    KeyRepository is backed by a Java KeyStore. Private keys are always
    discovered by looking into this KeyStore. Public keys may also be
    discovered via a DNS text (TXT) record lookup if configured to do so. You
    can also implement and plug in your own implementation of
    KeyRepository.</p>

    <div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d4e1917"/>41.4.1. Create a KeyStore</h3></div></div></div>
      

      <p>Use the Java keytool to generate RSA key pairs. Key aliases MUST
      HAVE the form of:</p>

      <p>&lt;selector&gt;._domainKey.&lt;domain&gt;</p>

      <p>For example:</p>

      <pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">$ keytool -genkeypair -alias burke._domainKey.example.com -keyalg RSA -keysize 1024 -keystore my-apps.jks </pre><p>You
      can always import your own official certificates too. See the JDK
      documentation for more details.</p>
    </div>

    <div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d4e1924"/>41.4.2. Configure Restreasy to use the KeyRepository</h3></div></div></div>
      

      <p>Next you need to configure the KeyRepository in your web.xml file
      so that it is created and made available to Resteasy to discover private
      and public keys.You can reference a Java key store you want the Resteasy
      signature framework to use within web.xml using either
      <code class="literal">resteasy.keystore.classpath</code> or
      <code class="literal">resteasy.keystore.filename</code> context parameters. You
      must also specify the password (sorry its clear text) using the
      <code class="literal">resteasy.keystore.password</code> context parameter. The
      resteasy.context.objects is used to create the instance of the
      repository. For example:</p>

      <pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">    &lt;context-param&gt;
        &lt;param-name&gt;resteasy.doseta.keystore.classpath&lt;/param-name&gt;
        &lt;param-value&gt;test.jks&lt;/param-value&gt;
    &lt;/context-param&gt;
    &lt;context-param&gt;
        &lt;param-name&gt;resteasy.doseta.keystore.password&lt;/param-name&gt;
        &lt;param-value&gt;geheim&lt;/param-value&gt;
    &lt;/context-param&gt;
    &lt;context-param&gt;
        &lt;param-name&gt;resteasy.context.objects&lt;/param-name&gt;
        &lt;param-value&gt;org.jboss.resteasy.security.doseta.KeyRepository : org.jboss.resteasy.security.doseta.ConfiguredDosetaKeyRepository&lt;/param-value&gt;
    &lt;/context-param&gt;

</pre>

      <p>You can also manually register your own instance of a
      KeyRepository within an Application class. For example:</p>

      <pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">import org.jboss.resteasy.core.Dispatcher;
import org.jboss.resteasy.security.doseta.KeyRepository;
import org.jboss.resteasy.security.doseta.DosetaKeyRepository;

import javax.ws.rs.core.Application;
import javax.ws.rs.core.Context;

public class SignatureApplication extends Application
{
   private HashSet&lt;Class&lt;?&gt;&gt; classes = new HashSet&lt;Class&lt;?&gt;&gt;();
   private KeyRepository repository;

   public SignatureApplication(@Context Dispatcher dispatcher)
   {
      classes.add(SignedResource.class);

      repository = new DosetaKeyRepository();
      repository.setKeyStorePath("test.jks");
      repository.setKeyStorePassword("password");
      repository.setUseDns(false);
      repository.start();

      dispatcher.getDefaultContextObjects().put(KeyRepository.class, repository);
   }

   @Override
   public Set&lt;Class&lt;?&gt;&gt; getClasses()
   {
      return classes;
   }
}

</pre>

      <p>On the client side, you can load a KeyStore manually, by
      instantiating an instance of
      org.jboss.resteasy.security.doseta.DosetaKeyRepository. You then set a
      request attribute, "org.jboss.resteasy.security.doseta.KeyRepository",
      with the value of the created instance. Use the
      ClientRequest.getAttributes() method to do this. For example:</p>

      <pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">DosetaKeyRepository keyRepository = new DoestaKeyRepository();
repository.setKeyStorePath("test.jks");
repository.setKeyStorePassword("password");
repository.setUseDns(false);
repository.start();

DKIMSignature signature = new DKIMSignature();
signature.setDomain("example.com");

ClientRequest request = new ClientRequest("http://...");
request.getAttributes().put(KeyRepository.class.getName(), repository);
request.header("DKIM-Signature", signatures);
</pre>
    </div>

    <div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d4e1938"/>41.4.3. Using DNS to Discover Public Keys</h3></div></div></div>
      

      <p>Public keys can also be discover by a DNS text record lookup. You
      must configure web.xml to turn this feature:</p>

      <pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">    &lt;context-param&gt;
        &lt;param-name&gt;resteasy.doseta.use.dns&lt;/param-name&gt;
        &lt;param-value&gt;true&lt;/param-value&gt;
    &lt;/context-param&gt;
    &lt;context-param&gt;
        &lt;param-name&gt;resteasy.doseta.dns.uri&lt;/param-name&gt;
        &lt;param-value&gt;dns://localhost:9095&lt;/param-value&gt;
    &lt;/context-param&gt;

</pre><p>The resteasy.doseta.dns.uri context-param is optional and
      allows you to point to a specific DNS server to locate text
      records.</p>

      <div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d4e1943"/>41.4.3.1. Configuring DNS TXT Records</h4></div></div></div>
        

        <p>DNS TXT Records are stored via a format described by the DOSETA
        specification. The public key is defined via a base 64 encoding. You
        can obtain this text encoding by exporting your public keys from your
        keystore, then using a tool like openssl to get the text-based format.
        For example:</p>

        <pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">$ keytool -export -alias bill._domainKey.client.com -keystore client.jks -file bill.der 
$ openssl x509 -noout -pubkey -in bill.der -inform der &gt; bill.pem</pre><p>The
        output will look something like: </p>

        <pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">-----BEGIN PUBLIC KEY-----
MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQCKxct5GHz8dFw0mzAMfvNju2b3
oeAv/EOPfVb9mD73Wn+CJYXvnryhqo99Y/q47urWYWAF/bqH9AMyMfibPr6IlP8m
O9pNYf/Zsqup/7oJxrvzJU7T0IGdLN1hHcC+qRnwkKddNmD8UPEQ4BXiX4xFxbTj
NvKWLZVKGQMyy6EFVQIDAQAB
-----END PUBLIC KEY-----
</pre>

        <p>The DNS text record entry would look like this:</p>

        <pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">test2._domainKey        IN      TXT     "v=DKIM1; p=MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQCIKFLFWuQfDfBug688BJ0dazQ/x+GEnH443KpnBK8agpJXSgFAPhlRvf0yhqHeuI+J5onsSOo9Rn4fKaFQaQNBfCQpHSMnZpBC3X0G5Bc1HWq1AtBl6Z1rbyFen4CmGYOyRzDBUOIW6n8QK47bf3hvoSxqpY1pHdgYoVK0YdIP+wIDAQAB; t=s"
</pre>

        <p>Notice that the newlines are take out. Also, notice that the
        text record is a name value ';' delimited list of parameters. The p
        field contains the public key.</p>
      </div>
    </div>
  </div>
</div>

    <div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d4e1952"/>Chapter 42. Body Encryption and Signing via SMIME</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="#d4e1955">42.1. Maven settings</a></span></dt><dt><span class="section"><a href="#d4e1960">42.2. Message Body Encryption</a></span></dt><dt><span class="section"><a href="#d4e1971">42.3. Message Body Signing</a></span></dt><dt><span class="section"><a href="#d4e1982">42.4. application/pkcs7-signature</a></span></dt></dl></div>
  

  <p>S/MIME (Secure/Multipurpose Internet Mail Extensions) is a standard
  for public key encryption and signing of MIME data. MIME data being a set of
  headers and a message body. Its most often seen in the email world when
  somebody wants to encrypt and/or sign an email message they are sending
  across the internet. It can also be used for HTTP requests as well which is
  what the RESTEasy integration with S/MIME is all about. RESTEasy allows you
  to easily encrypt and/or sign an email message using the S/MIME standard.
  While the API is described here, you may also want to check out the example
  projects that come with the RESTEasy distribution. It shows both Java and
  Python clients exchanging S/MIME formatted messages with a JAX-RS
  service.</p>

  <div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d4e1955"/>42.1. Maven settings</h2></div></div></div>
    

    <p>You must include the resteasy-crypto project to use the smime framework.</p>

    <pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">        &lt;dependency&gt;
            &lt;groupId&gt;org.jboss.resteasy&lt;/groupId&gt;
            &lt;artifactId&gt;resteasy-crypto&lt;/artifactId&gt;
            &lt;version&gt;3.0.5.Final&lt;/version&gt;
        &lt;/dependency&gt;

</pre>
  </div>

  <div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d4e1960"/>42.2. Message Body Encryption</h2></div></div></div>
    

    <p>While HTTPS is used to encrypt the entire HTTP message, S/MIME
    encryption is used solely for the message body of the HTTP request or
    response. This is very useful if you have a representation that may be
    forwarded by multiple parties (for example, HornetQ's REST Messaging
    integration!) and you want to protect the message from prying eyes as it
    travels across the network. RESTEasy has two different interfaces for
    encrypting message bodies. One for output, one for input. If your client
    or server wants to send an HTTP request or response with an encrypted
    body, it uses the
    <code class="literal">org.jboss.resteasy.security.smime.EnvelopedOutput</code> type.
    Encrypting a body also requires an X509 certificate which can be generated
    by the Java keytool command-line interface, or the openssl tool that comes
    installed on many OS's. Here's an example of using the
    <code class="literal">EnvelopedOutput</code> interface:</p>

    <pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">// server side   

@Path("encrypted")
@GET
public EnvelopedOutput getEncrypted()
{
   Customer cust = new Customer();
   cust.setName("Bill");
   
   X509Certificate certificate = ...;
   EnvelopedOutput output = new EnvelopedOutput(cust, MediaType.APPLICATION_XML_TYPE);
   output.setCertificate(certificate);
   return output;
}


// client side
X509Certificate cert = ...; 
Customer cust = new Customer();
cust.setName("Bill");
EnvelopedOutput output = new EnvelopedOutput(cust, "application/xml");
output.setCertificate(cert);
Response res = target.request().post(Entity.entity(output, "application/pkcs7-mime").post();

</pre>

    <p>An EnvelopedOutput instance is created passing in the entity you
    want to marshal and the media type you want to marshal it into. So in this
    example, we're taking a Customer class and marshalling it into XML before
    we encrypt it. RESTEasy will then encrypt the EnvelopedOutput using the
    BouncyCastle framework's SMIME integration. The output is a Base64
    encoding and would look something like this:</p>

    <pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">Content-Type: application/pkcs7-mime; smime-type=enveloped-data; name="smime.p7m"
Content-Transfer-Encoding: base64
Content-Disposition: attachment; filename="smime.p7m"

MIAGCSqGSIb3DQEHA6CAMIACAQAxgewwgekCAQAwUjBFMQswCQYDVQQGEwJBVTETMBEGA1UECBMK
U29tZS1TdGF0ZTEhMB8GA1UEChMYSW50ZXJuZXQgV2lkZ2l0cyBQdHkgTHRkAgkA7oW81OriflAw
DQYJKoZIhvcNAQEBBQAEgYCfnqPK/O34DFl2p2zm+xZQ6R+94BqZHdtEWQN2evrcgtAng+f2ltIL
xr/PiK+8bE8wDO5GuCg+k92uYp2rLKlZ5BxCGb8tRM4kYC9sHbH2dPaqzUBhMxjgWdMCX6Q7E130
u9MdGcP74Ogwj8fNl3lD4sx/0k02/QwgaukeY7uNHzCABgkqhkiG9w0BBwEwFAYIKoZIhvcNAwcE
CDRozFLsPnSgoIAEQHmqjSKAWlQbuGQL9w4nKw4l+44WgTjKf7mGWZvYY8tOCcdmhDxRSM1Ly682
Imt+LTZf0LXzuFGTsCGOUo742N8AAAAAAAAAAAAA
</pre>

    <p>Decrypting an S/MIME encrypted message requires using the
    org.jboss.resteasy.security.smime.EnvelopedInput interface. You also need
    both the private key and X509Certificate used to encrypt the message.
    Here's an example:</p>

    <pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">// server side

@Path("encrypted")
@POST
public void postEncrypted(EnvelopedInput&lt;Customer&gt; input)
{
   PrivateKey privateKey = ...;
   X509Certificate certificate = ...;
   Customer cust = input.getEntity(privateKey, certificate);
}

// client side

ClientRequest request = new ClientRequest("http://localhost:9095/smime/encrypted");
EnvelopedInput input = request.getTarget(EnvelopedInput.class);
Customer cust = (Customer)input.getEntity(Customer.class, privateKey, cert);

</pre>

    <p>Both examples simply call the getEntity() method passing in the
    PrivateKey and X509Certificate instances requires to decrypt the message.
    On the server side, a generic is used with EnvelopedInput to specify the
    type to marshal to. On the server side this information is passed as a
    parameter to getEntity(). The message is in MIME format: a Content-Type
    header and body, so the EnvelopedInput class now has everything it needs
    to know to both decrypt and unmarshall the entity. </p>
  </div>

  <div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d4e1971"/>42.3. Message Body Signing</h2></div></div></div>
    

    <p>S/MIME also allows you to digitally sign a message. It is a bit
    different than the Doseta Digital Signing Framework. Doseta is an HTTP
    header that contains the signature. S/MIME uses the multipart/signed data
    format which is a multipart message that contains the entity and the
    digital signature. So Doseta is a header, S/MIME is its own media type.
    Generally I would prefer Doseta as S/MIME signatures require the client to
    know how to parse a multipart message and Doseta doesn't. Its up to you
    what you want to use.</p>

    <p>Resteasy has two different interfaces for creating a
    multipart/signed message. One for input, one for output. If your client or
    server wants to send an HTTP request or response with an multipart/signed
    body, it uses the
    <code class="literal">org.jboss.resteasy.security.smime.SignedOutput</code> type.
    This type requires both the PrivateKey and X509Certificate to create the
    signature. Here's an example of signing an entity and sending a
    multipart/signed entity.</p>

    <pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">// server-side

   @Path("signed")
   @GET
   @Produces("multipart/signed")
   public SignedOutput getSigned()
   {
      Customer cust = new Customer();
      cust.setName("Bill");

      SignedOutput output = new SignedOutput(cust, MediaType.APPLICATION_XML_TYPE);
      output.setPrivateKey(privateKey);
      output.setCertificate(certificate);
      return output;
   }


// client side
      Client client = new ResteasyClient();
      WebTarget target = client.target("http://localhost:9095/smime/signed");
      Customer cust = new Customer();
      cust.setName("Bill");
      SignedOutput output = new SignedOutput(cust, "application/xml");
      output.setPrivateKey(privateKey);
      output.setCertificate(cert);
      Response res = target.request().post(Entity.entity(output, "multipart/signed");

</pre>

    <p>An SignedOutput instance is created passing in the entity you want
    to marshal and the media type you want to marshal it into. So in this
    example, we're taking a Customer class and marshalling it into XML before
    we sign it. RESTEasy will then sign the SignedOutput using the
    BouncyCastle framework's SMIME integration. The output iwould look
    something like this:</p>

    <pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">Content-Type: multipart/signed; protocol="application/pkcs7-signature"; micalg=sha1;  boundary="----=_Part_0_1083228271.1313024422098"

------=_Part_0_1083228271.1313024422098
Content-Type: application/xml
Content-Transfer-Encoding: 7bit

&lt;customer name="bill"/&gt;
------=_Part_0_1083228271.1313024422098
Content-Type: application/pkcs7-signature; name=smime.p7s; smime-type=signed-data
Content-Transfer-Encoding: base64
Content-Disposition: attachment; filename="smime.p7s"
Content-Description: S/MIME Cryptographic Signature

MIAGCSqGSIb3DQEHAqCAMIACAQExCzAJBgUrDgMCGgUAMIAGCSqGSIb3DQEHAQAAMYIBVzCCAVMC
AQEwUjBFMQswCQYDVQQGEwJBVTETMBEGA1UECBMKU29tZS1TdGF0ZTEhMB8GA1UEChMYSW50ZXJu
ZXQgV2lkZ2l0cyBQdHkgTHRkAgkA7oW81OriflAwCQYFKw4DAhoFAKBdMBgGCSqGSIb3DQEJAzEL
BgkqhkiG9w0BBwEwHAYJKoZIhvcNAQkFMQ8XDTExMDgxMTAxMDAyMlowIwYJKoZIhvcNAQkEMRYE
FH32BfR1l1vzDshtQvJrgvpGvjADMA0GCSqGSIb3DQEBAQUABIGAL3KVi3ul9cPRUMYcGgQmWtsZ
0bLbAldO+okrt8mQ87SrUv2LGkIJbEhGHsOlsgSU80/YumP+Q4lYsVanVfoI8GgQH3Iztp+Rce2c
y42f86ZypE7ueynI4HTPNHfr78EpyKGzWuZHW4yMo70LpXhk5RqfM9a/n4TEa9QuTU76atAAAAAA
AAA=
------=_Part_0_1083228271.1313024422098--
</pre>

    <p>To unmarshal and verify a signed message requires using the
    <code class="literal">org.jboss.resteasy.security.smime.SignedInput</code>
    interface. You only need the X509Certificate to verify the message. Here's
    an example of unmarshalling and verifying a multipart/signed
    entity.</p>

    <pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">// server side

   @Path("signed")
   @POST
   @Consumes("multipart/signed")
   public void postSigned(SignedInput&lt;Customer&gt; input) throws Exception
   {
      Customer cust = input.getEntity();
      if (!input.verify(certificate))
      {
         throw new WebApplicationException(500);
      }
   }

// client side
      Client client = new ResteasyClient();
      WebTarget target = client.target("http://localhost:9095/smime/signed");
      SignedInput input = target.request().get(SignedInput.class);
      Customer cust = (Customer)input.getEntity(Customer.class)
      input.verify(cert);

</pre>
  </div>
    <div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d4e1982"/>42.4. application/pkcs7-signature</h2></div></div></div>
        
        <p>
            application/pkcs7-signature is a data format that includes both the data and the signature in one ASN.1
            binary encoding.
        </p>
        <p>
            SignedOutput and SignedInput can be used to return application/pkcs7-signature format in binary form.  Just
            change the @Produces or @Consumes to that media type to send back that format.
        </p>
        <p>
            Also, if your @Produces or @Consumes is text/plain instead, SignedOutput will be base64 encoded and sent
            as a string.
        </p>
    </div>
</div>

   <div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="RESTEasy_EJB_Integration"/>Chapter 43. EJB Integration</h2></div></div></div>


<p>

To integrate with EJB you must first modify your EJB's published interfaces.  Resteasy currently only has simple portable integration with EJBs so you must also manually configure your Resteasy WAR.
</p>
<p>


</p>
<p>

Resteasy currently only has simple integration with EJBs.  To make an EJB a JAX-RS resource, you must annotate an SLSB's @Remote or @Local interface with JAX-RS annotations:
</p>
<p>

</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">
@Local
@Path("/Library")
public interface Library {
   
   @GET
   @Path("/books/{isbn}")
   public String getBook(@PathParam("isbn") String isbn);
}

@Stateless
public class LibraryBean implements Library {

...

}
</pre><p>
</p>
<p>

</p>
<p>


</p>
<p>

Next, in RESTeasy's web.xml file you must manually register the EJB with RESTeasy using the resteasy.jndi.resources &lt;context-param&gt;
</p>
<p>

</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">
&lt;web-app&gt;
   &lt;display-name&gt;Archetype Created Web Application&lt;/display-name&gt;
   &lt;context-param&gt;
      &lt;param-name&gt;resteasy.jndi.resources&lt;/param-name&gt;
      &lt;param-value&gt;LibraryBean/local&lt;/param-value&gt;
   &lt;/context-param&gt;

   &lt;listener&gt;
      &lt;listener-class&gt;org.jboss.resteasy.plugins.server.servlet.ResteasyBootstrap&lt;/listener-class&gt;
   &lt;/listener&gt;

   &lt;servlet&gt;
      &lt;servlet-name&gt;Resteasy&lt;/servlet-name&gt;
      &lt;servlet-class&gt;org.jboss.resteasy.plugins.server.servlet.HttpServletDispatcher&lt;/servlet-class&gt;
   &lt;/servlet&gt;

   &lt;servlet-mapping&gt;
      &lt;servlet-name&gt;Resteasy&lt;/servlet-name&gt;
      &lt;url-pattern&gt;/*&lt;/url-pattern&gt;
   &lt;/servlet-mapping&gt;

&lt;/web-app&gt;
</pre><p>
</p>
<p>

This is the only portable way we can offer EJB integration.  Future versions of RESTeasy will have tighter integration
    with JBoss AS so you do not have to do any manual registrations or modifications to web.xml.  For right now though,
    we're focusing on portability.
</p>
<p>

</p>
<p>


</p>
<p>

If you're using Resteasy with an EAR and EJB, a good structure to have is:
</p>
<p>

</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">
my-ear.ear
|------myejb.jar
|------resteasy-jaxrs.war
       |
       ----WEB-INF/web.xml
       ----WEB-INF/lib (nothing)
|------lib/
       |
       ----All Resteasy jar files
</pre><p>
</p>
<p>

From the distribution, remove all libraries from WEB-INF/lib and place them in a common EAR lib.  OR.  Just place the Resteasy jar dependencies in your application server's system classpath.  (i.e. In JBoss put them in server/default/lib)
</p>
<p>

An example EAR project is available from our testsuite here.
</p>
<p>


</p>
</div>

   <div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="RESTEasy_Spring_Integration"/>Chapter 44. Spring Integration</h2></div></div></div>


<p>

RESTEasy integrates with Spring 3.0.x.  We are interested in other forms of Spring integration, so please help contribute.
</p>
<div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="SpringBeanProcessor"/>44.1. Basic Integration</h3></div></div></div>
   
<p>For Maven users, you must use the resteasy-spring artifact.  Otherwise, the jar is available in the downloaded distribution.
</p>
<pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">

&lt;dependency&gt;
    &lt;groupId&gt;org.jboss.resteasy&lt;/groupId&gt;
    &lt;artifactId&gt;resteasy-spring&lt;/artifactId&gt;
    &lt;version&gt;whatever version you are using&lt;/version&gt;
&lt;/dependency&gt;

</pre>
<p>
RESTeasy comes with its own Spring ContextLoaderListener that registers a RESTeasy specific BeanPostProcessor that processes JAX-RS annotations when a bean is created by a BeanFactory.  What does this mean?  RESTeasy will automatically scan for @Provider and JAX-RS resource annotations on your bean class and register them as JAX-RS resources.
</p>
<p> Here is what you have to do with your web.xml file</p>
<pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">
&lt;web-app&gt;
   &lt;display-name&gt;Archetype Created Web Application&lt;/display-name&gt;

   &lt;listener&gt;
      &lt;listener-class&gt;org.jboss.resteasy.plugins.server.servlet.ResteasyBootstrap&lt;/listener-class&gt;
   &lt;/listener&gt;

   &lt;listener&gt;
      &lt;listener-class&gt;org.jboss.resteasy.plugins.spring.SpringContextLoaderListener&lt;/listener-class&gt;
   &lt;/listener&gt;

   &lt;servlet&gt;
      &lt;servlet-name&gt;Resteasy&lt;/servlet-name&gt;
      &lt;servlet-class&gt;org.jboss.resteasy.plugins.server.servlet.HttpServletDispatcher&lt;/servlet-class&gt;
   &lt;/servlet&gt;

   &lt;servlet-mapping&gt;
      &lt;servlet-name&gt;Resteasy&lt;/servlet-name&gt;
      &lt;url-pattern&gt;/*&lt;/url-pattern&gt;
   &lt;/servlet-mapping&gt;


&lt;/web-app&gt;
</pre>
<p>

The SpringContextLoaderListener must be declared after ResteasyBootstrap as it uses ServletContext attributes initialized by it.
</p>
<p>

If you do not use a Spring ContextLoaderListener to create your bean factories, then you can manually register the RESTeasy BeanFactoryPostProcessor by allocating an instance of org.jboss.resteasy.plugins.spring.SpringBeanProcessor.  You can obtain instances of a ResteasyProviderFactory and Registry from the ServletContext attributes org.jboss.resteasy.spi.ResteasyProviderFactory and org.jboss.resteasy.spi.Registry.  (Really the string FQN of these classes).  There is also a org.jboss.resteasy.plugins.spring.SpringBeanProcessorServletAware, that will automatically inject references to the Registry and ResteasyProviderFactory from the Servlet Context.  (that is, if you have used RestasyBootstrap to bootstrap Resteasy).
</p>
<p>
   Our Spring integration supports both singletons and the "prototype" scope.  RESTEasy handles injecting @Context references.  Constructor injection is not supported though.  Also, with the "prototype" scope, RESTEasy will inject any @*Param annotated fields or setters before the request is dispatched.
</p>
<p>
</p>
<p>
NOTE: You can only use auto-proxied beans with our base Spring integration.   You will have undesirable affects if you are doing handcoded proxying with Spring, i.e., with ProxyFactoryBean.  If you are using auto-proxied beans, you will be ok.
</p>
</div>
<div class="sect2" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="SpringMVC"/>44.2. Spring MVC Integration</h3></div></div></div>
   
   <p> 
      RESTEasy can also integrate with the Spring DispatcherServlet.  The advantages of using this are that you have a simpler web.xml file, you can dispatch to either Spring controllers or Resteasy from under the same base URL, and finally, the most important, you can use Spring ModelAndView objects as return arguments from @GET resource methods.  Setup requires you using the Spring DispatcherServlet in your web.xml file, as well as importing the springmvc-resteasy.xml file into your base Spring beans xml file.   Here's an example web.xml file:
   </p>
<pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">
&lt;web-app&gt;
   &lt;display-name&gt;Archetype Created Web Application&lt;/display-name&gt;

   &lt;servlet&gt;
      &lt;servlet-name&gt;Spring&lt;/servlet-name&gt;
      &lt;servlet-class&gt;org.springframework.web.servlet.DispatcherServlet;&lt;/servlet-class&gt;
   &lt;/servlet&gt;

   &lt;servlet-mapping&gt;
      &lt;servlet-name&gt;Spring&lt;/servlet-name&gt;
      &lt;url-pattern&gt;/*&lt;/url-pattern&gt;
   &lt;/servlet-mapping&gt;


&lt;/web-app&gt;
</pre>
<p>Then within your main Spring beans xml, import the springmvc-resteasy.xml file</p>
<pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">

&lt;beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xsi:schemaLocation="
    http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-2.5.xsd
    http://www.springframework.org/schema/util http://www.springframework.org/schema/util/spring-util-2.5.xsd
http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
"&gt;

    &lt;!-- Import basic SpringMVC Resteasy integration --&gt;
    &lt;import resource="classpath:springmvc-resteasy.xml"/&gt;
....

</pre>
    <p>
        You can specify resteasy configuration options by overriding the resteasy.deployment bean which is an instance
        of org.jboss.resteasy.spi.ResteasyDeployment.  Here's an example of adding media type suffix mappings as well
        as enabling the Resteasy asynchronous job service.
    </p>
<pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">

&lt;beans xmlns="http://www.springframework.org/schema/beans" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xmlns:p="http://www.springframework.org/schema/p" xmlns:context="http://www.springframework.org/schema/context"
    xmlns:util="http://www.springframework.org/schema/util"
    xsi:schemaLocation="
        http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-2.5.xsd
        http://www.springframework.org/schema/util http://www.springframework.org/schema/util/spring-util-2.5.xsd
        http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
        "&gt;

    &lt;!-- Import basic SpringMVC Resteasy integration --&gt;
    &lt;import resource="classpath:springmvc-resteasy.xml" /&gt;

    &lt;!-- override the bean definition for deployment --&gt;
    &lt;bean id="resteasy.deployment" class="org.jboss.resteasy.spi.ResteasyDeployment" init-method="start" destroy-method="stop"&gt;
        &lt;property name="asyncJobServiceEnabled" value="true"/&gt;
        &lt;property name="mediaTypeMappings"&gt;
            &lt;map&gt;
                &lt;entry key="json" value="application/json" /&gt;
                &lt;entry key="xml" value="application/xml" /&gt;
            &lt;/map&gt;
        &lt;/property&gt;
    &lt;/bean&gt;
...


</pre>
</div>
</div>

   <div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="CDI"/>Chapter 45. CDI Integration</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="#d4e2034">45.1. Using CDI beans as JAX-RS components</a></span></dt><dt><span class="section"><a href="#d4e2041">45.2. Default scopes</a></span></dt><dt><span class="section"><a href="#d4e2053">45.3. Configuration within JBoss 6 M4 and Higher</a></span></dt><dt><span class="section"><a href="#d4e2056">45.4. Configuration with different distributions</a></span></dt></dl></div>
    
    <p>This module provides integration with JSR-299 (Contexts and
        Dependency Injection for the Java EE platform)
    </p>
    <div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d4e2034"/>45.1. Using CDI beans as JAX-RS components</h2></div></div></div>
        
        <p>
            Both the JAX-RS and CDI specifications introduce their own
            component
            model. On the one hand, every class placed in a CDI archive that
            fulfills a set of basic constraints is implicitly a CDI bean. On
            the
            other hand, explicit decoration of your Java class with
            <code class="code">@Path</code>
            or
            <code class="code">@Provider</code>
            is required for it to become a JAX-RS component.
            Without the
            integration code, annotating a class suitable for being a CDI bean
            with
            JAX-RS annotations leads into a faulty result (JAX-RS component
            not managed by CDI)
            The
            resteasy-cdi module is a bridge that
            allows
            RESTEasy
            to work with class
            instances obtained from the CDI
            container.
        </p>
        <p>
            During a
            web
            service
            invocation, resteasy-cdi asks the CDI
            container
            for the
            managed
            instance
            of a JAX-RS component. Then, this
            instance is
            passed
            to
            RESTEasy.
            If a
            managed instance is not available for
            some
            reason (the
            class is
            placed
            in a jar which is not a bean deployment
            archive),
            RESTEasy
            falls back to
            instantiating the class itself.
        </p>
        <p>
            As a result, CDI services like injection, lifecycle management,
            events, decoration and interceptor bindings can be used in JAX-RS
            components.
        </p>
    </div>
    <div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d4e2041"/>45.2. Default scopes</h2></div></div></div>
        
        <p>
            A CDI bean that does not explicitly define a scope is
            <code class="code">@Dependent</code>
            scoped by default.
            This pseudo scope means that the bean adapts to the
            lifecycle of
            the bean it is
            injected into. Normal scopes (request,
            session,
            application) are more suitable for JAX-RS components as they
            designate component's lifecycle boundaries explicitly. Therefore, the
            resteasy-cdi
            module alters the default
            scoping in
            the following way:
        </p>
        <div class="itemizedlist"><ul><li>
                <p>
                    If a JAX-RS root resource does not define a scope
                    explicitly,
                    it is
                    bound to the Request scope.
                </p>
            </li><li>
                <p>
                    If a JAX-RS Provider or
                    <code class="code">javax.ws.rs.Application</code>
                    subclass
                    does not define a scope explicitly, it is bound to the
                    Application
                    scope.
                </p>
            </li></ul></div>
        <div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="warning"><h2>Warning</h2>
            <p>
                Since the scope of all beans that do not declare a scope is
                modified by resteasy-cdi, this affects session beans as well. As a
                result, a conflict occurs if the scope of a stateless session bean
                or singleton is changed automatically as the spec prohibits these
                components to
                be @RequestScoped.
                Therefore, you
                need to explicitly
                define a scope
                when using stateless session
                beans or singletons. This
                requirement is likely to
                be removed in
                future releases.
            </p>
        </div>
    </div>
    <div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d4e2053"/>45.3. Configuration within JBoss 6 M4 and Higher</h2></div></div></div>
        
        <p>
            CDI integration is provided with no additional configuration with JBoss AS 6-M4 and higher.
        </p>
    </div>
    <div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d4e2056"/>45.4. Configuration with different distributions</h2></div></div></div>
        
        <p>
            Provided you have an
            existing RESTEasy application, all that needs to
            be done is to
            add the
            resteasy-cdi jar into your project's
            <code class="code">WEB-INF/lib</code>
            directory.
            When using
            maven, this can be achieve by defining the
            following
            dependency.
            </p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML">&lt;!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) --&gt;
&lt;span class="xml_tag_symbols"&gt;&amp;lt;&lt;/span&gt;&lt;span class="xml_tag_name"&gt;dependency&lt;/span&gt;&lt;span class="xml_tag_symbols"&gt;&amp;gt;&lt;/span&gt;&lt;span class="xml_plain"&gt;&lt;/span&gt;&lt;br /&gt;
&lt;span class="xml_plain"&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;/span&gt;&lt;span class="xml_tag_symbols"&gt;&amp;lt;&lt;/span&gt;&lt;span class="xml_tag_name"&gt;groupId&lt;/span&gt;&lt;span class="xml_tag_symbols"&gt;&amp;gt;&lt;/span&gt;&lt;span class="xml_plain"&gt;org.jboss.resteasy&lt;/span&gt;&lt;span class="xml_tag_symbols"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="xml_tag_name"&gt;groupId&lt;/span&gt;&lt;span class="xml_tag_symbols"&gt;&amp;gt;&lt;/span&gt;&lt;span class="xml_plain"&gt;&lt;/span&gt;&lt;br /&gt;
&lt;span class="xml_plain"&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;/span&gt;&lt;span class="xml_tag_symbols"&gt;&amp;lt;&lt;/span&gt;&lt;span class="xml_tag_name"&gt;artifactId&lt;/span&gt;&lt;span class="xml_tag_symbols"&gt;&amp;gt;&lt;/span&gt;&lt;span class="xml_plain"&gt;resteasy-cdi&lt;/span&gt;&lt;span class="xml_tag_symbols"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="xml_tag_name"&gt;artifactId&lt;/span&gt;&lt;span class="xml_tag_symbols"&gt;&amp;gt;&lt;/span&gt;&lt;span class="xml_plain"&gt;&lt;/span&gt;&lt;br /&gt;
&lt;span class="xml_plain"&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;/span&gt;&lt;span class="xml_tag_symbols"&gt;&amp;lt;&lt;/span&gt;&lt;span class="xml_tag_name"&gt;version&lt;/span&gt;&lt;span class="xml_tag_symbols"&gt;&amp;gt;&lt;/span&gt;&lt;span class="xml_plain"&gt;${project.version}&lt;/span&gt;&lt;span class="xml_tag_symbols"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="xml_tag_name"&gt;version&lt;/span&gt;&lt;span class="xml_tag_symbols"&gt;&amp;gt;&lt;/span&gt;&lt;span class="xml_plain"&gt;&lt;/span&gt;&lt;br /&gt;
&lt;span class="xml_tag_symbols"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="xml_tag_name"&gt;dependency&lt;/span&gt;&lt;span class="xml_tag_symbols"&gt;&amp;gt;&lt;/span&gt;&lt;span class="xml_plain"&gt;&lt;/span&gt;&lt;br /&gt;
</pre><p>
        </p>
        <p>
            Furthermore, when running a pre-Servlet 3 container, the
            following context parameter needs to be specified in web.xml. (This
            is done
            automatically via web-fragment in a Servlet 3 environment)
        </p>
        <pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">context-param</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">param-name</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">resteasy.injector.factory</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">param-name</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">param-value</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">org.jboss.resteasy.cdi.CdiInjectorFactory</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">param-value</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">context-param</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
</pre>
        <p>
            When deploying an application to a Servlet container that does not
            support CDI out of the box
            (Tomcat, Jetty, Google App Engine), a CDI implementation needs to be
            added first.
            <a class="ulink" href="http://docs.jboss.org/weld/reference/latest/en-US/html/environments.html">Weld-servlet module
            </a>
            can be used for this purpose.
        </p>
    </div>
</div>
   <div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="Seam"/>Chapter 46. Seam Integration</h2></div></div></div>
    
    <p>RESTEasy integrates quite nicely with the JBoss Seam framework.  This integration is maintained
    by the Seam developers and documented there as well.  Check out <a class="ulink" href="http://docs.jboss.org/seam/latest/en-US/html/webservices.html#d0e22078">Seam documentation</a>.</p>
</div>
    <div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="Guice1"/>Chapter 47. Guice 3.0 Integration</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="#d4e2078">47.1. Request Scope</a></span></dt><dt><span class="section"><a href="#d4e2082">47.2. Binding JAX-RS utilities</a></span></dt><dt><span class="section"><a href="#d4e2085">47.3. Configuring Stage</a></span></dt><dt><span class="section"><a href="#d4e2089">47.4. Custom Injector creation</a></span></dt></dl></div>
    
    <p>RESTEasy has some simple integration with Guice 3.0.  RESTEasy will scan the binding types for a Guice Module
        for @Path and @Provider annotations.  It will register these bindings with RESTEasy.  The guice-hello
    project that comes in the RESTEasy examples/ directory gives a nice example of this.</p>
<pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">
@Path("hello")
public class HelloResource
{
   @GET
   @Path("{name}")
   public String hello(@PathParam("name") final String name) {
      return "Hello " + name;
   }
}
</pre>
    <p>First you start off by specifying a JAX-RS resource class.  The HelloResource is just that.  Next you
    create a Guice Module class that defines all your bindings:</p>
<pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">
import com.google.inject.Module;
import com.google.inject.Binder;

public class HelloModule implements Module
{
    public void configure(final Binder binder)
    {
       binder.bind(HelloResource.class);
    }
}
</pre>
    <p>You put all these classes somewhere within your WAR WEB-INF/classes or in a JAR within WEB-INF/lib.  Then
    you need to create your web.xml file.  You need to use the GuiceResteasyBootstrapServletContextListener as
    follows</p>
<pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">

&lt;web-app&gt;
    &lt;display-name&gt;Guice Hello&lt;/display-name&gt;

    &lt;context-param&gt;
        &lt;param-name&gt;resteasy.guice.modules&lt;/param-name&gt;
        &lt;param-value&gt;org.jboss.resteasy.examples.guice.hello.HelloModule&lt;/param-value&gt;
    &lt;/context-param&gt;

    &lt;listener&gt;
        &lt;listener-class&gt;
            org.jboss.resteasy.plugins.guice.GuiceResteasyBootstrapServletContextListener
        &lt;/listener-class&gt;
    &lt;/listener&gt;

    &lt;servlet&gt;
        &lt;servlet-name&gt;Resteasy&lt;/servlet-name&gt;
        &lt;servlet-class&gt;
            org.jboss.resteasy.plugins.server.servlet.HttpServletDispatcher
        &lt;/servlet-class&gt;
    &lt;/servlet&gt;

    &lt;servlet-mapping&gt;
        &lt;servlet-name&gt;Resteasy&lt;/servlet-name&gt;
        &lt;url-pattern&gt;/*&lt;/url-pattern&gt;
    &lt;/servlet-mapping&gt;

&lt;/web-app&gt;

</pre>
    <p>GuiceResteasyBootstrapServletContextListener is a subclass of ResteasyBootstrap, so you can use
    any other RESTEasy configuration option within your web.xml file.  Also notice that there is a
    resteasy.guice.modules context-param.  This can take a comma delimited list of class names that
    are Guice Modules.</p>
    <div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d4e2078"/>47.1. Request Scope</h2></div></div></div>
      
      <p>
        Add the RequestScopeModule to your modules to allow objects to be scoped to the HTTP request by adding
        the @RequestScoped annotation to your class.  All the objects injectable via the @Context annotation are 
        also injectable, except ServletConfig and ServletContext.
      </p>
<pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">

import javax.inject.Inject;
import javax.servlet.http.HttpServletRequest;
import javax.ws.rs.core.Context;

import org.jboss.resteasy.plugins.guice.RequestScoped;

@RequestScoped
public class MyClass
{
    @Inject @Context
    private HttpRequest request;
}

</pre>
    </div>
    <div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d4e2082"/>47.2. Binding JAX-RS utilities</h2></div></div></div>
        
        <p>
            Add the JaxrsModule to bind javax.ws.rs.ext.RuntimeDelegate, javax.ws.rs.core.Response.ResponseBuilder, javax.ws.rs.core.UriBuilder, javax.ws.rs.core.Variant.VariantListBuilder and org.jboss.resteasy.client.ClientExecutor.
        </p>
    </div>
    <div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d4e2085"/>47.3. Configuring Stage</h2></div></div></div>
        
        <p>
            You can configure the stage Guice uses to deploy your modules by specific a context param, resteasy.guice.stage.
            If this value is not specified, Resteasy uses whatever Guice's default is.
        </p>
<pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">

&lt;web-app&gt;
    &lt;display-name&gt;Guice Hello&lt;/display-name&gt;

    &lt;context-param&gt;
        &lt;param-name&gt;resteasy.guice.modules&lt;/param-name&gt;
        &lt;param-value&gt;org.jboss.resteasy.examples.guice.hello.HelloModule&lt;/param-value&gt;
    &lt;/context-param&gt;

    &lt;context-param&gt;
        &lt;param-name&gt;resteasy.guice.stage&lt;/param-name&gt;
        &lt;param-value&gt;PRODUCTION&lt;/param-value&gt;
    &lt;/context-param&gt;

    &lt;listener&gt;
        &lt;listener-class&gt;
            org.jboss.resteasy.plugins.guice.GuiceResteasyBootstrapServletContextListener
        &lt;/listener-class&gt;
    &lt;/listener&gt;

    &lt;servlet&gt;
        &lt;servlet-name&gt;Resteasy&lt;/servlet-name&gt;
        &lt;servlet-class&gt;
            org.jboss.resteasy.plugins.server.servlet.HttpServletDispatcher
        &lt;/servlet-class&gt;
    &lt;/servlet&gt;

    &lt;servlet-mapping&gt;
        &lt;servlet-name&gt;Resteasy&lt;/servlet-name&gt;
        &lt;url-pattern&gt;/*&lt;/url-pattern&gt;
    &lt;/servlet-mapping&gt;

&lt;/web-app&gt;

</pre>        
    </div>
    <div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d4e2089"/>47.4. Custom Injector creation</h2></div></div></div>
      
      <p>
        GuiceResteasyBootstrapServletContextListener can be extended to allow more flexibility in the way the Injector and Modules
        are created.  Three methods can be overridden: getModules(), withInjector() and getStage(). Register your subclass as the
        listener in the web.xml.
      </p>
      <p>
        Override getModules() when you need to pass arguments to your modules' constructor or perform more complex operations.
      </p>
      <p>
        Override withInjector(Injector) when you need to interact with the Injector after it has been created.
      </p>
      <p>
        Override getStage(ServletContext) to set the Stage yourself.
      </p>
<pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">

&lt;web-app&gt;
    &lt;!-- other tags omitted --&gt;
    &lt;listener&gt;
      &lt;listener-class&gt;
         org.jboss.resteasy.plugins.guice.GuiceResteasyBootstrapServletContextListener
      &lt;/listener-class&gt;
    &lt;/listener&gt;
&lt;/web-app&gt;

public class MyServletContextListener extends GuiceResteasyBootstrapServletContextListener
{

    @Override
    protected List&lt;Module&gt; getModules(ServletContext context)
    {
        return asList((Module)new JpaPersistModule("consulting_hours"), new MyModule());
    }
    
    @Override
    public void withInjector(Injector injector)
    {
        injector.getInstance(PersistService.class).start();
    }
}

</pre>        
    </div>
</div>

   <div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="RESTEasy_Client_Framework"/>Chapter 48. Resteasy Client API</h2></div></div></div><div class="toc"><dl><dt><span class="sect1"><a href="#d4e2098">48.1. JAX-RS 2.0 Client API</a></span></dt><dt><span class="sect1"><a href="#d4e2106">48.2. Resteasy Proxy Framework</a></span></dt><dt><span class="sect1"><a href="#transport_layer">48.3. Apache HTTP Client 4.x and other backends</a></span></dt></dl></div>
    

    <div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d4e2098"/>48.1. JAX-RS 2.0 Client API</h2></div></div></div>
        
        <p>JAX-RS 2.0 introduces a new client API so that you can make http requests to your remote RESTful web services.
        It is a 'fluent' request building API with really 3 main classes:  Client, WebTarget, and Response.  The Client
        interface is a builder of WebTarget instances.  WebTarget represents a distinct URL or URL template from which
        you can build more sub-resource WebTargets or invoke requests on.</p>
        <p>
            There are really two ways to create a Client.  Standard way, or you can use the ResteasyClientBuilder class.
            The advantage of the latter is that it gives you a few more helper methods to configure your client.
        </p>
        <pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">
            Client client = ClientBuilder.newClient();
            ... or...
            Client client = ClientBuilder.newBuilder().build();
            WebTarget target = client.target("http://foo.com/resource");
            Response response = target.request().get();
            String value = response.readEntity(String.class);
            response.close();  // You should close connections!

            ResteasyClient client = new ResteasyClientBuilder().build();
            ResteasyWebTarget target = client.target("http://foo.com/resource");
        </pre>
        <p>
            Resteasy will automatically load a set of default providers. (Basically all classes listed in all
            META-INF/services/javax.ws.rs.ext.Providers files).  Additionally, you can manually register other providers,
            filters, and interceptors through the Configuration object provided by the method call Client.configuration().
            Configuration also lets you set various configuration properties that may be needed.
        </p>
        <p>
            Each WebTarget has its own Configuration instance which inherits the components and properties registered with
            its parent.  This allows you to set specific configuration options per target resource.  For example, username
            and password.
        </p>
    </div>
    <p>

    </p>

    <div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d4e2106"/>48.2. Resteasy Proxy Framework</h2></div></div></div>
        
    <p>

        The Resteasy Proxy  Framework is the mirror opposite of the JAX-RS server-side specification. Instead of using
        JAX-RS annotations to map an incoming request to your RESTFul Web Service method, the client framework builds an
        HTTP request that it uses to invoke on a remote RESTful Web Service. This remote service does not have to be a
        JAX-RS service and can be any web resource that accepts HTTP requests.
    </p>
    <p>

        Resteasy has a client proxy framework that allows you to use JAX-RS annotations to invoke on a remote HTTP
        resource.
        The way it works is that you write a Java interface and use JAX-RS annotations on methods and the interface. For
        example:
    </p>
    <p>

</p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">
public interface SimpleClient
{
   @GET
   @Path("basic")
   @Produces("text/plain")
   String getBasic();

   @PUT
   @Path("basic")
   @Consumes("text/plain")
   void putBasic(String body);

   @GET
   @Path("queryParam")
   @Produces("text/plain")
   String getQueryParam(@QueryParam("param")String param);

   @GET
   @Path("matrixParam")
   @Produces("text/plain")
   String getMatrixParam(@MatrixParam("param")String param);

   @GET
   @Path("uriParam/{param}")
   @Produces("text/plain")
   int getUriParam(@PathParam("param")int param);
}</pre><p>
    </p>
    <p>

        Resteasy has a simple API based on Apache HttpClient. You generate a proxy then you can invoke methods on the
        proxy. The invoked method gets translated to an HTTP request based on how you annotated the method and posted to
        the server. Here's how you would set this up:
    </p>
    <p>

        </p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">
            Client client = ClientFactory.newClient();
            WebTarget target = client.target("http://example.com/base/uri");
            ResteasyWebTarget rtarget = (ResteasyWebTarget)target;

            SimpleClient simple = rtarget.proxy(SimpleClient.class);
            client.putBasic("hello world");
        </pre><p>
        Alternatively you can use the Resteasy client extension interfaces directly:
        </p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">
            ResteasyClient client = new ResteasyClientBuilder().build();
            ResteasyWebTarget target = client.target("http://example.com/base/uri");

            SimpleClient simple = target.proxy(SimpleClient.class);
            client.putBasic("hello world");
        </pre><p>

    </p>
    <p>

        @CookieParam works the mirror opposite of its server-side counterpart and creates a cookie header to send to the
        server. You do not need to use @CookieParam if you allocate your own javax.ws.rs.core.Cookie object and pass it
        as
        a parameter to a client proxy method. The client framework understands that you are passing a cookie to the
        server
        so no extra metadata is needed.
    </p>
    <p>
     The framework also supports the JAX-RS locator pattern, but on the client side.  So, if you have a method annotated only with @Path, that proxy method
     will return a new proxy of the interface returned by that method.
    </p>
    <div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="Custom_client-side_responses"/>1. Abstract Responses</h2></div></div></div>
        

        <p>

            Sometimes you are interested not only in the response body of a client request, but also either the response
            code and/or response headers. The Client-Proxy framework has two ways to get at this information
        </p>
        <p>


        </p>
        <p>

            You may return a javax.ws.rs.core.Response.Status enumeration from your method calls:
        </p>
        <p>

            </p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">
@Path("/")
public interface MyProxy {
   @POST
   Response.Status updateSite(MyPojo pojo);
}
            </pre><p>
        </p>
        <p>

            Internally, after invoking on the server, the client proxy internals will convert the HTTP response code into
            a
            Response.Status enum.
        </p>
        <p>


        </p>
        <p>

            If you are interested in everything, you can get it with the javax.ws.rs.core.Response class:
        </p>
        <p>

            </p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">
@Path("/")
public interface LibraryService {

   @GET
   @Produces("application/xml")
   Response getAllBooks();
}</pre><p>
        </p>
     </div>
    <div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="Sharing_interfaces"/>2. Sharing an interface between client and server</h2></div></div></div>
        
        <p>
            It is generally possible to share an interface between the client and server. In this scenario, you just
            have your JAX-RS services implement an annotated interface
            and then reuse that same interface to create client proxies to invoke on the client-side.
        </p>

    </div>
    </div>
    
    
    

   
   <div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="transport_layer"/>48.3. Apache HTTP Client 4.x and other backends</h2></div></div></div>
     
     
     <p>
         Network communication between the client and server is handled in Resteasy,
         by default, by HttpClient (4.x) from the Apache HttpComponents project.  In general,
         the interface between the Resteasy Client Framework and the network is
         found in an implementation of
         <code class="classname">org.jboss.resteasy.client.jaxrs.ClientHttpEngine</code>, and
         <code class="classname">org.jboss.resteasy.client.jaxrs.engines.ApacheHttpClient4Engine</code>,
         which uses HttpClient (4.x), is the default implementation.  Resteasy
         also ships with the following client engines, all found in the
         <code class="code">org.jboss.resteasy.client.jaxrs.engines</code> package:
     </p>
     
     <div class="itemizedlist"><ul><li>
             URLConnectionClientExecutor: uses <code class="classname">java.net.HttpURLConnection</code>;
         </li><li>InMemoryClientExecutor: dispatches requests to a server in the same JVM.</li></ul></div>
     <p>
         and a client executor may be passed to a specific <code class="classname">ClientRequest</code>:
     </p>
     
     <pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">
ResteasyClient client = new ResteasyClientBuilder().httpEngine(engine).build();
     </pre>
     
     <p>
         Resteasy and HttpClient make reasonable default decisions so that it is possible to use the client
         framework without ever referencing HttpClient, but for some applications it may be necessary to drill
         down into the HttpClient details.  <code class="classname">ApacheHttpClient4Engine</code> can
         be supplied with an instance of <code class="classname">org.apache.http.client.HttpClient</code> and
         an instance of <code class="classname">org.apache.http.protocol.HttpContext</code>, which can carry
         additional configuration details into the HttpClient layer.  For example, authentication
         may be configured as follows:
     </p>
     
     <pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">
// Configure HttpClient to authenticate preemptively
// by prepopulating the authentication data cache.
 
// 1. Create AuthCache instance
AuthCache authCache = new BasicAuthCache();
 
// 2. Generate BASIC scheme object and add it to the local auth cache
AuthScheme basicAuth = new BasicScheme();
authCache.put(new HttpHost("sippycups.bluemonkeydiamond.com"), basicAuth);
 
// 3. Add AuthCache to the execution context
BasicHttpContext localContext = new BasicHttpContext();
localContext.setAttribute(ClientContext.AUTH_CACHE, authCache);
 
// 4. Create client executor and proxy
DefaultHttpClient httpClient = new DefaultHttpClient();
ApacheHttpClient4Engine engine = new ApacheHttpClient4Engine(httpClient, localContext);
ResteasyClient client = new ResteasyClientBuilder().httpEngine(engine).build();
     </pre>

     <p>
         One default decision made by HttpClient and adopted by Resteasy is the use of
         <code class="classname">org.apache.http.impl.conn.SingleClientConnManager</code>,
         which manages a single socket at any given time and which
         supports the use case in which one or more invocations are made serially
         from a single thread.  For multithreaded applications, 
         <code class="classname">SingleClientConnManager</code> may be replaced by 
         <code class="classname">org.apache.http.impl.conn.tsccm.ThreadSafeClientConnManager</code>:
     </p>
     
     <pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">
ClientConnectionManager cm = new ThreadSafeClientConnManager();
HttpClient httpClient = new DefaultHttpClient(cm);
ApacheHttpClient4Engine engine = new ApacheHttpClient4Engine(httpClient);
     </pre>
     
     <p>
         For more information about HttpClient (4.x), see the documentation
         at <a class="ulink" href="http://hc.apache.org/httpcomponents-client-ga/tutorial/html/">
         http://hc.apache.org/httpcomponents-client-ga/tutorial/html/</a>.
     </p>
     
     <p>
         <span class="bold"><strong>Note.</strong></span> It is important to understand
         the difference between "releasing" a connection and "closing" a
         connection.  <span class="bold"><strong>Releasing</strong></span> a connection
         makes it available for reuse.  <span class="bold"><strong>Closing</strong></span>
         a connection frees its resources and makes it unusable.
     </p>
     <p>
         <code class="classname">SingleClientConnManager</code> manages
         a single socket, which it allocates to at most a single invocation
         at any given time.  Before that socket can be reused, it has to be
         released from its current use, which can occur in one of two ways.  If
         an execution of a request or a call on
         a proxy returns a class other than <code class="classname">Response</code>,
         then Resteasy will take care of releasing the connection.  For example,
         in the fragments
     </p>
     
     <pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">
WebTarget target = client.target("http://localhost:8081/customer/123");
String answer = target.request().get(String.class);
     </pre>
     
     <p>
         or
     </p>
     
     <pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">
ResteasyWebTarget target = client.target("http://localhost:8081/customer/123");
RegistryStats stats = target.proxy(RegistryStats.class);
RegistryData data = stats.get();
     </pre>
     
     <p>
        Resteasy will release the connection under the covers.  The only counterexample is the case
        in which the response is an instance of <code class="classname">InputStream</code>, which must
        be closed explicitly.
     </p>
     
     <p>
         On the other hand, if the result of an invocation is an instance of
         <code class="classname">Response</code>, then Response.close() method must be used to released the connection.
     </p>
     
     <pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">
WebTarget target = client.target("http://localhost:8081/customer/123");
Response response = target.request().get();
System.out.println(response.getStatus());
response.close();
     </pre>
     
     <p>
         You should probably execute this in a try/finally block.  Again, releasing a connection only makes it available
         for another use. <span class="bold"><strong>It does not normally close the socket.</strong></span>
     </p>
         
     <p>
         On the other hand,
         <code class="methodname">ApacheHttpClient4Engine.finalize()</code> will close any open
         sockets, but only if it created the <code class="classname">HttpClient</code> it has been
         using.  If an <code class="classname">HttpClient</code> has been passed into the
         <code class="classname">ApacheHttpClient4Executor</code>, then the user is responsible
         for closing the connections:
     </p>
     
     <pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">
HttpClient httpClient = new DefaultHttpClient();
ApacheHttpClient4Engine executor = new ApacheHttpClient4Engine(httpClient);
...
httpClient.getConnectionManager().shutdown();
     </pre>
     
     <p>
         Note that if <code class="classname">ApacheHttpClient4Engine</code> has created its own
         instance of <code class="classname">HttpClient</code>, it is not necessary to wait
         for <code class="methodname">finalize()</code> to close open sockets.  The
         <code class="classname">ClientHttpEngine</code> interface has a <code class="methodname">close()</code>
         method for this purpose.
     </p>

    <p>
        Finally, if your javax.ws.rs.client.Client class has created the engine automatically for you, you should
        call Client.close() and this will clean up any socket connections.
    </p>
     
   </div>
   

</div>


   

 <div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="AJAX_Client"/>Chapter 49. AJAX Client</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="#d4e2191">49.1. Generated JavaScript API</a></span></dt><dd><dl><dt><span class="section"><a href="#d4e2200">49.1.1. JavaScript API servlet</a></span></dt><dt><span class="section"><a href="#d4e2204">49.1.2. JavaScript API usage</a></span></dt><dt><span class="section"><a href="#d4e2258">49.1.3. Work with @Form</a></span></dt><dt><span class="section"><a href="#d4e2270">49.1.4. MIME types and unmarshalling.</a></span></dt><dt><span class="section"><a href="#d4e2295">49.1.5. MIME types and marshalling.</a></span></dt></dl></dd><dt><span class="section"><a href="#d4e2324">49.2. Using the JavaScript API to build AJAX queries</a></span></dt><dd><dl><dt><span class="section"><a href="#d4e2327">49.2.1. The REST object</a></span></dt><dt><span class="section"><a href="#d4e2347">49.2.2. The REST.Request class</a></span></dt></dl></dd><dt><span class="section"><a href="#d4e2397">49.3. Caching Features</a></span></dt></dl></div>
    
    <p>RESTEasy resources can be accessed in JavaScript using AJAX using a 
      proxy API generated by RESTEasy.</p>
    <div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d4e2191"/>49.1. Generated JavaScript API</h2></div></div></div>
    	
    	<p>
    		RESTEasy can generate a JavaScript API that uses AJAX calls to invoke JAX-RS operations.
    	</p>
   		<div class="example"><a id="d4e2194"/><p class="title"><b>Example 49.1. First JAX-RS JavaScript API example</b></p><div class="example-contents">
   			
    		<p>
    			Let's take a simple JAX-RS API:
	    	</p>
	    	<pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">@Path("orders")
public interface Orders {
 @Path("{id}")
 @GET
 public String getOrder(@PathParam("id") String id){
  return "Hello "+id;
 }
}</pre>
	    	<p>
				The preceding API would be accessible using the following JavaScript code:
	    	</p>
	    	<pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVASCRIPT">var order = Orders.getOrder({id: 23});</pre>
   		</div></div><br class="example-break"/>
    	<div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d4e2200"/>49.1.1. JavaScript API servlet</h3></div></div></div>
    		
    		<p>
    			In order to enable the JavaScript API servlet you must configure it in your
    			web.xml file as such:
    		</p>
    		<pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">servlet</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">servlet-name</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">RESTEasy&nbsp;JSAPI</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">servlet-name</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">servlet-class</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">org.jboss.resteasy.jsapi.JSAPIServlet</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">servlet-class</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">servlet</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">servlet-mapping</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">servlet-name</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">RESTEasy&nbsp;JSAPI</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">servlet-name</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">url-pattern</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">/rest-js</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">url-pattern</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">servlet-mapping</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
</pre>
    	</div>
    	<div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d4e2204"/>49.1.2. JavaScript API usage</h3></div></div></div>
    		
    		<p>
    			Each JAX-RS resource class will generate a JavaScript object of the same name
    			as the declaring class (or interface), which will contain every JAX-RS method
    			as properties.
    		</p>
    		<div class="example"><a id="d4e2207"/><p class="title"><b>Example 49.2. Structure of JAX-RS generated JavaScript</b></p><div class="example-contents">
    			
    			<p>For example, if the JAX-RS resource X defines methods Y and Z:
    			</p>
	    		<pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Path</span><!-- <br/> --><span class="java_separator">(</span><!-- <br/> --><span class="java_literal">&quot;/&quot;</span><!-- <br/> --><span class="java_separator">)</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">interface</span><span class="java_plain">&nbsp;X</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;@GET</span>
<!--  --><br/><span class="java_plain">&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;Y</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;@PUT</span>
<!--  --><br/><span class="java_plain">&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;Z</span><span class="java_separator">(</span><span class="java_type">String</span><span class="java_plain">&nbsp;entity</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_separator">}</span></pre>
    			<p>
	    			Then the JavaScript API will define the following functions:
    			</p>
	    		<pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVASCRIPT">var X = {
 Y : function(params){…},
 Z : function(params){…}
};</pre>
    		</div></div><br class="example-break"/>
    		<p>
				Each JavaScript API method takes an optional object as single
				parameter where each property is a cookie, header, path, query or form parameter as identified
				by their name, or the following special parameters:
    		</p>
    		<div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="warning"><h2>Warning</h2><p>The following special parameter names are subject to change.</p></div>
    		<table id="d4e2216">
				<caption>Table 49.1. API parameter properties</caption>
				<thead>
					<tr>
						<th rowspan="1" colspan="1">Property name</th>
						<th rowspan="1" colspan="1">Default</th>
						<th rowspan="1" colspan="1">Description</th>
					</tr>
				</thead>
				<tbody>
					<tr>
						<td rowspan="1" colspan="1">$entity</td>
						<td rowspan="1" colspan="1"/>
						<td rowspan="1" colspan="1">The entity to send as a PUT, POST request.</td>
					</tr>
					<tr>
						<td rowspan="1" colspan="1">$contentType</td>
						<td rowspan="1" colspan="1">As determined by @Consumes.</td>
						<td rowspan="1" colspan="1">The MIME type of the body entity sent as the Content-Type header.</td>
					</tr>
					<tr>
						<td rowspan="1" colspan="1">$accepts</td>
						<td rowspan="1" colspan="1">Determined by @Provides, defaults to */*.</td>
						<td rowspan="1" colspan="1">The accepted MIME types sent as the Accept header.</td>
					</tr>
					<tr>
						<td rowspan="1" colspan="1">$callback</td>
						<td rowspan="1" colspan="1"/>
						<td rowspan="1" colspan="1">
							Set to a function(httpCode, xmlHttpRequest, value) for an asynchronous call. If 
							not present, the call will be synchronous and return the value.
						</td>
					</tr>
					<tr>
						<td rowspan="1" colspan="1">$apiURL</td>
						<td rowspan="1" colspan="1">Determined by container</td>
						<td rowspan="1" colspan="1">Set to the base URI of your JAX-RS endpoint, not including the last slash.</td>
					</tr>
					<tr>
						<td rowspan="1" colspan="1">$username</td>
						<td rowspan="1" colspan="1"/>
						<td rowspan="1" colspan="1">If username and password are set, they will be used for credentials for the request.</td>
					</tr>
					<tr>
						<td rowspan="1" colspan="1">$password</td>
						<td rowspan="1" colspan="1"/>
						<td rowspan="1" colspan="1">If username and password are set, they will be used for credentials for the request.</td>
					</tr>
				</tbody>
    		</table>
    		<div class="example"><a id="d4e2252"/><p class="title"><b>Example 49.3. Using the API</b></p><div class="example-contents">
    			
    			<p>Here is an example of JAX-RS API:</p>
	    		<pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Path</span><!-- <br/> --><span class="java_separator">(</span><!-- <br/> --><span class="java_literal">&quot;foo&quot;</span><!-- <br/> --><span class="java_separator">)</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Foo</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;@</span><span class="java_type">Path</span><span class="java_separator">(</span><span class="java_literal">&quot;{id}&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;@GET</span>
<!--  --><br/><span class="java_plain">&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;get</span><span class="java_separator">(</span><span class="java_plain">@</span><span class="java_type">QueryParam</span><span class="java_separator">(</span><span class="java_literal">&quot;order&quot;</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;order</span><span class="java_separator">,</span><span class="java_plain">&nbsp;@</span><span class="java_type">HeaderParam</span><span class="java_separator">(</span><span class="java_literal">&quot;X-Foo&quot;</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;header</span><span class="java_separator">,</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">MatrixParam</span><span class="java_separator">(</span><span class="java_literal">&quot;colour&quot;</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;colour</span><span class="java_separator">,</span><span class="java_plain">&nbsp;@</span><span class="java_type">CookieParam</span><span class="java_separator">(</span><span class="java_literal">&quot;Foo-Cookie&quot;</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;cookie</span><span class="java_separator">){</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_operator">&amp;</span>
<!--  --><br/><span class="java_plain">&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;@POST</span>
<!--  --><br/><span class="java_plain">&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;post</span><span class="java_separator">(</span><span class="java_type">String</span><span class="java_plain">&nbsp;text</span><span class="java_separator">){</span>
<!--  --><br/><span class="java_plain">&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_separator">}</span></pre>
				<p>We can use the previous JAX-RS API in JavaScript using the following code:</p>
	    		<pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVASCRIPT">
var text = Foo.get({order: 'desc', 'X-Foo': 'hello',
                    colour: 'blue', 'Foo-Cookie': 123987235444});
Foo.put({$entity: text});</pre>
    		</div></div><br class="example-break"/>
    	</div>
    	<div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d4e2258"/>49.1.3. Work with @Form</h3></div></div></div>
    		
    		<p>
    			@Form is a RESTEasy specific annotation that allows you to re-use any @*Param annotation within an injected class. 
    			The generated JavaScript API will expand the parameters for use automatically. Support we have the following form:
    		</p>
    		<pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_keyword">public</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_keyword">class</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">MyForm</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">FormParam</span><span class="java_separator">(</span><span class="java_literal">&quot;stuff&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;stuff</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">FormParam</span><span class="java_separator">(</span><span class="java_literal">&quot;number&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">int</span><span class="java_plain">&nbsp;number</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">HeaderParam</span><span class="java_separator">(</span><span class="java_literal">&quot;myHeader&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;header</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_separator">}</span></pre>
			<p>And the resource is like:</p>
			<pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Path</span><!-- <br/> --><span class="java_separator">(</span><!-- <br/> --><span class="java_literal">&quot;/&quot;</span><!-- <br/> --><span class="java_separator">)</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">MyResource</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@POST</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;postForm</span><span class="java_separator">(</span><span class="java_plain">@</span><span class="java_type">Form</span><span class="java_plain">&nbsp;</span><span class="java_type">MyForm</span><span class="java_plain">&nbsp;myForm</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{...}</span>
</span>
<!--  --><br/><span class="java_separator">}</span></pre>
			<p>Then we could call the method from JavaScript API like following:</p>
			<pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_type">MyResource</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">postForm</span><!-- <br/> --><span class="java_separator">({</span><!-- <br/> --><span class="java_plain">stuff</span><!-- <br/> --><span class="java_operator">:</span><!-- <br/> --><span class="java_literal">&quot;A&quot;</span><!-- <br/> --><span class="java_separator">,</span><!-- <br/> --><span class="java_plain">&nbsp;myHeader</span><!-- <br/> --><span class="java_operator">:</span><!-- <br/> --><span class="java_literal">&quot;B&quot;</span><!-- <br/> --><span class="java_separator">,</span><!-- <br/> --><span class="java_plain">&nbsp;number</span><!-- <br/> --><span class="java_operator">:</span><!-- <br/> --><span class="java_literal">1</span><!-- <br/> --><span class="java_separator">});</span></pre>
			<p>Also, @Form supports prefix mappings for lists and maps:</p>
			<pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_keyword">public</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_keyword">static</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_keyword">class</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">Person</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Form</span><span class="java_separator">(</span><span class="java_plain">prefix</span><span class="java_operator">=</span><span class="java_literal">&quot;telephoneNumbers&quot;</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_type">List</span><span class="java_operator">&lt;</span><span class="java_type">TelephoneNumber</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;telephoneNumbers</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Form</span><span class="java_separator">(</span><span class="java_plain">prefix</span><span class="java_operator">=</span><span class="java_literal">&quot;address&quot;</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_type">Map</span><span class="java_operator">&lt;</span><span class="java_type">String</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">Address</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;addresses</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">static</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">TelephoneNumber</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">FormParam</span><span class="java_separator">(</span><span class="java_literal">&quot;countryCode&quot;</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;countryCode</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">FormParam</span><span class="java_separator">(</span><span class="java_literal">&quot;number&quot;</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;number</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">static</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Address</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">FormParam</span><span class="java_separator">(</span><span class="java_literal">&quot;street&quot;</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;street</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">FormParam</span><span class="java_separator">(</span><span class="java_literal">&quot;houseNumber&quot;</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;houseNumber</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Path</span><span class="java_separator">(</span><span class="java_literal">&quot;person&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">static</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">MyResource</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@POST</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;postForm</span><span class="java_separator">(</span><span class="java_plain">@</span><span class="java_type">Form</span><span class="java_plain">&nbsp;</span><span class="java_type">Person</span><span class="java_plain">&nbsp;p</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{...}</span><span class="java_plain">&nbsp;</span>
<!--  --><br/><span class="java_separator">}</span></pre>
		<p>From JavaScript we could call the API like this:</p>
		<pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">MyResource.postForm({
	telephoneNumbers:[
		{"telephoneNumbers[0].countryCode":31},
		{"telephoneNumbers[0].number":12345678},
		{"telephoneNumbers[1].countryCode":91},
		{"telephoneNumbers[1].number":9717738723}
	],
	address:[
		{"address[INVOICE].street":"Main Street"},
		{"address[INVOICE].houseNumber":2},
		{"address[SHIPPING].street":"Square One"},
		{"address[SHIPPING].houseNumber":13}
	]
});</pre>
    	</div>
    	<div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d4e2270"/>49.1.4. MIME types and unmarshalling.</h3></div></div></div>
    		
    		<p>
    			The Accept header sent by any client JavaScript function is controlled by the $accepts parameter, which overrides
    			the @Produces annotation on the JAX-RS endpoint. The returned value however is controlled by the Content-Type header
    			sent in the response as follows:
    		</p>
    		<table id="d4e2273">
				<caption>Table 49.2. Return values by MIME type</caption>
				<thead>
					<tr>
						<th rowspan="1" colspan="1">MIME</th>
						<th rowspan="1" colspan="1">Description</th>
					</tr>
				</thead>
				<tbody>
					<tr>
						<td rowspan="1" colspan="1">text/xml,application/xml,application/*+xml</td>
						<td rowspan="1" colspan="1">
							The response entity is parsed as XML before being returned. The return value is thus a DOM Document.
						</td>
					</tr>
					<tr>
						<td rowspan="1" colspan="1">application/json</td>
						<td rowspan="1" colspan="1">
							The response entity is parsed as JSON before being returned. The return value is thus a JavaScript Object.
						</td>
					</tr>
					<tr>
						<td rowspan="1" colspan="1">Anything else</td>
						<td rowspan="1" colspan="1">The response entity is returned raw.</td>
					</tr>
				</tbody>
			</table>
	   		<div class="example"><a id="d4e2289"/><p class="title"><b>Example 49.4. Unmarshalling example</b></p><div class="example-contents">
   				
    			<p>
	    			The RESTEasy JavaScript client API can automatically unmarshall JSON and XML:
	    		</p>
	    		<pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">@Path("orders")
public interface Orders {

 @XmlRootElement
 public static class Order {
  @XmlElement
  private String id;
  
  public Order(){}
  
  public Order(String id){
   this.id = id;
  }
 }

 @Path("{id}/xml")
 @GET
 @Produces("application/xml")
 public Order getOrderXML(@PathParam("id") String id){
  return new Order(id);
 }

 @Path("{id}/json")
 @GET
 @Produces("application/json")
 public Order getOrderJSON(@PathParam("id") String id){
  return new Order(id);
 }
}</pre>
	    		<p>
					Let us look at what the preceding JAX-RS API would give us on the client side:
	    		</p>
	    		<pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVASCRIPT">// this returns a JSON object
var orderJSON = Orders.getOrderJSON({id: "23"});
orderJSON.id == "23";

// this one returns a DOM Document whose root element is the order, with one child (id)
// whose child is the text node value
var orderXML = Orders.getOrderXML({id: "23"});
orderXML.documentElement.childNodes[0].childNodes[0].nodeValue == "23";</pre>
   			</div></div><br class="example-break"/>
    	</div>
    	<div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d4e2295"/>49.1.5. MIME types and marshalling.</h3></div></div></div>
    		
    		<p>
    			The Content-Type header sent in the request is controlled by the $contentType parameter which overrides the
    			@Consumes annotation on the JAX-RS endpoint. The value passed as entity body using the $entity parameter is marshalled
    			according to both its type and content type:
    		</p>
    		<table id="d4e2298">
				<caption>Table 49.3. Controlling sent entities</caption>
				<thead>
					<tr>
						<th rowspan="1" colspan="1">Type</th>
						<th rowspan="1" colspan="1">MIME</th>
						<th rowspan="1" colspan="1">Description</th>
					</tr>
				</thead>
				<tbody>
					<tr>
						<td rowspan="1" colspan="1">DOM Element</td>
						<td rowspan="1" colspan="1">Empty or text/xml,application/xml,application/*+xml</td>
						<td rowspan="1" colspan="1">The DOM Element is marshalled to XML before being sent.</td>
					</tr>
					<tr>
						<td rowspan="1" colspan="1">JavaScript Object (JSON)</td>
						<td rowspan="1" colspan="1">Empty or application/json</td>
						<td rowspan="1" colspan="1">The JSON object is marshalled to a JSON string before being sent.</td>
					</tr>
					<tr>
						<td rowspan="1" colspan="1">Anything else</td>
						<td rowspan="1" colspan="1">Anything else</td>
						<td rowspan="1" colspan="1">
							The entity is sent as is.
						</td>
					</tr>
				</tbody>
			</table>
	   		<div class="example"><a id="d4e2318"/><p class="title"><b>Example 49.5. Marshalling example</b></p><div class="example-contents">
   				
    			<p>
	    			The RESTEasy JavaScript client API can automatically marshall JSON and XML:
	    		</p>
	    		<pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">@Path("orders")
public interface Orders {

 @XmlRootElement
 public static class Order {
  @XmlElement
  private String id;
  
  public Order(){}
  
  public Order(String id){
   this.id = id;
  }
 }

 @Path("{id}/xml")
 @PUT
 @Consumes("application/xml")
 public void putOrderXML(Order order){
  // store order
 }

 @Path("{id}/json")
 @PUT
 @Consumes("application/json")
 public void putOrderJSON(Order order){
  // store order
 }
}</pre>
	    		<p>
					Let us look at what the preceding JAX-RS API would give us on the client side:
	    		</p>
	    		<pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVASCRIPT">// this saves a JSON object
Orders.putOrderJSON({$entity: {id: "23"}});

// It is a bit more work with XML
var order = document.createElement("order");
var id = document.createElement("id");
order.appendChild(id);
id.appendChild(document.createTextNode("23"));
Orders.putOrderXML({$entity: order});</pre>
   			</div></div><br class="example-break"/>
    	</div>
   	</div>
   	<div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d4e2324"/>49.2. Using the JavaScript API to build AJAX queries</h2></div></div></div>
   		
   		<p>
   			The RESTEasy JavaScript API can also be used to manually construct your requests.
   		</p>
   		<div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d4e2327"/>49.2.1. The REST object</h3></div></div></div>
   			
   			<p>
   				The REST object contains the following read-write properties:
   			</p>
    		<table id="d4e2330">
				<caption>Table 49.4. The REST object</caption>
				<thead>
					<tr>
						<th rowspan="1" colspan="1">Property</th>
						<th rowspan="1" colspan="1">Description</th>
					</tr>
				</thead>
				<tbody>
					<tr>
						<td rowspan="1" colspan="1">apiURL</td>
						<td rowspan="1" colspan="1">
							Set by default to the JAX-RS root URL, used by every JavaScript client API functions when constructing
							the requests.
						</td>
					</tr>
					<tr>
						<td rowspan="1" colspan="1">log</td>
						<td rowspan="1" colspan="1">
							Set to a function(string) in order to receive RESTEasy client API logs. This is useful if you want to
							debug your client API and place the logs where you can see them.
						</td>
					</tr>
				</tbody>
			</table>
	   		<div class="example"><a id="d4e2343"/><p class="title"><b>Example 49.6. Using the REST object</b></p><div class="example-contents">
   				
    			<p>
	    			The REST object can be used to override RESTEasy JavaScript API client behaviour:
	    		</p>
	    		<pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVASCRIPT">// Change the base URL used by the API:
REST.apiURL = "http://api.service.com";

// log everything in a div element
REST.log = function(text){
 jQuery("#log-div").append(text);
};</pre>
   			</div></div><br class="example-break"/>
   		</div>
   		<div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d4e2347"/>49.2.2. The REST.Request class</h3></div></div></div>
   			
   			<p>
   				The REST.Request class is used to build custom requests. It has the following members: 
   			</p>
    		<table id="d4e2350">
				<caption>Table 49.5. The REST.Request class</caption>
				<thead>
					<tr>
						<th rowspan="1" colspan="1">Member</th>
						<th rowspan="1" colspan="1">Description</th>
					</tr>
				</thead>
				<tbody>
					<tr>
						<td rowspan="1" colspan="1">execute(callback)</td>
						<td rowspan="1" colspan="1">
							Executes the request with all the information set in the current object. The value is never returned
							but passed to the optional argument callback.
						</td>
					</tr>
					<tr>
						<td rowspan="1" colspan="1">setAccepts(acceptHeader)</td>
						<td rowspan="1" colspan="1">
							Sets the Accept request header. Defaults to */*.
						</td>
					</tr>
					<tr>
						<td rowspan="1" colspan="1">setCredentials(username, password)</td>
						<td rowspan="1" colspan="1">
							Sets the request credentials.
						</td>
					</tr>
					<tr>
						<td rowspan="1" colspan="1">setEntity(entity)</td>
						<td rowspan="1" colspan="1">
							Sets the request entity.
						</td>
					</tr>
					<tr>
						<td rowspan="1" colspan="1">setContentType(contentTypeHeader)</td>
						<td rowspan="1" colspan="1">
							Sets the Content-Type request header.
						</td>
					</tr>
					<tr>
						<td rowspan="1" colspan="1">setURI(uri)</td>
						<td rowspan="1" colspan="1">
							Sets the request URI. This should be an absolute URI.
						</td>
					</tr>
					<tr>
						<td rowspan="1" colspan="1">setMethod(method)</td>
						<td rowspan="1" colspan="1">
							Sets the request method. Defaults to GET.
						</td>
					</tr>
					<tr>
						<td rowspan="1" colspan="1">setAsync(async)</td>
						<td rowspan="1" colspan="1">
							Controls whether the request should be asynchronous. Defaults to true.
						</td>
					</tr>
					<tr>
						<td rowspan="1" colspan="1">addCookie(name, value)</td>
						<td rowspan="1" colspan="1">
							Sets the given cookie in the current document when executing the request.
							Beware that this will be persistent in your browser.
						</td>
					</tr>
					<tr>
						<td rowspan="1" colspan="1">addQueryParameter(name, value)</td>
						<td rowspan="1" colspan="1">
							Adds a query parameter to the URI query part.
						</td>
					</tr>
					<tr>
						<td rowspan="1" colspan="1">addMatrixParameter(name, value)</td>
						<td rowspan="1" colspan="1">
							Adds a matrix parameter (path parameter) to the last path segment of the request URI.
						</td>
					</tr>
					<tr>
						<td rowspan="1" colspan="1">addHeader(name, value)</td>
						<td rowspan="1" colspan="1">
							Adds a request header.
						</td>
					</tr>
				</tbody>
			</table>
	   		<div class="example"><a id="d4e2393"/><p class="title"><b>Example 49.7. Using the REST.Request class</b></p><div class="example-contents">
   				
    			<p>
	    			The REST.Request class can be used to build custom requests:
	    		</p>
	    		<pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVASCRIPT">var r = new REST.Request();
r.setURI("http://api.service.com/orders/23/json");
r.setMethod("PUT");
r.setContentType("application/json");
r.setEntity({id: "23"});
r.addMatrixParameter("JSESSIONID", "12309812378123");
r.execute(function(status, request, entity){
 log("Response is "+status);
});</pre>
   			</div></div><br class="example-break"/>
   		</div>
   	</div>
   	<div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d4e2397"/>49.3. Caching Features</h2></div></div></div>
   		
   		<p>
   			RESTEasy AJAX Client works well with server side caching features. But the buggy browsers cache will 
   			always prevent the function to work properly. If you'd like to use RESTEasy's caching feature with its
   			AJAX client, you can enable 'antiBrowserCache' option:
   		</p>
	    <pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVASCRIPT">REST.antiBrowserCache = true;</pre>
		<p>
			The above setting should be set once before you call any APIs.
		</p>
   	</div>
</div>
   <div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="Validation"/>Chapter 50. Validation</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="#d4e2429">50.1. Violation reporting</a></span></dt><dt><span class="section"><a href="#d4e2455">50.2. Bean Validation 1.1</a></span></dt><dt><span class="section"><a href="#d4e2459">50.3. Bean Validation 1.0</a></span></dt><dt><span class="section"><a href="#d4e2470">50.4. Validation Service Providers</a></span></dt></dl></div>
   
   
   <p>
   RESTEasy provides the support for validation mandated by the
   <a class="ulink" href="http://www.jcp.org/en/jsr/detail?id=339">JAX-RS: Java API for RESTful Web Services 2.0 </a>,
   given the presence of an implementation of the
   <a class="ulink" href="http://beanvalidation.org/1.1/spec/">Bean Validation specification 1.1</a>
   such as <a class="ulink" href="http://www.hibernate.org/subprojects/validator.html"> Hibernate Validator 5.x</a>. 
   </p>
   
   <p>
   Validation provides a declarative way of imposing constraints on fields and properties of beans, bean classes,
   and the parameters and return values of bean methods.  For example, in
   </p>
   
   <pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">
@Path("all")
@TestClassConstraint(5)
public class TestResource
{
   @Size(min=2, max=4)
   @PathParam("s")
   String s;

   private String t;

   @Size(min=3)  
   public String getT()
   {
      return t;
   }

   @PathParam("t") 
   public void setT(String t)
   {
      this.t = t;
   }

   @POST
   @Path("{s}/{t}/{u}")
   @Pattern(regexp="[a-c]+")
   public String post(@PathParam("u") String u)
   {
      return u;
   }
}
</pre>  
   
   <p>
   the field <code class="code">s</code> is constrained by the Bean Validation built-in annotation <code class="code">@Size</code>
   to have between 2 and 4 characters, the property <code class="code">t</code> is constrained to have at least 3
   characters, and the <code class="code">TestResource</code> object is constrained by the application defined
   annotation <code class="code">@TestClassConstraint</code> to have the combined lengths of <code class="code">s</code> and
   <code class="code">t</code> less than 5:
   </p>
   
   <pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">
@Constraint(validatedBy = TestClassValidator.class)
@Target({TYPE})
@Retention(RUNTIME)
public @interface TestClassConstraint
{
   String message() default "Concatenation of s and t must have length &gt; {value}";
   Class&lt;?&gt;[] groups() default {};
   Class&lt;? extends Payload&gt;[] payload() default {};
   int value();
}

public class TestClassValidator implements ConstraintValidator&lt;TestClassConstraint, TestResource&gt;
{
   int length;

   public void initialize(TestClassConstraint constraintAnnotation)
   {
      length = constraintAnnotation.value();
   }

   public boolean isValid(TestResource value, ConstraintValidatorContext context)
   {
      boolean b = value.retrieveS().length() + value.getT().length() &lt; length;
   }
}
</pre> 
   
   <p>
   See the links above for more about how to create validation annotations.
   </p>
   
   <p>
   Also, the method parameter <code class="code">u</code> is constrained to have no more than 5 characters,
   and the return value of method <code class="code">post</code> is constrained by the built-in annotation
   <code class="code">@Pattern</code> to match the regular expression "[a-c]+".
   </p>
   
   <p>
   The sequence of validation constraint testing is as follows:
   </p>
   
   <div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="orderedlist"><ol><li>Create the resource and validate field, property, and class constraints.</li><li>Validate the resource method parameters.</li><li>If no violations have been detected, call the resource method and validate the return value</li></ol></div>
   
   <div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d4e2429"/>50.1. Violation reporting</h2></div></div></div>
   
   
   <p>
   If a validation problem occurs, either a problem with the validation definitions or a constraint violation,
   Resteasy will set the return header <code class="classname">org.jboss.resteasy.api.validation.Validation.VALIDATION_HEADER</code>
   ("validation-exception") to "true".
   </p>
   
   <p>
   If Resteasy detects a structural validation problem, such as a validation annotation with a 
   missing validator class, it will return a String representation of a 
   <code class="classname">javax.validation.ValidationException</code>.  For example
   </p>
   
<pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">
javax.validation.ValidationException: HV000028: Unexpected exception during isValid call.[org.jboss.resteasy.test.validation.TestValidationExceptions$OtherValidationException]
</pre>
   
   <p>
   If any constraint violations are detected, Resteasy will return a report in one of a variety
   of formats.  If one of "application/xml" or "application/json" occur in the "Accept" request header,
   Resteasy will return an appropriately marshalled instance of
   <code class="classname">org.jboss.resteasy.api.validation.ViolationReport</code>:
   </p>

<pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">
@XmlRootElement(name="violationReport")
@XmlAccessorType(XmlAccessType.FIELD)
public class ViolationReport
{
   ...

   public ArrayList&lt;ResteasyConstraintViolation&gt; getFieldViolations()
   {
      return fieldViolations;
   }

   public ArrayList&lt;ResteasyConstraintViolation&gt; getPropertyViolations()
   {
      return propertyViolations;
   }

   public ArrayList&lt;ResteasyConstraintViolation&gt; getClassViolations()
   {
      return classViolations;
   }

   public ArrayList&lt;ResteasyConstraintViolation&gt; getParameterViolations()
   {
      return parameterViolations;
   }

   public ArrayList&lt;ResteasyConstraintViolation&gt; getReturnValueViolations()
   {
      return returnValueViolations;
   }

   ...
}
</pre>

   <p>
   where <code class="classname">org.jboss.resteasy.api.validation.ResteasyConstraintViolation</code> is defined:
   </p>
   
<pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">
@XmlRootElement(name="resteasyConstraintViolation")
@XmlAccessorType(XmlAccessType.FIELD)
public class ResteasyConstraintViolation implements Serializable
{
   ...
   
   /**
    * @return type of constraint
    */
   public ConstraintType.Type getConstraintType()
   {
      return constraintType;
   }
   
   /**
    * @return description of element violating constraint
    */
   public String getPath()
   {
      return path;
   }
   
   /**
    * @return description of constraint violation
    */
   public String getMessage()
   {
      return message;
   }
   
   /**
    * @return object in violation of constraint
    */
   public String getValue()
   {
      return value;
   }
   
   /**
    * @return String representation of violation
    */
   public String toString()
   {
      return "[" + type() + "]\r[" + path + "]\r[" + message + "]\r[" + value + "]\r";
   }
   
   /**
    * @return String form of violation type 
    */
   public String type()
   {
      return constraintType.toString();
   }
}
</pre>

   <p>
   and <code class="classname">org.jboss.resteasy.api.validation.ConstraintType</code> is the enumeration
   </p>
   
<pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">
public class ConstraintType
{
   public enum Type {CLASS, FIELD, PROPERTY, PARAMETER, RETURN_VALUE};
}
</pre>

   <p>
   If both "application/xml" or "application/json" occur in the "Accept" request header, the media type
   is chosen according to the ranking given by implicit or explicit "q" parameter values.  In the
   case of a tie, the returned media type is indeterminate.
   </p>
   
   <p>If neither "application/xml" or "application/json" occur in the "Accept" request header,
   Resteasy returns a report with a String representation of each
   <code class="classname">ResteasyConstraintViolation</code>, where
   each field is delimited by '[' and ']', followed by a '\r', with a final '\r' at the end.
   For example,
   </p>
   
<pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">
[FIELD]
[s]
[size must be between 2 and 4]
[a]

[PROPERTY]
[t]
[size must be between 3 and 5]
[z]

[CLASS]
[]
[Concatenation of s and t must have length &gt; 5]
[org.jboss.resteasy.validation.TestResource@68467a6f]

[PARAMETER]
[test.&lt;cross-parameter&gt;]
[Parameters must total &lt;= 7]
[[5, 7]]

[RETURN_VALUE]
[g.&lt;return value&gt;]
[size must be between 2 and 4]
[abcde]
</pre>

   <p>
   where the four fields are
   </p>
   
   <div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="orderedlist"><ol><li>type of constraint</li><li>path to violating element (e.g., field name, class name, method name and parameter name)</li><li>message</li><li>violating element</li></ol></div>
 
   </div>

   <div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d4e2455"/>50.2. Bean Validation 1.1</h2></div></div></div>
   
   
   <p>
   The form of validation mandated by the JAX-RS 2.0 specification, based on Bean Validation 1.1,
   is supported by the RESTEasy module resteasy-validator-provider-11, which produces the artifact
   resteasy-validator-provider-11-&lt;version&gt;.jar.  Validation is turned on by default (assuming
   resteasy-validator-provider-11-&lt;version&gt;.jar is available), though
   parameter and return value validation can be turned off or modified in the validation.xml
   configuration file. See the
   <a class="ulink" href="http://docs.jboss.org/hibernate/validator/5.0/reference/en-US/html/">Hibernate Validator</a>
   documentation for the details.  Wildfly 8.x will ship with Hibernate Validator 5.x.
   </p>
   </div>
            
   <div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d4e2459"/>50.3. Bean Validation 1.0</h2></div></div></div>
   
   
   <p>
   Validation is not included in the original JAX-RS specification, but RESTEasy 2.x provides a
   form of validation, including parameter and return value validation, based on Bean Validation 1.0
   plus Hibernate 4.x extensions. For applications running in the context of Hibernate Validation 4.x,
   RESTEasy 3.x inherits the validation semantics from RESTEasy 2.x.  This version of validation is
   in the RESTEasy module resteasy-hibernatevalidate-provider, which produces the artifact
   resteasy-hibernatevalidator-provider-&lt;version&gt;.jar.  It follows the validation sequence
   given in the first section, detecting field, property, class, parameter, and return value constraints,
   though with a somewhat less rich semantics than resteasy-validator-provider-11.
   </p>
   
   <p>
   Unlike resteasy-validator-provider-11, resteasy-hibernatevalidate-provider does not do validation
   testing by default.  Validation must be turned on. There are two relevent annotations - 
   <code class="classname">org.jboss.resteasy.plugins.validation.hibernate.ValidateRequest</code> and
   <code class="classname">org.jboss.resteasy.plugins.validation.hibernate.DoNotValidateRequest</code> - 
   that are used to indicate what needs validation or not. We can tell RESTEasy to validate any method
   in a resource annotating the resource:
   </p>
   
<pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">
@Path("resourcePath")
@ValidateRequest
public interface Resource {
   
   @POST
   @Path("insert")
   public String insert(...

   @GET
   @Path("list")
   public String list(...
    
}</pre>

   <p>
   We can tell it to validate just some methods in an interface:
   </p>

<pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">
@Path("resourcePath")
public interface Resource {
   
   @POST
   @Path("insert")
   @ValidateRequest
   public String insert(...

   @GET
   @Path("list")
   public String list(...
    
}</pre>   

   <p>
      This way RESTEasy will only trigger validation in insert method.
      It's possible to say what methods you don't want to be validated: 
   </p>
               
<pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">
@Path("resourcePath")
@ValidateRequest
public interface Resource {
   
   @POST
   @Path("insert")
   public String insert(...
   
   @GET
   @Path("list")
   @DoNotValidateRequest
   public String list(...
    
}</pre>   

   </div>   

   <div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d4e2470"/>50.4. Validation Service Providers</h2></div></div></div>
         
         
         <p>
         RESTEasy obtains a bean validation implemenation by looking in the available
         META-INF/services/javax.ws.rs.Providers files for an implementation
         of <code class="classname">ContextResolver&lt;GeneralValidator&gt;</code>, where 
         <code class="classname">org.jboss.resteasy.spi.GeneralValidator</code> is
         </p>

<pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">
public interface GeneralValidator
{
   /**
    * Validates all constraints on {@code object}.
    *
    * @param object object to validate
    * @param groups the group or list of groups targeted for validation (defaults to
    *        {@link Default})
    * @return constraint violations or an empty set if none
    * @throws IllegalArgumentException if object is {@code null}
    *         or if {@code null} is passed to the varargs groups
    * @throws ValidationException if a non recoverable error happens
    *         during the validation process
    */
   public abstract void validate(HttpRequest request, Object object, Class&lt;?&gt;... groups);
   /**
    * Validates all constraints placed on the parameters of the given method.
    *
    * @param &lt;T&gt; the type hosting the method to validate
    * @param object the object on which the method to validate is invoked
    * @param method the method for which the parameter constraints is validated
    * @param parameterValues the values provided by the caller for the given method's
    *        parameters
    * @param groups the group or list of groups targeted for validation (defaults to
    *        {@link Default})
    * @return a set with the constraint violations caused by this validation;
    *         will be empty if no error occurs, but never {@code null}
    * @throws IllegalArgumentException if {@code null} is passed for any of the parameters
    *         or if parameters don't match with each other
    * @throws ValidationException if a non recoverable error happens during the
    *         validation process
    */
   public abstract void validateAllParameters(HttpRequest request, Object object, Method method, Object[] parameterValues, Class&lt;?&gt;... groups);

   /**
    * Validates all return value constraints of the given method.
    *
    * @param &lt;T&gt; the type hosting the method to validate
    * @param object the object on which the method to validate is invoked
    * @param method the method for which the return value constraints is validated
    * @param returnValue the value returned by the given method
    * @param groups the group or list of groups targeted for validation (defaults to
    *        {@link Default})
    * @return a set with the constraint violations caused by this validation;
    *         will be empty if no error occurs, but never {@code null}
    * @throws IllegalArgumentException if {@code null} is passed for any of the object,
    *         method or groups parameters or if parameters don't match with each other
    * @throws ValidationException if a non recoverable error happens during the
    *         validation process
    */
   public abstract void validateReturnValue(
         HttpRequest request, Object object, Method method, Object returnValue, Class&lt;?&gt;... groups);

   /**
    * Indicates if validation is turned on for a class.
    * 
    * @param clazz Class to be examined
    * @return true if and only if validation is turned on for clazz
    */
   public abstract boolean isValidatable(Class&lt;?&gt; clazz);
     
   /**
    * Indicates if validation is turned on for a method.
    * 
    * @param method method to be examined
    * @return true if and only if validation is turned on for method
    */   
   public abstract boolean isMethodValidatable(Method method);

   void checkViolations(HttpRequest request);
}
</pre>

   <p>
   The methods and the javadoc are adapted from the Bean Validation 1.1 classes
   <code class="classname">javax.validation.Validator</code> and
   <code class="classname">javax.validation.executable.ExecutableValidator</code>.
   </p>
 
   <p>
   RESTEasy supplies two implementations of <code class="methodname">GeneralValidator</code>,
   in the modules resteasy-validator-provider-11 and resteasy-hibernatevalidator-provider.
   An alternative implementation may be supplied by implementing 
   <code class="classname">ContextResolver&lt;GeneralValidator&gt;</code> and
   <code class="classname">org.jboss.resteasy.spi.validation.GeneralValidator</code>.
   </p>        
   </div>
</div>

   <div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="Maven_and_RESTEasy"/>Chapter 51. Maven and RESTEasy</h2></div></div></div>
   
   <p>
JBoss's Maven Repository is at:
      http://repository.jboss.org/nexus/content/groups/public/
   </p>
   <p>

      Here's the pom.xml fragment to use. Resteasy is modularized into various components.  Mix and max as you see fit.  Please replace 3.0.5.Final with the current Resteasy version you want to use.
   </p>
<pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">

&lt;repositories&gt;
   &lt;repository&gt;
      &lt;id&gt;jboss&lt;/id&gt;
      &lt;url&gt;http://repository.jboss.org/nexus/content/groups/public/&lt;/url&gt;
   &lt;/repository&gt;
&lt;/repositories&gt;
&lt;dependencies&gt;
   &lt;!-- core library --&gt;
   &lt;dependency&gt;
      &lt;groupId&gt;org.jboss.resteasy&lt;/groupId&gt;
      &lt;artifactId&gt;resteasy-jaxrs&lt;/artifactId&gt;
      &lt;version&gt;3.0.5.Final&lt;/version&gt;
   &lt;/dependency&gt;
   &lt;dependency&gt;
      &lt;groupId&gt;org.jboss.resteasy&lt;/groupId&gt;
      &lt;artifactId&gt;resteasy-client&lt;/artifactId&gt;
      &lt;version&gt;3.0.5.Final&lt;/version&gt;
   &lt;/dependency&gt;

   &lt;!-- optional modules --&gt;

   &lt;!-- JAXB support --&gt;
   &lt;dependency&gt;
      &lt;groupId&gt;org.jboss.resteasy&lt;/groupId&gt;
      &lt;artifactId&gt;resteasy-jaxb-provider&lt;/artifactId&gt;
      &lt;version&gt;3.0.5.Final&lt;/version&gt;
   &lt;/dependency&gt;
   &lt;!-- multipart/form-data and multipart/mixed support --&gt;
   &lt;dependency&gt;
      &lt;groupId&gt;org.jboss.resteasy&lt;/groupId&gt;
      &lt;artifactId&gt;resteasy-multipart-provider&lt;/artifactId&gt;
      &lt;version&gt;3.0.5.Final&lt;/version&gt;
   &lt;/dependency&gt;
   &lt;!-- Resteasy Server Cache --&gt;
   &lt;dependency&gt;
      &lt;groupId&gt;org.jboss.resteasy&lt;/groupId&gt;
      &lt;artifactId&gt;resteasy-cache-core&lt;/artifactId&gt;
      &lt;version&gt;3.0.5.Final&lt;/version&gt;
   &lt;/dependency&gt;
   &lt;!-- Ruby YAML support --&gt;
   &lt;dependency&gt;
      &lt;groupId&gt;org.jboss.resteasy&lt;/groupId&gt;
      &lt;artifactId&gt;resteasy-yaml-provider&lt;/artifactId&gt;
      &lt;version&gt;3.0.5.Final&lt;/version&gt;
   &lt;/dependency&gt;
   &lt;!-- JAXB + Atom support --&gt;
   &lt;dependency&gt;
      &lt;groupId&gt;org.jboss.resteasy&lt;/groupId&gt;
      &lt;artifactId&gt;resteasy-atom-provider&lt;/artifactId&gt;
      &lt;version&gt;3.0.5.Final&lt;/version&gt;
   &lt;/dependency&gt;
   &lt;!-- Spring integration --&gt;
   &lt;dependency&gt;
      &lt;groupId&gt;org.jboss.resteasy&lt;/groupId&gt;
      &lt;artifactId&gt;resteasy-spring&lt;/artifactId&gt;
      &lt;version&gt;3.0.5.Final&lt;/version&gt;
   &lt;/dependency&gt;
   &lt;!-- Guice integration --&gt;
   &lt;dependency&gt;
      &lt;groupId&gt;org.jboss.resteasy&lt;/groupId&gt;
      &lt;artifactId&gt;resteasy-guice&lt;/artifactId&gt;
      &lt;version&gt;3.0.5.Final&lt;/version&gt;
   &lt;/dependency&gt;

   &lt;!-- Asynchronous HTTP support with Servlet 3.0  --&gt;
   &lt;dependency&gt;
      &lt;groupId&gt;org.jboss.resteasy&lt;/groupId&gt;
      &lt;artifactId&gt;async-http-servlet-3.0&lt;/artifactId&gt;
      &lt;version&gt;3.0.5.Final&lt;/version&gt;
   &lt;/dependency&gt;

&lt;/dependencies&gt;

</pre>
    <p>
        There is also a pom that can be imported so the versions of the individual modules do not have to be specified. Note that maven 2.0.9 is required for this.
    </p>
    <pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">

    &lt;dependencyManagement&gt;
        &lt;dependencies&gt;
            &lt;dependency&gt;
                &lt;groupId&gt;org.jboss.resteasy&lt;/groupId&gt;
                &lt;artifactId&gt;resteasy-bom&lt;/artifactId&gt;
                &lt;version&gt;3.0.5.Final&lt;/version&gt;
                &lt;type&gt;pom&lt;/type&gt;
                &lt;scope&gt;import&lt;/scope&gt;
            &lt;/dependency&gt;
        &lt;/dependencies&gt;
    &lt;/dependencyManagement&gt;

    </pre>
</div>

   <div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="JBoss5"/>Chapter 52. JBoss AS 5.x Integration</h2></div></div></div>
    
    <p>Resteasy has no special integration with JBoss Application Server so it must be configured and
        installed
        like any other container. There are some issues though. You must make sure that there is not a copy
        of servlet-api-xxx.jar in your WEB-INF/lib directory as this may cause problems. Also, if you are running
        with JDK 6, make sure to filter out the JAXB jars as they come with JDK 6.
    </p>
</div>
<div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="JBoss AS 6"/>Chapter 53. JBoss AS 6/7 Integration</h2></div></div></div>

<p>
    RESTEasy is preconfigured and completely integrated with JBoss 6-M4 and higher. You can use it with EJB
    and CDI and you can rely completely on JBoss for scanning for your JAX-RS services and deploying them. All
    you have to provide is your JAX-RS service classes packaged within a WAR either as POJOs, CDI beans,
    or EJBs and provide an empty web.xml file as follows:
</p>
<p>
    </p><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">
        
&lt;web-app version="3.0" xmlns="http://java.sun.com/xml/ns/javaee"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/web-app_3_0.xsd"&gt;
&lt;/web-app&gt;

    </pre><p>
</p>
</div>

   <div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="doc"/>Chapter 54. Documentation Support</h2></div></div></div>
    
    <p>There's a great javadoc engine that allows you to generate javadocs for JAX-RS and JAXB called<a class="ulink" href="http://www.lunatech-labs.com/open-source/jax-doclets">JAX-Doclet</a>. Follow the link for more
        details.
    </p>
</div>

<div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="Migration_from_older_versions"/>Chapter 55. Migration from older versions</h2></div></div></div><div class="toc"><dl><dt><span class="sect1"><a href="#d4e2504">55.1. Migrating from 3.0 to 3.0.4</a></span></dt><dt><span class="sect1"><a href="#d4e2509">55.2. Migrating from 3.0-beta-6 and 3.0-rc-1</a></span></dt><dt><span class="sect1"><a href="#d4e2516">55.3. Migrating from 3.0-beta-5 and 3.0-beta-6</a></span></dt><dt><span class="sect1"><a href="#d4e2523">55.4. Migrating from 3.0-beta-4 and 3.0-beta-5</a></span></dt><dt><span class="sect1"><a href="#d4e2528">55.5. Migrating from 3.0-beta-2 and 3.0-beta-4</a></span></dt><dt><span class="sect1"><a href="#d4e2533">55.6. Migrating from 3.0-beta-1 and 3.0-beta-2</a></span></dt><dt><span class="sect1"><a href="#d4e2537">55.7. Migrating from 2.x to 3.0-beta-1</a></span></dt><dt><span class="sect1"><a href="#d4e2549">55.8. Migrating from 2.3.2 to 2.3.3</a></span></dt><dt><span class="sect1"><a href="#d4e2553">55.9. Migrating from 2.3.0 to 2.3.1</a></span></dt><dt><span class="sect1"><a href="#d4e2557">55.10. Migrating from 2.2.x to 2.3</a></span></dt><dt><span class="sect1"><a href="#22_221">55.11. Migrating from 2.2.0 to 2.2.1</a></span></dt><dt><span class="sect1"><a href="#21_22">55.12. Migrating from 2.1.x to 2.2</a></span></dt><dt><span class="sect1"><a href="#20_21">55.13. Migrating from 2.0.x to 2.1</a></span></dt><dt><span class="sect1"><a href="#Migrating_to_Resteasy_12_20">55.14. Migrating from 1.2.x to 2.0</a></span></dt><dt><span class="sect1"><a href="#migrating_1.2_1.2.1">55.15. Migrating from 1.2.GA to 1.2.1.GA</a></span></dt><dt><span class="sect1"><a href="#Migrating_to_Resteasy_1_1_1_2">55.16. Migrating from 1.1 to 1.2</a></span></dt></dl></div>

<div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d4e2504"/>55.1. Migrating from 3.0 to 3.0.4</h2></div></div></div>
    
    <div class="itemizedlist"><ul><li>
            Servlet 3.0 deployments within standalone Tomcat or Jetty can now use the Resteasy <code class="literal">ServletContainerInitializer</code>.
            This allows tighter integration with Resteasy much like you have within JBoss/Wildfly.  Check out the
            installation/configuration section of this document for more information.
        </li></ul></div>
</div>
<div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d4e2509"/>55.2. Migrating from 3.0-beta-6 and 3.0-rc-1</h2></div></div></div>
    
    <div class="itemizedlist"><ul><li>
            Form parameters are now read via a provider where earlier they were read from HttpServletRequest.getParameterMap().
            This may break deployments that depend on that behavior, i.e. if you have a servlet filter that calls that very method.
            For those situations I added the switch resteasy.use.container.form.params
        </li><li>
            The JAX-RS TCK has become very strict with a ton more tests.  I can't remember them all, but there are a number
            of edge cases which earlier Resteasy releases misinterpreted.
        </li><li>
            Any Failure exceptions in the SPI now have a corresponding JAX-RS 2.0 exception, so they have been deprecated
            Resteasy no longer uses these old SPI exceptions internally.  It now uses the JAX-RS 2.0 ones.
        </li><li>
            A number of SPIs have changed.  Shouldn't be an issue for those of you who use Restasy as-is.  Specifically
            InjectorFactory and Registry have changed.
        </li></ul></div>
</div>
<div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d4e2516"/>55.3. Migrating from 3.0-beta-5 and 3.0-beta-6</h2></div></div></div>
    
    <div class="itemizedlist"><ul><li>
            The JAX-RS 2.0 TCK has become very very strict in terms of the matching algorithm.  Unfortunately, the matching
            algorithm is quite poor so there are a number of resource schemes that will no longer match.
            For example, resource classes are scanned for a best match, other are ignored in the match.
            Resource locators are not visited unless they are a best match over resource methods.  There is one config switch
            I added so that Resteasy will ignore the Spec defined class expression filtering step and instead match
            base on the full expressions of each JAX-RS method.  resteasy.wider.request.matching.  Set that to true
            and you will at least be able to avoid that.
        </li><li>
            The JAX-RS TCK has become very strict with a ton more tests.  I can't remember them all, but there are a number
            of edge cases which earlier Resteasy releases misinterpreted.
        </li><li>
            Any Failure exceptions in the SPI now have a corresponding JAX-RS 2.0 exception, so they have been deprecated
            Resteasy no longer uses these old SPI exceptions internally.  It now uses the JAX-RS 2.0 ones.
        </li><li>
            A number of SPIs have changed.  Shouldn't be an issue for those of you who use Restasy as-is.  Specifically
            InjectorFactory and Registry have changed.
        </li></ul></div>
</div>
<div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d4e2523"/>55.4. Migrating from 3.0-beta-4 and 3.0-beta-5</h2></div></div></div>
    
    <div class="itemizedlist"><ul><li>
            JSONP support is no longer on by default.  A few users have complained that it is a security hole for their applications.
        </li><li>
            A number of SPIs have changed.  Shouldn't be an issue for those of you who use Restasy as-is.  Specifically
            InjectorFactory and Registry have changed.
        </li></ul></div>
</div>
    <div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d4e2528"/>55.5. Migrating from 3.0-beta-2 and 3.0-beta-4</h2></div></div></div>
    
    <div class="itemizedlist"><ul><li>
            The JAX-RS 2.0 class ClientFactory no longer exists.  It has been replaced with ClientBuilder.  You can
            still call newClient(), but there is now an additional builder interface.  Likewise, there is no
            ResteasyClientFactory.  We also have an extension to ClientBuilder called ResteasyClientBuilder.  So docs
            for more details.
        </li><li>
            Filter execution and exception handling now matches the JAX-RS 2.0 spec.  Exceptions thrown from filters/interceptors
            can now be mapped if possible.  Responses returned from ExceptionMappers are now filtered.
        </li></ul></div>
</div>
<div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d4e2533"/>55.6. Migrating from 3.0-beta-1 and 3.0-beta-2</h2></div></div></div>
    
    <div class="itemizedlist"><ul><li>
            The constructors for ResteasyClient class are no longer public.  You need to use the new ResteasyClientBuilder
            class.  One thing to note is that when a ResteasyClient is created by a builder, it no longer
            uses ResteasyProviderFactory.getInstance(), but instead instantiates a new one.  This will probably
            not effect most uses.
        </li></ul></div>
</div>
<div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d4e2537"/>55.7. Migrating from 2.x to 3.0-beta-1</h2></div></div></div>
    
    <div class="itemizedlist"><ul><li>
            Resteasy manual client API, interceptors, StringConverters, StringParamterConverters, and Async HTTP APIs have all been
            deprecated and will be removed possibly in a later release.  There is now a JAX-RS 2.0 equivalent for each
            of these things.
        </li><li>
            resteasy-crypto: SignedInput and SignedOutput must have a multipart/signed content type set either through
            the request or response object, or by annotation @Consumes/@Produces
        </li><li>
            Server-side cache setup has been changed. Please see documentation for more details.
        </li><li>
            The security filters for @RolesAllowed, etc. now return 403, Forbidden instead of 401.
        </li><li>
            Most add() methods have been removed or made protected in ResteasyProviderFactory.  Use registerProvider() and registerProviderInstance() methods.
        </li><li>
            The new JAX-RS 2.0 client-side filters will not be bound and run when you are using Resteasy's old client api.
        </li><li>
            On server-side, all old Resteasy interceptors can run in parallel with the new JAX-RS 2.0 filter and interceptor
            interfaces.
        </li><li>
            Some SPIs have changed.  This should not effect applications unless you are doing something you aren't supposed
            to do.
        </li><li>
            The async tomcat and async jboss web modules have been removed.  If you are not running under Servlet 3.0,
            async HTTP server-side, will be faked and run synchronously in same request thread.
        </li></ul></div>
</div>
<div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d4e2549"/>55.8. Migrating from 2.3.2 to 2.3.3</h2></div></div></div>
    
    <div class="itemizedlist"><ul><li>
            MultipartInput has a new close() method.  If you have a read body that is MultipartInput or one of
            its subinterfaces, then you must call this method to clean up any temporary files created.  Otherwise,
            these possible temporary files are deleted on GC or JDK shutdown.  Other multipart providers clean up
            automatically.
        </li></ul></div>
</div>
<div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d4e2553"/>55.9. Migrating from 2.3.0 to 2.3.1</h2></div></div></div>
    
    <div class="itemizedlist"><ul><li>
            sjsxp has been removed as a dependency for the Resteasy JAXB provider
        </li></ul></div>
</div>
<div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d4e2557"/>55.10. Migrating from 2.2.x to 2.3</h2></div></div></div>
    
    <div class="itemizedlist"><ul><li>
            The Apache Abdera integration has been removed as a project.  If you want the integration back, please
            ping our dev lists or open a JIRA.
        </li><li>
            Apache Http Client 4.x is now the default underlying client HTTP mechanism.  If there are problems, you
            can change the default mechanism by calling ClientRequest.setDefaultExecutorClass.
        </li><li>
            ClientRequest no longer supports a shared default executor.  The 
            <code class="code">createPerRequestInstance</code> parameter has been removed from
            <code class="methodname">ClientRequest.setDefaultExecutorClass()</code>.
        </li><li>
          resteasy-doseta module no longer exists.  It is now renamed to the resteasy-crypto module and also includes other things beyond doseta.
        </li><li>
          Doseta work has be refactored a bit and may have broken backward compatibility.
        </li><li>
          Jackson has been upgraded from 1.6.3 to 1.8.5.  Let me know if there are any issues.
        </li><li>
          Form parameter processing behavior was modified because of RESTEASY-574.  If you are having problems with form paramater processing on Tomcat after
          this fix, please log a JIRA or contact the resteasy-developers email list.
        </li><li>
	  Some subtle changes were made to ExceptionMapper handling so that you can write ExceptionMappers for any exception thrown internally or within
	  your application.  See JIRA Issue RESTEASY-595 for more details.  This may have an effect on existing applications that have an ExceptionMapper
	  for RuntimeException in that you will start to see Resteasy internal exceptions being caught by this kind of ExceptionMapper.
        </li><li>
            The resteasy-cache (Server-side cache) will now invalidate the cache when a PUT, POST, or DELETE is done on a particular URI.
        </li></ul></div>
</div>
<div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="22_221"/>55.11. Migrating from 2.2.0 to 2.2.1</h2></div></div></div>
    
    <div class="itemizedlist"><ul><li>
	  Had to upgrade JAXB libs from 2.1.x to 2.2.4 as there was a concurrency bug in JAXB impl.
        </li></ul></div>
</div>
<div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="21_22"/>55.12. Migrating from 2.1.x to 2.2</h2></div></div></div>
    
    <div class="itemizedlist"><ul><li>
            ClientRequest.getHeaders() always returns a copy. It also converts the values within
            ClientRequest.getHeadersAsObjects() to string. If you
            add values to the map returned by getHeaders() nothing happen. Instead add values to the
            getHeadersAsObjects() map. This allows non-string header objects
            to propagate through the MessageBodyWriter interceptor and ClientExecutor interceptor chains.
        </li></ul></div>
</div>
<div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="20_21"/>55.13. Migrating from 2.0.x to 2.1</h2></div></div></div>
    
    <div class="itemizedlist"><ul><li>
            Slf4j is no longer the default logging mechanism for resteasy. Resteasy also no longer ships with SLF4J
            libraries. Please read the logging
            section in the Installation and Configuration chapter for more details.
        </li><li>
            The constructor used to instantiate resource and provider classes is now picked based on the requirements of
            the JAX-RS specification.
            Specifically, the public constructor with the most arguments is picked. This behavior varies from previous
            versions where a no-arg
            constructor is preferred.
        </li></ul></div>
</div>
<div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="Migrating_to_Resteasy_12_20"/>55.14. Migrating from 1.2.x to 2.0</h2></div></div></div>
    

    <p>

        </p><div class="itemizedlist"><ul><li>
                TJWS has been forked to fix some bugs. The new groupId is org.jboss.resteasy, the artifactId is
                tjws. It will match the resteasy distribution version
            </li><li>
                Please check out the JBoss 6 integration. It makes things a lot easier if you are deploying in that
                environment
            </li><li>
                There is a new Filter implementation that is the preferred deployment mechanism. Servlet-based
                deployments are still supported, but it is suggested you use to using a FilterDispatcher. See
                documentation for more details.
            </li><li>
                As per required by the spec List or array injection of empty values will return an empty collection
                or array, not null. I.e.
                (@QueryParam("name") List&lt;String&gt; param) param will be an empty List. Resteasy 1.2.x and
                earlier would return null.
            </li><li>
                We have forked TJWS, the servlet container used for embedded testing into the group
                org.jboss.resteasy, with the artifact id of tjws. You will need
                to remove these dependencies from your maven builds if you are using any part of the resteasy
                embeddable server. TJWS has a number of startup/shutdown
                race conditions we had to fix in order to make unit testing viable.
            </li><li>
                Spring integration compiled against Spring 3.0.3. It may or may not still work with 2.5.6 and lower
            </li></ul></div><p>
    </p>
</div>
<div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="migrating_1.2_1.2.1"/>55.15. Migrating from 1.2.GA to 1.2.1.GA</h2></div></div></div>
    
    <p>
        Methods @Deprecated within 1.2.GA have been removed. This is in the Client Framework and has to do with all
        references to Apache HTTP Client. You must now create an ClientExecutor if you want to manage your Apache
        HTTP Client
        sessions.
    </p>
</div>
<div class="sect1" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="Migrating_to_Resteasy_1_1_1_2"/>55.16. Migrating from 1.1 to 1.2</h2></div></div></div>
    

    <p>

        </p><div class="itemizedlist"><ul><li>
                The resteasy-maven-import artifact has been renamed to resteasy-bom
            </li><li>
                Jettison and Fastinfoset have been broken out of the resteasy-jaxb-provider maven module. You will
                now need to include resteasy-jettison-provider or resteasy-fastinfoset-provider if you use either
                of these libraries.
            </li><li>
                The constructors for ClientRequest that have a HttpClient parameter (Apache Http Client 3.1 API) are
                now deprecated. They will be removed in the final release of 1.2. You must create a Apache hTTP
                Client Executor and pass it in as a parameter if you want to re-use existing Apache HttpClient
                sessions or do any special configuration. The same is true for the ProxyFactoyr methods.
            </li><li>
                Apache HttpClient 4.0 support is available if you want to use it. I've had some trouble with it so
                it is not the default implementation yet for the client framework.
            </li><li>
                It is no longer required to call RegisterBuiltin.register() to initialize the set of providers. Too
                many users forgot to do this (include myself!). You can turn this off by calling the static method
                ResteasyProviderFactory.setRegisterBuiltinByDefault(false)
            </li><li>
                The Embedded Container's API has changed to use org.jboss.resteasy.spi.ResteasyDeployment. Please
                see embedded documentation for more details.
            </li></ul></div><p>
    </p>
</div>
</div>

   <div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="REST_BOOKS"/>Chapter 56. Books You Can Read</h2></div></div></div>

<p>There are a number of great books that you can learn REST and JAX-RS from</p>
<div class="itemizedlist"><ul><li>
<a class="ulink" href="http://oreilly.com/catalog/9780596529260/">RESTful Web Services</a> by Leonard Richardson and Sam Ruby.  A great introduction to REST.
</li><li>
<a class="ulink" href="http://oreilly.com/catalog/9780596158040/">RESTful Java with JAX-RS</a> by Bill Burke.  Overview of REST and detailed explanation of JAX-RS.  
Book examples are distributed with RESTEasy.
</li><li>
<a class="ulink" href="http://oreilly.com/catalog/9780596808679/">RESTful Web Services Cookbook</a> by Subbu Allamaraju and Mike Amundsen.  Detailed cookbook on how to design RESTful services.
</li></ul></div>
</div>


</div></body></html>